"use strict";var bp=Object.create;var Zr=Object.defineProperty;var Rp=Object.getOwnPropertyDescriptor;var wp=Object.getOwnPropertyNames;var Ap=Object.getPrototypeOf,Op=Object.prototype.hasOwnProperty;var g=(r,e)=>()=>(e||r((e={exports:{}}).exports,e),e.exports),Mp=(r,e)=>{for(var t in e)Zr(r,t,{get:e[t],enumerable:!0})},Oc=(r,e,t,i)=>{if(e&&typeof e=="object"||typeof e=="function")for(let n of wp(e))!Op.call(r,n)&&n!==t&&Zr(r,n,{get:()=>e[n],enumerable:!(i=Rp(e,n))||i.enumerable});return r};var Qr=(r,e,t)=>(t=r!=null?bp(Ap(r)):{},Oc(e||!r||!r.__esModule?Zr(t,"default",{value:r,enumerable:!0}):t,r)),kp=r=>Oc(Zr({},"__esModule",{value:!0}),r);var z=g(qe=>{"use strict";Object.defineProperty(qe,"__esModule",{value:!0});qe.DEFAULT_MAX_RECEIVE_MESSAGE_LENGTH=qe.DEFAULT_MAX_SEND_MESSAGE_LENGTH=qe.Propagate=qe.LogVerbosity=qe.Status=void 0;var Mc;(function(r){r[r.OK=0]="OK",r[r.CANCELLED=1]="CANCELLED",r[r.UNKNOWN=2]="UNKNOWN",r[r.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",r[r.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",r[r.NOT_FOUND=5]="NOT_FOUND",r[r.ALREADY_EXISTS=6]="ALREADY_EXISTS",r[r.PERMISSION_DENIED=7]="PERMISSION_DENIED",r[r.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",r[r.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",r[r.ABORTED=10]="ABORTED",r[r.OUT_OF_RANGE=11]="OUT_OF_RANGE",r[r.UNIMPLEMENTED=12]="UNIMPLEMENTED",r[r.INTERNAL=13]="INTERNAL",r[r.UNAVAILABLE=14]="UNAVAILABLE",r[r.DATA_LOSS=15]="DATA_LOSS",r[r.UNAUTHENTICATED=16]="UNAUTHENTICATED"})(Mc||(qe.Status=Mc={}));var kc;(function(r){r[r.DEBUG=0]="DEBUG",r[r.INFO=1]="INFO",r[r.ERROR=2]="ERROR",r[r.NONE=3]="NONE"})(kc||(qe.LogVerbosity=kc={}));var Nc;(function(r){r[r.DEADLINE=1]="DEADLINE",r[r.CENSUS_STATS_CONTEXT=2]="CENSUS_STATS_CONTEXT",r[r.CENSUS_TRACING_CONTEXT=4]="CENSUS_TRACING_CONTEXT",r[r.CANCELLATION=8]="CANCELLATION",r[r.DEFAULTS=65535]="DEFAULTS"})(Nc||(qe.Propagate=Nc={}));qe.DEFAULT_MAX_SEND_MESSAGE_LENGTH=-1;qe.DEFAULT_MAX_RECEIVE_MESSAGE_LENGTH=4*1024*1024});var Js=g((eT,Np)=>{Np.exports={name:"@grpc/grpc-js",version:"1.10.10",description:"gRPC Library for Node - pure JS implementation",homepage:"https://grpc.io/",repository:"https://github.com/grpc/grpc-node/tree/master/packages/grpc-js",main:"build/src/index.js",engines:{node:">=12.10.0"},keywords:[],author:{name:"Google Inc."},types:"build/src/index.d.ts",license:"Apache-2.0",devDependencies:{"@types/gulp":"^4.0.17","@types/gulp-mocha":"0.0.37","@types/lodash":"^4.14.202","@types/mocha":"^10.0.6","@types/ncp":"^2.0.8","@types/node":">=20.11.20","@types/pify":"^5.0.4","@types/semver":"^7.5.8","@typescript-eslint/eslint-plugin":"^7.1.0","@typescript-eslint/parser":"^7.1.0","@typescript-eslint/typescript-estree":"^7.1.0","clang-format":"^1.8.0",eslint:"^8.42.0","eslint-config-prettier":"^8.8.0","eslint-plugin-node":"^11.1.0","eslint-plugin-prettier":"^4.2.1",execa:"^2.0.3",gulp:"^4.0.2","gulp-mocha":"^6.0.0",lodash:"^4.17.21",madge:"^5.0.1","mocha-jenkins-reporter":"^0.4.1",ncp:"^2.0.0",pify:"^4.0.1",prettier:"^2.8.8",rimraf:"^3.0.2",semver:"^7.6.0","ts-node":"^10.9.2",typescript:"^5.3.3"},contributors:[{name:"Google Inc."}],scripts:{build:"npm run compile",clean:"rimraf ./build",compile:"tsc -p .",format:'clang-format -i -style="{Language: JavaScript, BasedOnStyle: Google, ColumnLimit: 80}" src/*.ts test/*.ts',lint:"eslint src/*.ts test/*.ts",prepare:"npm run generate-types && npm run compile",test:"gulp test",check:"npm run lint",fix:"eslint --fix src/*.ts test/*.ts",pretest:"npm run generate-types && npm run generate-test-types && npm run compile",posttest:"npm run check && madge -c ./build/src","generate-types":"proto-loader-gen-types --keepCase --longs String --enums String --defaults --oneofs --includeComments --includeDirs proto/ --include-dirs test/fixtures/ -O src/generated/ --grpcLib ../index channelz.proto","generate-test-types":"proto-loader-gen-types --keepCase --longs String --enums String --defaults --oneofs --includeComments --include-dirs test/fixtures/ -O test/generated/ --grpcLib ../../src/index test_service.proto"},dependencies:{"@grpc/proto-loader":"^0.7.13","@js-sdsl/ordered-map":"^4.4.2"},files:["src/**/*.ts","build/src/**/*.{js,d.ts,js.map}","proto/*.proto","LICENSE","deps/envoy-api/envoy/api/v2/**/*.proto","deps/envoy-api/envoy/config/**/*.proto","deps/envoy-api/envoy/service/**/*.proto","deps/envoy-api/envoy/type/**/*.proto","deps/udpa/udpa/**/*.proto","deps/googleapis/google/api/*.proto","deps/googleapis/google/rpc/*.proto","deps/protoc-gen-validate/validate/**/*.proto"]}});var te=g(be=>{"use strict";var Xs,Zs,Qs,ea;Object.defineProperty(be,"__esModule",{value:!0});be.isTracerEnabled=be.trace=be.log=be.setLoggerVerbosity=be.setLogger=be.getLogger=void 0;var Nt=z(),Pp=require("process"),Ip=Js().version,xp={error:(r,...e)=>{console.error("E "+r,...e)},info:(r,...e)=>{console.error("I "+r,...e)},debug:(r,...e)=>{console.error("D "+r,...e)}},ri=xp,Ci=Nt.LogVerbosity.ERROR,Dp=(Zs=(Xs=process.env.GRPC_NODE_VERBOSITY)!==null&&Xs!==void 0?Xs:process.env.GRPC_VERBOSITY)!==null&&Zs!==void 0?Zs:"";switch(Dp.toUpperCase()){case"DEBUG":Ci=Nt.LogVerbosity.DEBUG;break;case"INFO":Ci=Nt.LogVerbosity.INFO;break;case"ERROR":Ci=Nt.LogVerbosity.ERROR;break;case"NONE":Ci=Nt.LogVerbosity.NONE;break;default:}var Lp=()=>ri;be.getLogger=Lp;var Fp=r=>{ri=r};be.setLogger=Fp;var qp=r=>{Ci=r};be.setLoggerVerbosity=qp;var Bp=(r,...e)=>{let t;if(r>=Ci){switch(r){case Nt.LogVerbosity.DEBUG:t=ri.debug;break;case Nt.LogVerbosity.INFO:t=ri.info;break;case Nt.LogVerbosity.ERROR:t=ri.error;break}t||(t=ri.error),t&&t.bind(ri)(...e)}};be.log=Bp;var Up=(ea=(Qs=process.env.GRPC_NODE_TRACE)!==null&&Qs!==void 0?Qs:process.env.GRPC_TRACE)!==null&&ea!==void 0?ea:"",ta=new Set,Pc=new Set;for(let r of Up.split(","))r.startsWith("-")?Pc.add(r.substring(1)):ta.add(r);var zp=ta.has("all");function Hp(r,e,t){Ic(e)&&(0,be.log)(r,new Date().toISOString()+" | v"+Ip+" "+Pp.pid+" | "+e+" | "+t)}be.trace=Hp;function Ic(r){return!Pc.has(r)&&(zp||ta.has(r))}be.isTracerEnabled=Ic});var en=g(Ti=>{"use strict";Object.defineProperty(Ti,"__esModule",{value:!0});Ti.getErrorCode=Ti.getErrorMessage=void 0;function jp(r){return r instanceof Error?r.message:String(r)}Ti.getErrorMessage=jp;function Gp(r){return typeof r=="object"&&r!==null&&"code"in r&&typeof r.code=="number"?r.code:null}Ti.getErrorCode=Gp});var Re=g(rn=>{"use strict";Object.defineProperty(rn,"__esModule",{value:!0});rn.Metadata=void 0;var Wp=te(),$p=z(),Vp=en(),Yp=/^[0-9a-z_.-]+$/,Kp=/^[ -~]*$/;function Jp(r){return Yp.test(r)}function Xp(r){return Kp.test(r)}function Dc(r){return r.endsWith("-bin")}function Zp(r){return!r.startsWith("grpc-")}function tn(r){return r.toLowerCase()}function xc(r,e){if(!Jp(r))throw new Error('Metadata key "'+r+'" contains illegal characters');if(e!=null)if(Dc(r)){if(!Buffer.isBuffer(e))throw new Error("keys that end with '-bin' must have Buffer values")}else{if(Buffer.isBuffer(e))throw new Error("keys that don't end with '-bin' must have String values");if(!Xp(e))throw new Error('Metadata string value "'+e+'" contains illegal characters')}}var Ei=class{constructor(e={}){this.internalRepr=new Map,this.options=e}set(e,t){e=tn(e),xc(e,t),this.internalRepr.set(e,[t])}add(e,t){e=tn(e),xc(e,t);let i=this.internalRepr.get(e);i===void 0?this.internalRepr.set(e,[t]):i.push(t)}remove(e){e=tn(e),this.internalRepr.delete(e)}get(e){return e=tn(e),this.internalRepr.get(e)||[]}getMap(){let e={};for(let[t,i]of this.internalRepr)if(i.length>0){let n=i[0];e[t]=Buffer.isBuffer(n)?Buffer.from(n):n}return e}clone(){let e=new Ei(this.options),t=e.internalRepr;for(let[i,n]of this.internalRepr){let s=n.map(a=>Buffer.isBuffer(a)?Buffer.from(a):a);t.set(i,s)}return e}merge(e){for(let[t,i]of e.internalRepr){let n=(this.internalRepr.get(t)||[]).concat(i);this.internalRepr.set(t,n)}}setOptions(e){this.options=e}getOptions(){return this.options}toHttp2Headers(){let e={};for(let[t,i]of this.internalRepr)e[t]=i.map(Qp);return e}toJSON(){let e={};for(let[t,i]of this.internalRepr)e[t]=i;return e}static fromHttp2Headers(e){let t=new Ei;for(let i of Object.keys(e)){if(i.charAt(0)===":")continue;let n=e[i];try{Dc(i)?Array.isArray(n)?n.forEach(s=>{t.add(i,Buffer.from(s,"base64"))}):n!==void 0&&(Zp(i)?n.split(",").forEach(s=>{t.add(i,Buffer.from(s.trim(),"base64"))}):t.add(i,Buffer.from(n,"base64"))):Array.isArray(n)?n.forEach(s=>{t.add(i,s)}):n!==void 0&&t.add(i,n)}catch(s){let a=`Failed to add metadata entry ${i}: ${n}. ${(0,Vp.getErrorMessage)(s)}. For more information see https://github.com/grpc/grpc-node/issues/1173`;(0,Wp.log)($p.LogVerbosity.ERROR,a)}}return t}};rn.Metadata=Ei;var Qp=r=>Buffer.isBuffer(r)?r.toString("base64"):r});var ra=g(nn=>{"use strict";Object.defineProperty(nn,"__esModule",{value:!0});nn.CallCredentials=void 0;var ia=Re();function eg(r){return"getRequestHeaders"in r&&typeof r.getRequestHeaders=="function"}var Pt=class{static createFromMetadataGenerator(e){return new ur(e)}static createFromGoogleCredential(e){return Pt.createFromMetadataGenerator((t,i)=>{let n;eg(e)?n=e.getRequestHeaders(t.service_url):n=new Promise((s,a)=>{e.getRequestMetadata(t.service_url,(o,l)=>{if(o){a(o);return}if(!l){a(new Error("Headers not set by metadata plugin"));return}s(l)})}),n.then(s=>{let a=new ia.Metadata;for(let o of Object.keys(s))a.add(o,s[o]);i(null,a)},s=>{i(s)})})}static createEmpty(){return new dr}};nn.CallCredentials=Pt;var bi=class extends Pt{constructor(e){super(),this.creds=e}async generateMetadata(e){let t=new ia.Metadata,i=await Promise.all(this.creds.map(n=>n.generateMetadata(e)));for(let n of i)t.merge(n);return t}compose(e){return new bi(this.creds.concat([e]))}_equals(e){return this===e?!0:e instanceof bi?this.creds.every((t,i)=>t._equals(e.creds[i])):!1}},ur=class extends Pt{constructor(e){super(),this.metadataGenerator=e}generateMetadata(e){return new Promise((t,i)=>{this.metadataGenerator(e,(n,s)=>{s!==void 0?t(s):i(n)})})}compose(e){return new bi([this,e])}_equals(e){return this===e?!0:e instanceof ur?this.metadataGenerator===e.metadataGenerator:!1}},dr=class extends Pt{generateMetadata(e){return Promise.resolve(new ia.Metadata)}compose(e){return e}_equals(e){return e instanceof dr}}});var sa=g(Ri=>{"use strict";Object.defineProperty(Ri,"__esModule",{value:!0});Ri.getDefaultRootsData=Ri.CIPHER_SUITES=void 0;var tg=require("fs");Ri.CIPHER_SUITES=process.env.GRPC_SSL_CIPHER_SUITES;var Lc=process.env.GRPC_DEFAULT_SSL_ROOTS_FILE_PATH,na=null;function ig(){return Lc?(na===null&&(na=tg.readFileSync(Lc)),na):null}Ri.getDefaultRootsData=ig});var an=g(sn=>{"use strict";Object.defineProperty(sn,"__esModule",{value:!0});sn.ChannelCredentials=void 0;var rg=require("tls"),ng=ra(),Fc=sa();function aa(r,e){if(r&&!(r instanceof Buffer))throw new TypeError(`${e}, if provided, must be a Buffer.`)}var wi=class{constructor(e){this.callCredentials=e||ng.CallCredentials.createEmpty()}_getCallCredentials(){return this.callCredentials}static createSsl(e,t,i,n){var s;if(aa(e,"Root certificate"),aa(t,"Private key"),aa(i,"Certificate chain"),t&&!i)throw new Error("Private key must be given with accompanying certificate chain");if(!t&&i)throw new Error("Certificate chain must be given with accompanying private key");let a=(0,rg.createSecureContext)({ca:(s=e??(0,Fc.getDefaultRootsData)())!==null&&s!==void 0?s:void 0,key:t??void 0,cert:i??void 0,ciphers:Fc.CIPHER_SUITES});return new Ai(a,n??{})}static createFromSecureContext(e,t){return new Ai(e,t??{})}static createInsecure(){return new hr}};sn.ChannelCredentials=wi;var hr=class extends wi{constructor(){super()}compose(e){throw new Error("Cannot compose insecure credentials")}_getConnectionOptions(){return null}_isSecure(){return!1}_equals(e){return e instanceof hr}},Ai=class extends wi{constructor(e,t){super(),this.secureContext=e,this.verifyOptions=t,this.connectionOptions={secureContext:e},t?.checkServerIdentity&&(this.connectionOptions.checkServerIdentity=t.checkServerIdentity)}compose(e){let t=this.callCredentials.compose(e);return new Oi(this,t)}_getConnectionOptions(){return Object.assign({},this.connectionOptions)}_isSecure(){return!0}_equals(e){return this===e?!0:e instanceof Ai?this.secureContext===e.secureContext&&this.verifyOptions.checkServerIdentity===e.verifyOptions.checkServerIdentity:!1}},Oi=class extends wi{constructor(e,t){super(t),this.channelCredentials=e}compose(e){let t=this.callCredentials.compose(e);return new Oi(this.channelCredentials,t)}_getConnectionOptions(){return this.channelCredentials._getConnectionOptions()}_isSecure(){return!0}_equals(e){return this===e?!0:e instanceof Oi?this.channelCredentials._equals(e.channelCredentials)&&this.callCredentials._equals(e.callCredentials):!1}}});var ni=g(fe=>{"use strict";Object.defineProperty(fe,"__esModule",{value:!0});fe.selectLbConfigFromList=fe.getDefaultConfig=fe.parseLoadBalancingConfig=fe.isLoadBalancerNameRegistered=fe.createLoadBalancer=fe.registerDefaultLoadBalancerType=fe.registerLoadBalancerType=fe.createChildChannelControlHelper=void 0;var sg=te(),ag=z();function og(r,e){var t,i,n,s,a,o,l,c,u,h;return{createSubchannel:(i=(t=e.createSubchannel)===null||t===void 0?void 0:t.bind(e))!==null&&i!==void 0?i:r.createSubchannel.bind(r),updateState:(s=(n=e.updateState)===null||n===void 0?void 0:n.bind(e))!==null&&s!==void 0?s:r.updateState.bind(r),requestReresolution:(o=(a=e.requestReresolution)===null||a===void 0?void 0:a.bind(e))!==null&&o!==void 0?o:r.requestReresolution.bind(r),addChannelzChild:(c=(l=e.addChannelzChild)===null||l===void 0?void 0:l.bind(e))!==null&&c!==void 0?c:r.addChannelzChild.bind(r),removeChannelzChild:(h=(u=e.removeChannelzChild)===null||u===void 0?void 0:u.bind(e))!==null&&h!==void 0?h:r.removeChannelzChild.bind(r)}}fe.createChildChannelControlHelper=og;var It={},fr=null;function lg(r,e,t){It[r]={LoadBalancer:e,LoadBalancingConfig:t}}fe.registerLoadBalancerType=lg;function cg(r){fr=r}fe.registerDefaultLoadBalancerType=cg;function ug(r,e,t){let i=r.getLoadBalancerName();return i in It?new It[i].LoadBalancer(e,t):null}fe.createLoadBalancer=ug;function dg(r){return r in It}fe.isLoadBalancerNameRegistered=dg;function qc(r){let e=Object.keys(r);if(e.length!==1)throw new Error("Provided load balancing config has multiple conflicting entries");let t=e[0];if(t in It)try{return It[t].LoadBalancingConfig.createFromJson(r[t])}catch(i){throw new Error(`${t}: ${i.message}`)}else throw new Error(`Unrecognized load balancing config name ${t}`)}fe.parseLoadBalancingConfig=qc;function hg(){if(!fr)throw new Error("No default load balancer type registered");return new It[fr].LoadBalancingConfig}fe.getDefaultConfig=hg;function fg(r,e=!1){for(let t of r)try{return qc(t)}catch(i){(0,sg.log)(ag.LogVerbosity.DEBUG,"Config parsing failed with error",i.message);continue}return e&&fr?new It[fr].LoadBalancingConfig:null}fe.selectLbConfigFromList=fg});var oa=g(xt=>{"use strict";Object.defineProperty(xt,"__esModule",{value:!0});xt.extractAndSelectServiceConfig=xt.validateServiceConfig=xt.validateRetryThrottling=void 0;var pg=require("os"),on=z(),ln=/^\d+(\.\d{1,9})?s$/,gg="node";function mg(r){if("service"in r&&r.service!==""){if(typeof r.service!="string")throw new Error(`Invalid method config name: invalid service: expected type string, got ${typeof r.service}`);if("method"in r&&r.method!==""){if(typeof r.method!="string")throw new Error(`Invalid method config name: invalid method: expected type string, got ${typeof r.service}`);return{service:r.service,method:r.method}}else return{service:r.service}}else{if("method"in r&&r.method!==void 0)throw new Error("Invalid method config name: method set with empty or unset service");return{}}}function vg(r){if(!("maxAttempts"in r)||!Number.isInteger(r.maxAttempts)||r.maxAttempts<2)throw new Error("Invalid method config retry policy: maxAttempts must be an integer at least 2");if(!("initialBackoff"in r)||typeof r.initialBackoff!="string"||!ln.test(r.initialBackoff))throw new Error("Invalid method config retry policy: initialBackoff must be a string consisting of a positive integer followed by s");if(!("maxBackoff"in r)||typeof r.maxBackoff!="string"||!ln.test(r.maxBackoff))throw new Error("Invalid method config retry policy: maxBackoff must be a string consisting of a positive integer followed by s");if(!("backoffMultiplier"in r)||typeof r.backoffMultiplier!="number"||r.backoffMultiplier<=0)throw new Error("Invalid method config retry policy: backoffMultiplier must be a number greater than 0");if(!("retryableStatusCodes"in r&&Array.isArray(r.retryableStatusCodes)))throw new Error("Invalid method config retry policy: retryableStatusCodes is required");if(r.retryableStatusCodes.length===0)throw new Error("Invalid method config retry policy: retryableStatusCodes must be non-empty");for(let e of r.retryableStatusCodes)if(typeof e=="number"){if(!Object.values(on.Status).includes(e))throw new Error("Invalid method config retry policy: retryableStatusCodes value not in status code range")}else if(typeof e=="string"){if(!Object.values(on.Status).includes(e.toUpperCase()))throw new Error("Invalid method config retry policy: retryableStatusCodes value not a status code name")}else throw new Error("Invalid method config retry policy: retryableStatusCodes value must be a string or number");return{maxAttempts:r.maxAttempts,initialBackoff:r.initialBackoff,maxBackoff:r.maxBackoff,backoffMultiplier:r.backoffMultiplier,retryableStatusCodes:r.retryableStatusCodes}}function yg(r){if(!("maxAttempts"in r)||!Number.isInteger(r.maxAttempts)||r.maxAttempts<2)throw new Error("Invalid method config hedging policy: maxAttempts must be an integer at least 2");if("hedgingDelay"in r&&(typeof r.hedgingDelay!="string"||!ln.test(r.hedgingDelay)))throw new Error("Invalid method config hedging policy: hedgingDelay must be a string consisting of a positive integer followed by s");if("nonFatalStatusCodes"in r&&Array.isArray(r.nonFatalStatusCodes))for(let t of r.nonFatalStatusCodes)if(typeof t=="number"){if(!Object.values(on.Status).includes(t))throw new Error("Invlid method config hedging policy: nonFatalStatusCodes value not in status code range")}else if(typeof t=="string"){if(!Object.values(on.Status).includes(t.toUpperCase()))throw new Error("Invlid method config hedging policy: nonFatalStatusCodes value not a status code name")}else throw new Error("Invlid method config hedging policy: nonFatalStatusCodes value must be a string or number");let e={maxAttempts:r.maxAttempts};return r.hedgingDelay&&(e.hedgingDelay=r.hedgingDelay),r.nonFatalStatusCodes&&(e.nonFatalStatusCodes=r.nonFatalStatusCodes),e}function Sg(r){var e;let t={name:[]};if(!("name"in r)||!Array.isArray(r.name))throw new Error("Invalid method config: invalid name array");for(let i of r.name)t.name.push(mg(i));if("waitForReady"in r){if(typeof r.waitForReady!="boolean")throw new Error("Invalid method config: invalid waitForReady");t.waitForReady=r.waitForReady}if("timeout"in r)if(typeof r.timeout=="object"){if(!("seconds"in r.timeout)||typeof r.timeout.seconds!="number")throw new Error("Invalid method config: invalid timeout.seconds");if(!("nanos"in r.timeout)||typeof r.timeout.nanos!="number")throw new Error("Invalid method config: invalid timeout.nanos");t.timeout=r.timeout}else if(typeof r.timeout=="string"&&ln.test(r.timeout)){let i=r.timeout.substring(0,r.timeout.length-1).split(".");t.timeout={seconds:i[0]|0,nanos:((e=i[1])!==null&&e!==void 0?e:0)|0}}else throw new Error("Invalid method config: invalid timeout");if("maxRequestBytes"in r){if(typeof r.maxRequestBytes!="number")throw new Error("Invalid method config: invalid maxRequestBytes");t.maxRequestBytes=r.maxRequestBytes}if("maxResponseBytes"in r){if(typeof r.maxResponseBytes!="number")throw new Error("Invalid method config: invalid maxRequestBytes");t.maxResponseBytes=r.maxResponseBytes}if("retryPolicy"in r){if("hedgingPolicy"in r)throw new Error("Invalid method config: retryPolicy and hedgingPolicy cannot both be specified");t.retryPolicy=vg(r.retryPolicy)}else"hedgingPolicy"in r&&(t.hedgingPolicy=yg(r.hedgingPolicy));return t}function Bc(r){if(!("maxTokens"in r)||typeof r.maxTokens!="number"||r.maxTokens<=0||r.maxTokens>1e3)throw new Error("Invalid retryThrottling: maxTokens must be a number in (0, 1000]");if(!("tokenRatio"in r)||typeof r.tokenRatio!="number"||r.tokenRatio<=0)throw new Error("Invalid retryThrottling: tokenRatio must be a number greater than 0");return{maxTokens:+r.maxTokens.toFixed(3),tokenRatio:+r.tokenRatio.toFixed(3)}}xt.validateRetryThrottling=Bc;function _g(r){if(!(typeof r=="object"&&r!==null))throw new Error(`Invalid loadBalancingConfig: unexpected type ${typeof r}`);let e=Object.keys(r);if(e.length>1)throw new Error(`Invalid loadBalancingConfig: unexpected multiple keys ${e}`);if(e.length===0)throw new Error("Invalid loadBalancingConfig: load balancing policy name required");return{[e[0]]:r[e[0]]}}function Uc(r){let e={loadBalancingConfig:[],methodConfig:[]};if("loadBalancingPolicy"in r)if(typeof r.loadBalancingPolicy=="string")e.loadBalancingPolicy=r.loadBalancingPolicy;else throw new Error("Invalid service config: invalid loadBalancingPolicy");if("loadBalancingConfig"in r)if(Array.isArray(r.loadBalancingConfig))for(let i of r.loadBalancingConfig)e.loadBalancingConfig.push(_g(i));else throw new Error("Invalid service config: invalid loadBalancingConfig");if("methodConfig"in r&&Array.isArray(r.methodConfig))for(let i of r.methodConfig)e.methodConfig.push(Sg(i));"retryThrottling"in r&&(e.retryThrottling=Bc(r.retryThrottling));let t=[];for(let i of e.methodConfig)for(let n of i.name){for(let s of t)if(n.service===s.service&&n.method===s.method)throw new Error(`Invalid service config: duplicate name ${n.service}/${n.method}`);t.push(n)}return e}xt.validateServiceConfig=Uc;function Cg(r){if(!("serviceConfig"in r))throw new Error("Invalid service config choice: missing service config");let e={serviceConfig:Uc(r.serviceConfig)};if("clientLanguage"in r)if(Array.isArray(r.clientLanguage)){e.clientLanguage=[];for(let i of r.clientLanguage)if(typeof i=="string")e.clientLanguage.push(i);else throw new Error("Invalid service config choice: invalid clientLanguage")}else throw new Error("Invalid service config choice: invalid clientLanguage");if("clientHostname"in r)if(Array.isArray(r.clientHostname)){e.clientHostname=[];for(let i of r.clientHostname)if(typeof i=="string")e.clientHostname.push(i);else throw new Error("Invalid service config choice: invalid clientHostname")}else throw new Error("Invalid service config choice: invalid clientHostname");if("percentage"in r)if(typeof r.percentage=="number"&&0<=r.percentage&&r.percentage<=100)e.percentage=r.percentage;else throw new Error("Invalid service config choice: invalid percentage");let t=["clientLanguage","percentage","clientHostname","serviceConfig"];for(let i in r)if(!t.includes(i))throw new Error(`Invalid service config choice: unexpected field ${i}`);return e}function Tg(r,e){if(!Array.isArray(r))throw new Error("Invalid service config list");for(let t of r){let i=Cg(t);if(!(typeof i.percentage=="number"&&e>i.percentage)){if(Array.isArray(i.clientHostname)){let n=!1;for(let s of i.clientHostname)s===pg.hostname()&&(n=!0);if(!n)continue}if(Array.isArray(i.clientLanguage)){let n=!1;for(let s of i.clientLanguage)s===gg&&(n=!0);if(!n)continue}return i.serviceConfig}}throw new Error("No matching service config found")}function Eg(r,e){for(let t of r)if(t.length>0&&t[0].startsWith("grpc_config=")){let i=t.join("").substring(12),n=JSON.parse(i);return Tg(n,e)}return null}xt.extractAndSelectServiceConfig=Eg});var Be=g(cn=>{"use strict";Object.defineProperty(cn,"__esModule",{value:!0});cn.ConnectivityState=void 0;var zc;(function(r){r[r.IDLE=0]="IDLE",r[r.CONNECTING=1]="CONNECTING",r[r.READY=2]="READY",r[r.TRANSIENT_FAILURE=3]="TRANSIENT_FAILURE",r[r.SHUTDOWN=4]="SHUTDOWN"})(zc||(cn.ConnectivityState=zc={}))});var Pe=g(at=>{"use strict";Object.defineProperty(at,"__esModule",{value:!0});at.uriToString=at.combineHostPort=at.splitHostPort=at.parseUri=void 0;var bg=/^(?:([A-Za-z0-9+.-]+):)?(?:\/\/([^/]*)\/)?(.+)$/;function Rg(r){let e=bg.exec(r);return e===null?null:{scheme:e[1],authority:e[2],path:e[3]}}at.parseUri=Rg;var Hc=/^\d+$/;function wg(r){if(r.startsWith("[")){let e=r.indexOf("]");if(e===-1)return null;let t=r.substring(1,e);if(t.indexOf(":")===-1)return null;if(r.length>e+1)if(r[e+1]===":"){let i=r.substring(e+2);return Hc.test(i)?{host:t,port:+i}:null}else return null;else return{host:t}}else{let e=r.split(":");return e.length===2?Hc.test(e[1])?{host:e[0],port:+e[1]}:null:{host:r}}}at.splitHostPort=wg;function Ag(r){return r.port===void 0?r.host:r.host.includes(":")?`[${r.host}]:${r.port}`:`${r.host}:${r.port}`}at.combineHostPort=Ag;function Og(r){let e="";return r.scheme!==void 0&&(e+=r.scheme+":"),r.authority!==void 0&&(e+="//"+r.authority+"/"),e+=r.path,e}at.uriToString=Og});var ot=g(Ue=>{"use strict";Object.defineProperty(Ue,"__esModule",{value:!0});Ue.mapUriDefaultScheme=Ue.getDefaultAuthority=Ue.createResolver=Ue.registerDefaultScheme=Ue.registerResolver=void 0;var ca=Pe(),Mi={},la=null;function Mg(r,e){Mi[r]=e}Ue.registerResolver=Mg;function kg(r){la=r}Ue.registerDefaultScheme=kg;function Ng(r,e,t){if(r.scheme!==void 0&&r.scheme in Mi)return new Mi[r.scheme](r,e,t);throw new Error(`No resolver could be created for target ${(0,ca.uriToString)(r)}`)}Ue.createResolver=Ng;function Pg(r){if(r.scheme!==void 0&&r.scheme in Mi)return Mi[r.scheme].getDefaultAuthority(r);throw new Error(`Invalid target ${(0,ca.uriToString)(r)}`)}Ue.getDefaultAuthority=Pg;function Ig(r){return r.scheme===void 0||!(r.scheme in Mi)?la!==null?{scheme:la,authority:void 0,path:(0,ca.uriToString)(r)}:null:r}Ue.mapUriDefaultScheme=Ig});var Lt=g(Dt=>{"use strict";Object.defineProperty(Dt,"__esModule",{value:!0});Dt.QueuePicker=Dt.UnavailablePicker=Dt.PickResultType=void 0;var xg=Re(),Dg=z(),un;(function(r){r[r.COMPLETE=0]="COMPLETE",r[r.QUEUE=1]="QUEUE",r[r.TRANSIENT_FAILURE=2]="TRANSIENT_FAILURE",r[r.DROP=3]="DROP"})(un||(Dt.PickResultType=un={}));var ua=class{constructor(e){this.status=Object.assign({code:Dg.Status.UNAVAILABLE,details:"No connection established",metadata:new xg.Metadata},e)}pick(e){return{pickResultType:un.TRANSIENT_FAILURE,subchannel:null,status:this.status,onCallStarted:null,onCallEnded:null}}};Dt.UnavailablePicker=ua;var da=class{constructor(e,t){this.loadBalancer=e,this.childPicker=t,this.calledExitIdle=!1}pick(e){return this.calledExitIdle||(process.nextTick(()=>{this.loadBalancer.exitIdle()}),this.calledExitIdle=!0),this.childPicker?this.childPicker.pick(e):{pickResultType:un.QUEUE,subchannel:null,status:null,onCallStarted:null,onCallEnded:null}}};Dt.QueuePicker=da});var pr=g(dn=>{"use strict";Object.defineProperty(dn,"__esModule",{value:!0});dn.BackoffTimeout=void 0;var Lg=1e3,Fg=1.6,qg=12e4,Bg=.2;function Ug(r,e){return Math.random()*(e-r)+r}var ha=class{constructor(e,t){this.callback=e,this.initialDelay=Lg,this.multiplier=Fg,this.maxDelay=qg,this.jitter=Bg,this.running=!1,this.hasRef=!0,this.startTime=new Date,this.endTime=new Date,t&&(t.initialDelay&&(this.initialDelay=t.initialDelay),t.multiplier&&(this.multiplier=t.multiplier),t.jitter&&(this.jitter=t.jitter),t.maxDelay&&(this.maxDelay=t.maxDelay)),this.nextDelay=this.initialDelay,this.timerId=setTimeout(()=>{},0),clearTimeout(this.timerId)}runTimer(e){var t,i;this.endTime=this.startTime,this.endTime.setMilliseconds(this.endTime.getMilliseconds()+this.nextDelay),clearTimeout(this.timerId),this.timerId=setTimeout(()=>{this.callback(),this.running=!1},e),this.hasRef||(i=(t=this.timerId).unref)===null||i===void 0||i.call(t)}runOnce(){this.running=!0,this.startTime=new Date,this.runTimer(this.nextDelay);let e=Math.min(this.nextDelay*this.multiplier,this.maxDelay),t=e*this.jitter;this.nextDelay=e+Ug(-t,t)}stop(){clearTimeout(this.timerId),this.running=!1}reset(){if(this.nextDelay=this.initialDelay,this.running){let e=new Date,t=this.startTime;t.setMilliseconds(t.getMilliseconds()+this.nextDelay),clearTimeout(this.timerId),e<t?this.runTimer(t.getTime()-e.getTime()):this.running=!1}}isRunning(){return this.running}ref(){var e,t;this.hasRef=!0,(t=(e=this.timerId).ref)===null||t===void 0||t.call(e)}unref(){var e,t;this.hasRef=!1,(t=(e=this.timerId).unref)===null||t===void 0||t.call(e)}getEndTime(){return this.endTime}};dn.BackoffTimeout=ha});var fn=g(hn=>{"use strict";Object.defineProperty(hn,"__esModule",{value:!0});hn.ChildLoadBalancerHandler=void 0;var zg=ni(),Hg=Be(),jg="child_load_balancer_helper",fa=class{constructor(e,t){this.channelControlHelper=e,this.options=t,this.currentChild=null,this.pendingChild=null,this.latestConfig=null,this.ChildPolicyHelper=class{constructor(i){this.parent=i,this.child=null}createSubchannel(i,n){return this.parent.channelControlHelper.createSubchannel(i,n)}updateState(i,n){var s;if(this.calledByPendingChild()){if(i===Hg.ConnectivityState.CONNECTING)return;(s=this.parent.currentChild)===null||s===void 0||s.destroy(),this.parent.currentChild=this.parent.pendingChild,this.parent.pendingChild=null}else if(!this.calledByCurrentChild())return;this.parent.channelControlHelper.updateState(i,n)}requestReresolution(){var i;let n=(i=this.parent.pendingChild)!==null&&i!==void 0?i:this.parent.currentChild;this.child===n&&this.parent.channelControlHelper.requestReresolution()}setChild(i){this.child=i}addChannelzChild(i){this.parent.channelControlHelper.addChannelzChild(i)}removeChannelzChild(i){this.parent.channelControlHelper.removeChannelzChild(i)}calledByPendingChild(){return this.child===this.parent.pendingChild}calledByCurrentChild(){return this.child===this.parent.currentChild}}}configUpdateRequiresNewPolicyInstance(e,t){return e.getLoadBalancerName()!==t.getLoadBalancerName()}updateAddressList(e,t,i){let n;if(this.currentChild===null||this.latestConfig===null||this.configUpdateRequiresNewPolicyInstance(this.latestConfig,t)){let s=new this.ChildPolicyHelper(this),a=(0,zg.createLoadBalancer)(t,s,this.options);s.setChild(a),this.currentChild===null?(this.currentChild=a,n=this.currentChild):(this.pendingChild&&this.pendingChild.destroy(),this.pendingChild=a,n=this.pendingChild)}else this.pendingChild===null?n=this.currentChild:n=this.pendingChild;this.latestConfig=t,n.updateAddressList(e,t,i)}exitIdle(){this.currentChild&&(this.currentChild.exitIdle(),this.pendingChild&&this.pendingChild.exitIdle())}resetBackoff(){this.currentChild&&(this.currentChild.resetBackoff(),this.pendingChild&&this.pendingChild.resetBackoff())}destroy(){this.currentChild&&(this.currentChild.destroy(),this.currentChild=null),this.pendingChild&&(this.pendingChild.destroy(),this.pendingChild=null)}getTypeName(){return jg}};hn.ChildLoadBalancerHandler=fa});var Gc=g(pn=>{"use strict";Object.defineProperty(pn,"__esModule",{value:!0});pn.ResolvingLoadBalancer=void 0;var Gg=ni(),Wg=oa(),Ae=Be(),$g=ot(),gr=Lt(),Vg=pr(),pa=z(),Yg=Re(),Kg=te(),Jg=z(),Xg=Pe(),Zg=fn(),Qg="resolving_load_balancer";function jc(r){Kg.trace(Jg.LogVerbosity.DEBUG,Qg,r)}var em=["SERVICE_AND_METHOD","SERVICE","EMPTY"];function tm(r,e,t,i){for(let n of t.name)switch(i){case"EMPTY":if(!n.service&&!n.method)return!0;break;case"SERVICE":if(n.service===r&&!n.method)return!0;break;case"SERVICE_AND_METHOD":if(n.service===r&&n.method===e)return!0}return!1}function im(r,e,t,i){for(let n of t)if(tm(r,e,n,i))return n;return null}function rm(r){return function(t,i){var n,s;let a=t.split("/").filter(c=>c.length>0),o=(n=a[0])!==null&&n!==void 0?n:"",l=(s=a[1])!==null&&s!==void 0?s:"";if(r&&r.methodConfig)for(let c of em){let u=im(o,l,r.methodConfig,c);if(u)return{methodConfig:u,pickInformation:{},status:pa.Status.OK,dynamicFilterFactories:[]}}return{methodConfig:{name:[]},pickInformation:{},status:pa.Status.OK,dynamicFilterFactories:[]}}}var ga=class{constructor(e,t,i,n,s){this.target=e,this.channelControlHelper=t,this.onSuccessfulResolution=n,this.onFailedResolution=s,this.latestChildState=Ae.ConnectivityState.IDLE,this.latestChildPicker=new gr.QueuePicker(this),this.currentState=Ae.ConnectivityState.IDLE,this.previousServiceConfig=null,this.continueResolving=!1,i["grpc.service_config"]?this.defaultServiceConfig=(0,Wg.validateServiceConfig)(JSON.parse(i["grpc.service_config"])):this.defaultServiceConfig={loadBalancingConfig:[],methodConfig:[]},this.updateState(Ae.ConnectivityState.IDLE,new gr.QueuePicker(this)),this.childLoadBalancer=new Zg.ChildLoadBalancerHandler({createSubchannel:t.createSubchannel.bind(t),requestReresolution:()=>{this.backoffTimeout.isRunning()?(jc("requestReresolution delayed by backoff timer until "+this.backoffTimeout.getEndTime().toISOString()),this.continueResolving=!0):this.updateResolution()},updateState:(o,l)=>{this.latestChildState=o,this.latestChildPicker=l,this.updateState(o,l)},addChannelzChild:t.addChannelzChild.bind(t),removeChannelzChild:t.removeChannelzChild.bind(t)},i),this.innerResolver=(0,$g.createResolver)(e,{onSuccessfulResolution:(o,l,c,u,h)=>{var f;this.backoffTimeout.stop(),this.backoffTimeout.reset();let p=null;l===null?c===null?(this.previousServiceConfig=null,p=this.defaultServiceConfig):this.previousServiceConfig===null?this.handleResolutionFailure(c):p=this.previousServiceConfig:(p=l,this.previousServiceConfig=l);let E=(f=p?.loadBalancingConfig)!==null&&f!==void 0?f:[],m=(0,Gg.selectLbConfigFromList)(E,!0);if(m===null){this.handleResolutionFailure({code:pa.Status.UNAVAILABLE,details:"All load balancer options in service config are not compatible",metadata:new Yg.Metadata});return}this.childLoadBalancer.updateAddressList(o,m,h);let b=p??this.defaultServiceConfig;this.onSuccessfulResolution(b,u??rm(b))},onError:o=>{this.handleResolutionFailure(o)}},i);let a={initialDelay:i["grpc.initial_reconnect_backoff_ms"],maxDelay:i["grpc.max_reconnect_backoff_ms"]};this.backoffTimeout=new Vg.BackoffTimeout(()=>{this.continueResolving?(this.updateResolution(),this.continueResolving=!1):this.updateState(this.latestChildState,this.latestChildPicker)},a),this.backoffTimeout.unref()}updateResolution(){this.innerResolver.updateResolution(),this.currentState===Ae.ConnectivityState.IDLE&&this.updateState(Ae.ConnectivityState.CONNECTING,this.latestChildPicker),this.backoffTimeout.runOnce()}updateState(e,t){jc((0,Xg.uriToString)(this.target)+" "+Ae.ConnectivityState[this.currentState]+" -> "+Ae.ConnectivityState[e]),e===Ae.ConnectivityState.IDLE&&(t=new gr.QueuePicker(this,t)),this.currentState=e,this.channelControlHelper.updateState(e,t)}handleResolutionFailure(e){this.latestChildState===Ae.ConnectivityState.IDLE&&(this.updateState(Ae.ConnectivityState.TRANSIENT_FAILURE,new gr.UnavailablePicker(e)),this.onFailedResolution(e))}exitIdle(){(this.currentState===Ae.ConnectivityState.IDLE||this.currentState===Ae.ConnectivityState.TRANSIENT_FAILURE)&&(this.backoffTimeout.isRunning()?this.continueResolving=!0:this.updateResolution()),this.childLoadBalancer.exitIdle()}updateAddressList(e,t){throw new Error("updateAddressList not supported on ResolvingLoadBalancer")}resetBackoff(){this.backoffTimeout.reset(),this.childLoadBalancer.resetBackoff()}destroy(){this.childLoadBalancer.destroy(),this.innerResolver.destroy(),this.backoffTimeout.reset(),this.backoffTimeout.stop(),this.latestChildState=Ae.ConnectivityState.IDLE,this.latestChildPicker=new gr.QueuePicker(this),this.currentState=Ae.ConnectivityState.IDLE,this.previousServiceConfig=null,this.continueResolving=!1}getTypeName(){return"resolving_load_balancer"}};pn.ResolvingLoadBalancer=ga});var Wc=g(ki=>{"use strict";Object.defineProperty(ki,"__esModule",{value:!0});ki.channelOptionsEqual=ki.recognizedOptions=void 0;ki.recognizedOptions={"grpc.ssl_target_name_override":!0,"grpc.primary_user_agent":!0,"grpc.secondary_user_agent":!0,"grpc.default_authority":!0,"grpc.keepalive_time_ms":!0,"grpc.keepalive_timeout_ms":!0,"grpc.keepalive_permit_without_calls":!0,"grpc.service_config":!0,"grpc.max_concurrent_streams":!0,"grpc.initial_reconnect_backoff_ms":!0,"grpc.max_reconnect_backoff_ms":!0,"grpc.use_local_subchannel_pool":!0,"grpc.max_send_message_length":!0,"grpc.max_receive_message_length":!0,"grpc.enable_http_proxy":!0,"grpc.enable_channelz":!0,"grpc.dns_min_time_between_resolutions_ms":!0,"grpc.enable_retries":!0,"grpc.per_rpc_retry_buffer_size":!0,"grpc.retry_buffer_size":!0,"grpc.max_connection_age_ms":!0,"grpc.max_connection_age_grace_ms":!0,"grpc-node.max_session_memory":!0,"grpc.service_config_disable_resolution":!0,"grpc.client_idle_timeout_ms":!0,"grpc-node.tls_enable_trace":!0,"grpc.lb.ring_hash.ring_size_cap":!0};function nm(r,e){let t=Object.keys(r).sort(),i=Object.keys(e).sort();if(t.length!==i.length)return!1;for(let n=0;n<t.length;n+=1)if(t[n]!==i[n]||r[t[n]]!==e[i[n]])return!1;return!0}ki.channelOptionsEqual=nm});var Xe=g(pe=>{"use strict";Object.defineProperty(pe,"__esModule",{value:!0});pe.EndpointMap=pe.endpointHasAddress=pe.endpointToString=pe.endpointEqual=pe.stringToSubchannelAddress=pe.subchannelAddressToString=pe.subchannelAddressEqual=pe.isTcpSubchannelAddress=void 0;var $c=require("net");function vr(r){return"port"in r}pe.isTcpSubchannelAddress=vr;function gn(r,e){return!r&&!e?!0:!r||!e?!1:vr(r)?vr(e)&&r.host===e.host&&r.port===e.port:!vr(e)&&r.path===e.path}pe.subchannelAddressEqual=gn;function Vc(r){return vr(r)?(0,$c.isIPv6)(r.host)?"["+r.host+"]:"+r.port:r.host+":"+r.port:r.path}pe.subchannelAddressToString=Vc;var sm=443;function am(r,e){return(0,$c.isIP)(r)?{host:r,port:e??sm}:{path:r}}pe.stringToSubchannelAddress=am;function om(r,e){if(r.addresses.length!==e.addresses.length)return!1;for(let t=0;t<r.addresses.length;t++)if(!gn(r.addresses[t],e.addresses[t]))return!1;return!0}pe.endpointEqual=om;function lm(r){return"["+r.addresses.map(Vc).join(", ")+"]"}pe.endpointToString=lm;function Yc(r,e){for(let t of r.addresses)if(gn(t,e))return!0;return!1}pe.endpointHasAddress=Yc;function mr(r,e){if(r.addresses.length!==e.addresses.length)return!1;for(let t of r.addresses){let i=!1;for(let n of e.addresses)if(gn(t,n)){i=!0;break}if(!i)return!1}return!0}var ma=class{constructor(){this.map=new Set}get size(){return this.map.size}getForSubchannelAddress(e){for(let t of this.map)if(Yc(t.key,e))return t.value}deleteMissing(e){let t=[];for(let i of this.map){let n=!1;for(let s of e)mr(s,i.key)&&(n=!0);n||(t.push(i.value),this.map.delete(i))}return t}get(e){for(let t of this.map)if(mr(e,t.key))return t.value}set(e,t){for(let i of this.map)if(mr(e,i.key)){i.value=t;return}this.map.add({key:e,value:t})}delete(e){for(let t of this.map)if(mr(e,t.key)){this.map.delete(t);return}}has(e){for(let t of this.map)if(mr(e,t.key))return!0;return!1}clear(){this.map.clear()}*keys(){for(let e of this.map)yield e.key}*values(){for(let e of this.map)yield e.value}*entries(){for(let e of this.map)yield[e.key,e.value]}};pe.EndpointMap=ma});var Kc=g(ba=>{"use strict";Object.defineProperty(ba,"t",{value:!0});var mn=class{constructor(e,t,i=1){this.i=void 0,this.h=void 0,this.o=void 0,this.u=e,this.l=t,this.p=i}I(){let e=this,t=e.o.o===e;if(t&&e.p===1)e=e.h;else if(e.i)for(e=e.i;e.h;)e=e.h;else{if(t)return e.o;let i=e.o;for(;i.i===e;)e=i,i=e.o;e=i}return e}B(){let e=this;if(e.h){for(e=e.h;e.i;)e=e.i;return e}else{let t=e.o;for(;t.h===e;)e=t,t=e.o;return e.h!==t?t:e}}_(){let e=this.o,t=this.h,i=t.i;return e.o===this?e.o=t:e.i===this?e.i=t:e.h=t,t.o=e,t.i=this,this.o=t,this.h=i,i&&(i.o=this),t}g(){let e=this.o,t=this.i,i=t.h;return e.o===this?e.o=t:e.i===this?e.i=t:e.h=t,t.o=e,t.h=this,this.o=t,this.i=i,i&&(i.o=this),t}},va=class extends mn{constructor(){super(...arguments),this.M=1}_(){let e=super._();return this.O(),e.O(),e}g(){let e=super.g();return this.O(),e.O(),e}O(){this.M=1,this.i&&(this.M+=this.i.M),this.h&&(this.M+=this.h.M)}},ya=class{constructor(e=0){this.iteratorType=e}equals(e){return this.T===e.T}},Sa=class{constructor(){this.m=0}get length(){return this.m}size(){return this.m}empty(){return this.m===0}},_a=class extends Sa{};function si(){throw new RangeError("Iterator access denied!")}var Ca=class extends _a{constructor(e=function(i,n){return i<n?-1:i>n?1:0},t=!1){super(),this.v=void 0,this.A=e,this.enableIndex=t,this.N=t?va:mn,this.C=new this.N}R(e,t){let i=this.C;for(;e;){let n=this.A(e.u,t);if(n<0)e=e.h;else if(n>0)i=e,e=e.i;else return e}return i}K(e,t){let i=this.C;for(;e;)this.A(e.u,t)<=0?e=e.h:(i=e,e=e.i);return i}L(e,t){let i=this.C;for(;e;){let n=this.A(e.u,t);if(n<0)i=e,e=e.h;else if(n>0)e=e.i;else return e}return i}k(e,t){let i=this.C;for(;e;)this.A(e.u,t)<0?(i=e,e=e.h):e=e.i;return i}P(e){for(;;){let t=e.o;if(t===this.C)return;if(e.p===1){e.p=0;return}if(e===t.i){let i=t.h;if(i.p===1)i.p=0,t.p=1,t===this.v?this.v=t._():t._();else if(i.h&&i.h.p===1){i.p=t.p,t.p=0,i.h.p=0,t===this.v?this.v=t._():t._();return}else i.i&&i.i.p===1?(i.p=1,i.i.p=0,i.g()):(i.p=1,e=t)}else{let i=t.i;if(i.p===1)i.p=0,t.p=1,t===this.v?this.v=t.g():t.g();else if(i.i&&i.i.p===1){i.p=t.p,t.p=0,i.i.p=0,t===this.v?this.v=t.g():t.g();return}else i.h&&i.h.p===1?(i.p=1,i.h.p=0,i._()):(i.p=1,e=t)}}}S(e){if(this.m===1){this.clear();return}let t=e;for(;t.i||t.h;){if(t.h)for(t=t.h;t.i;)t=t.i;else t=t.i;let n=e.u;e.u=t.u,t.u=n;let s=e.l;e.l=t.l,t.l=s,e=t}this.C.i===t?this.C.i=t.o:this.C.h===t&&(this.C.h=t.o),this.P(t);let i=t.o;if(t===i.i?i.i=void 0:i.h=void 0,this.m-=1,this.v.p=0,this.enableIndex)for(;i!==this.C;)i.M-=1,i=i.o}U(e){let t=typeof e=="number"?e:void 0,i=typeof e=="function"?e:void 0,n=typeof e>"u"?[]:void 0,s=0,a=this.v,o=[];for(;o.length||a;)if(a)o.push(a),a=a.i;else{if(a=o.pop(),s===t)return a;n&&n.push(a),i&&i(a,s,this),s+=1,a=a.h}return n}j(e){for(;;){let t=e.o;if(t.p===0)return;let i=t.o;if(t===i.i){let n=i.h;if(n&&n.p===1){if(n.p=t.p=0,i===this.v)return;i.p=1,e=i;continue}else if(e===t.h){if(e.p=0,e.i&&(e.i.o=t),e.h&&(e.h.o=i),t.h=e.i,i.i=e.h,e.i=t,e.h=i,i===this.v)this.v=e,this.C.o=e;else{let s=i.o;s.i===i?s.i=e:s.h=e}e.o=i.o,t.o=e,i.o=e,i.p=1}else{t.p=0,i===this.v?this.v=i.g():i.g(),i.p=1;return}}else{let n=i.i;if(n&&n.p===1){if(n.p=t.p=0,i===this.v)return;i.p=1,e=i;continue}else if(e===t.i){if(e.p=0,e.i&&(e.i.o=i),e.h&&(e.h.o=t),i.h=e.i,t.i=e.h,e.i=i,e.h=t,i===this.v)this.v=e,this.C.o=e;else{let s=i.o;s.i===i?s.i=e:s.h=e}e.o=i.o,t.o=e,i.o=e,i.p=1}else{t.p=0,i===this.v?this.v=i._():i._(),i.p=1;return}}this.enableIndex&&(t.O(),i.O(),e.O());return}}q(e,t,i){if(this.v===void 0)return this.m+=1,this.v=new this.N(e,t,0),this.v.o=this.C,this.C.o=this.C.i=this.C.h=this.v,this.m;let n,s=this.C.i,a=this.A(s.u,e);if(a===0)return s.l=t,this.m;if(a>0)s.i=new this.N(e,t),s.i.o=s,n=s.i,this.C.i=n;else{let o=this.C.h,l=this.A(o.u,e);if(l===0)return o.l=t,this.m;if(l<0)o.h=new this.N(e,t),o.h.o=o,n=o.h,this.C.h=n;else{if(i!==void 0){let c=i.T;if(c!==this.C){let u=this.A(c.u,e);if(u===0)return c.l=t,this.m;if(u>0){let h=c.I(),f=this.A(h.u,e);if(f===0)return h.l=t,this.m;f<0&&(n=new this.N(e,t),h.h===void 0?(h.h=n,n.o=h):(c.i=n,n.o=c))}}}if(n===void 0)for(n=this.v;;){let c=this.A(n.u,e);if(c>0){if(n.i===void 0){n.i=new this.N(e,t),n.i.o=n,n=n.i;break}n=n.i}else if(c<0){if(n.h===void 0){n.h=new this.N(e,t),n.h.o=n,n=n.h;break}n=n.h}else return n.l=t,this.m}}}if(this.enableIndex){let o=n.o;for(;o!==this.C;)o.M+=1,o=o.o}return this.j(n),this.m+=1,this.m}H(e,t){for(;e;){let i=this.A(e.u,t);if(i<0)e=e.h;else if(i>0)e=e.i;else return e}return e||this.C}clear(){this.m=0,this.v=void 0,this.C.o=void 0,this.C.i=this.C.h=void 0}updateKeyByIterator(e,t){let i=e.T;if(i===this.C&&si(),this.m===1)return i.u=t,!0;let n=i.B().u;if(i===this.C.i)return this.A(n,t)>0?(i.u=t,!0):!1;let s=i.I().u;return i===this.C.h?this.A(s,t)<0?(i.u=t,!0):!1:this.A(s,t)>=0||this.A(n,t)<=0?!1:(i.u=t,!0)}eraseElementByPos(e){if(e<0||e>this.m-1)throw new RangeError;let t=this.U(e);return this.S(t),this.m}eraseElementByKey(e){if(this.m===0)return!1;let t=this.H(this.v,e);return t===this.C?!1:(this.S(t),!0)}eraseElementByIterator(e){let t=e.T;t===this.C&&si();let i=t.h===void 0;return e.iteratorType===0?i&&e.next():(!i||t.i===void 0)&&e.next(),this.S(t),e}getHeight(){if(this.m===0)return 0;function e(t){return t?Math.max(e(t.i),e(t.h))+1:0}return e(this.v)}},Ta=class extends ya{constructor(e,t,i){super(i),this.T=e,this.C=t,this.iteratorType===0?(this.pre=function(){return this.T===this.C.i&&si(),this.T=this.T.I(),this},this.next=function(){return this.T===this.C&&si(),this.T=this.T.B(),this}):(this.pre=function(){return this.T===this.C.h&&si(),this.T=this.T.B(),this},this.next=function(){return this.T===this.C&&si(),this.T=this.T.I(),this})}get index(){let e=this.T,t=this.C.o;if(e===this.C)return t?t.M-1:0;let i=0;for(e.i&&(i+=e.i.M);e!==t;){let n=e.o;e===n.h&&(i+=1,n.i&&(i+=n.i.M)),e=n}return i}isAccessible(){return this.T!==this.C}},Ie=class extends Ta{constructor(e,t,i,n){super(e,t,n),this.container=i}get pointer(){this.T===this.C&&si();let e=this;return new Proxy([],{get(t,i){return i==="0"?e.T.u:i==="1"?e.T.l:(t[0]=e.T.u,t[1]=e.T.l,t[i])},set(t,i,n){if(i!=="1")throw new TypeError("prop must be 1");return e.T.l=n,!0}})}copy(){return new Ie(this.T,this.C,this.container,this.iteratorType)}},Ea=class extends Ca{constructor(e=[],t,i){super(t,i);let n=this;e.forEach(function(s){n.setElement(s[0],s[1])})}begin(){return new Ie(this.C.i||this.C,this.C,this)}end(){return new Ie(this.C,this.C,this)}rBegin(){return new Ie(this.C.h||this.C,this.C,this,1)}rEnd(){return new Ie(this.C,this.C,this,1)}front(){if(this.m===0)return;let e=this.C.i;return[e.u,e.l]}back(){if(this.m===0)return;let e=this.C.h;return[e.u,e.l]}lowerBound(e){let t=this.R(this.v,e);return new Ie(t,this.C,this)}upperBound(e){let t=this.K(this.v,e);return new Ie(t,this.C,this)}reverseLowerBound(e){let t=this.L(this.v,e);return new Ie(t,this.C,this)}reverseUpperBound(e){let t=this.k(this.v,e);return new Ie(t,this.C,this)}forEach(e){this.U(function(t,i,n){e([t.u,t.l],i,n)})}setElement(e,t,i){return this.q(e,t,i)}getElementByPos(e){if(e<0||e>this.m-1)throw new RangeError;let t=this.U(e);return[t.u,t.l]}find(e){let t=this.H(this.v,e);return new Ie(t,this.C,this)}getElementByKey(e){return this.H(this.v,e).l}union(e){let t=this;return e.forEach(function(i){t.setElement(i[0],i[1])}),this.m}*[Symbol.iterator](){let e=this.m,t=this.U();for(let i=0;i<e;++i){let n=t[i];yield[n.u,n.l]}}};ba.OrderedMap=Ea});var vn=g(Ni=>{"use strict";Object.defineProperty(Ni,"__esModule",{value:!0});Ni.addAdminServicesToServer=Ni.registerAdminService=void 0;var Jc=[];function cm(r,e){Jc.push({getServiceDefinition:r,getHandlers:e})}Ni.registerAdminService=cm;function um(r){for(let{getServiceDefinition:e,getHandlers:t}of Jc)r.addService(e(),t())}Ni.addAdminServicesToServer=um});var Xc=g(ze=>{"use strict";Object.defineProperty(ze,"__esModule",{value:!0});ze.ClientDuplexStreamImpl=ze.ClientWritableStreamImpl=ze.ClientReadableStreamImpl=ze.ClientUnaryCallImpl=ze.callErrorFromStatus=void 0;var dm=require("events"),Ma=require("stream"),yr=z();function hm(r,e){let t=`${r.code} ${yr.Status[r.code]}: ${r.details}`,n=`${new Error(t).stack}
for call at
${e}`;return Object.assign(new Error(t),r,{stack:n})}ze.callErrorFromStatus=hm;var Ra=class extends dm.EventEmitter{constructor(){super()}cancel(){var e;(e=this.call)===null||e===void 0||e.cancelWithStatus(yr.Status.CANCELLED,"Cancelled on client")}getPeer(){var e,t;return(t=(e=this.call)===null||e===void 0?void 0:e.getPeer())!==null&&t!==void 0?t:"unknown"}};ze.ClientUnaryCallImpl=Ra;var wa=class extends Ma.Readable{constructor(e){super({objectMode:!0}),this.deserialize=e}cancel(){var e;(e=this.call)===null||e===void 0||e.cancelWithStatus(yr.Status.CANCELLED,"Cancelled on client")}getPeer(){var e,t;return(t=(e=this.call)===null||e===void 0?void 0:e.getPeer())!==null&&t!==void 0?t:"unknown"}_read(e){var t;(t=this.call)===null||t===void 0||t.startRead()}};ze.ClientReadableStreamImpl=wa;var Aa=class extends Ma.Writable{constructor(e){super({objectMode:!0}),this.serialize=e}cancel(){var e;(e=this.call)===null||e===void 0||e.cancelWithStatus(yr.Status.CANCELLED,"Cancelled on client")}getPeer(){var e,t;return(t=(e=this.call)===null||e===void 0?void 0:e.getPeer())!==null&&t!==void 0?t:"unknown"}_write(e,t,i){var n;let s={callback:i},a=Number(t);Number.isNaN(a)||(s.flags=a),(n=this.call)===null||n===void 0||n.sendMessageWithContext(s,e)}_final(e){var t;(t=this.call)===null||t===void 0||t.halfClose(),e()}};ze.ClientWritableStreamImpl=Aa;var Oa=class extends Ma.Duplex{constructor(e,t){super({objectMode:!0}),this.serialize=e,this.deserialize=t}cancel(){var e;(e=this.call)===null||e===void 0||e.cancelWithStatus(yr.Status.CANCELLED,"Cancelled on client")}getPeer(){var e,t;return(t=(e=this.call)===null||e===void 0?void 0:e.getPeer())!==null&&t!==void 0?t:"unknown"}_read(e){var t;(t=this.call)===null||t===void 0||t.startRead()}_write(e,t,i){var n;let s={callback:i},a=Number(t);Number.isNaN(a)||(s.flags=a),(n=this.call)===null||n===void 0||n.sendMessageWithContext(s,e)}_final(e){var t;(t=this.call)===null||t===void 0||t.halfClose(),e()}};ze.ClientDuplexStreamImpl=Oa});var Zc=g(Pi=>{"use strict";Object.defineProperty(Pi,"__esModule",{value:!0});Pi.InterceptingListenerImpl=Pi.isInterceptingListener=void 0;function fm(r){return r.onReceiveMetadata!==void 0&&r.onReceiveMetadata.length===1}Pi.isInterceptingListener=fm;var ka=class{constructor(e,t){this.listener=e,this.nextListener=t,this.processingMetadata=!1,this.hasPendingMessage=!1,this.processingMessage=!1,this.pendingStatus=null}processPendingMessage(){this.hasPendingMessage&&(this.nextListener.onReceiveMessage(this.pendingMessage),this.pendingMessage=null,this.hasPendingMessage=!1)}processPendingStatus(){this.pendingStatus&&this.nextListener.onReceiveStatus(this.pendingStatus)}onReceiveMetadata(e){this.processingMetadata=!0,this.listener.onReceiveMetadata(e,t=>{this.processingMetadata=!1,this.nextListener.onReceiveMetadata(t),this.processPendingMessage(),this.processPendingStatus()})}onReceiveMessage(e){this.processingMessage=!0,this.listener.onReceiveMessage(e,t=>{this.processingMessage=!1,this.processingMetadata?(this.pendingMessage=t,this.hasPendingMessage=!0):(this.nextListener.onReceiveMessage(t),this.processPendingStatus())})}onReceiveStatus(e){this.listener.onReceiveStatus(e,t=>{this.processingMetadata||this.processingMessage?this.pendingStatus=t:this.nextListener.onReceiveStatus(t)})}};Pi.InterceptingListenerImpl=ka});var Fa=g(He=>{"use strict";Object.defineProperty(He,"__esModule",{value:!0});He.getInterceptingCall=He.InterceptingCall=He.RequesterBuilder=He.ListenerBuilder=He.InterceptorConfigurationError=void 0;var pm=Re(),Qc=Zc(),eu=z(),tu=en(),ai=class extends Error{constructor(e){super(e),this.name="InterceptorConfigurationError",Error.captureStackTrace(this,ai)}};He.InterceptorConfigurationError=ai;var Pa=class{constructor(){this.metadata=void 0,this.message=void 0,this.status=void 0}withOnReceiveMetadata(e){return this.metadata=e,this}withOnReceiveMessage(e){return this.message=e,this}withOnReceiveStatus(e){return this.status=e,this}build(){return{onReceiveMetadata:this.metadata,onReceiveMessage:this.message,onReceiveStatus:this.status}}};He.ListenerBuilder=Pa;var Ia=class{constructor(){this.start=void 0,this.message=void 0,this.halfClose=void 0,this.cancel=void 0}withStart(e){return this.start=e,this}withSendMessage(e){return this.message=e,this}withHalfClose(e){return this.halfClose=e,this}withCancel(e){return this.cancel=e,this}build(){return{start:this.start,sendMessage:this.message,halfClose:this.halfClose,cancel:this.cancel}}};He.RequesterBuilder=Ia;var Na={onReceiveMetadata:(r,e)=>{e(r)},onReceiveMessage:(r,e)=>{e(r)},onReceiveStatus:(r,e)=>{e(r)}},Sr={start:(r,e,t)=>{t(r,e)},sendMessage:(r,e)=>{e(r)},halfClose:r=>{r()},cancel:r=>{r()}},xa=class{constructor(e,t){var i,n,s,a;this.nextCall=e,this.processingMetadata=!1,this.pendingMessageContext=null,this.processingMessage=!1,this.pendingHalfClose=!1,t?this.requester={start:(i=t.start)!==null&&i!==void 0?i:Sr.start,sendMessage:(n=t.sendMessage)!==null&&n!==void 0?n:Sr.sendMessage,halfClose:(s=t.halfClose)!==null&&s!==void 0?s:Sr.halfClose,cancel:(a=t.cancel)!==null&&a!==void 0?a:Sr.cancel}:this.requester=Sr}cancelWithStatus(e,t){this.requester.cancel(()=>{this.nextCall.cancelWithStatus(e,t)})}getPeer(){return this.nextCall.getPeer()}processPendingMessage(){this.pendingMessageContext&&(this.nextCall.sendMessageWithContext(this.pendingMessageContext,this.pendingMessage),this.pendingMessageContext=null,this.pendingMessage=null)}processPendingHalfClose(){this.pendingHalfClose&&this.nextCall.halfClose()}start(e,t){var i,n,s,a,o,l;let c={onReceiveMetadata:(n=(i=t?.onReceiveMetadata)===null||i===void 0?void 0:i.bind(t))!==null&&n!==void 0?n:u=>{},onReceiveMessage:(a=(s=t?.onReceiveMessage)===null||s===void 0?void 0:s.bind(t))!==null&&a!==void 0?a:u=>{},onReceiveStatus:(l=(o=t?.onReceiveStatus)===null||o===void 0?void 0:o.bind(t))!==null&&l!==void 0?l:u=>{}};this.processingMetadata=!0,this.requester.start(e,c,(u,h)=>{var f,p,E;this.processingMetadata=!1;let m;if((0,Qc.isInterceptingListener)(h))m=h;else{let b={onReceiveMetadata:(f=h.onReceiveMetadata)!==null&&f!==void 0?f:Na.onReceiveMetadata,onReceiveMessage:(p=h.onReceiveMessage)!==null&&p!==void 0?p:Na.onReceiveMessage,onReceiveStatus:(E=h.onReceiveStatus)!==null&&E!==void 0?E:Na.onReceiveStatus};m=new Qc.InterceptingListenerImpl(b,c)}this.nextCall.start(u,m),this.processPendingMessage(),this.processPendingHalfClose()})}sendMessageWithContext(e,t){this.processingMessage=!0,this.requester.sendMessage(t,i=>{this.processingMessage=!1,this.processingMetadata?(this.pendingMessageContext=e,this.pendingMessage=t):(this.nextCall.sendMessageWithContext(e,i),this.processPendingHalfClose())})}sendMessage(e){this.sendMessageWithContext({},e)}startRead(){this.nextCall.startRead()}halfClose(){this.requester.halfClose(()=>{this.processingMetadata||this.processingMessage?this.pendingHalfClose=!0:this.nextCall.halfClose()})}};He.InterceptingCall=xa;function gm(r,e,t){var i,n;let s=(i=t.deadline)!==null&&i!==void 0?i:1/0,a=t.host,o=(n=t.parent)!==null&&n!==void 0?n:null,l=t.propagate_flags,c=t.credentials,u=r.createCall(e,s,a,o,l);return c&&u.setCredentials(c),u}var yn=class{constructor(e,t){this.call=e,this.methodDefinition=t}cancelWithStatus(e,t){this.call.cancelWithStatus(e,t)}getPeer(){return this.call.getPeer()}sendMessageWithContext(e,t){let i;try{i=this.methodDefinition.requestSerialize(t)}catch(n){this.call.cancelWithStatus(eu.Status.INTERNAL,`Request message serialization failure: ${(0,tu.getErrorMessage)(n)}`);return}this.call.sendMessageWithContext(e,i)}sendMessage(e){this.sendMessageWithContext({},e)}start(e,t){let i=null;this.call.start(e,{onReceiveMetadata:n=>{var s;(s=t?.onReceiveMetadata)===null||s===void 0||s.call(t,n)},onReceiveMessage:n=>{var s;let a;try{a=this.methodDefinition.responseDeserialize(n)}catch(o){i={code:eu.Status.INTERNAL,details:`Response message parsing error: ${(0,tu.getErrorMessage)(o)}`,metadata:new pm.Metadata},this.call.cancelWithStatus(i.code,i.details);return}(s=t?.onReceiveMessage)===null||s===void 0||s.call(t,a)},onReceiveStatus:n=>{var s,a;i?(s=t?.onReceiveStatus)===null||s===void 0||s.call(t,i):(a=t?.onReceiveStatus)===null||a===void 0||a.call(t,n)}})}startRead(){this.call.startRead()}halfClose(){this.call.halfClose()}},Da=class extends yn{constructor(e,t){super(e,t)}start(e,t){var i,n;let s=!1,a={onReceiveMetadata:(n=(i=t?.onReceiveMetadata)===null||i===void 0?void 0:i.bind(t))!==null&&n!==void 0?n:o=>{},onReceiveMessage:o=>{var l;s=!0,(l=t?.onReceiveMessage)===null||l===void 0||l.call(t,o)},onReceiveStatus:o=>{var l,c;s||(l=t?.onReceiveMessage)===null||l===void 0||l.call(t,null),(c=t?.onReceiveStatus)===null||c===void 0||c.call(t,o)}};super.start(e,a),this.call.startRead()}},La=class extends yn{};function mm(r,e,t){let i=gm(r,t.path,e);return t.responseStream?new La(i,t):new Da(i,t)}function vm(r,e,t,i){if(r.clientInterceptors.length>0&&r.clientInterceptorProviders.length>0)throw new ai("Both interceptors and interceptor_providers were passed as options to the client constructor. Only one of these is allowed.");if(r.callInterceptors.length>0&&r.callInterceptorProviders.length>0)throw new ai("Both interceptors and interceptor_providers were passed as call options. Only one of these is allowed.");let n=[];r.callInterceptors.length>0||r.callInterceptorProviders.length>0?n=[].concat(r.callInterceptors,r.callInterceptorProviders.map(o=>o(e))).filter(o=>o):n=[].concat(r.clientInterceptors,r.clientInterceptorProviders.map(o=>o(e))).filter(o=>o);let s=Object.assign({},t,{method_definition:e});return n.reduceRight((o,l)=>c=>l(c,o),o=>mm(i,o,e))(s)}He.getInterceptingCall=vm});var Ua=g(_n=>{"use strict";Object.defineProperty(_n,"__esModule",{value:!0});_n.Client=void 0;var lt=Xc(),ym=za(),Sm=Be(),Ft=z(),Ii=Re(),Sn=Fa(),Ze=Symbol(),xi=Symbol(),Di=Symbol(),Tt=Symbol();function qa(r){return typeof r=="function"}function Li(r){var e;return((e=r.stack)===null||e===void 0?void 0:e.split(`
`).slice(1).join(`
`))||"no stack trace available"}var Ba=class{constructor(e,t,i={}){var n,s;if(i=Object.assign({},i),this[xi]=(n=i.interceptors)!==null&&n!==void 0?n:[],delete i.interceptors,this[Di]=(s=i.interceptor_providers)!==null&&s!==void 0?s:[],delete i.interceptor_providers,this[xi].length>0&&this[Di].length>0)throw new Error("Both interceptors and interceptor_providers were passed as options to the client constructor. Only one of these is allowed.");if(this[Tt]=i.callInvocationTransformer,delete i.callInvocationTransformer,i.channelOverride)this[Ze]=i.channelOverride;else if(i.channelFactoryOverride){let a=i.channelFactoryOverride;delete i.channelFactoryOverride,this[Ze]=a(e,t,i)}else this[Ze]=new ym.ChannelImplementation(e,t,i)}close(){this[Ze].close()}getChannel(){return this[Ze]}waitForReady(e,t){let i=n=>{if(n){t(new Error("Failed to connect before the deadline"));return}let s;try{s=this[Ze].getConnectivityState(!0)}catch{t(new Error("The channel has been closed"));return}if(s===Sm.ConnectivityState.READY)t();else try{this[Ze].watchConnectivityState(s,e,i)}catch{t(new Error("The channel has been closed"))}};setImmediate(i)}checkOptionalUnaryResponseArguments(e,t,i){if(qa(e))return{metadata:new Ii.Metadata,options:{},callback:e};if(qa(t))return e instanceof Ii.Metadata?{metadata:e,options:{},callback:t}:{metadata:new Ii.Metadata,options:e,callback:t};if(!(e instanceof Ii.Metadata&&t instanceof Object&&qa(i)))throw new Error("Incorrect arguments passed");return{metadata:e,options:t,callback:i}}makeUnaryRequest(e,t,i,n,s,a,o){var l,c;let u=this.checkOptionalUnaryResponseArguments(s,a,o),h={path:e,requestStream:!1,responseStream:!1,requestSerialize:t,responseDeserialize:i},f={argument:n,metadata:u.metadata,call:new lt.ClientUnaryCallImpl,channel:this[Ze],methodDefinition:h,callOptions:u.options,callback:u.callback};this[Tt]&&(f=this[Tt](f));let p=f.call,E={clientInterceptors:this[xi],clientInterceptorProviders:this[Di],callInterceptors:(l=f.callOptions.interceptors)!==null&&l!==void 0?l:[],callInterceptorProviders:(c=f.callOptions.interceptor_providers)!==null&&c!==void 0?c:[]},m=(0,Sn.getInterceptingCall)(E,f.methodDefinition,f.callOptions,f.channel);p.call=m;let b=null,S=!1,T=new Error;return m.start(f.metadata,{onReceiveMetadata:k=>{p.emit("metadata",k)},onReceiveMessage(k){b!==null&&m.cancelWithStatus(Ft.Status.UNIMPLEMENTED,"Too many responses received"),b=k},onReceiveStatus(k){if(!S){if(S=!0,k.code===Ft.Status.OK)if(b===null){let w=Li(T);f.callback((0,lt.callErrorFromStatus)({code:Ft.Status.UNIMPLEMENTED,details:"No message received",metadata:k.metadata},w))}else f.callback(null,b);else{let w=Li(T);f.callback((0,lt.callErrorFromStatus)(k,w))}T=null,p.emit("status",k)}}}),m.sendMessage(n),m.halfClose(),p}makeClientStreamRequest(e,t,i,n,s,a){var o,l;let c=this.checkOptionalUnaryResponseArguments(n,s,a),u={path:e,requestStream:!0,responseStream:!1,requestSerialize:t,responseDeserialize:i},h={metadata:c.metadata,call:new lt.ClientWritableStreamImpl(t),channel:this[Ze],methodDefinition:u,callOptions:c.options,callback:c.callback};this[Tt]&&(h=this[Tt](h));let f=h.call,p={clientInterceptors:this[xi],clientInterceptorProviders:this[Di],callInterceptors:(o=h.callOptions.interceptors)!==null&&o!==void 0?o:[],callInterceptorProviders:(l=h.callOptions.interceptor_providers)!==null&&l!==void 0?l:[]},E=(0,Sn.getInterceptingCall)(p,h.methodDefinition,h.callOptions,h.channel);f.call=E;let m=null,b=!1,S=new Error;return E.start(h.metadata,{onReceiveMetadata:T=>{f.emit("metadata",T)},onReceiveMessage(T){m!==null&&E.cancelWithStatus(Ft.Status.UNIMPLEMENTED,"Too many responses received"),m=T,E.startRead()},onReceiveStatus(T){if(!b){if(b=!0,T.code===Ft.Status.OK)if(m===null){let k=Li(S);h.callback((0,lt.callErrorFromStatus)({code:Ft.Status.UNIMPLEMENTED,details:"No message received",metadata:T.metadata},k))}else h.callback(null,m);else{let k=Li(S);h.callback((0,lt.callErrorFromStatus)(T,k))}S=null,f.emit("status",T)}}}),f}checkMetadataAndOptions(e,t){let i,n;return e instanceof Ii.Metadata?(i=e,t?n=t:n={}):(e?n=e:n={},i=new Ii.Metadata),{metadata:i,options:n}}makeServerStreamRequest(e,t,i,n,s,a){var o,l;let c=this.checkMetadataAndOptions(s,a),u={path:e,requestStream:!1,responseStream:!0,requestSerialize:t,responseDeserialize:i},h={argument:n,metadata:c.metadata,call:new lt.ClientReadableStreamImpl(i),channel:this[Ze],methodDefinition:u,callOptions:c.options};this[Tt]&&(h=this[Tt](h));let f=h.call,p={clientInterceptors:this[xi],clientInterceptorProviders:this[Di],callInterceptors:(o=h.callOptions.interceptors)!==null&&o!==void 0?o:[],callInterceptorProviders:(l=h.callOptions.interceptor_providers)!==null&&l!==void 0?l:[]},E=(0,Sn.getInterceptingCall)(p,h.methodDefinition,h.callOptions,h.channel);f.call=E;let m=!1,b=new Error;return E.start(h.metadata,{onReceiveMetadata(S){f.emit("metadata",S)},onReceiveMessage(S){f.push(S)},onReceiveStatus(S){if(!m){if(m=!0,f.push(null),S.code!==Ft.Status.OK){let T=Li(b);f.emit("error",(0,lt.callErrorFromStatus)(S,T))}b=null,f.emit("status",S)}}}),E.sendMessage(n),E.halfClose(),f}makeBidiStreamRequest(e,t,i,n,s){var a,o;let l=this.checkMetadataAndOptions(n,s),c={path:e,requestStream:!0,responseStream:!0,requestSerialize:t,responseDeserialize:i},u={metadata:l.metadata,call:new lt.ClientDuplexStreamImpl(t,i),channel:this[Ze],methodDefinition:c,callOptions:l.options};this[Tt]&&(u=this[Tt](u));let h=u.call,f={clientInterceptors:this[xi],clientInterceptorProviders:this[Di],callInterceptors:(a=u.callOptions.interceptors)!==null&&a!==void 0?a:[],callInterceptorProviders:(o=u.callOptions.interceptor_providers)!==null&&o!==void 0?o:[]},p=(0,Sn.getInterceptingCall)(f,u.methodDefinition,u.callOptions,u.channel);h.call=p;let E=!1,m=new Error;return p.start(u.metadata,{onReceiveMetadata(b){h.emit("metadata",b)},onReceiveMessage(b){h.push(b)},onReceiveStatus(b){if(!E){if(E=!0,h.push(null),b.code!==Ft.Status.OK){let S=Li(m);h.emit("error",(0,lt.callErrorFromStatus)(b,S))}m=null,h.emit("status",b)}}}),h}};_n.Client=Ba});var ja=g(Fi=>{"use strict";Object.defineProperty(Fi,"__esModule",{value:!0});Fi.loadPackageDefinition=Fi.makeClientConstructor=void 0;var _r=Ua(),_m={unary:_r.Client.prototype.makeUnaryRequest,server_stream:_r.Client.prototype.makeServerStreamRequest,client_stream:_r.Client.prototype.makeClientStreamRequest,bidi:_r.Client.prototype.makeBidiStreamRequest};function Ha(r){return["__proto__","prototype","constructor"].includes(r)}function iu(r,e,t){t||(t={});class i extends _r.Client{}return Object.keys(r).forEach(n=>{if(Ha(n))return;let s=r[n],a;if(typeof n=="string"&&n.charAt(0)==="$")throw new Error("Method names cannot start with $");s.requestStream?s.responseStream?a="bidi":a="client_stream":s.responseStream?a="server_stream":a="unary";let o=s.requestSerialize,l=s.responseDeserialize,c=Cm(_m[a],s.path,o,l);i.prototype[n]=c,Object.assign(i.prototype[n],s),s.originalName&&!Ha(s.originalName)&&(i.prototype[s.originalName]=i.prototype[n])}),i.service=r,i.serviceName=e,i}Fi.makeClientConstructor=iu;function Cm(r,e,t,i){return function(...n){return r.call(this,e,t,i,...n)}}function Tm(r){return"format"in r}function Em(r){let e={};for(let t in r)if(Object.prototype.hasOwnProperty.call(r,t)){let i=r[t],n=t.split(".");if(n.some(o=>Ha(o)))continue;let s=n[n.length-1],a=e;for(let o of n.slice(0,-1))a[o]||(a[o]={}),a=a[o];Tm(i)?a[s]=i:a[s]=iu(i,s,{})}return e}Fi.loadPackageDefinition=Em});var Au=g((wT,wu)=>{var bm=1/0,Rm="[object Symbol]",wm=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,Am=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,Tn="\\ud800-\\udfff",uu="\\u0300-\\u036f\\ufe20-\\ufe23",du="\\u20d0-\\u20f0",hu="\\u2700-\\u27bf",fu="a-z\\xdf-\\xf6\\xf8-\\xff",Om="\\xac\\xb1\\xd7\\xf7",Mm="\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf",km="\\u2000-\\u206f",Nm=" \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",pu="A-Z\\xc0-\\xd6\\xd8-\\xde",gu="\\ufe0e\\ufe0f",mu=Om+Mm+km+Nm,Wa="['\u2019]",Pm="["+Tn+"]",ru="["+mu+"]",Cn="["+uu+du+"]",vu="\\d+",Im="["+hu+"]",yu="["+fu+"]",Su="[^"+Tn+mu+vu+hu+fu+pu+"]",Ga="\\ud83c[\\udffb-\\udfff]",xm="(?:"+Cn+"|"+Ga+")",_u="[^"+Tn+"]",$a="(?:\\ud83c[\\udde6-\\uddff]){2}",Va="[\\ud800-\\udbff][\\udc00-\\udfff]",qi="["+pu+"]",Cu="\\u200d",nu="(?:"+yu+"|"+Su+")",Dm="(?:"+qi+"|"+Su+")",su="(?:"+Wa+"(?:d|ll|m|re|s|t|ve))?",au="(?:"+Wa+"(?:D|LL|M|RE|S|T|VE))?",Tu=xm+"?",Eu="["+gu+"]?",Lm="(?:"+Cu+"(?:"+[_u,$a,Va].join("|")+")"+Eu+Tu+")*",bu=Eu+Tu+Lm,Fm="(?:"+[Im,$a,Va].join("|")+")"+bu,qm="(?:"+[_u+Cn+"?",Cn,$a,Va,Pm].join("|")+")",Bm=RegExp(Wa,"g"),Um=RegExp(Cn,"g"),zm=RegExp(Ga+"(?="+Ga+")|"+qm+bu,"g"),Hm=RegExp([qi+"?"+yu+"+"+su+"(?="+[ru,qi,"$"].join("|")+")",Dm+"+"+au+"(?="+[ru,qi+nu,"$"].join("|")+")",qi+"?"+nu+"+"+su,qi+"+"+au,vu,Fm].join("|"),"g"),jm=RegExp("["+Cu+Tn+uu+du+gu+"]"),Gm=/[a-z][A-Z]|[A-Z]{2,}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,Wm={\u00C0:"A",\u00C1:"A",\u00C2:"A",\u00C3:"A",\u00C4:"A",\u00C5:"A",\u00E0:"a",\u00E1:"a",\u00E2:"a",\u00E3:"a",\u00E4:"a",\u00E5:"a",\u00C7:"C",\u00E7:"c",\u00D0:"D",\u00F0:"d",\u00C8:"E",\u00C9:"E",\u00CA:"E",\u00CB:"E",\u00E8:"e",\u00E9:"e",\u00EA:"e",\u00EB:"e",\u00CC:"I",\u00CD:"I",\u00CE:"I",\u00CF:"I",\u00EC:"i",\u00ED:"i",\u00EE:"i",\u00EF:"i",\u00D1:"N",\u00F1:"n",\u00D2:"O",\u00D3:"O",\u00D4:"O",\u00D5:"O",\u00D6:"O",\u00D8:"O",\u00F2:"o",\u00F3:"o",\u00F4:"o",\u00F5:"o",\u00F6:"o",\u00F8:"o",\u00D9:"U",\u00DA:"U",\u00DB:"U",\u00DC:"U",\u00F9:"u",\u00FA:"u",\u00FB:"u",\u00FC:"u",\u00DD:"Y",\u00FD:"y",\u00FF:"y",\u00C6:"Ae",\u00E6:"ae",\u00DE:"Th",\u00FE:"th",\u00DF:"ss",\u0100:"A",\u0102:"A",\u0104:"A",\u0101:"a",\u0103:"a",\u0105:"a",\u0106:"C",\u0108:"C",\u010A:"C",\u010C:"C",\u0107:"c",\u0109:"c",\u010B:"c",\u010D:"c",\u010E:"D",\u0110:"D",\u010F:"d",\u0111:"d",\u0112:"E",\u0114:"E",\u0116:"E",\u0118:"E",\u011A:"E",\u0113:"e",\u0115:"e",\u0117:"e",\u0119:"e",\u011B:"e",\u011C:"G",\u011E:"G",\u0120:"G",\u0122:"G",\u011D:"g",\u011F:"g",\u0121:"g",\u0123:"g",\u0124:"H",\u0126:"H",\u0125:"h",\u0127:"h",\u0128:"I",\u012A:"I",\u012C:"I",\u012E:"I",\u0130:"I",\u0129:"i",\u012B:"i",\u012D:"i",\u012F:"i",\u0131:"i",\u0134:"J",\u0135:"j",\u0136:"K",\u0137:"k",\u0138:"k",\u0139:"L",\u013B:"L",\u013D:"L",\u013F:"L",\u0141:"L",\u013A:"l",\u013C:"l",\u013E:"l",\u0140:"l",\u0142:"l",\u0143:"N",\u0145:"N",\u0147:"N",\u014A:"N",\u0144:"n",\u0146:"n",\u0148:"n",\u014B:"n",\u014C:"O",\u014E:"O",\u0150:"O",\u014D:"o",\u014F:"o",\u0151:"o",\u0154:"R",\u0156:"R",\u0158:"R",\u0155:"r",\u0157:"r",\u0159:"r",\u015A:"S",\u015C:"S",\u015E:"S",\u0160:"S",\u015B:"s",\u015D:"s",\u015F:"s",\u0161:"s",\u0162:"T",\u0164:"T",\u0166:"T",\u0163:"t",\u0165:"t",\u0167:"t",\u0168:"U",\u016A:"U",\u016C:"U",\u016E:"U",\u0170:"U",\u0172:"U",\u0169:"u",\u016B:"u",\u016D:"u",\u016F:"u",\u0171:"u",\u0173:"u",\u0174:"W",\u0175:"w",\u0176:"Y",\u0177:"y",\u0178:"Y",\u0179:"Z",\u017B:"Z",\u017D:"Z",\u017A:"z",\u017C:"z",\u017E:"z",\u0132:"IJ",\u0133:"ij",\u0152:"Oe",\u0153:"oe",\u0149:"'n",\u017F:"ss"},$m=typeof global=="object"&&global&&global.Object===Object&&global,Vm=typeof self=="object"&&self&&self.Object===Object&&self,Ym=$m||Vm||Function("return this")();function Km(r,e,t,i){var n=-1,s=r?r.length:0;for(i&&s&&(t=r[++n]);++n<s;)t=e(t,r[n],n,r);return t}function Jm(r){return r.split("")}function Xm(r){return r.match(wm)||[]}function Zm(r){return function(e){return r?.[e]}}var Qm=Zm(Wm);function Ru(r){return jm.test(r)}function ev(r){return Gm.test(r)}function tv(r){return Ru(r)?iv(r):Jm(r)}function iv(r){return r.match(zm)||[]}function rv(r){return r.match(Hm)||[]}var nv=Object.prototype,sv=nv.toString,ou=Ym.Symbol,lu=ou?ou.prototype:void 0,cu=lu?lu.toString:void 0;function av(r,e,t){var i=-1,n=r.length;e<0&&(e=-e>n?0:n+e),t=t>n?n:t,t<0&&(t+=n),n=e>t?0:t-e>>>0,e>>>=0;for(var s=Array(n);++i<n;)s[i]=r[i+e];return s}function ov(r){if(typeof r=="string")return r;if(hv(r))return cu?cu.call(r):"";var e=r+"";return e=="0"&&1/r==-bm?"-0":e}function lv(r,e,t){var i=r.length;return t=t===void 0?i:t,!e&&t>=i?r:av(r,e,t)}function cv(r){return function(e){e=En(e);var t=Ru(e)?tv(e):void 0,i=t?t[0]:e.charAt(0),n=t?lv(t,1).join(""):e.slice(1);return i[r]()+n}}function uv(r){return function(e){return Km(vv(gv(e).replace(Bm,"")),r,"")}}function dv(r){return!!r&&typeof r=="object"}function hv(r){return typeof r=="symbol"||dv(r)&&sv.call(r)==Rm}function En(r){return r==null?"":ov(r)}var fv=uv(function(r,e,t){return e=e.toLowerCase(),r+(t?pv(e):e)});function pv(r){return mv(En(r).toLowerCase())}function gv(r){return r=En(r),r&&r.replace(Am,Qm).replace(Um,"")}var mv=cv("toUpperCase");function vv(r,e,t){return r=En(r),e=t?void 0:e,e===void 0?ev(r)?rv(r):Xm(r):r.match(e)||[]}wu.exports=fv});var Ya=g((AT,Ou)=>{"use strict";Ou.exports=yv;function yv(r,e){for(var t=new Array(arguments.length-1),i=0,n=2,s=!0;n<arguments.length;)t[i++]=arguments[n++];return new Promise(function(o,l){t[i]=function(u){if(s)if(s=!1,u)l(u);else{for(var h=new Array(arguments.length-1),f=0;f<h.length;)h[f++]=arguments[f];o.apply(null,h)}};try{r.apply(e||null,t)}catch(c){s&&(s=!1,l(c))}})}});var Pu=g(Nu=>{"use strict";var bn=Nu;bn.length=function(e){var t=e.length;if(!t)return 0;for(var i=0;--t%4>1&&e.charAt(t)==="=";)++i;return Math.ceil(e.length*3)/4-i};var Bi=new Array(64),ku=new Array(123);for(Qe=0;Qe<64;)ku[Bi[Qe]=Qe<26?Qe+65:Qe<52?Qe+71:Qe<62?Qe-4:Qe-59|43]=Qe++;var Qe;bn.encode=function(e,t,i){for(var n=null,s=[],a=0,o=0,l;t<i;){var c=e[t++];switch(o){case 0:s[a++]=Bi[c>>2],l=(c&3)<<4,o=1;break;case 1:s[a++]=Bi[l|c>>4],l=(c&15)<<2,o=2;break;case 2:s[a++]=Bi[l|c>>6],s[a++]=Bi[c&63],o=0;break}a>8191&&((n||(n=[])).push(String.fromCharCode.apply(String,s)),a=0)}return o&&(s[a++]=Bi[l],s[a++]=61,o===1&&(s[a++]=61)),n?(a&&n.push(String.fromCharCode.apply(String,s.slice(0,a))),n.join("")):String.fromCharCode.apply(String,s.slice(0,a))};var Mu="invalid encoding";bn.decode=function(e,t,i){for(var n=i,s=0,a,o=0;o<e.length;){var l=e.charCodeAt(o++);if(l===61&&s>1)break;if((l=ku[l])===void 0)throw Error(Mu);switch(s){case 0:a=l,s=1;break;case 1:t[i++]=a<<2|(l&48)>>4,a=l,s=2;break;case 2:t[i++]=(a&15)<<4|(l&60)>>2,a=l,s=3;break;case 3:t[i++]=(a&3)<<6|l,s=0;break}}if(s===1)throw Error(Mu);return i-n};bn.test=function(e){return/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/.test(e)}});var xu=g((MT,Iu)=>{"use strict";Iu.exports=Rn;function Rn(){this._listeners={}}Rn.prototype.on=function(e,t,i){return(this._listeners[e]||(this._listeners[e]=[])).push({fn:t,ctx:i||this}),this};Rn.prototype.off=function(e,t){if(e===void 0)this._listeners={};else if(t===void 0)this._listeners[e]=[];else for(var i=this._listeners[e],n=0;n<i.length;)i[n].fn===t?i.splice(n,1):++n;return this};Rn.prototype.emit=function(e){var t=this._listeners[e];if(t){for(var i=[],n=1;n<arguments.length;)i.push(arguments[n++]);for(n=0;n<t.length;)t[n].fn.apply(t[n++].ctx,i)}return this}});var zu=g((kT,Uu)=>{"use strict";Uu.exports=Du(Du);function Du(r){return typeof Float32Array<"u"?function(){var e=new Float32Array([-0]),t=new Uint8Array(e.buffer),i=t[3]===128;function n(l,c,u){e[0]=l,c[u]=t[0],c[u+1]=t[1],c[u+2]=t[2],c[u+3]=t[3]}function s(l,c,u){e[0]=l,c[u]=t[3],c[u+1]=t[2],c[u+2]=t[1],c[u+3]=t[0]}r.writeFloatLE=i?n:s,r.writeFloatBE=i?s:n;function a(l,c){return t[0]=l[c],t[1]=l[c+1],t[2]=l[c+2],t[3]=l[c+3],e[0]}function o(l,c){return t[3]=l[c],t[2]=l[c+1],t[1]=l[c+2],t[0]=l[c+3],e[0]}r.readFloatLE=i?a:o,r.readFloatBE=i?o:a}():function(){function e(i,n,s,a){var o=n<0?1:0;if(o&&(n=-n),n===0)i(1/n>0?0:2147483648,s,a);else if(isNaN(n))i(2143289344,s,a);else if(n>34028234663852886e22)i((o<<31|2139095040)>>>0,s,a);else if(n<11754943508222875e-54)i((o<<31|Math.round(n/1401298464324817e-60))>>>0,s,a);else{var l=Math.floor(Math.log(n)/Math.LN2),c=Math.round(n*Math.pow(2,-l)*8388608)&8388607;i((o<<31|l+127<<23|c)>>>0,s,a)}}r.writeFloatLE=e.bind(null,Lu),r.writeFloatBE=e.bind(null,Fu);function t(i,n,s){var a=i(n,s),o=(a>>31)*2+1,l=a>>>23&255,c=a&8388607;return l===255?c?NaN:o*(1/0):l===0?o*1401298464324817e-60*c:o*Math.pow(2,l-150)*(c+8388608)}r.readFloatLE=t.bind(null,qu),r.readFloatBE=t.bind(null,Bu)}(),typeof Float64Array<"u"?function(){var e=new Float64Array([-0]),t=new Uint8Array(e.buffer),i=t[7]===128;function n(l,c,u){e[0]=l,c[u]=t[0],c[u+1]=t[1],c[u+2]=t[2],c[u+3]=t[3],c[u+4]=t[4],c[u+5]=t[5],c[u+6]=t[6],c[u+7]=t[7]}function s(l,c,u){e[0]=l,c[u]=t[7],c[u+1]=t[6],c[u+2]=t[5],c[u+3]=t[4],c[u+4]=t[3],c[u+5]=t[2],c[u+6]=t[1],c[u+7]=t[0]}r.writeDoubleLE=i?n:s,r.writeDoubleBE=i?s:n;function a(l,c){return t[0]=l[c],t[1]=l[c+1],t[2]=l[c+2],t[3]=l[c+3],t[4]=l[c+4],t[5]=l[c+5],t[6]=l[c+6],t[7]=l[c+7],e[0]}function o(l,c){return t[7]=l[c],t[6]=l[c+1],t[5]=l[c+2],t[4]=l[c+3],t[3]=l[c+4],t[2]=l[c+5],t[1]=l[c+6],t[0]=l[c+7],e[0]}r.readDoubleLE=i?a:o,r.readDoubleBE=i?o:a}():function(){function e(i,n,s,a,o,l){var c=a<0?1:0;if(c&&(a=-a),a===0)i(0,o,l+n),i(1/a>0?0:2147483648,o,l+s);else if(isNaN(a))i(0,o,l+n),i(2146959360,o,l+s);else if(a>17976931348623157e292)i(0,o,l+n),i((c<<31|2146435072)>>>0,o,l+s);else{var u;if(a<22250738585072014e-324)u=a/5e-324,i(u>>>0,o,l+n),i((c<<31|u/4294967296)>>>0,o,l+s);else{var h=Math.floor(Math.log(a)/Math.LN2);h===1024&&(h=1023),u=a*Math.pow(2,-h),i(u*4503599627370496>>>0,o,l+n),i((c<<31|h+1023<<20|u*1048576&1048575)>>>0,o,l+s)}}}r.writeDoubleLE=e.bind(null,Lu,0,4),r.writeDoubleBE=e.bind(null,Fu,4,0);function t(i,n,s,a,o){var l=i(a,o+n),c=i(a,o+s),u=(c>>31)*2+1,h=c>>>20&2047,f=4294967296*(c&1048575)+l;return h===2047?f?NaN:u*(1/0):h===0?u*5e-324*f:u*Math.pow(2,h-1075)*(f+4503599627370496)}r.readDoubleLE=t.bind(null,qu,0,4),r.readDoubleBE=t.bind(null,Bu,4,0)}(),r}function Lu(r,e,t){e[t]=r&255,e[t+1]=r>>>8&255,e[t+2]=r>>>16&255,e[t+3]=r>>>24}function Fu(r,e,t){e[t]=r>>>24,e[t+1]=r>>>16&255,e[t+2]=r>>>8&255,e[t+3]=r&255}function qu(r,e){return(r[e]|r[e+1]<<8|r[e+2]<<16|r[e+3]<<24)>>>0}function Bu(r,e){return(r[e]<<24|r[e+1]<<16|r[e+2]<<8|r[e+3])>>>0}});var Ka=g((exports,module)=>{"use strict";module.exports=inquire;function inquire(moduleName){try{var mod=eval("quire".replace(/^/,"re"))(moduleName);if(mod&&(mod.length||Object.keys(mod).length))return mod}catch(r){}return null}});var ju=g(Hu=>{"use strict";var Ja=Hu;Ja.length=function(e){for(var t=0,i=0,n=0;n<e.length;++n)i=e.charCodeAt(n),i<128?t+=1:i<2048?t+=2:(i&64512)===55296&&(e.charCodeAt(n+1)&64512)===56320?(++n,t+=4):t+=3;return t};Ja.read=function(e,t,i){var n=i-t;if(n<1)return"";for(var s=null,a=[],o=0,l;t<i;)l=e[t++],l<128?a[o++]=l:l>191&&l<224?a[o++]=(l&31)<<6|e[t++]&63:l>239&&l<365?(l=((l&7)<<18|(e[t++]&63)<<12|(e[t++]&63)<<6|e[t++]&63)-65536,a[o++]=55296+(l>>10),a[o++]=56320+(l&1023)):a[o++]=(l&15)<<12|(e[t++]&63)<<6|e[t++]&63,o>8191&&((s||(s=[])).push(String.fromCharCode.apply(String,a)),o=0);return s?(o&&s.push(String.fromCharCode.apply(String,a.slice(0,o))),s.join("")):String.fromCharCode.apply(String,a.slice(0,o))};Ja.write=function(e,t,i){for(var n=i,s,a,o=0;o<e.length;++o)s=e.charCodeAt(o),s<128?t[i++]=s:s<2048?(t[i++]=s>>6|192,t[i++]=s&63|128):(s&64512)===55296&&((a=e.charCodeAt(o+1))&64512)===56320?(s=65536+((s&1023)<<10)+(a&1023),++o,t[i++]=s>>18|240,t[i++]=s>>12&63|128,t[i++]=s>>6&63|128,t[i++]=s&63|128):(t[i++]=s>>12|224,t[i++]=s>>6&63|128,t[i++]=s&63|128);return i-n}});var Wu=g((PT,Gu)=>{"use strict";Gu.exports=Sv;function Sv(r,e,t){var i=t||8192,n=i>>>1,s=null,a=i;return function(l){if(l<1||l>n)return r(l);a+l>i&&(s=r(i),a=0);var c=e.call(s,a,a+=l);return a&7&&(a=(a|7)+1),c}}});var Vu=g((IT,$u)=>{"use strict";$u.exports=ge;var Cr=ct();function ge(r,e){this.lo=r>>>0,this.hi=e>>>0}var oi=ge.zero=new ge(0,0);oi.toNumber=function(){return 0};oi.zzEncode=oi.zzDecode=function(){return this};oi.length=function(){return 1};var _v=ge.zeroHash="\0\0\0\0\0\0\0\0";ge.fromNumber=function(e){if(e===0)return oi;var t=e<0;t&&(e=-e);var i=e>>>0,n=(e-i)/4294967296>>>0;return t&&(n=~n>>>0,i=~i>>>0,++i>4294967295&&(i=0,++n>4294967295&&(n=0))),new ge(i,n)};ge.from=function(e){if(typeof e=="number")return ge.fromNumber(e);if(Cr.isString(e))if(Cr.Long)e=Cr.Long.fromString(e);else return ge.fromNumber(parseInt(e,10));return e.low||e.high?new ge(e.low>>>0,e.high>>>0):oi};ge.prototype.toNumber=function(e){if(!e&&this.hi>>>31){var t=~this.lo+1>>>0,i=~this.hi>>>0;return t||(i=i+1>>>0),-(t+i*4294967296)}return this.lo+this.hi*4294967296};ge.prototype.toLong=function(e){return Cr.Long?new Cr.Long(this.lo|0,this.hi|0,!!e):{low:this.lo|0,high:this.hi|0,unsigned:!!e}};var qt=String.prototype.charCodeAt;ge.fromHash=function(e){return e===_v?oi:new ge((qt.call(e,0)|qt.call(e,1)<<8|qt.call(e,2)<<16|qt.call(e,3)<<24)>>>0,(qt.call(e,4)|qt.call(e,5)<<8|qt.call(e,6)<<16|qt.call(e,7)<<24)>>>0)};ge.prototype.toHash=function(){return String.fromCharCode(this.lo&255,this.lo>>>8&255,this.lo>>>16&255,this.lo>>>24,this.hi&255,this.hi>>>8&255,this.hi>>>16&255,this.hi>>>24)};ge.prototype.zzEncode=function(){var e=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^e)>>>0,this.lo=(this.lo<<1^e)>>>0,this};ge.prototype.zzDecode=function(){var e=-(this.lo&1);return this.lo=((this.lo>>>1|this.hi<<31)^e)>>>0,this.hi=(this.hi>>>1^e)>>>0,this};ge.prototype.length=function(){var e=this.lo,t=(this.lo>>>28|this.hi<<4)>>>0,i=this.hi>>>24;return i===0?t===0?e<16384?e<128?1:2:e<2097152?3:4:t<16384?t<128?5:6:t<2097152?7:8:i<128?9:10}});var ct=g(Xa=>{"use strict";var N=Xa;N.asPromise=Ya();N.base64=Pu();N.EventEmitter=xu();N.float=zu();N.inquire=Ka();N.utf8=ju();N.pool=Wu();N.LongBits=Vu();N.isNode=!!(typeof global<"u"&&global&&global.process&&global.process.versions&&global.process.versions.node);N.global=N.isNode&&global||typeof window<"u"&&window||typeof self<"u"&&self||Xa;N.emptyArray=Object.freeze?Object.freeze([]):[];N.emptyObject=Object.freeze?Object.freeze({}):{};N.isInteger=Number.isInteger||function(e){return typeof e=="number"&&isFinite(e)&&Math.floor(e)===e};N.isString=function(e){return typeof e=="string"||e instanceof String};N.isObject=function(e){return e&&typeof e=="object"};N.isset=N.isSet=function(e,t){var i=e[t];return i!=null&&e.hasOwnProperty(t)?typeof i!="object"||(Array.isArray(i)?i.length:Object.keys(i).length)>0:!1};N.Buffer=function(){try{var r=N.inquire("buffer").Buffer;return r.prototype.utf8Write?r:null}catch{return null}}();N._Buffer_from=null;N._Buffer_allocUnsafe=null;N.newBuffer=function(e){return typeof e=="number"?N.Buffer?N._Buffer_allocUnsafe(e):new N.Array(e):N.Buffer?N._Buffer_from(e):typeof Uint8Array>"u"?e:new Uint8Array(e)};N.Array=typeof Uint8Array<"u"?Uint8Array:Array;N.Long=N.global.dcodeIO&&N.global.dcodeIO.Long||N.global.Long||N.inquire("long");N.key2Re=/^true|false|0|1$/;N.key32Re=/^-?(?:0|[1-9][0-9]*)$/;N.key64Re=/^(?:[\\x00-\\xff]{8}|-?(?:0|[1-9][0-9]*))$/;N.longToHash=function(e){return e?N.LongBits.from(e).toHash():N.LongBits.zeroHash};N.longFromHash=function(e,t){var i=N.LongBits.fromHash(e);return N.Long?N.Long.fromBits(i.lo,i.hi,t):i.toNumber(!!t)};function Yu(r,e,t){for(var i=Object.keys(e),n=0;n<i.length;++n)(r[i[n]]===void 0||!t)&&(r[i[n]]=e[i[n]]);return r}N.merge=Yu;N.lcFirst=function(e){return e.charAt(0).toLowerCase()+e.substring(1)};function Ku(r){function e(t,i){if(!(this instanceof e))return new e(t,i);Object.defineProperty(this,"message",{get:function(){return t}}),Error.captureStackTrace?Error.captureStackTrace(this,e):Object.defineProperty(this,"stack",{value:new Error().stack||""}),i&&Yu(this,i)}return e.prototype=Object.create(Error.prototype,{constructor:{value:e,writable:!0,enumerable:!1,configurable:!0},name:{get:function(){return r},set:void 0,enumerable:!1,configurable:!0},toString:{value:function(){return this.name+": "+this.message},writable:!0,enumerable:!1,configurable:!0}}),e}N.newError=Ku;N.ProtocolError=Ku("ProtocolError");N.oneOfGetter=function(e){for(var t={},i=0;i<e.length;++i)t[e[i]]=1;return function(){for(var n=Object.keys(this),s=n.length-1;s>-1;--s)if(t[n[s]]===1&&this[n[s]]!==void 0&&this[n[s]]!==null)return n[s]}};N.oneOfSetter=function(e){return function(t){for(var i=0;i<e.length;++i)e[i]!==t&&delete this[e[i]]}};N.toJSONOptions={longs:String,enums:String,bytes:String,json:!0};N._configure=function(){var r=N.Buffer;if(!r){N._Buffer_from=N._Buffer_allocUnsafe=null;return}N._Buffer_from=r.from!==Uint8Array.from&&r.from||function(t,i){return new r(t,i)},N._Buffer_allocUnsafe=r.allocUnsafe||function(t){return new r(t)}}});var An=g((DT,Qu)=>{"use strict";Qu.exports=H;var je=ct(),Za,wn=je.LongBits,Ju=je.base64,Xu=je.utf8;function Tr(r,e,t){this.fn=r,this.len=e,this.next=void 0,this.val=t}function eo(){}function Cv(r){this.head=r.head,this.tail=r.tail,this.len=r.len,this.next=r.states}function H(){this.len=0,this.head=new Tr(eo,0,0),this.tail=this.head,this.states=null}var Zu=function(){return je.Buffer?function(){return(H.create=function(){return new Za})()}:function(){return new H}};H.create=Zu();H.alloc=function(e){return new je.Array(e)};je.Array!==Array&&(H.alloc=je.pool(H.alloc,je.Array.prototype.subarray));H.prototype._push=function(e,t,i){return this.tail=this.tail.next=new Tr(e,t,i),this.len+=t,this};function to(r,e,t){e[t]=r&255}function Tv(r,e,t){for(;r>127;)e[t++]=r&127|128,r>>>=7;e[t]=r}function io(r,e){this.len=r,this.next=void 0,this.val=e}io.prototype=Object.create(Tr.prototype);io.prototype.fn=Tv;H.prototype.uint32=function(e){return this.len+=(this.tail=this.tail.next=new io((e=e>>>0)<128?1:e<16384?2:e<2097152?3:e<268435456?4:5,e)).len,this};H.prototype.int32=function(e){return e<0?this._push(ro,10,wn.fromNumber(e)):this.uint32(e)};H.prototype.sint32=function(e){return this.uint32((e<<1^e>>31)>>>0)};function ro(r,e,t){for(;r.hi;)e[t++]=r.lo&127|128,r.lo=(r.lo>>>7|r.hi<<25)>>>0,r.hi>>>=7;for(;r.lo>127;)e[t++]=r.lo&127|128,r.lo=r.lo>>>7;e[t++]=r.lo}H.prototype.uint64=function(e){var t=wn.from(e);return this._push(ro,t.length(),t)};H.prototype.int64=H.prototype.uint64;H.prototype.sint64=function(e){var t=wn.from(e).zzEncode();return this._push(ro,t.length(),t)};H.prototype.bool=function(e){return this._push(to,1,e?1:0)};function Qa(r,e,t){e[t]=r&255,e[t+1]=r>>>8&255,e[t+2]=r>>>16&255,e[t+3]=r>>>24}H.prototype.fixed32=function(e){return this._push(Qa,4,e>>>0)};H.prototype.sfixed32=H.prototype.fixed32;H.prototype.fixed64=function(e){var t=wn.from(e);return this._push(Qa,4,t.lo)._push(Qa,4,t.hi)};H.prototype.sfixed64=H.prototype.fixed64;H.prototype.float=function(e){return this._push(je.float.writeFloatLE,4,e)};H.prototype.double=function(e){return this._push(je.float.writeDoubleLE,8,e)};var Ev=je.Array.prototype.set?function(e,t,i){t.set(e,i)}:function(e,t,i){for(var n=0;n<e.length;++n)t[i+n]=e[n]};H.prototype.bytes=function(e){var t=e.length>>>0;if(!t)return this._push(to,1,0);if(je.isString(e)){var i=H.alloc(t=Ju.length(e));Ju.decode(e,i,0),e=i}return this.uint32(t)._push(Ev,t,e)};H.prototype.string=function(e){var t=Xu.length(e);return t?this.uint32(t)._push(Xu.write,t,e):this._push(to,1,0)};H.prototype.fork=function(){return this.states=new Cv(this),this.head=this.tail=new Tr(eo,0,0),this.len=0,this};H.prototype.reset=function(){return this.states?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new Tr(eo,0,0),this.len=0),this};H.prototype.ldelim=function(){var e=this.head,t=this.tail,i=this.len;return this.reset().uint32(i),i&&(this.tail.next=e.next,this.tail=t,this.len+=i),this};H.prototype.finish=function(){for(var e=this.head.next,t=this.constructor.alloc(this.len),i=0;e;)e.fn(e.val,t,i),i+=e.len,e=e.next;return t};H._configure=function(r){Za=r,H.create=Zu(),Za._configure()}});var id=g((LT,td)=>{"use strict";td.exports=ut;var ed=An();(ut.prototype=Object.create(ed.prototype)).constructor=ut;var Bt=ct();function ut(){ed.call(this)}ut._configure=function(){ut.alloc=Bt._Buffer_allocUnsafe,ut.writeBytesBuffer=Bt.Buffer&&Bt.Buffer.prototype instanceof Uint8Array&&Bt.Buffer.prototype.set.name==="set"?function(e,t,i){t.set(e,i)}:function(e,t,i){if(e.copy)e.copy(t,i,0,e.length);else for(var n=0;n<e.length;)t[i++]=e[n++]}};ut.prototype.bytes=function(e){Bt.isString(e)&&(e=Bt._Buffer_from(e,"base64"));var t=e.length>>>0;return this.uint32(t),t&&this._push(ut.writeBytesBuffer,t,e),this};function bv(r,e,t){r.length<40?Bt.utf8.write(r,e,t):e.utf8Write?e.utf8Write(r,t):e.write(r,t)}ut.prototype.string=function(e){var t=Bt.Buffer.byteLength(e);return this.uint32(t),t&&this._push(bv,t,e),this};ut._configure()});var Mn=g((FT,od)=>{"use strict";od.exports=se;var et=ct(),so,sd=et.LongBits,Rv=et.utf8;function tt(r,e){return RangeError("index out of range: "+r.pos+" + "+(e||1)+" > "+r.len)}function se(r){this.buf=r,this.pos=0,this.len=r.length}var rd=typeof Uint8Array<"u"?function(e){if(e instanceof Uint8Array||Array.isArray(e))return new se(e);throw Error("illegal buffer")}:function(e){if(Array.isArray(e))return new se(e);throw Error("illegal buffer")},ad=function(){return et.Buffer?function(t){return(se.create=function(n){return et.Buffer.isBuffer(n)?new so(n):rd(n)})(t)}:rd};se.create=ad();se.prototype._slice=et.Array.prototype.subarray||et.Array.prototype.slice;se.prototype.uint32=function(){var e=4294967295;return function(){if(e=(this.buf[this.pos]&127)>>>0,this.buf[this.pos++]<128||(e=(e|(this.buf[this.pos]&127)<<7)>>>0,this.buf[this.pos++]<128)||(e=(e|(this.buf[this.pos]&127)<<14)>>>0,this.buf[this.pos++]<128)||(e=(e|(this.buf[this.pos]&127)<<21)>>>0,this.buf[this.pos++]<128)||(e=(e|(this.buf[this.pos]&15)<<28)>>>0,this.buf[this.pos++]<128))return e;if((this.pos+=5)>this.len)throw this.pos=this.len,tt(this,10);return e}}();se.prototype.int32=function(){return this.uint32()|0};se.prototype.sint32=function(){var e=this.uint32();return e>>>1^-(e&1)|0};function no(){var r=new sd(0,0),e=0;if(this.len-this.pos>4){for(;e<4;++e)if(r.lo=(r.lo|(this.buf[this.pos]&127)<<e*7)>>>0,this.buf[this.pos++]<128)return r;if(r.lo=(r.lo|(this.buf[this.pos]&127)<<28)>>>0,r.hi=(r.hi|(this.buf[this.pos]&127)>>4)>>>0,this.buf[this.pos++]<128)return r;e=0}else{for(;e<3;++e){if(this.pos>=this.len)throw tt(this);if(r.lo=(r.lo|(this.buf[this.pos]&127)<<e*7)>>>0,this.buf[this.pos++]<128)return r}return r.lo=(r.lo|(this.buf[this.pos++]&127)<<e*7)>>>0,r}if(this.len-this.pos>4){for(;e<5;++e)if(r.hi=(r.hi|(this.buf[this.pos]&127)<<e*7+3)>>>0,this.buf[this.pos++]<128)return r}else for(;e<5;++e){if(this.pos>=this.len)throw tt(this);if(r.hi=(r.hi|(this.buf[this.pos]&127)<<e*7+3)>>>0,this.buf[this.pos++]<128)return r}throw Error("invalid varint encoding")}se.prototype.bool=function(){return this.uint32()!==0};function On(r,e){return(r[e-4]|r[e-3]<<8|r[e-2]<<16|r[e-1]<<24)>>>0}se.prototype.fixed32=function(){if(this.pos+4>this.len)throw tt(this,4);return On(this.buf,this.pos+=4)};se.prototype.sfixed32=function(){if(this.pos+4>this.len)throw tt(this,4);return On(this.buf,this.pos+=4)|0};function nd(){if(this.pos+8>this.len)throw tt(this,8);return new sd(On(this.buf,this.pos+=4),On(this.buf,this.pos+=4))}se.prototype.float=function(){if(this.pos+4>this.len)throw tt(this,4);var e=et.float.readFloatLE(this.buf,this.pos);return this.pos+=4,e};se.prototype.double=function(){if(this.pos+8>this.len)throw tt(this,4);var e=et.float.readDoubleLE(this.buf,this.pos);return this.pos+=8,e};se.prototype.bytes=function(){var e=this.uint32(),t=this.pos,i=this.pos+e;if(i>this.len)throw tt(this,e);if(this.pos+=e,Array.isArray(this.buf))return this.buf.slice(t,i);if(t===i){var n=et.Buffer;return n?n.alloc(0):new this.buf.constructor(0)}return this._slice.call(this.buf,t,i)};se.prototype.string=function(){var e=this.bytes();return Rv.read(e,0,e.length)};se.prototype.skip=function(e){if(typeof e=="number"){if(this.pos+e>this.len)throw tt(this,e);this.pos+=e}else do if(this.pos>=this.len)throw tt(this);while(this.buf[this.pos++]&128);return this};se.prototype.skipType=function(r){switch(r){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;(r=this.uint32()&7)!==4;)this.skipType(r);break;case 5:this.skip(4);break;default:throw Error("invalid wire type "+r+" at offset "+this.pos)}return this};se._configure=function(r){so=r,se.create=ad(),so._configure();var e=et.Long?"toLong":"toNumber";et.merge(se.prototype,{int64:function(){return no.call(this)[e](!1)},uint64:function(){return no.call(this)[e](!0)},sint64:function(){return no.call(this).zzDecode()[e](!1)},fixed64:function(){return nd.call(this)[e](!0)},sfixed64:function(){return nd.call(this)[e](!1)}})}});var dd=g((qT,ud)=>{"use strict";ud.exports=li;var cd=Mn();(li.prototype=Object.create(cd.prototype)).constructor=li;var ld=ct();function li(r){cd.call(this,r)}li._configure=function(){ld.Buffer&&(li.prototype._slice=ld.Buffer.prototype.slice)};li.prototype.string=function(){var e=this.uint32();return this.buf.utf8Slice?this.buf.utf8Slice(this.pos,this.pos=Math.min(this.pos+e,this.len)):this.buf.toString("utf-8",this.pos,this.pos=Math.min(this.pos+e,this.len))};li._configure()});var fd=g((BT,hd)=>{"use strict";hd.exports=Er;var ao=ct();(Er.prototype=Object.create(ao.EventEmitter.prototype)).constructor=Er;function Er(r,e,t){if(typeof r!="function")throw TypeError("rpcImpl must be a function");ao.EventEmitter.call(this),this.rpcImpl=r,this.requestDelimited=!!e,this.responseDelimited=!!t}Er.prototype.rpcCall=function r(e,t,i,n,s){if(!n)throw TypeError("request must be specified");var a=this;if(!s)return ao.asPromise(r,a,e,t,i,n);if(!a.rpcImpl){setTimeout(function(){s(Error("already ended"))},0);return}try{return a.rpcImpl(e,t[a.requestDelimited?"encodeDelimited":"encode"](n).finish(),function(l,c){if(l)return a.emit("error",l,e),s(l);if(c===null){a.end(!0);return}if(!(c instanceof i))try{c=i[a.responseDelimited?"decodeDelimited":"decode"](c)}catch(u){return a.emit("error",u,e),s(u)}return a.emit("data",c,e),s(null,c)})}catch(o){a.emit("error",o,e),setTimeout(function(){s(o)},0);return}};Er.prototype.end=function(e){return this.rpcImpl&&(e||this.rpcImpl(null,null,null),this.rpcImpl=null,this.emit("end").off()),this}});var oo=g(pd=>{"use strict";var wv=pd;wv.Service=fd()});var lo=g((zT,gd)=>{"use strict";gd.exports={}});var yd=g(vd=>{"use strict";var Oe=vd;Oe.build="minimal";Oe.Writer=An();Oe.BufferWriter=id();Oe.Reader=Mn();Oe.BufferReader=dd();Oe.util=ct();Oe.rpc=oo();Oe.roots=lo();Oe.configure=md;function md(){Oe.util._configure(),Oe.Writer._configure(Oe.BufferWriter),Oe.Reader._configure(Oe.BufferReader)}md()});var _d=g((jT,Sd)=>{"use strict";Sd.exports=co;function co(r,e){typeof r=="string"&&(e=r,r=void 0);var t=[];function i(s){if(typeof s!="string"){var a=n();if(co.verbose&&console.log("codegen: "+a),a="return "+a,s){for(var o=Object.keys(s),l=new Array(o.length+1),c=new Array(o.length),u=0;u<o.length;)l[u]=o[u],c[u]=s[o[u++]];return l[u]=a,Function.apply(null,l).apply(null,c)}return Function(a)()}for(var h=new Array(arguments.length-1),f=0;f<h.length;)h[f]=arguments[++f];if(f=0,s=s.replace(/%([%dfijs])/g,function(E,m){var b=h[f++];switch(m){case"d":case"f":return String(Number(b));case"i":return String(Math.floor(b));case"j":return JSON.stringify(b);case"s":return String(b)}return"%"}),f!==h.length)throw Error("parameter count mismatch");return t.push(s),i}function n(s){return"function "+(s||e||"")+"("+(r&&r.join(",")||"")+`){
  `+t.join(`
  `)+`
}`}return i.toString=n,i}co.verbose=!1});var Td=g((GT,Cd)=>{"use strict";Cd.exports=br;var Av=Ya(),Ov=Ka(),uo=Ov("fs");function br(r,e,t){return typeof e=="function"?(t=e,e={}):e||(e={}),t?!e.xhr&&uo&&uo.readFile?uo.readFile(r,function(n,s){return n&&typeof XMLHttpRequest<"u"?br.xhr(r,e,t):n?t(n):t(null,e.binary?s:s.toString("utf8"))}):br.xhr(r,e,t):Av(br,this,r,e)}br.xhr=function(e,t,i){var n=new XMLHttpRequest;n.onreadystatechange=function(){if(n.readyState===4){if(n.status!==0&&n.status!==200)return i(Error("status "+n.status));if(t.binary){var a=n.response;if(!a){a=[];for(var o=0;o<n.responseText.length;++o)a.push(n.responseText.charCodeAt(o)&255)}return i(null,typeof Uint8Array<"u"?new Uint8Array(a):a)}return i(null,n.responseText)}},t.binary&&("overrideMimeType"in n&&n.overrideMimeType("text/plain; charset=x-user-defined"),n.responseType="arraybuffer"),n.open("GET",e),n.send()}});var Rd=g(bd=>{"use strict";var fo=bd,Ed=fo.isAbsolute=function(e){return/^(?:\/|\w+:)/.test(e)},ho=fo.normalize=function(e){e=e.replace(/\\/g,"/").replace(/\/{2,}/g,"/");var t=e.split("/"),i=Ed(e),n="";i&&(n=t.shift()+"/");for(var s=0;s<t.length;)t[s]===".."?s>0&&t[s-1]!==".."?t.splice(--s,2):i?t.splice(s,1):++s:t[s]==="."?t.splice(s,1):++s;return n+t.join("/")};fo.resolve=function(e,t,i){return i||(t=ho(t)),Ed(t)?t:(i||(e=ho(e)),(e=e.replace(/(?:\/|^)[^/]+$/,"")).length?ho(e+"/"+t):t)}});var ci=g(wd=>{"use strict";var Rr=wd,Mv=me(),kv=["double","float","int32","uint32","sint32","fixed32","sfixed32","int64","uint64","sint64","fixed64","sfixed64","bool","string","bytes"];function wr(r,e){var t=0,i={};for(e|=0;t<r.length;)i[kv[t+e]]=r[t++];return i}Rr.basic=wr([1,5,0,0,0,5,5,0,0,0,1,1,0,2,2]);Rr.defaults=wr([0,0,0,0,0,0,0,0,0,0,0,0,!1,"",Mv.emptyArray,null]);Rr.long=wr([0,0,0,1,1],7);Rr.mapKey=wr([0,0,0,5,5,0,0,0,1,1,0,2],2);Rr.packed=wr([1,5,0,0,0,5,5,0,0,0,1,1,0])});var Ut=g((VT,Md)=>{"use strict";Md.exports=Ge;var kn=ui();((Ge.prototype=Object.create(kn.prototype)).constructor=Ge).className="Field";var Ad=it(),Od=ci(),ce=me(),po,Nv=/^required|optional|repeated$/;Ge.fromJSON=function(e,t){return new Ge(e,t.id,t.type,t.rule,t.extend,t.options,t.comment)};function Ge(r,e,t,i,n,s,a){if(ce.isObject(i)?(a=n,s=i,i=n=void 0):ce.isObject(n)&&(a=s,s=n,n=void 0),kn.call(this,r,s),!ce.isInteger(e)||e<0)throw TypeError("id must be a non-negative integer");if(!ce.isString(t))throw TypeError("type must be a string");if(i!==void 0&&!Nv.test(i=i.toString().toLowerCase()))throw TypeError("rule must be a string rule");if(n!==void 0&&!ce.isString(n))throw TypeError("extend must be a string");i==="proto3_optional"&&(i="optional"),this.rule=i&&i!=="optional"?i:void 0,this.type=t,this.id=e,this.extend=n||void 0,this.required=i==="required",this.optional=!this.required,this.repeated=i==="repeated",this.map=!1,this.message=null,this.partOf=null,this.typeDefault=null,this.defaultValue=null,this.long=ce.Long?Od.long[t]!==void 0:!1,this.bytes=t==="bytes",this.resolvedType=null,this.extensionField=null,this.declaringField=null,this._packed=null,this.comment=a}Object.defineProperty(Ge.prototype,"packed",{get:function(){return this._packed===null&&(this._packed=this.getOption("packed")!==!1),this._packed}});Ge.prototype.setOption=function(e,t,i){return e==="packed"&&(this._packed=null),kn.prototype.setOption.call(this,e,t,i)};Ge.prototype.toJSON=function(e){var t=e?!!e.keepComments:!1;return ce.toObject(["rule",this.rule!=="optional"&&this.rule||void 0,"type",this.type,"id",this.id,"extend",this.extend,"options",this.options,"comment",t?this.comment:void 0])};Ge.prototype.resolve=function(){if(this.resolved)return this;if((this.typeDefault=Od.defaults[this.type])===void 0?(this.resolvedType=(this.declaringField?this.declaringField.parent:this.parent).lookupTypeOrEnum(this.type),this.resolvedType instanceof po?this.typeDefault=null:this.typeDefault=this.resolvedType.values[Object.keys(this.resolvedType.values)[0]]):this.options&&this.options.proto3_optional&&(this.typeDefault=null),this.options&&this.options.default!=null&&(this.typeDefault=this.options.default,this.resolvedType instanceof Ad&&typeof this.typeDefault=="string"&&(this.typeDefault=this.resolvedType.values[this.typeDefault])),this.options&&((this.options.packed===!0||this.options.packed!==void 0&&this.resolvedType&&!(this.resolvedType instanceof Ad))&&delete this.options.packed,Object.keys(this.options).length||(this.options=void 0)),this.long)this.typeDefault=ce.Long.fromNumber(this.typeDefault,this.type.charAt(0)==="u"),Object.freeze&&Object.freeze(this.typeDefault);else if(this.bytes&&typeof this.typeDefault=="string"){var e;ce.base64.test(this.typeDefault)?ce.base64.decode(this.typeDefault,e=ce.newBuffer(ce.base64.length(this.typeDefault)),0):ce.utf8.write(this.typeDefault,e=ce.newBuffer(ce.utf8.length(this.typeDefault)),0),this.typeDefault=e}return this.map?this.defaultValue=ce.emptyObject:this.repeated?this.defaultValue=ce.emptyArray:this.defaultValue=this.typeDefault,this.parent instanceof po&&(this.parent.ctor.prototype[this.name]=this.defaultValue),kn.prototype.resolve.call(this)};Ge.d=function(e,t,i,n){return typeof t=="function"?t=ce.decorateType(t).name:t&&typeof t=="object"&&(t=ce.decorateEnum(t).name),function(a,o){ce.decorateType(a.constructor).add(new Ge(o,e,t,i,{default:n}))}};Ge._configure=function(e){po=e}});var Ui=g((YT,Pd)=>{"use strict";Pd.exports=We;var Pn=ui();((We.prototype=Object.create(Pn.prototype)).constructor=We).className="OneOf";var kd=Ut(),Nn=me();function We(r,e,t,i){if(Array.isArray(e)||(t=e,e=void 0),Pn.call(this,r,t),!(e===void 0||Array.isArray(e)))throw TypeError("fieldNames must be an Array");this.oneof=e||[],this.fieldsArray=[],this.comment=i}We.fromJSON=function(e,t){return new We(e,t.oneof,t.options,t.comment)};We.prototype.toJSON=function(e){var t=e?!!e.keepComments:!1;return Nn.toObject(["options",this.options,"oneof",this.oneof,"comment",t?this.comment:void 0])};function Nd(r){if(r.parent)for(var e=0;e<r.fieldsArray.length;++e)r.fieldsArray[e].parent||r.parent.add(r.fieldsArray[e])}We.prototype.add=function(e){if(!(e instanceof kd))throw TypeError("field must be a Field");return e.parent&&e.parent!==this.parent&&e.parent.remove(e),this.oneof.push(e.name),this.fieldsArray.push(e),e.partOf=this,Nd(this),this};We.prototype.remove=function(e){if(!(e instanceof kd))throw TypeError("field must be a Field");var t=this.fieldsArray.indexOf(e);if(t<0)throw Error(e+" is not a member of "+this);return this.fieldsArray.splice(t,1),t=this.oneof.indexOf(e.name),t>-1&&this.oneof.splice(t,1),e.partOf=null,this};We.prototype.onAdd=function(e){Pn.prototype.onAdd.call(this,e);for(var t=this,i=0;i<this.oneof.length;++i){var n=e.get(this.oneof[i]);n&&!n.partOf&&(n.partOf=t,t.fieldsArray.push(n))}Nd(this)};We.prototype.onRemove=function(e){for(var t=0,i;t<this.fieldsArray.length;++t)(i=this.fieldsArray[t]).parent&&i.parent.remove(i);Pn.prototype.onRemove.call(this,e)};We.d=function(){for(var e=new Array(arguments.length),t=0;t<arguments.length;)e[t]=arguments[t++];return function(n,s){Nn.decorateType(n.constructor).add(new We(s,e)),Object.defineProperty(n,s,{get:Nn.oneOfGetter(e),set:Nn.oneOfSetter(e)})}}});var ji=g((KT,Ld)=>{"use strict";Ld.exports=j;var go=ui();((j.prototype=Object.create(go.prototype)).constructor=j).className="Namespace";var Id=Ut(),In=me(),Pv=Ui(),zi,Ar,Hi;j.fromJSON=function(e,t){return new j(e,t.options).addJSON(t.nested)};function xd(r,e){if(r&&r.length){for(var t={},i=0;i<r.length;++i)t[r[i].name]=r[i].toJSON(e);return t}}j.arrayToJSON=xd;j.isReservedId=function(e,t){if(e){for(var i=0;i<e.length;++i)if(typeof e[i]!="string"&&e[i][0]<=t&&e[i][1]>t)return!0}return!1};j.isReservedName=function(e,t){if(e){for(var i=0;i<e.length;++i)if(e[i]===t)return!0}return!1};function j(r,e){go.call(this,r,e),this.nested=void 0,this._nestedArray=null}function Dd(r){return r._nestedArray=null,r}Object.defineProperty(j.prototype,"nestedArray",{get:function(){return this._nestedArray||(this._nestedArray=In.toArray(this.nested))}});j.prototype.toJSON=function(e){return In.toObject(["options",this.options,"nested",xd(this.nestedArray,e)])};j.prototype.addJSON=function(e){var t=this;if(e)for(var i=Object.keys(e),n=0,s;n<i.length;++n)s=e[i[n]],t.add((s.fields!==void 0?zi.fromJSON:s.values!==void 0?Hi.fromJSON:s.methods!==void 0?Ar.fromJSON:s.id!==void 0?Id.fromJSON:j.fromJSON)(i[n],s));return this};j.prototype.get=function(e){return this.nested&&this.nested[e]||null};j.prototype.getEnum=function(e){if(this.nested&&this.nested[e]instanceof Hi)return this.nested[e].values;throw Error("no such enum: "+e)};j.prototype.add=function(e){if(!(e instanceof Id&&e.extend!==void 0||e instanceof zi||e instanceof Pv||e instanceof Hi||e instanceof Ar||e instanceof j))throw TypeError("object must be a valid nested object");if(!this.nested)this.nested={};else{var t=this.get(e.name);if(t)if(t instanceof j&&e instanceof j&&!(t instanceof zi||t instanceof Ar)){for(var i=t.nestedArray,n=0;n<i.length;++n)e.add(i[n]);this.remove(t),this.nested||(this.nested={}),e.setOptions(t.options,!0)}else throw Error("duplicate name '"+e.name+"' in "+this)}return this.nested[e.name]=e,e.onAdd(this),Dd(this)};j.prototype.remove=function(e){if(!(e instanceof go))throw TypeError("object must be a ReflectionObject");if(e.parent!==this)throw Error(e+" is not a member of "+this);return delete this.nested[e.name],Object.keys(this.nested).length||(this.nested=void 0),e.onRemove(this),Dd(this)};j.prototype.define=function(e,t){if(In.isString(e))e=e.split(".");else if(!Array.isArray(e))throw TypeError("illegal path");if(e&&e.length&&e[0]==="")throw Error("path must be relative");for(var i=this;e.length>0;){var n=e.shift();if(i.nested&&i.nested[n]){if(i=i.nested[n],!(i instanceof j))throw Error("path conflicts with non-namespace objects")}else i.add(i=new j(n))}return t&&i.addJSON(t),i};j.prototype.resolveAll=function(){for(var e=this.nestedArray,t=0;t<e.length;)e[t]instanceof j?e[t++].resolveAll():e[t++].resolve();return this.resolve()};j.prototype.lookup=function(e,t,i){if(typeof t=="boolean"?(i=t,t=void 0):t&&!Array.isArray(t)&&(t=[t]),In.isString(e)&&e.length){if(e===".")return this.root;e=e.split(".")}else if(!e.length)return this;if(e[0]==="")return this.root.lookup(e.slice(1),t);var n=this.get(e[0]);if(n){if(e.length===1){if(!t||t.indexOf(n.constructor)>-1)return n}else if(n instanceof j&&(n=n.lookup(e.slice(1),t,!0)))return n}else for(var s=0;s<this.nestedArray.length;++s)if(this._nestedArray[s]instanceof j&&(n=this._nestedArray[s].lookup(e,t,!0)))return n;return this.parent===null||i?null:this.parent.lookup(e,t)};j.prototype.lookupType=function(e){var t=this.lookup(e,[zi]);if(!t)throw Error("no such type: "+e);return t};j.prototype.lookupEnum=function(e){var t=this.lookup(e,[Hi]);if(!t)throw Error("no such Enum '"+e+"' in "+this);return t};j.prototype.lookupTypeOrEnum=function(e){var t=this.lookup(e,[zi,Hi]);if(!t)throw Error("no such Type or Enum '"+e+"' in "+this);return t};j.prototype.lookupService=function(e){var t=this.lookup(e,[Ar]);if(!t)throw Error("no such Service '"+e+"' in "+this);return t};j._configure=function(r,e,t){zi=r,Ar=e,Hi=t}});var xn=g((JT,Fd)=>{"use strict";Fd.exports=Et;var mo=Ut();((Et.prototype=Object.create(mo.prototype)).constructor=Et).className="MapField";var Iv=ci(),Or=me();function Et(r,e,t,i,n,s){if(mo.call(this,r,e,i,void 0,void 0,n,s),!Or.isString(t))throw TypeError("keyType must be a string");this.keyType=t,this.resolvedKeyType=null,this.map=!0}Et.fromJSON=function(e,t){return new Et(e,t.id,t.keyType,t.type,t.options,t.comment)};Et.prototype.toJSON=function(e){var t=e?!!e.keepComments:!1;return Or.toObject(["keyType",this.keyType,"type",this.type,"id",this.id,"extend",this.extend,"options",this.options,"comment",t?this.comment:void 0])};Et.prototype.resolve=function(){if(this.resolved)return this;if(Iv.mapKey[this.keyType]===void 0)throw Error("invalid key type: "+this.keyType);return mo.prototype.resolve.call(this)};Et.d=function(e,t,i){return typeof i=="function"?i=Or.decorateType(i).name:i&&typeof i=="object"&&(i=Or.decorateEnum(i).name),function(s,a){Or.decorateType(s.constructor).add(new Et(a,e,t,i))}}});var Dn=g((XT,qd)=>{"use strict";qd.exports=di;var vo=ui();((di.prototype=Object.create(vo.prototype)).constructor=di).className="Method";var Gi=me();function di(r,e,t,i,n,s,a,o,l){if(Gi.isObject(n)?(a=n,n=s=void 0):Gi.isObject(s)&&(a=s,s=void 0),!(e===void 0||Gi.isString(e)))throw TypeError("type must be a string");if(!Gi.isString(t))throw TypeError("requestType must be a string");if(!Gi.isString(i))throw TypeError("responseType must be a string");vo.call(this,r,a),this.type=e||"rpc",this.requestType=t,this.requestStream=n?!0:void 0,this.responseType=i,this.responseStream=s?!0:void 0,this.resolvedRequestType=null,this.resolvedResponseType=null,this.comment=o,this.parsedOptions=l}di.fromJSON=function(e,t){return new di(e,t.type,t.requestType,t.responseType,t.requestStream,t.responseStream,t.options,t.comment,t.parsedOptions)};di.prototype.toJSON=function(e){var t=e?!!e.keepComments:!1;return Gi.toObject(["type",this.type!=="rpc"&&this.type||void 0,"requestType",this.requestType,"requestStream",this.requestStream,"responseType",this.responseType,"responseStream",this.responseStream,"options",this.options,"comment",t?this.comment:void 0,"parsedOptions",this.parsedOptions])};di.prototype.resolve=function(){return this.resolved?this:(this.resolvedRequestType=this.parent.lookupType(this.requestType),this.resolvedResponseType=this.parent.lookupType(this.responseType),vo.prototype.resolve.call(this))}});var Ln=g((ZT,Ud)=>{"use strict";Ud.exports=$e;var zt=ji();(($e.prototype=Object.create(zt.prototype)).constructor=$e).className="Service";var yo=Dn(),Mr=me(),xv=oo();function $e(r,e){zt.call(this,r,e),this.methods={},this._methodsArray=null}$e.fromJSON=function(e,t){var i=new $e(e,t.options);if(t.methods)for(var n=Object.keys(t.methods),s=0;s<n.length;++s)i.add(yo.fromJSON(n[s],t.methods[n[s]]));return t.nested&&i.addJSON(t.nested),i.comment=t.comment,i};$e.prototype.toJSON=function(e){var t=zt.prototype.toJSON.call(this,e),i=e?!!e.keepComments:!1;return Mr.toObject(["options",t&&t.options||void 0,"methods",zt.arrayToJSON(this.methodsArray,e)||{},"nested",t&&t.nested||void 0,"comment",i?this.comment:void 0])};Object.defineProperty($e.prototype,"methodsArray",{get:function(){return this._methodsArray||(this._methodsArray=Mr.toArray(this.methods))}});function Bd(r){return r._methodsArray=null,r}$e.prototype.get=function(e){return this.methods[e]||zt.prototype.get.call(this,e)};$e.prototype.resolveAll=function(){for(var e=this.methodsArray,t=0;t<e.length;++t)e[t].resolve();return zt.prototype.resolve.call(this)};$e.prototype.add=function(e){if(this.get(e.name))throw Error("duplicate name '"+e.name+"' in "+this);return e instanceof yo?(this.methods[e.name]=e,e.parent=this,Bd(this)):zt.prototype.add.call(this,e)};$e.prototype.remove=function(e){if(e instanceof yo){if(this.methods[e.name]!==e)throw Error(e+" is not a member of "+this);return delete this.methods[e.name],e.parent=null,Bd(this)}return zt.prototype.remove.call(this,e)};$e.prototype.create=function(e,t,i){for(var n=new xv.Service(e,t,i),s=0,a;s<this.methodsArray.length;++s){var o=Mr.lcFirst((a=this._methodsArray[s]).resolve().name).replace(/[^$\w_]/g,"");n[o]=Mr.codegen(["r","c"],Mr.isReserved(o)?o+"_":o)("return this.rpcCall(m,q,s,r,c)")({m:a,q:a.resolvedRequestType.ctor,s:a.resolvedResponseType.ctor})}return n}});var Fn=g((QT,zd)=>{"use strict";zd.exports=dt;var Dv=ct();function dt(r){if(r)for(var e=Object.keys(r),t=0;t<e.length;++t)this[e[t]]=r[e[t]]}dt.create=function(e){return this.$type.create(e)};dt.encode=function(e,t){return this.$type.encode(e,t)};dt.encodeDelimited=function(e,t){return this.$type.encodeDelimited(e,t)};dt.decode=function(e){return this.$type.decode(e)};dt.decodeDelimited=function(e){return this.$type.decodeDelimited(e)};dt.verify=function(e){return this.$type.verify(e)};dt.fromObject=function(e){return this.$type.fromObject(e)};dt.toObject=function(e,t){return this.$type.toObject(e,t)};dt.prototype.toJSON=function(){return this.$type.toObject(this,Dv.toJSONOptions)}});var So=g((eE,jd)=>{"use strict";jd.exports=qv;var Lv=it(),bt=ci(),Hd=me();function Fv(r){return"missing required '"+r.name+"'"}function qv(r){var e=Hd.codegen(["r","l"],r.name+"$decode")("if(!(r instanceof Reader))")("r=Reader.create(r)")("var c=l===undefined?r.len:r.pos+l,m=new this.ctor"+(r.fieldsArray.filter(function(o){return o.map}).length?",k,value":""))("while(r.pos<c){")("var t=r.uint32()");r.group&&e("if((t&7)===4)")("break"),e("switch(t>>>3){");for(var t=0;t<r.fieldsArray.length;++t){var i=r._fieldsArray[t].resolve(),n=i.resolvedType instanceof Lv?"int32":i.type,s="m"+Hd.safeProp(i.name);e("case %i: {",i.id),i.map?(e("if(%s===util.emptyObject)",s)("%s={}",s)("var c2 = r.uint32()+r.pos"),bt.defaults[i.keyType]!==void 0?e("k=%j",bt.defaults[i.keyType]):e("k=null"),bt.defaults[n]!==void 0?e("value=%j",bt.defaults[n]):e("value=null"),e("while(r.pos<c2){")("var tag2=r.uint32()")("switch(tag2>>>3){")("case 1: k=r.%s(); break",i.keyType)("case 2:"),bt.basic[n]===void 0?e("value=types[%i].decode(r,r.uint32())",t):e("value=r.%s()",n),e("break")("default:")("r.skipType(tag2&7)")("break")("}")("}"),bt.long[i.keyType]!==void 0?e('%s[typeof k==="object"?util.longToHash(k):k]=value',s):e("%s[k]=value",s)):i.repeated?(e("if(!(%s&&%s.length))",s,s)("%s=[]",s),bt.packed[n]!==void 0&&e("if((t&7)===2){")("var c2=r.uint32()+r.pos")("while(r.pos<c2)")("%s.push(r.%s())",s,n)("}else"),bt.basic[n]===void 0?e(i.resolvedType.group?"%s.push(types[%i].decode(r))":"%s.push(types[%i].decode(r,r.uint32()))",s,t):e("%s.push(r.%s())",s,n)):bt.basic[n]===void 0?e(i.resolvedType.group?"%s=types[%i].decode(r)":"%s=types[%i].decode(r,r.uint32())",s,t):e("%s=r.%s()",s,n),e("break")("}")}for(e("default:")("r.skipType(t&7)")("break")("}")("}"),t=0;t<r._fieldsArray.length;++t){var a=r._fieldsArray[t];a.required&&e("if(!m.hasOwnProperty(%j))",a.name)("throw util.ProtocolError(%j,{instance:m})",Fv(a))}return e("return m")}});var To=g((tE,Gd)=>{"use strict";Gd.exports=zv;var Bv=it(),_o=me();function Ve(r,e){return r.name+": "+e+(r.repeated&&e!=="array"?"[]":r.map&&e!=="object"?"{k:"+r.keyType+"}":"")+" expected"}function Co(r,e,t,i){if(e.resolvedType)if(e.resolvedType instanceof Bv){r("switch(%s){",i)("default:")("return%j",Ve(e,"enum value"));for(var n=Object.keys(e.resolvedType.values),s=0;s<n.length;++s)r("case %i:",e.resolvedType.values[n[s]]);r("break")("}")}else r("{")("var e=types[%i].verify(%s);",t,i)("if(e)")("return%j+e",e.name+".")("}");else switch(e.type){case"int32":case"uint32":case"sint32":case"fixed32":case"sfixed32":r("if(!util.isInteger(%s))",i)("return%j",Ve(e,"integer"));break;case"int64":case"uint64":case"sint64":case"fixed64":case"sfixed64":r("if(!util.isInteger(%s)&&!(%s&&util.isInteger(%s.low)&&util.isInteger(%s.high)))",i,i,i,i)("return%j",Ve(e,"integer|Long"));break;case"float":case"double":r('if(typeof %s!=="number")',i)("return%j",Ve(e,"number"));break;case"bool":r('if(typeof %s!=="boolean")',i)("return%j",Ve(e,"boolean"));break;case"string":r("if(!util.isString(%s))",i)("return%j",Ve(e,"string"));break;case"bytes":r('if(!(%s&&typeof %s.length==="number"||util.isString(%s)))',i,i,i)("return%j",Ve(e,"buffer"));break}return r}function Uv(r,e,t){switch(e.keyType){case"int32":case"uint32":case"sint32":case"fixed32":case"sfixed32":r("if(!util.key32Re.test(%s))",t)("return%j",Ve(e,"integer key"));break;case"int64":case"uint64":case"sint64":case"fixed64":case"sfixed64":r("if(!util.key64Re.test(%s))",t)("return%j",Ve(e,"integer|Long key"));break;case"bool":r("if(!util.key2Re.test(%s))",t)("return%j",Ve(e,"boolean key"));break}return r}function zv(r){var e=_o.codegen(["m"],r.name+"$verify")('if(typeof m!=="object"||m===null)')("return%j","object expected"),t=r.oneofsArray,i={};t.length&&e("var p={}");for(var n=0;n<r.fieldsArray.length;++n){var s=r._fieldsArray[n].resolve(),a="m"+_o.safeProp(s.name);if(s.optional&&e("if(%s!=null&&m.hasOwnProperty(%j)){",a,s.name),s.map)e("if(!util.isObject(%s))",a)("return%j",Ve(s,"object"))("var k=Object.keys(%s)",a)("for(var i=0;i<k.length;++i){"),Uv(e,s,"k[i]"),Co(e,s,n,a+"[k[i]]")("}");else if(s.repeated)e("if(!Array.isArray(%s))",a)("return%j",Ve(s,"array"))("for(var i=0;i<%s.length;++i){",a),Co(e,s,n,a+"[i]")("}");else{if(s.partOf){var o=_o.safeProp(s.partOf.name);i[s.partOf.name]===1&&e("if(p%s===1)",o)("return%j",s.partOf.name+": multiple values"),i[s.partOf.name]=1,e("p%s=1",o)}Co(e,s,n,a)}s.optional&&e("}")}return e("return null")}});var Ro=g($d=>{"use strict";var Wd=$d,kr=it(),ht=me();function Eo(r,e,t,i){var n=!1;if(e.resolvedType)if(e.resolvedType instanceof kr){r("switch(d%s){",i);for(var s=e.resolvedType.values,a=Object.keys(s),o=0;o<a.length;++o)s[a[o]]===e.typeDefault&&!n&&(r("default:")('if(typeof(d%s)==="number"){m%s=d%s;break}',i,i,i),e.repeated||r("break"),n=!0),r("case%j:",a[o])("case %i:",s[a[o]])("m%s=%j",i,s[a[o]])("break");r("}")}else r('if(typeof d%s!=="object")',i)("throw TypeError(%j)",e.fullName+": object expected")("m%s=types[%i].fromObject(d%s)",i,t,i);else{var l=!1;switch(e.type){case"double":case"float":r("m%s=Number(d%s)",i,i);break;case"uint32":case"fixed32":r("m%s=d%s>>>0",i,i);break;case"int32":case"sint32":case"sfixed32":r("m%s=d%s|0",i,i);break;case"uint64":l=!0;case"int64":case"sint64":case"fixed64":case"sfixed64":r("if(util.Long)")("(m%s=util.Long.fromValue(d%s)).unsigned=%j",i,i,l)('else if(typeof d%s==="string")',i)("m%s=parseInt(d%s,10)",i,i)('else if(typeof d%s==="number")',i)("m%s=d%s",i,i)('else if(typeof d%s==="object")',i)("m%s=new util.LongBits(d%s.low>>>0,d%s.high>>>0).toNumber(%s)",i,i,i,l?"true":"");break;case"bytes":r('if(typeof d%s==="string")',i)("util.base64.decode(d%s,m%s=util.newBuffer(util.base64.length(d%s)),0)",i,i,i)("else if(d%s.length >= 0)",i)("m%s=d%s",i,i);break;case"string":r("m%s=String(d%s)",i,i);break;case"bool":r("m%s=Boolean(d%s)",i,i);break}}return r}Wd.fromObject=function(e){var t=e.fieldsArray,i=ht.codegen(["d"],e.name+"$fromObject")("if(d instanceof this.ctor)")("return d");if(!t.length)return i("return new this.ctor");i("var m=new this.ctor");for(var n=0;n<t.length;++n){var s=t[n].resolve(),a=ht.safeProp(s.name);s.map?(i("if(d%s){",a)('if(typeof d%s!=="object")',a)("throw TypeError(%j)",s.fullName+": object expected")("m%s={}",a)("for(var ks=Object.keys(d%s),i=0;i<ks.length;++i){",a),Eo(i,s,n,a+"[ks[i]]")("}")("}")):s.repeated?(i("if(d%s){",a)("if(!Array.isArray(d%s))",a)("throw TypeError(%j)",s.fullName+": array expected")("m%s=[]",a)("for(var i=0;i<d%s.length;++i){",a),Eo(i,s,n,a+"[i]")("}")("}")):(s.resolvedType instanceof kr||i("if(d%s!=null){",a),Eo(i,s,n,a),s.resolvedType instanceof kr||i("}"))}return i("return m")};function bo(r,e,t,i){if(e.resolvedType)e.resolvedType instanceof kr?r("d%s=o.enums===String?(types[%i].values[m%s]===undefined?m%s:types[%i].values[m%s]):m%s",i,t,i,i,t,i,i):r("d%s=types[%i].toObject(m%s,o)",i,t,i);else{var n=!1;switch(e.type){case"double":case"float":r("d%s=o.json&&!isFinite(m%s)?String(m%s):m%s",i,i,i,i);break;case"uint64":n=!0;case"int64":case"sint64":case"fixed64":case"sfixed64":r('if(typeof m%s==="number")',i)("d%s=o.longs===String?String(m%s):m%s",i,i,i)("else")("d%s=o.longs===String?util.Long.prototype.toString.call(m%s):o.longs===Number?new util.LongBits(m%s.low>>>0,m%s.high>>>0).toNumber(%s):m%s",i,i,i,i,n?"true":"",i);break;case"bytes":r("d%s=o.bytes===String?util.base64.encode(m%s,0,m%s.length):o.bytes===Array?Array.prototype.slice.call(m%s):m%s",i,i,i,i,i);break;default:r("d%s=m%s",i,i);break}}return r}Wd.toObject=function(e){var t=e.fieldsArray.slice().sort(ht.compareFieldsById);if(!t.length)return ht.codegen()("return {}");for(var i=ht.codegen(["m","o"],e.name+"$toObject")("if(!o)")("o={}")("var d={}"),n=[],s=[],a=[],o=0;o<t.length;++o)t[o].partOf||(t[o].resolve().repeated?n:t[o].map?s:a).push(t[o]);if(n.length){for(i("if(o.arrays||o.defaults){"),o=0;o<n.length;++o)i("d%s=[]",ht.safeProp(n[o].name));i("}")}if(s.length){for(i("if(o.objects||o.defaults){"),o=0;o<s.length;++o)i("d%s={}",ht.safeProp(s[o].name));i("}")}if(a.length){for(i("if(o.defaults){"),o=0;o<a.length;++o){var l=a[o],c=ht.safeProp(l.name);if(l.resolvedType instanceof kr)i("d%s=o.enums===String?%j:%j",c,l.resolvedType.valuesById[l.typeDefault],l.typeDefault);else if(l.long)i("if(util.Long){")("var n=new util.Long(%i,%i,%j)",l.typeDefault.low,l.typeDefault.high,l.typeDefault.unsigned)("d%s=o.longs===String?n.toString():o.longs===Number?n.toNumber():n",c)("}else")("d%s=o.longs===String?%j:%i",c,l.typeDefault.toString(),l.typeDefault.toNumber());else if(l.bytes){var u="["+Array.prototype.slice.call(l.typeDefault).join(",")+"]";i("if(o.bytes===String)d%s=%j",c,String.fromCharCode.apply(String,l.typeDefault))("else{")("d%s=%s",c,u)("if(o.bytes!==Array)d%s=util.newBuffer(d%s)",c,c)("}")}else i("d%s=%j",c,l.typeDefault)}i("}")}var h=!1;for(o=0;o<t.length;++o){var l=t[o],f=e._fieldsArray.indexOf(l),c=ht.safeProp(l.name);l.map?(h||(h=!0,i("var ks2")),i("if(m%s&&(ks2=Object.keys(m%s)).length){",c,c)("d%s={}",c)("for(var j=0;j<ks2.length;++j){"),bo(i,l,f,c+"[ks2[j]]")("}")):l.repeated?(i("if(m%s&&m%s.length){",c,c)("d%s=[]",c)("for(var j=0;j<m%s.length;++j){",c),bo(i,l,f,c+"[j]")("}")):(i("if(m%s!=null&&m.hasOwnProperty(%j)){",c,l.name),bo(i,l,f,c),l.partOf&&i("if(o.oneofs)")("d%s=%j",ht.safeProp(l.partOf.name),l.name)),i("}")}return i("return d")}});var wo=g(Vd=>{"use strict";var Hv=Vd,jv=Fn();Hv[".google.protobuf.Any"]={fromObject:function(r){if(r&&r["@type"]){var e=r["@type"].substring(r["@type"].lastIndexOf("/")+1),t=this.lookup(e);if(t){var i=r["@type"].charAt(0)==="."?r["@type"].slice(1):r["@type"];return i.indexOf("/")===-1&&(i="/"+i),this.create({type_url:i,value:t.encode(t.fromObject(r)).finish()})}}return this.fromObject(r)},toObject:function(r,e){var t="type.googleapis.com/",i="",n="";if(e&&e.json&&r.type_url&&r.value){n=r.type_url.substring(r.type_url.lastIndexOf("/")+1),i=r.type_url.substring(0,r.type_url.lastIndexOf("/")+1);var s=this.lookup(n);s&&(r=s.decode(r.value))}if(!(r instanceof this.ctor)&&r instanceof jv){var a=r.$type.toObject(r,e),o=r.$type.fullName[0]==="."?r.$type.fullName.slice(1):r.$type.fullName;return i===""&&(i=t),n=i+o,a["@type"]=n,a}return this.toObject(r,e)}}});var Un=g((nE,Kd)=>{"use strict";Kd.exports=K;var rt=ji();((K.prototype=Object.create(rt.prototype)).constructor=K).className="Type";var Gv=it(),Mo=Ui(),qn=Ut(),Wv=xn(),$v=Ln(),Ao=Fn(),Oo=Mn(),Vv=An(),Ce=me(),Yv=ko(),Kv=So(),Jv=To(),Yd=Ro(),Xv=wo();function K(r,e){rt.call(this,r,e),this.fields={},this.oneofs=void 0,this.extensions=void 0,this.reserved=void 0,this.group=void 0,this._fieldsById=null,this._fieldsArray=null,this._oneofsArray=null,this._ctor=null}Object.defineProperties(K.prototype,{fieldsById:{get:function(){if(this._fieldsById)return this._fieldsById;this._fieldsById={};for(var r=Object.keys(this.fields),e=0;e<r.length;++e){var t=this.fields[r[e]],i=t.id;if(this._fieldsById[i])throw Error("duplicate id "+i+" in "+this);this._fieldsById[i]=t}return this._fieldsById}},fieldsArray:{get:function(){return this._fieldsArray||(this._fieldsArray=Ce.toArray(this.fields))}},oneofsArray:{get:function(){return this._oneofsArray||(this._oneofsArray=Ce.toArray(this.oneofs))}},ctor:{get:function(){return this._ctor||(this.ctor=K.generateConstructor(this)())},set:function(r){var e=r.prototype;e instanceof Ao||((r.prototype=new Ao).constructor=r,Ce.merge(r.prototype,e)),r.$type=r.prototype.$type=this,Ce.merge(r,Ao,!0),this._ctor=r;for(var t=0;t<this.fieldsArray.length;++t)this._fieldsArray[t].resolve();var i={};for(t=0;t<this.oneofsArray.length;++t)i[this._oneofsArray[t].resolve().name]={get:Ce.oneOfGetter(this._oneofsArray[t].oneof),set:Ce.oneOfSetter(this._oneofsArray[t].oneof)};t&&Object.defineProperties(r.prototype,i)}}});K.generateConstructor=function(e){for(var t=Ce.codegen(["p"],e.name),i=0,n;i<e.fieldsArray.length;++i)(n=e._fieldsArray[i]).map?t("this%s={}",Ce.safeProp(n.name)):n.repeated&&t("this%s=[]",Ce.safeProp(n.name));return t("if(p)for(var ks=Object.keys(p),i=0;i<ks.length;++i)if(p[ks[i]]!=null)")("this[ks[i]]=p[ks[i]]")};function Bn(r){return r._fieldsById=r._fieldsArray=r._oneofsArray=null,delete r.encode,delete r.decode,delete r.verify,r}K.fromJSON=function(e,t){var i=new K(e,t.options);i.extensions=t.extensions,i.reserved=t.reserved;for(var n=Object.keys(t.fields),s=0;s<n.length;++s)i.add((typeof t.fields[n[s]].keyType<"u"?Wv.fromJSON:qn.fromJSON)(n[s],t.fields[n[s]]));if(t.oneofs)for(n=Object.keys(t.oneofs),s=0;s<n.length;++s)i.add(Mo.fromJSON(n[s],t.oneofs[n[s]]));if(t.nested)for(n=Object.keys(t.nested),s=0;s<n.length;++s){var a=t.nested[n[s]];i.add((a.id!==void 0?qn.fromJSON:a.fields!==void 0?K.fromJSON:a.values!==void 0?Gv.fromJSON:a.methods!==void 0?$v.fromJSON:rt.fromJSON)(n[s],a))}return t.extensions&&t.extensions.length&&(i.extensions=t.extensions),t.reserved&&t.reserved.length&&(i.reserved=t.reserved),t.group&&(i.group=!0),t.comment&&(i.comment=t.comment),i};K.prototype.toJSON=function(e){var t=rt.prototype.toJSON.call(this,e),i=e?!!e.keepComments:!1;return Ce.toObject(["options",t&&t.options||void 0,"oneofs",rt.arrayToJSON(this.oneofsArray,e),"fields",rt.arrayToJSON(this.fieldsArray.filter(function(n){return!n.declaringField}),e)||{},"extensions",this.extensions&&this.extensions.length?this.extensions:void 0,"reserved",this.reserved&&this.reserved.length?this.reserved:void 0,"group",this.group||void 0,"nested",t&&t.nested||void 0,"comment",i?this.comment:void 0])};K.prototype.resolveAll=function(){for(var e=this.fieldsArray,t=0;t<e.length;)e[t++].resolve();var i=this.oneofsArray;for(t=0;t<i.length;)i[t++].resolve();return rt.prototype.resolveAll.call(this)};K.prototype.get=function(e){return this.fields[e]||this.oneofs&&this.oneofs[e]||this.nested&&this.nested[e]||null};K.prototype.add=function(e){if(this.get(e.name))throw Error("duplicate name '"+e.name+"' in "+this);if(e instanceof qn&&e.extend===void 0){if(this._fieldsById?this._fieldsById[e.id]:this.fieldsById[e.id])throw Error("duplicate id "+e.id+" in "+this);if(this.isReservedId(e.id))throw Error("id "+e.id+" is reserved in "+this);if(this.isReservedName(e.name))throw Error("name '"+e.name+"' is reserved in "+this);return e.parent&&e.parent.remove(e),this.fields[e.name]=e,e.message=this,e.onAdd(this),Bn(this)}return e instanceof Mo?(this.oneofs||(this.oneofs={}),this.oneofs[e.name]=e,e.onAdd(this),Bn(this)):rt.prototype.add.call(this,e)};K.prototype.remove=function(e){if(e instanceof qn&&e.extend===void 0){if(!this.fields||this.fields[e.name]!==e)throw Error(e+" is not a member of "+this);return delete this.fields[e.name],e.parent=null,e.onRemove(this),Bn(this)}if(e instanceof Mo){if(!this.oneofs||this.oneofs[e.name]!==e)throw Error(e+" is not a member of "+this);return delete this.oneofs[e.name],e.parent=null,e.onRemove(this),Bn(this)}return rt.prototype.remove.call(this,e)};K.prototype.isReservedId=function(e){return rt.isReservedId(this.reserved,e)};K.prototype.isReservedName=function(e){return rt.isReservedName(this.reserved,e)};K.prototype.create=function(e){return new this.ctor(e)};K.prototype.setup=function(){for(var e=this.fullName,t=[],i=0;i<this.fieldsArray.length;++i)t.push(this._fieldsArray[i].resolve().resolvedType);this.encode=Yv(this)({Writer:Vv,types:t,util:Ce}),this.decode=Kv(this)({Reader:Oo,types:t,util:Ce}),this.verify=Jv(this)({types:t,util:Ce}),this.fromObject=Yd.fromObject(this)({types:t,util:Ce}),this.toObject=Yd.toObject(this)({types:t,util:Ce});var n=Xv[e];if(n){var s=Object.create(this);s.fromObject=this.fromObject,this.fromObject=n.fromObject.bind(s),s.toObject=this.toObject,this.toObject=n.toObject.bind(s)}return this};K.prototype.encode=function(e,t){return this.setup().encode(e,t)};K.prototype.encodeDelimited=function(e,t){return this.encode(e,t&&t.len?t.fork():t).ldelim()};K.prototype.decode=function(e,t){return this.setup().decode(e,t)};K.prototype.decodeDelimited=function(e){return e instanceof Oo||(e=Oo.create(e)),this.decode(e,e.uint32())};K.prototype.verify=function(e){return this.setup().verify(e)};K.prototype.fromObject=function(e){return this.setup().fromObject(e)};K.prototype.toObject=function(e,t){return this.setup().toObject(e,t)};K.d=function(e){return function(i){Ce.decorateType(i,e)}}});var jn=g((sE,eh)=>{"use strict";eh.exports=xe;var Hn=ji();((xe.prototype=Object.create(Hn.prototype)).constructor=xe).className="Root";var Po=Ut(),Xd=it(),Zv=Ui(),Ht=me(),Zd,No,Nr;function xe(r){Hn.call(this,"",r),this.deferred=[],this.files=[]}xe.fromJSON=function(e,t){return t||(t=new xe),e.options&&t.setOptions(e.options),t.addJSON(e.nested)};xe.prototype.resolvePath=Ht.path.resolve;xe.prototype.fetch=Ht.fetch;function Qd(){}xe.prototype.load=function r(e,t,i){typeof t=="function"&&(i=t,t=void 0);var n=this;if(!i)return Ht.asPromise(r,n,e,t);var s=i===Qd;function a(p,E){if(i){if(s)throw p;var m=i;i=null,m(p,E)}}function o(p){var E=p.lastIndexOf("google/protobuf/");if(E>-1){var m=p.substring(E);if(m in Nr)return m}return null}function l(p,E){try{if(Ht.isString(E)&&E.charAt(0)==="{"&&(E=JSON.parse(E)),!Ht.isString(E))n.setOptions(E.options).addJSON(E.nested);else{No.filename=p;var m=No(E,n,t),b,S=0;if(m.imports)for(;S<m.imports.length;++S)(b=o(m.imports[S])||n.resolvePath(p,m.imports[S]))&&c(b);if(m.weakImports)for(S=0;S<m.weakImports.length;++S)(b=o(m.weakImports[S])||n.resolvePath(p,m.weakImports[S]))&&c(b,!0)}}catch(T){a(T)}!s&&!u&&a(null,n)}function c(p,E){if(p=o(p)||p,!(n.files.indexOf(p)>-1)){if(n.files.push(p),p in Nr){s?l(p,Nr[p]):(++u,setTimeout(function(){--u,l(p,Nr[p])}));return}if(s){var m;try{m=Ht.fs.readFileSync(p).toString("utf8")}catch(b){E||a(b);return}l(p,m)}else++u,n.fetch(p,function(b,S){if(--u,!!i){if(b){E?u||a(null,n):a(b);return}l(p,S)}})}}var u=0;Ht.isString(e)&&(e=[e]);for(var h=0,f;h<e.length;++h)(f=n.resolvePath("",e[h]))&&c(f);if(s)return n;u||a(null,n)};xe.prototype.loadSync=function(e,t){if(!Ht.isNode)throw Error("not supported");return this.load(e,t,Qd)};xe.prototype.resolveAll=function(){if(this.deferred.length)throw Error("unresolvable extensions: "+this.deferred.map(function(e){return"'extend "+e.extend+"' in "+e.parent.fullName}).join(", "));return Hn.prototype.resolveAll.call(this)};var zn=/^[A-Z]/;function Jd(r,e){var t=e.parent.lookup(e.extend);if(t){var i=new Po(e.fullName,e.id,e.type,e.rule,void 0,e.options);return t.get(i.name)||(i.declaringField=e,e.extensionField=i,t.add(i)),!0}return!1}xe.prototype._handleAdd=function(e){if(e instanceof Po)e.extend!==void 0&&!e.extensionField&&(Jd(this,e)||this.deferred.push(e));else if(e instanceof Xd)zn.test(e.name)&&(e.parent[e.name]=e.values);else if(!(e instanceof Zv)){if(e instanceof Zd)for(var t=0;t<this.deferred.length;)Jd(this,this.deferred[t])?this.deferred.splice(t,1):++t;for(var i=0;i<e.nestedArray.length;++i)this._handleAdd(e._nestedArray[i]);zn.test(e.name)&&(e.parent[e.name]=e)}};xe.prototype._handleRemove=function(e){if(e instanceof Po){if(e.extend!==void 0)if(e.extensionField)e.extensionField.parent.remove(e.extensionField),e.extensionField=null;else{var t=this.deferred.indexOf(e);t>-1&&this.deferred.splice(t,1)}}else if(e instanceof Xd)zn.test(e.name)&&delete e.parent[e.name];else if(e instanceof Hn){for(var i=0;i<e.nestedArray.length;++i)this._handleRemove(e._nestedArray[i]);zn.test(e.name)&&delete e.parent[e.name]}};xe._configure=function(r,e,t){Zd=r,No=e,Nr=t}});var me=g((aE,ih)=>{"use strict";var ae=ih.exports=ct(),th=lo(),Io,xo;ae.codegen=_d();ae.fetch=Td();ae.path=Rd();ae.fs=ae.inquire("fs");ae.toArray=function(e){if(e){for(var t=Object.keys(e),i=new Array(t.length),n=0;n<t.length;)i[n]=e[t[n++]];return i}return[]};ae.toObject=function(e){for(var t={},i=0;i<e.length;){var n=e[i++],s=e[i++];s!==void 0&&(t[n]=s)}return t};var Qv=/\\/g,ey=/"/g;ae.isReserved=function(e){return/^(?:do|if|in|for|let|new|try|var|case|else|enum|eval|false|null|this|true|void|with|break|catch|class|const|super|throw|while|yield|delete|export|import|public|return|static|switch|typeof|default|extends|finally|package|private|continue|debugger|function|arguments|interface|protected|implements|instanceof)$/.test(e)};ae.safeProp=function(e){return!/^[$\w_]+$/.test(e)||ae.isReserved(e)?'["'+e.replace(Qv,"\\\\").replace(ey,'\\"')+'"]':"."+e};ae.ucFirst=function(e){return e.charAt(0).toUpperCase()+e.substring(1)};var ty=/_([a-z])/g;ae.camelCase=function(e){return e.substring(0,1)+e.substring(1).replace(ty,function(t,i){return i.toUpperCase()})};ae.compareFieldsById=function(e,t){return e.id-t.id};ae.decorateType=function(e,t){if(e.$type)return t&&e.$type.name!==t&&(ae.decorateRoot.remove(e.$type),e.$type.name=t,ae.decorateRoot.add(e.$type)),e.$type;Io||(Io=Un());var i=new Io(t||e.name);return ae.decorateRoot.add(i),i.ctor=e,Object.defineProperty(e,"$type",{value:i,enumerable:!1}),Object.defineProperty(e.prototype,"$type",{value:i,enumerable:!1}),i};var iy=0;ae.decorateEnum=function(e){if(e.$type)return e.$type;xo||(xo=it());var t=new xo("Enum"+iy++,e);return ae.decorateRoot.add(t),Object.defineProperty(e,"$type",{value:t,enumerable:!1}),t};ae.setProperty=function(e,t,i){function n(s,a,o){var l=a.shift();if(l==="__proto__"||l==="prototype")return s;if(a.length>0)s[l]=n(s[l]||{},a,o);else{var c=s[l];c&&(o=[].concat(c).concat(o)),s[l]=o}return s}if(typeof e!="object")throw TypeError("dst must be an object");if(!t)throw TypeError("path must be specified");return t=t.split("."),n(e,t,i)};Object.defineProperty(ae,"decorateRoot",{get:function(){return th.decorated||(th.decorated=new(jn()))}})});var ui=g((oE,rh)=>{"use strict";rh.exports=De;De.className="ReflectionObject";var Gn=me(),Wn;function De(r,e){if(!Gn.isString(r))throw TypeError("name must be a string");if(e&&!Gn.isObject(e))throw TypeError("options must be an object");this.options=e,this.parsedOptions=null,this.name=r,this.parent=null,this.resolved=!1,this.comment=null,this.filename=null}Object.defineProperties(De.prototype,{root:{get:function(){for(var r=this;r.parent!==null;)r=r.parent;return r}},fullName:{get:function(){for(var r=[this.name],e=this.parent;e;)r.unshift(e.name),e=e.parent;return r.join(".")}}});De.prototype.toJSON=function(){throw Error()};De.prototype.onAdd=function(e){this.parent&&this.parent!==e&&this.parent.remove(this),this.parent=e,this.resolved=!1;var t=e.root;t instanceof Wn&&t._handleAdd(this)};De.prototype.onRemove=function(e){var t=e.root;t instanceof Wn&&t._handleRemove(this),this.parent=null,this.resolved=!1};De.prototype.resolve=function(){return this.resolved?this:(this.root instanceof Wn&&(this.resolved=!0),this)};De.prototype.getOption=function(e){if(this.options)return this.options[e]};De.prototype.setOption=function(e,t,i){return(!i||!this.options||this.options[e]===void 0)&&((this.options||(this.options={}))[e]=t),this};De.prototype.setParsedOption=function(e,t,i){this.parsedOptions||(this.parsedOptions=[]);var n=this.parsedOptions;if(i){var s=n.find(function(l){return Object.prototype.hasOwnProperty.call(l,e)});if(s){var a=s[e];Gn.setProperty(a,i,t)}else s={},s[e]=Gn.setProperty({},i,t),n.push(s)}else{var o={};o[e]=t,n.push(o)}return this};De.prototype.setOptions=function(e,t){if(e)for(var i=Object.keys(e),n=0;n<i.length;++n)this.setOption(i[n],e[i[n]],t);return this};De.prototype.toString=function(){var e=this.constructor.className,t=this.fullName;return t.length?e+" "+t:e};De._configure=function(r){Wn=r}});var it=g((lE,ah)=>{"use strict";ah.exports=ft;var nh=ui();((ft.prototype=Object.create(nh.prototype)).constructor=ft).className="Enum";var sh=ji(),$n=me();function ft(r,e,t,i,n,s){if(nh.call(this,r,t),e&&typeof e!="object")throw TypeError("values must be an object");if(this.valuesById={},this.values=Object.create(this.valuesById),this.comment=i,this.comments=n||{},this.valuesOptions=s,this.reserved=void 0,e)for(var a=Object.keys(e),o=0;o<a.length;++o)typeof e[a[o]]=="number"&&(this.valuesById[this.values[a[o]]=e[a[o]]]=a[o])}ft.fromJSON=function(e,t){var i=new ft(e,t.values,t.options,t.comment,t.comments);return i.reserved=t.reserved,i};ft.prototype.toJSON=function(e){var t=e?!!e.keepComments:!1;return $n.toObject(["options",this.options,"valuesOptions",this.valuesOptions,"values",this.values,"reserved",this.reserved&&this.reserved.length?this.reserved:void 0,"comment",t?this.comment:void 0,"comments",t?this.comments:void 0])};ft.prototype.add=function(e,t,i,n){if(!$n.isString(e))throw TypeError("name must be a string");if(!$n.isInteger(t))throw TypeError("id must be an integer");if(this.values[e]!==void 0)throw Error("duplicate name '"+e+"' in "+this);if(this.isReservedId(t))throw Error("id "+t+" is reserved in "+this);if(this.isReservedName(e))throw Error("name '"+e+"' is reserved in "+this);if(this.valuesById[t]!==void 0){if(!(this.options&&this.options.allow_alias))throw Error("duplicate id "+t+" in "+this);this.values[e]=t}else this.valuesById[this.values[e]=t]=e;return n&&(this.valuesOptions===void 0&&(this.valuesOptions={}),this.valuesOptions[e]=n||null),this.comments[e]=i||null,this};ft.prototype.remove=function(e){if(!$n.isString(e))throw TypeError("name must be a string");var t=this.values[e];if(t==null)throw Error("name '"+e+"' does not exist in "+this);return delete this.valuesById[t],delete this.values[e],delete this.comments[e],this.valuesOptions&&delete this.valuesOptions[e],this};ft.prototype.isReservedId=function(e){return sh.isReservedId(this.reserved,e)};ft.prototype.isReservedName=function(e){return sh.isReservedName(this.reserved,e)}});var ko=g((cE,lh)=>{"use strict";lh.exports=ny;var ry=it(),Do=ci(),Lo=me();function oh(r,e,t,i){return e.resolvedType.group?r("types[%i].encode(%s,w.uint32(%i)).uint32(%i)",t,i,(e.id<<3|3)>>>0,(e.id<<3|4)>>>0):r("types[%i].encode(%s,w.uint32(%i).fork()).ldelim()",t,i,(e.id<<3|2)>>>0)}function ny(r){for(var e=Lo.codegen(["m","w"],r.name+"$encode")("if(!w)")("w=Writer.create()"),t,i,n=r.fieldsArray.slice().sort(Lo.compareFieldsById),t=0;t<n.length;++t){var s=n[t].resolve(),a=r._fieldsArray.indexOf(s),o=s.resolvedType instanceof ry?"int32":s.type,l=Do.basic[o];i="m"+Lo.safeProp(s.name),s.map?(e("if(%s!=null&&Object.hasOwnProperty.call(m,%j)){",i,s.name)("for(var ks=Object.keys(%s),i=0;i<ks.length;++i){",i)("w.uint32(%i).fork().uint32(%i).%s(ks[i])",(s.id<<3|2)>>>0,8|Do.mapKey[s.keyType],s.keyType),l===void 0?e("types[%i].encode(%s[ks[i]],w.uint32(18).fork()).ldelim().ldelim()",a,i):e(".uint32(%i).%s(%s[ks[i]]).ldelim()",16|l,o,i),e("}")("}")):s.repeated?(e("if(%s!=null&&%s.length){",i,i),s.packed&&Do.packed[o]!==void 0?e("w.uint32(%i).fork()",(s.id<<3|2)>>>0)("for(var i=0;i<%s.length;++i)",i)("w.%s(%s[i])",o,i)("w.ldelim()"):(e("for(var i=0;i<%s.length;++i)",i),l===void 0?oh(e,s,a,i+"[i]"):e("w.uint32(%i).%s(%s[i])",(s.id<<3|l)>>>0,o,i)),e("}")):(s.optional&&e("if(%s!=null&&Object.hasOwnProperty.call(m,%j))",i,s.name),l===void 0?oh(e,s,a,i):e("w.uint32(%i).%s(%s)",(s.id<<3|l)>>>0,o,i))}return e("return w")}});var uh=g((uE,ch)=>{"use strict";var B=ch.exports=yd();B.build="light";function sy(r,e,t){return typeof e=="function"?(t=e,e=new B.Root):e||(e=new B.Root),e.load(r,t)}B.load=sy;function ay(r,e){return e||(e=new B.Root),e.loadSync(r)}B.loadSync=ay;B.encoder=ko();B.decoder=So();B.verifier=To();B.converter=Ro();B.ReflectionObject=ui();B.Namespace=ji();B.Root=jn();B.Enum=it();B.Type=Un();B.Field=Ut();B.OneOf=Ui();B.MapField=xn();B.Service=Ln();B.Method=Dn();B.Message=Fn();B.wrappers=wo();B.types=ci();B.util=me();B.ReflectionObject._configure(B.Root);B.Namespace._configure(B.Type,B.Service,B.Enum);B.Root._configure(B.Type);B.Field._configure(B.Type)});var qo=g((dE,fh)=>{"use strict";fh.exports=hh;var Fo=/[\s{}=;:[\],'"()<>]/g,oy=/(?:"([^"\\]*(?:\\.[^"\\]*)*)")/g,ly=/(?:'([^'\\]*(?:\\.[^'\\]*)*)')/g,cy=/^ *[*/]+ */,uy=/^\s*\*?\/*/,dy=/\n/g,hy=/\s/,fy=/\\(.?)/g,py={0:"\0",r:"\r",n:`
`,t:"	"};function dh(r){return r.replace(fy,function(e,t){switch(t){case"\\":case"":return t;default:return py[t]||""}})}hh.unescape=dh;function hh(r,e){r=r.toString();var t=0,i=r.length,n=1,s=0,a={},o=[],l=null;function c(w){return Error("illegal "+w+" (line "+n+")")}function u(){var w=l==="'"?ly:oy;w.lastIndex=t-1;var L=w.exec(r);if(!L)throw c("string");return t=w.lastIndex,b(l),l=null,dh(L[1])}function h(w){return r.charAt(w)}function f(w,L,x){var q={type:r.charAt(w++),lineEmpty:!1,leading:x},X;e?X=2:X=3;var re=w-X,W;do if(--re<0||(W=r.charAt(re))===`
`){q.lineEmpty=!0;break}while(W===" "||W==="	");for(var v=r.substring(w,L).split(dy),Q=0;Q<v.length;++Q)v[Q]=v[Q].replace(e?uy:cy,"").trim();q.text=v.join(`
`).trim(),a[n]=q,s=n}function p(w){var L=E(w),x=r.substring(w,L),q=/^\s*\/\//.test(x);return q}function E(w){for(var L=w;L<i&&h(L)!==`
`;)L++;return L}function m(){if(o.length>0)return o.shift();if(l)return u();var w,L,x,q,X,re=t===0;do{if(t===i)return null;for(w=!1;hy.test(x=h(t));)if(x===`
`&&(re=!0,++n),++t===i)return null;if(h(t)==="/"){if(++t===i)throw c("comment");if(h(t)==="/")if(e){if(q=t,X=!1,p(t-1)){X=!0;do if(t=E(t),t===i||(t++,!re))break;while(p(t))}else t=Math.min(i,E(t)+1);X&&(f(q,t,re),re=!0),n++,w=!0}else{for(X=h(q=t+1)==="/";h(++t)!==`
`;)if(t===i)return null;++t,X&&(f(q,t-1,re),re=!0),++n,w=!0}else if((x=h(t))==="*"){q=t+1,X=e||h(q)==="*";do{if(x===`
`&&++n,++t===i)throw c("comment");L=x,x=h(t)}while(L!=="*"||x!=="/");++t,X&&(f(q,t-2,re),re=!0),w=!0}else return"/"}}while(w);var W=t;Fo.lastIndex=0;var v=Fo.test(h(W++));if(!v)for(;W<i&&!Fo.test(h(W));)++W;var Q=r.substring(t,t=W);return(Q==='"'||Q==="'")&&(l=Q),Q}function b(w){o.push(w)}function S(){if(!o.length){var w=m();if(w===null)return null;b(w)}return o[0]}function T(w,L){var x=S(),q=x===w;if(q)return m(),!0;if(!L)throw c("token '"+x+"', '"+w+"' expected");return!1}function k(w){var L=null,x;return w===void 0?(x=a[n-1],delete a[n-1],x&&(e||x.type==="*"||x.lineEmpty)&&(L=x.leading?x.text:null)):(s<w&&S(),x=a[w],delete a[w],x&&!x.lineEmpty&&(e||x.type==="/")&&(L=x.leading?null:x.text)),L}return Object.defineProperty({next:m,peek:S,push:b,skip:T,cmnt:k},"line",{get:function(){return n}})}});var Sh=g((hE,yh)=>{"use strict";yh.exports=Rt;Rt.filename=null;Rt.defaults={keepCase:!1};var gy=qo(),ph=jn(),gh=Un(),mh=Ut(),my=xn(),vh=Ui(),vy=it(),yy=Ln(),Sy=Dn(),Bo=ci(),Uo=me(),_y=/^[1-9][0-9]*$/,Cy=/^-?[1-9][0-9]*$/,Ty=/^0[x][0-9a-fA-F]+$/,Ey=/^-?0[x][0-9a-fA-F]+$/,by=/^0[0-7]+$/,Ry=/^-?0[0-7]+$/,wy=/^(?![eE])[0-9]*(?:\.[0-9]*)?(?:[eE][+-]?[0-9]+)?$/,pt=/^[a-zA-Z_][a-zA-Z_0-9]*$/,gt=/^(?:\.?[a-zA-Z_][a-zA-Z_0-9]*)(?:\.[a-zA-Z_][a-zA-Z_0-9]*)*$/,Ay=/^(?:\.[a-zA-Z_][a-zA-Z_0-9]*)+$/;function Rt(r,e,t){e instanceof ph||(t=e,e=new ph),t||(t=Rt.defaults);var i=t.preferTrailingComment||!1,n=gy(r,t.alternateCommentMode||!1),s=n.next,a=n.push,o=n.peek,l=n.skip,c=n.cmnt,u=!0,h,f,p,E,m=!1,b=e,S=t.keepCase?function(_){return _}:Uo.camelCase;function T(_,C,R){var P=Rt.filename;return R||(Rt.filename=null),Error("illegal "+(C||"token")+" '"+_+"' ("+(P?P+", ":"")+"line "+n.line+")")}function k(){var _=[],C;do{if((C=s())!=='"'&&C!=="'")throw T(C);_.push(s()),l(C),C=o()}while(C==='"'||C==="'");return _.join("")}function w(_){var C=s();switch(C){case"'":case'"':return a(C),k();case"true":case"TRUE":return!0;case"false":case"FALSE":return!1}try{return x(C,!0)}catch{if(_&&gt.test(C))return C;throw T(C,"value")}}function L(_,C){var R,P;do C&&((R=o())==='"'||R==="'")?_.push(k()):_.push([P=q(s()),l("to",!0)?q(s()):P]);while(l(",",!0));var M={options:void 0};M.setOption=function(D,ee){this.options===void 0&&(this.options={}),this.options[D]=ee},Q(M,function(ee){if(ee==="option")Y(M,ee),l(";");else throw T(ee)},function(){ve(M)})}function x(_,C){var R=1;switch(_.charAt(0)==="-"&&(R=-1,_=_.substring(1)),_){case"inf":case"INF":case"Inf":return R*(1/0);case"nan":case"NAN":case"Nan":case"NaN":return NaN;case"0":return 0}if(_y.test(_))return R*parseInt(_,10);if(Ty.test(_))return R*parseInt(_,16);if(by.test(_))return R*parseInt(_,8);if(wy.test(_))return R*parseFloat(_);throw T(_,"number",C)}function q(_,C){switch(_){case"max":case"MAX":case"Max":return 536870911;case"0":return 0}if(!C&&_.charAt(0)==="-")throw T(_,"id");if(Cy.test(_))return parseInt(_,10);if(Ey.test(_))return parseInt(_,16);if(Ry.test(_))return parseInt(_,8);throw T(_,"id")}function X(){if(h!==void 0)throw T("package");if(h=s(),!gt.test(h))throw T(h,"name");b=b.define(h),l(";")}function re(){var _=o(),C;switch(_){case"weak":C=p||(p=[]),s();break;case"public":s();default:C=f||(f=[]);break}_=k(),l(";"),C.push(_)}function W(){if(l("="),E=k(),m=E==="proto3",!m&&E!=="proto2")throw T(E,"syntax");l(";")}function v(_,C){switch(C){case"option":return Y(_,C),l(";"),!0;case"message":return y(_,C),!0;case"enum":return $(_,C),!0;case"service":return le(_,C),!0;case"extend":return _i(_,C),!0}return!1}function Q(_,C,R){var P=n.line;if(_&&(typeof _.comment!="string"&&(_.comment=c()),_.filename=Rt.filename),l("{",!0)){for(var M;(M=s())!=="}";)C(M);l(";",!0)}else R&&R(),l(";"),_&&(typeof _.comment!="string"||i)&&(_.comment=c(P)||_.comment)}function y(_,C){if(!pt.test(C=s()))throw T(C,"type name");var R=new gh(C);Q(R,function(M){if(!v(R,M))switch(M){case"map":U(R,M);break;case"required":case"repeated":d(R,M);break;case"optional":m?d(R,"proto3_optional"):d(R,"optional");break;case"oneof":Z(R,M);break;case"extensions":L(R.extensions||(R.extensions=[]));break;case"reserved":L(R.reserved||(R.reserved=[]),!0);break;default:if(!m||!gt.test(M))throw T(M);a(M),d(R,"optional");break}}),_.add(R)}function d(_,C,R){var P=s();if(P==="group"){A(_,C);return}for(;P.endsWith(".")||o().startsWith(".");)P+=s();if(!gt.test(P))throw T(P,"type");var M=s();if(!pt.test(M))throw T(M,"name");M=S(M),l("=");var D=new mh(M,q(s()),P,C,R);if(Q(D,function(Ne){if(Ne==="option")Y(D,Ne),l(";");else throw T(Ne)},function(){ve(D)}),C==="proto3_optional"){var ee=new vh("_"+M);D.setOption("proto3_optional",!0),ee.add(D),_.add(ee)}else _.add(D);!m&&D.repeated&&(Bo.packed[P]!==void 0||Bo.basic[P]===void 0)&&D.setOption("packed",!1,!0)}function A(_,C){var R=s();if(!pt.test(R))throw T(R,"name");var P=Uo.lcFirst(R);R===P&&(R=Uo.ucFirst(R)),l("=");var M=q(s()),D=new gh(R);D.group=!0;var ee=new mh(P,M,R,C);ee.filename=Rt.filename,Q(D,function(Ne){switch(Ne){case"option":Y(D,Ne),l(";");break;case"required":case"repeated":d(D,Ne);break;case"optional":m?d(D,"proto3_optional"):d(D,"optional");break;case"message":y(D,Ne);break;case"enum":$(D,Ne);break;default:throw T(Ne)}}),_.add(D).add(ee)}function U(_){l("<");var C=s();if(Bo.mapKey[C]===void 0)throw T(C,"type");l(",");var R=s();if(!gt.test(R))throw T(R,"type");l(">");var P=s();if(!pt.test(P))throw T(P,"name");l("=");var M=new my(S(P),q(s()),C,R);Q(M,function(ee){if(ee==="option")Y(M,ee),l(";");else throw T(ee)},function(){ve(M)}),_.add(M)}function Z(_,C){if(!pt.test(C=s()))throw T(C,"name");var R=new vh(S(C));Q(R,function(M){M==="option"?(Y(R,M),l(";")):(a(M),d(R,"optional"))}),_.add(R)}function $(_,C){if(!pt.test(C=s()))throw T(C,"name");var R=new vy(C);Q(R,function(M){switch(M){case"option":Y(R,M),l(";");break;case"reserved":L(R.reserved||(R.reserved=[]),!0);break;default:ne(R,M)}}),_.add(R)}function ne(_,C){if(!pt.test(C))throw T(C,"name");l("=");var R=q(s(),!0),P={options:void 0};P.setOption=function(M,D){this.options===void 0&&(this.options={}),this.options[M]=D},Q(P,function(D){if(D==="option")Y(P,D),l(";");else throw T(D)},function(){ve(P)}),_.add(C,R,P.comment,P.options)}function Y(_,C){var R=l("(",!0);if(!gt.test(C=s()))throw T(C,"name");var P=C,M=P,D;R&&(l(")"),P="("+P+")",M=P,C=o(),Ay.test(C)&&(D=C.slice(1),P+=C,s())),l("=");var ee=Te(_,P);ie(_,M,ee,D)}function Te(_,C){if(l("{",!0)){for(var R={};!l("}",!0);){if(!pt.test(_e=s()))throw T(_e,"name");if(_e===null)throw T(_e,"end of input");var P,M=_e;if(l(":",!0),o()==="{")P=Te(_,C+"."+_e);else if(o()==="["){P=[];var D;if(l("[",!0)){do D=w(!0),P.push(D);while(l(",",!0));l("]"),typeof D<"u"&&oe(_,C+"."+_e,D)}}else P=w(!0),oe(_,C+"."+_e,P);var ee=R[M];ee&&(P=[].concat(ee).concat(P)),R[M]=P,l(",",!0),l(";",!0)}return R}var kt=w(!0);return oe(_,C,kt),kt}function oe(_,C,R){_.setOption&&_.setOption(C,R)}function ie(_,C,R,P){_.setParsedOption&&_.setParsedOption(C,R,P)}function ve(_){if(l("[",!0)){do Y(_,"option");while(l(",",!0));l("]")}return _}function le(_,C){if(!pt.test(C=s()))throw T(C,"service name");var R=new yy(C);Q(R,function(M){if(!v(R,M))if(M==="rpc")Ee(R,M);else throw T(M)}),_.add(R)}function Ee(_,C){var R=c(),P=C;if(!pt.test(C=s()))throw T(C,"name");var M=C,D,ee,kt,Ne;if(l("("),l("stream",!0)&&(ee=!0),!gt.test(C=s())||(D=C,l(")"),l("returns"),l("("),l("stream",!0)&&(Ne=!0),!gt.test(C=s())))throw T(C);kt=C,l(")");var Xr=new Sy(M,P,D,kt,ee,Ne);Xr.comment=R,Q(Xr,function(Ks){if(Ks==="option")Y(Xr,Ks),l(";");else throw T(Ks)}),_.add(Xr)}function _i(_,C){if(!gt.test(C=s()))throw T(C,"reference");var R=C;Q(null,function(M){switch(M){case"required":case"repeated":d(_,M,R);break;case"optional":m?d(_,"proto3_optional",R):d(_,"optional",R);break;default:if(!m||!gt.test(M))throw T(M);a(M),d(_,"optional",R);break}})}for(var _e;(_e=s())!==null;)switch(_e){case"package":if(!u)throw T(_e);X();break;case"import":if(!u)throw T(_e);re();break;case"syntax":if(!u)throw T(_e);W();break;case"option":Y(b,_e),l(";");break;default:if(v(b,_e)){u=!1;continue}throw T(_e)}return Rt.filename=null,{package:h,imports:f,weakImports:p,syntax:E,root:e}}});var Th=g((fE,Ch)=>{"use strict";Ch.exports=nt;var Oy=/\/|\./;function nt(r,e){Oy.test(r)||(r="google/protobuf/"+r+".proto",e={nested:{google:{nested:{protobuf:{nested:e}}}}}),nt[r]=e}nt("any",{Any:{fields:{type_url:{type:"string",id:1},value:{type:"bytes",id:2}}}});var _h;nt("duration",{Duration:_h={fields:{seconds:{type:"int64",id:1},nanos:{type:"int32",id:2}}}});nt("timestamp",{Timestamp:_h});nt("empty",{Empty:{fields:{}}});nt("struct",{Struct:{fields:{fields:{keyType:"string",type:"Value",id:1}}},Value:{oneofs:{kind:{oneof:["nullValue","numberValue","stringValue","boolValue","structValue","listValue"]}},fields:{nullValue:{type:"NullValue",id:1},numberValue:{type:"double",id:2},stringValue:{type:"string",id:3},boolValue:{type:"bool",id:4},structValue:{type:"Struct",id:5},listValue:{type:"ListValue",id:6}}},NullValue:{values:{NULL_VALUE:0}},ListValue:{fields:{values:{rule:"repeated",type:"Value",id:1}}}});nt("wrappers",{DoubleValue:{fields:{value:{type:"double",id:1}}},FloatValue:{fields:{value:{type:"float",id:1}}},Int64Value:{fields:{value:{type:"int64",id:1}}},UInt64Value:{fields:{value:{type:"uint64",id:1}}},Int32Value:{fields:{value:{type:"int32",id:1}}},UInt32Value:{fields:{value:{type:"uint32",id:1}}},BoolValue:{fields:{value:{type:"bool",id:1}}},StringValue:{fields:{value:{type:"string",id:1}}},BytesValue:{fields:{value:{type:"bytes",id:1}}}});nt("field_mask",{FieldMask:{fields:{paths:{rule:"repeated",type:"string",id:1}}}});nt.get=function(e){return nt[e]||null}});var bh=g((pE,Eh)=>{"use strict";var jt=Eh.exports=uh();jt.build="full";jt.tokenize=qo();jt.parse=Sh();jt.common=Th();jt.Root._configure(jt.Type,jt.parse,jt.common)});var Vn=g((gE,Rh)=>{"use strict";Rh.exports=bh()});var zo=g((mE,My)=>{My.exports={nested:{google:{nested:{protobuf:{nested:{FileDescriptorSet:{fields:{file:{rule:"repeated",type:"FileDescriptorProto",id:1}}},FileDescriptorProto:{fields:{name:{type:"string",id:1},package:{type:"string",id:2},dependency:{rule:"repeated",type:"string",id:3},publicDependency:{rule:"repeated",type:"int32",id:10,options:{packed:!1}},weakDependency:{rule:"repeated",type:"int32",id:11,options:{packed:!1}},messageType:{rule:"repeated",type:"DescriptorProto",id:4},enumType:{rule:"repeated",type:"EnumDescriptorProto",id:5},service:{rule:"repeated",type:"ServiceDescriptorProto",id:6},extension:{rule:"repeated",type:"FieldDescriptorProto",id:7},options:{type:"FileOptions",id:8},sourceCodeInfo:{type:"SourceCodeInfo",id:9},syntax:{type:"string",id:12}}},DescriptorProto:{fields:{name:{type:"string",id:1},field:{rule:"repeated",type:"FieldDescriptorProto",id:2},extension:{rule:"repeated",type:"FieldDescriptorProto",id:6},nestedType:{rule:"repeated",type:"DescriptorProto",id:3},enumType:{rule:"repeated",type:"EnumDescriptorProto",id:4},extensionRange:{rule:"repeated",type:"ExtensionRange",id:5},oneofDecl:{rule:"repeated",type:"OneofDescriptorProto",id:8},options:{type:"MessageOptions",id:7},reservedRange:{rule:"repeated",type:"ReservedRange",id:9},reservedName:{rule:"repeated",type:"string",id:10}},nested:{ExtensionRange:{fields:{start:{type:"int32",id:1},end:{type:"int32",id:2}}},ReservedRange:{fields:{start:{type:"int32",id:1},end:{type:"int32",id:2}}}}},FieldDescriptorProto:{fields:{name:{type:"string",id:1},number:{type:"int32",id:3},label:{type:"Label",id:4},type:{type:"Type",id:5},typeName:{type:"string",id:6},extendee:{type:"string",id:2},defaultValue:{type:"string",id:7},oneofIndex:{type:"int32",id:9},jsonName:{type:"string",id:10},options:{type:"FieldOptions",id:8}},nested:{Type:{values:{TYPE_DOUBLE:1,TYPE_FLOAT:2,TYPE_INT64:3,TYPE_UINT64:4,TYPE_INT32:5,TYPE_FIXED64:6,TYPE_FIXED32:7,TYPE_BOOL:8,TYPE_STRING:9,TYPE_GROUP:10,TYPE_MESSAGE:11,TYPE_BYTES:12,TYPE_UINT32:13,TYPE_ENUM:14,TYPE_SFIXED32:15,TYPE_SFIXED64:16,TYPE_SINT32:17,TYPE_SINT64:18}},Label:{values:{LABEL_OPTIONAL:1,LABEL_REQUIRED:2,LABEL_REPEATED:3}}}},OneofDescriptorProto:{fields:{name:{type:"string",id:1},options:{type:"OneofOptions",id:2}}},EnumDescriptorProto:{fields:{name:{type:"string",id:1},value:{rule:"repeated",type:"EnumValueDescriptorProto",id:2},options:{type:"EnumOptions",id:3}}},EnumValueDescriptorProto:{fields:{name:{type:"string",id:1},number:{type:"int32",id:2},options:{type:"EnumValueOptions",id:3}}},ServiceDescriptorProto:{fields:{name:{type:"string",id:1},method:{rule:"repeated",type:"MethodDescriptorProto",id:2},options:{type:"ServiceOptions",id:3}}},MethodDescriptorProto:{fields:{name:{type:"string",id:1},inputType:{type:"string",id:2},outputType:{type:"string",id:3},options:{type:"MethodOptions",id:4},clientStreaming:{type:"bool",id:5},serverStreaming:{type:"bool",id:6}}},FileOptions:{fields:{javaPackage:{type:"string",id:1},javaOuterClassname:{type:"string",id:8},javaMultipleFiles:{type:"bool",id:10},javaGenerateEqualsAndHash:{type:"bool",id:20,options:{deprecated:!0}},javaStringCheckUtf8:{type:"bool",id:27},optimizeFor:{type:"OptimizeMode",id:9,options:{default:"SPEED"}},goPackage:{type:"string",id:11},ccGenericServices:{type:"bool",id:16},javaGenericServices:{type:"bool",id:17},pyGenericServices:{type:"bool",id:18},deprecated:{type:"bool",id:23},ccEnableArenas:{type:"bool",id:31},objcClassPrefix:{type:"string",id:36},csharpNamespace:{type:"string",id:37},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]],reserved:[[38,38]],nested:{OptimizeMode:{values:{SPEED:1,CODE_SIZE:2,LITE_RUNTIME:3}}}},MessageOptions:{fields:{messageSetWireFormat:{type:"bool",id:1},noStandardDescriptorAccessor:{type:"bool",id:2},deprecated:{type:"bool",id:3},mapEntry:{type:"bool",id:7},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]],reserved:[[8,8]]},FieldOptions:{fields:{ctype:{type:"CType",id:1,options:{default:"STRING"}},packed:{type:"bool",id:2},jstype:{type:"JSType",id:6,options:{default:"JS_NORMAL"}},lazy:{type:"bool",id:5},deprecated:{type:"bool",id:3},weak:{type:"bool",id:10},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]],reserved:[[4,4]],nested:{CType:{values:{STRING:0,CORD:1,STRING_PIECE:2}},JSType:{values:{JS_NORMAL:0,JS_STRING:1,JS_NUMBER:2}}}},OneofOptions:{fields:{uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},EnumOptions:{fields:{allowAlias:{type:"bool",id:2},deprecated:{type:"bool",id:3},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},EnumValueOptions:{fields:{deprecated:{type:"bool",id:1},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},ServiceOptions:{fields:{deprecated:{type:"bool",id:33},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},MethodOptions:{fields:{deprecated:{type:"bool",id:33},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},UninterpretedOption:{fields:{name:{rule:"repeated",type:"NamePart",id:2},identifierValue:{type:"string",id:3},positiveIntValue:{type:"uint64",id:4},negativeIntValue:{type:"int64",id:5},doubleValue:{type:"double",id:6},stringValue:{type:"bytes",id:7},aggregateValue:{type:"string",id:8}},nested:{NamePart:{fields:{namePart:{rule:"required",type:"string",id:1},isExtension:{rule:"required",type:"bool",id:2}}}}},SourceCodeInfo:{fields:{location:{rule:"repeated",type:"Location",id:1}},nested:{Location:{fields:{path:{rule:"repeated",type:"int32",id:1},span:{rule:"repeated",type:"int32",id:2},leadingComments:{type:"string",id:3},trailingComments:{type:"string",id:4},leadingDetachedComments:{rule:"repeated",type:"string",id:6}}}}},GeneratedCodeInfo:{fields:{annotation:{rule:"repeated",type:"Annotation",id:1}},nested:{Annotation:{fields:{path:{rule:"repeated",type:"int32",id:1},sourceFile:{type:"string",id:2},begin:{type:"int32",id:3},end:{type:"int32",id:4}}}}}}}}}}}});var kh=g((F,Mh)=>{"use strict";var we=Vn();Mh.exports=F=we.descriptor=we.Root.fromJSON(zo()).lookup(".google.protobuf");var wh=we.Namespace,Pr=we.Root,wt=we.Enum,Gt=we.Type,Wt=we.Field,ky=we.MapField,Yn=we.OneOf,Ir=we.Service,Kn=we.Method;Pr.fromDescriptor=function(e){typeof e.length=="number"&&(e=F.FileDescriptorSet.decode(e));var t=new Pr;if(e.file)for(var i,n,s=0,a;s<e.file.length;++s){if(n=t,(i=e.file[s]).package&&i.package.length&&(n=t.define(i.package)),i.name&&i.name.length&&t.files.push(n.filename=i.name),i.messageType)for(a=0;a<i.messageType.length;++a)n.add(Gt.fromDescriptor(i.messageType[a],i.syntax));if(i.enumType)for(a=0;a<i.enumType.length;++a)n.add(wt.fromDescriptor(i.enumType[a]));if(i.extension)for(a=0;a<i.extension.length;++a)n.add(Wt.fromDescriptor(i.extension[a]));if(i.service)for(a=0;a<i.service.length;++a)n.add(Ir.fromDescriptor(i.service[a]));var o=Wi(i.options,F.FileOptions);if(o){var l=Object.keys(o);for(a=0;a<l.length;++a)n.setOption(l[a],o[l[a]])}}return t};Pr.prototype.toDescriptor=function(e){var t=F.FileDescriptorSet.create();return Ah(this,t.file,e),t};function Ah(r,e,t){var i=F.FileDescriptorProto.create({name:r.filename||(r.fullName.substring(1).replace(/\./g,"_")||"root")+".proto"});t&&(i.syntax=t),r instanceof Pr||(i.package=r.fullName.substring(1));for(var n=0,s;n<r.nestedArray.length;++n)(s=r._nestedArray[n])instanceof Gt?i.messageType.push(s.toDescriptor(t)):s instanceof wt?i.enumType.push(s.toDescriptor()):s instanceof Wt?i.extension.push(s.toDescriptor(t)):s instanceof Ir?i.service.push(s.toDescriptor()):s instanceof wh&&Ah(s,e,t);i.options=$i(r.options,F.FileOptions),i.messageType.length+i.enumType.length+i.extension.length+i.service.length&&e.push(i)}var Ny=0;Gt.fromDescriptor=function(e,t){typeof e.length=="number"&&(e=F.DescriptorProto.decode(e));var i=new Gt(e.name.length?e.name:"Type"+Ny++,Wi(e.options,F.MessageOptions)),n;if(e.oneofDecl)for(n=0;n<e.oneofDecl.length;++n)i.add(Yn.fromDescriptor(e.oneofDecl[n]));if(e.field)for(n=0;n<e.field.length;++n){var s=Wt.fromDescriptor(e.field[n],t);i.add(s),e.field[n].hasOwnProperty("oneofIndex")&&i.oneofsArray[e.field[n].oneofIndex].add(s)}if(e.extension)for(n=0;n<e.extension.length;++n)i.add(Wt.fromDescriptor(e.extension[n],t));if(e.nestedType)for(n=0;n<e.nestedType.length;++n)i.add(Gt.fromDescriptor(e.nestedType[n],t)),e.nestedType[n].options&&e.nestedType[n].options.mapEntry&&i.setOption("map_entry",!0);if(e.enumType)for(n=0;n<e.enumType.length;++n)i.add(wt.fromDescriptor(e.enumType[n]));if(e.extensionRange&&e.extensionRange.length)for(i.extensions=[],n=0;n<e.extensionRange.length;++n)i.extensions.push([e.extensionRange[n].start,e.extensionRange[n].end]);if(e.reservedRange&&e.reservedRange.length||e.reservedName&&e.reservedName.length){if(i.reserved=[],e.reservedRange)for(n=0;n<e.reservedRange.length;++n)i.reserved.push([e.reservedRange[n].start,e.reservedRange[n].end]);if(e.reservedName)for(n=0;n<e.reservedName.length;++n)i.reserved.push(e.reservedName[n])}return i};Gt.prototype.toDescriptor=function(e){var t=F.DescriptorProto.create({name:this.name}),i;for(i=0;i<this.fieldsArray.length;++i){var n;if(t.field.push(n=this._fieldsArray[i].toDescriptor(e)),this._fieldsArray[i]instanceof ky){var s=Ho(this._fieldsArray[i].keyType,this._fieldsArray[i].resolvedKeyType),a=Ho(this._fieldsArray[i].type,this._fieldsArray[i].resolvedType),o=a===11||a===14?this._fieldsArray[i].resolvedType&&Oh(this.parent,this._fieldsArray[i].resolvedType)||this._fieldsArray[i].type:void 0;t.nestedType.push(F.DescriptorProto.create({name:n.typeName,field:[F.FieldDescriptorProto.create({name:"key",number:1,label:1,type:s}),F.FieldDescriptorProto.create({name:"value",number:2,label:1,type:a,typeName:o})],options:F.MessageOptions.create({mapEntry:!0})}))}}for(i=0;i<this.oneofsArray.length;++i)t.oneofDecl.push(this._oneofsArray[i].toDescriptor());for(i=0;i<this.nestedArray.length;++i)this._nestedArray[i]instanceof Wt?t.field.push(this._nestedArray[i].toDescriptor(e)):this._nestedArray[i]instanceof Gt?t.nestedType.push(this._nestedArray[i].toDescriptor(e)):this._nestedArray[i]instanceof wt&&t.enumType.push(this._nestedArray[i].toDescriptor());if(this.extensions)for(i=0;i<this.extensions.length;++i)t.extensionRange.push(F.DescriptorProto.ExtensionRange.create({start:this.extensions[i][0],end:this.extensions[i][1]}));if(this.reserved)for(i=0;i<this.reserved.length;++i)typeof this.reserved[i]=="string"?t.reservedName.push(this.reserved[i]):t.reservedRange.push(F.DescriptorProto.ReservedRange.create({start:this.reserved[i][0],end:this.reserved[i][1]}));return t.options=$i(this.options,F.MessageOptions),t};var Py=/^(?![eE])[0-9]*(?:\.[0-9]*)?(?:[eE][+-]?[0-9]+)?$/;Wt.fromDescriptor=function(e,t){if(typeof e.length=="number"&&(e=F.DescriptorProto.decode(e)),typeof e.number!="number")throw Error("missing field id");var i;e.typeName&&e.typeName.length?i=e.typeName:i=Fy(e.type);var n;switch(e.label){case 1:n=void 0;break;case 2:n="required";break;case 3:n="repeated";break;default:throw Error("illegal label: "+e.label)}var s=e.extendee;e.extendee!==void 0&&(s=s.length?s:void 0);var a=new Wt(e.name.length?e.name:"field"+e.number,e.number,i,n,s);if(a.options=Wi(e.options,F.FieldOptions),e.defaultValue&&e.defaultValue.length){var o=e.defaultValue;switch(o){case"true":case"TRUE":o=!0;break;case"false":case"FALSE":o=!1;break;default:var l=Py.exec(o);l&&(o=parseInt(o));break}a.setOption("default",o)}return qy(e.type)&&(t==="proto3"?e.options&&!e.options.packed&&a.setOption("packed",!1):e.options&&e.options.packed||a.setOption("packed",!1)),a};Wt.prototype.toDescriptor=function(e){var t=F.FieldDescriptorProto.create({name:this.name,number:this.id});if(this.map)t.type=11,t.typeName=we.util.ucFirst(this.name),t.label=3;else{switch(t.type=Ho(this.type,this.resolve().resolvedType)){case 10:case 11:case 14:t.typeName=this.resolvedType?Oh(this.parent,this.resolvedType):this.type;break}switch(this.rule){case"repeated":t.label=3;break;case"required":t.label=2;break;default:t.label=1;break}}if(t.extendee=this.extensionField?this.extensionField.parent.fullName:this.extend,this.partOf&&(t.oneofIndex=this.parent.oneofsArray.indexOf(this.partOf))<0)throw Error("missing oneof");return this.options&&(t.options=$i(this.options,F.FieldOptions),this.options.default!=null&&(t.defaultValue=String(this.options.default))),e==="proto3"?this.packed||((t.options||(t.options=F.FieldOptions.create())).packed=!1):this.packed&&((t.options||(t.options=F.FieldOptions.create())).packed=!0),t};var Iy=0;wt.fromDescriptor=function(e){typeof e.length=="number"&&(e=F.EnumDescriptorProto.decode(e));var t={};if(e.value)for(var i=0;i<e.value.length;++i){var n=e.value[i].name,s=e.value[i].number||0;t[n&&n.length?n:"NAME"+s]=s}return new wt(e.name&&e.name.length?e.name:"Enum"+Iy++,t,Wi(e.options,F.EnumOptions))};wt.prototype.toDescriptor=function(){for(var e=[],t=0,i=Object.keys(this.values);t<i.length;++t)e.push(F.EnumValueDescriptorProto.create({name:i[t],number:this.values[i[t]]}));return F.EnumDescriptorProto.create({name:this.name,value:e,options:$i(this.options,F.EnumOptions)})};var xy=0;Yn.fromDescriptor=function(e){return typeof e.length=="number"&&(e=F.OneofDescriptorProto.decode(e)),new Yn(e.name&&e.name.length?e.name:"oneof"+xy++)};Yn.prototype.toDescriptor=function(){return F.OneofDescriptorProto.create({name:this.name})};var Dy=0;Ir.fromDescriptor=function(e){typeof e.length=="number"&&(e=F.ServiceDescriptorProto.decode(e));var t=new Ir(e.name&&e.name.length?e.name:"Service"+Dy++,Wi(e.options,F.ServiceOptions));if(e.method)for(var i=0;i<e.method.length;++i)t.add(Kn.fromDescriptor(e.method[i]));return t};Ir.prototype.toDescriptor=function(){for(var e=[],t=0;t<this.methodsArray.length;++t)e.push(this._methodsArray[t].toDescriptor());return F.ServiceDescriptorProto.create({name:this.name,method:e,options:$i(this.options,F.ServiceOptions)})};var Ly=0;Kn.fromDescriptor=function(e){return typeof e.length=="number"&&(e=F.MethodDescriptorProto.decode(e)),new Kn(e.name&&e.name.length?e.name:"Method"+Ly++,"rpc",e.inputType,e.outputType,!!e.clientStreaming,!!e.serverStreaming,Wi(e.options,F.MethodOptions))};Kn.prototype.toDescriptor=function(){return F.MethodDescriptorProto.create({name:this.name,inputType:this.resolvedRequestType?this.resolvedRequestType.fullName:this.requestType,outputType:this.resolvedResponseType?this.resolvedResponseType.fullName:this.responseType,clientStreaming:this.requestStream,serverStreaming:this.responseStream,options:$i(this.options,F.MethodOptions)})};function Fy(r){switch(r){case 1:return"double";case 2:return"float";case 3:return"int64";case 4:return"uint64";case 5:return"int32";case 6:return"fixed64";case 7:return"fixed32";case 8:return"bool";case 9:return"string";case 12:return"bytes";case 13:return"uint32";case 15:return"sfixed32";case 16:return"sfixed64";case 17:return"sint32";case 18:return"sint64"}throw Error("illegal type: "+r)}function qy(r){switch(r){case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 13:case 14:case 15:case 16:case 17:case 18:return!0}return!1}function Ho(r,e){switch(r){case"double":return 1;case"float":return 2;case"int64":return 3;case"uint64":return 4;case"int32":return 5;case"fixed64":return 6;case"fixed32":return 7;case"bool":return 8;case"string":return 9;case"bytes":return 12;case"uint32":return 13;case"sfixed32":return 15;case"sfixed64":return 16;case"sint32":return 17;case"sint64":return 18}if(e instanceof wt)return 14;if(e instanceof Gt)return e.group?10:11;throw Error("illegal type: "+r)}function Wi(r,e){if(r){for(var t=[],i=0,n,s,a;i<e.fieldsArray.length;++i)(s=(n=e._fieldsArray[i]).name)!=="uninterpretedOption"&&r.hasOwnProperty(s)&&(a=r[s],n.resolvedType instanceof wt&&typeof a=="number"&&n.resolvedType.valuesById[a]!==void 0&&(a=n.resolvedType.valuesById[a]),t.push(By(s),a));return t.length?we.util.toObject(t):void 0}}function $i(r,e){if(r){for(var t=[],i=0,n=Object.keys(r),s,a;i<n.length;++i)if(a=r[s=n[i]],s!=="default"){var o=e.fields[s];!o&&!(o=e.fields[s=we.util.camelCase(s)])||t.push(s,a)}return t.length?e.fromObject(we.util.toObject(t)):void 0}}function Oh(r,e){var t=r.fullName.split("."),i=e.fullName.split("."),n=0,s=0,a=i.length-1;if(!(r instanceof Pr)&&e instanceof wh)for(;n<t.length&&s<a&&t[n]===i[s];){var o=e.lookup(t[n++],!0);if(o!==null&&o!==e)break;++s}else for(;n<t.length&&s<a&&t[n]===i[s];++n,++s);return i.slice(s).join(".")}function By(r){return r.substring(0,1)+r.substring(1).replace(/([A-Z])(?=[a-z]|$)/g,function(e,t){return"_"+t.toLowerCase()})}});var Nh=g((vE,Uy)=>{Uy.exports={nested:{google:{nested:{protobuf:{nested:{Api:{fields:{name:{type:"string",id:1},methods:{rule:"repeated",type:"Method",id:2},options:{rule:"repeated",type:"Option",id:3},version:{type:"string",id:4},sourceContext:{type:"SourceContext",id:5},mixins:{rule:"repeated",type:"Mixin",id:6},syntax:{type:"Syntax",id:7}}},Method:{fields:{name:{type:"string",id:1},requestTypeUrl:{type:"string",id:2},requestStreaming:{type:"bool",id:3},responseTypeUrl:{type:"string",id:4},responseStreaming:{type:"bool",id:5},options:{rule:"repeated",type:"Option",id:6},syntax:{type:"Syntax",id:7}}},Mixin:{fields:{name:{type:"string",id:1},root:{type:"string",id:2}}},SourceContext:{fields:{fileName:{type:"string",id:1}}},Option:{fields:{name:{type:"string",id:1},value:{type:"Any",id:2}}},Syntax:{values:{SYNTAX_PROTO2:0,SYNTAX_PROTO3:1}}}}}}}}});var Ph=g((yE,zy)=>{zy.exports={nested:{google:{nested:{protobuf:{nested:{SourceContext:{fields:{fileName:{type:"string",id:1}}}}}}}}}});var Ih=g((SE,Hy)=>{Hy.exports={nested:{google:{nested:{protobuf:{nested:{Type:{fields:{name:{type:"string",id:1},fields:{rule:"repeated",type:"Field",id:2},oneofs:{rule:"repeated",type:"string",id:3},options:{rule:"repeated",type:"Option",id:4},sourceContext:{type:"SourceContext",id:5},syntax:{type:"Syntax",id:6}}},Field:{fields:{kind:{type:"Kind",id:1},cardinality:{type:"Cardinality",id:2},number:{type:"int32",id:3},name:{type:"string",id:4},typeUrl:{type:"string",id:6},oneofIndex:{type:"int32",id:7},packed:{type:"bool",id:8},options:{rule:"repeated",type:"Option",id:9},jsonName:{type:"string",id:10},defaultValue:{type:"string",id:11}},nested:{Kind:{values:{TYPE_UNKNOWN:0,TYPE_DOUBLE:1,TYPE_FLOAT:2,TYPE_INT64:3,TYPE_UINT64:4,TYPE_INT32:5,TYPE_FIXED64:6,TYPE_FIXED32:7,TYPE_BOOL:8,TYPE_STRING:9,TYPE_GROUP:10,TYPE_MESSAGE:11,TYPE_BYTES:12,TYPE_UINT32:13,TYPE_ENUM:14,TYPE_SFIXED32:15,TYPE_SFIXED64:16,TYPE_SINT32:17,TYPE_SINT64:18}},Cardinality:{values:{CARDINALITY_UNKNOWN:0,CARDINALITY_OPTIONAL:1,CARDINALITY_REQUIRED:2,CARDINALITY_REPEATED:3}}}},Enum:{fields:{name:{type:"string",id:1},enumvalue:{rule:"repeated",type:"EnumValue",id:2},options:{rule:"repeated",type:"Option",id:3},sourceContext:{type:"SourceContext",id:4},syntax:{type:"Syntax",id:5}}},EnumValue:{fields:{name:{type:"string",id:1},number:{type:"int32",id:2},options:{rule:"repeated",type:"Option",id:3}}},Option:{fields:{name:{type:"string",id:1},value:{type:"Any",id:2}}},Syntax:{values:{SYNTAX_PROTO2:0,SYNTAX_PROTO3:1}},Any:{fields:{type_url:{type:"string",id:1},value:{type:"bytes",id:2}}},SourceContext:{fields:{fileName:{type:"string",id:1}}}}}}}}}});var Fh=g($t=>{"use strict";Object.defineProperty($t,"__esModule",{value:!0});$t.addCommonProtos=$t.loadProtosWithOptionsSync=$t.loadProtosWithOptions=void 0;var xh=require("fs"),Dh=require("path"),Vi=Vn();function Lh(r,e){let t=r.resolvePath;r.resolvePath=(i,n)=>{if(Dh.isAbsolute(n))return n;for(let s of e){let a=Dh.join(s,n);try{return xh.accessSync(a,xh.constants.R_OK),a}catch{continue}}return process.emitWarning(`${n} not found in any of the include paths ${e}`),t(i,n)}}async function jy(r,e){let t=new Vi.Root;if(e=e||{},e.includeDirs){if(!Array.isArray(e.includeDirs))return Promise.reject(new Error("The includeDirs option must be an array"));Lh(t,e.includeDirs)}let i=await t.load(r,e);return i.resolveAll(),i}$t.loadProtosWithOptions=jy;function Gy(r,e){let t=new Vi.Root;if(e=e||{},e.includeDirs){if(!Array.isArray(e.includeDirs))throw new Error("The includeDirs option must be an array");Lh(t,e.includeDirs)}let i=t.loadSync(r,e);return i.resolveAll(),i}$t.loadProtosWithOptionsSync=Gy;function Wy(){let r=Nh(),e=zo(),t=Ph(),i=Ih();Vi.common("api",r.nested.google.nested.protobuf.nested),Vi.common("descriptor",e.nested.google.nested.protobuf.nested),Vi.common("source_context",t.nested.google.nested.protobuf.nested),Vi.common("type",i.nested.google.nested.protobuf.nested)}$t.addCommonProtos=Wy});var Uh=g((Bh,jo)=>{var qh=function(r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var e=null;try{e=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch{}function t(y,d,A){this.low=y|0,this.high=d|0,this.unsigned=!!A}t.prototype.__isLong__,Object.defineProperty(t.prototype,"__isLong__",{value:!0});function i(y){return(y&&y.__isLong__)===!0}function n(y){var d=Math.clz32(y&-y);return y?31-d:d}t.isLong=i;var s={},a={};function o(y,d){var A,U,Z;return d?(y>>>=0,(Z=0<=y&&y<256)&&(U=a[y],U)?U:(A=c(y,0,!0),Z&&(a[y]=A),A)):(y|=0,(Z=-128<=y&&y<128)&&(U=s[y],U)?U:(A=c(y,y<0?-1:0,!1),Z&&(s[y]=A),A))}t.fromInt=o;function l(y,d){if(isNaN(y))return d?w:k;if(d){if(y<0)return w;if(y>=b)return re}else{if(y<=-S)return W;if(y+1>=S)return X}return y<0?l(-y,d).neg():c(y%m|0,y/m|0,d)}t.fromNumber=l;function c(y,d,A){return new t(y,d,A)}t.fromBits=c;var u=Math.pow;function h(y,d,A){if(y.length===0)throw Error("empty string");if(typeof d=="number"?(A=d,d=!1):d=!!d,y==="NaN"||y==="Infinity"||y==="+Infinity"||y==="-Infinity")return d?w:k;if(A=A||10,A<2||36<A)throw RangeError("radix");var U;if((U=y.indexOf("-"))>0)throw Error("interior hyphen");if(U===0)return h(y.substring(1),d,A).neg();for(var Z=l(u(A,8)),$=k,ne=0;ne<y.length;ne+=8){var Y=Math.min(8,y.length-ne),Te=parseInt(y.substring(ne,ne+Y),A);if(Y<8){var oe=l(u(A,Y));$=$.mul(oe).add(l(Te))}else $=$.mul(Z),$=$.add(l(Te))}return $.unsigned=d,$}t.fromString=h;function f(y,d){return typeof y=="number"?l(y,d):typeof y=="string"?h(y,d):c(y.low,y.high,typeof d=="boolean"?d:y.unsigned)}t.fromValue=f;var p=1<<16,E=1<<24,m=p*p,b=m*m,S=b/2,T=o(E),k=o(0);t.ZERO=k;var w=o(0,!0);t.UZERO=w;var L=o(1);t.ONE=L;var x=o(1,!0);t.UONE=x;var q=o(-1);t.NEG_ONE=q;var X=c(-1,2147483647,!1);t.MAX_VALUE=X;var re=c(-1,-1,!0);t.MAX_UNSIGNED_VALUE=re;var W=c(0,-2147483648,!1);t.MIN_VALUE=W;var v=t.prototype;v.toInt=function(){return this.unsigned?this.low>>>0:this.low},v.toNumber=function(){return this.unsigned?(this.high>>>0)*m+(this.low>>>0):this.high*m+(this.low>>>0)},v.toString=function(d){if(d=d||10,d<2||36<d)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative())if(this.eq(W)){var A=l(d),U=this.div(A),Z=U.mul(A).sub(this);return U.toString(d)+Z.toInt().toString(d)}else return"-"+this.neg().toString(d);for(var $=l(u(d,6),this.unsigned),ne=this,Y="";;){var Te=ne.div($),oe=ne.sub(Te.mul($)).toInt()>>>0,ie=oe.toString(d);if(ne=Te,ne.isZero())return ie+Y;for(;ie.length<6;)ie="0"+ie;Y=""+ie+Y}},v.getHighBits=function(){return this.high},v.getHighBitsUnsigned=function(){return this.high>>>0},v.getLowBits=function(){return this.low},v.getLowBitsUnsigned=function(){return this.low>>>0},v.getNumBitsAbs=function(){if(this.isNegative())return this.eq(W)?64:this.neg().getNumBitsAbs();for(var d=this.high!=0?this.high:this.low,A=31;A>0&&!(d&1<<A);A--);return this.high!=0?A+33:A+1},v.isZero=function(){return this.high===0&&this.low===0},v.eqz=v.isZero,v.isNegative=function(){return!this.unsigned&&this.high<0},v.isPositive=function(){return this.unsigned||this.high>=0},v.isOdd=function(){return(this.low&1)===1},v.isEven=function(){return(this.low&1)===0},v.equals=function(d){return i(d)||(d=f(d)),this.unsigned!==d.unsigned&&this.high>>>31===1&&d.high>>>31===1?!1:this.high===d.high&&this.low===d.low},v.eq=v.equals,v.notEquals=function(d){return!this.eq(d)},v.neq=v.notEquals,v.ne=v.notEquals,v.lessThan=function(d){return this.comp(d)<0},v.lt=v.lessThan,v.lessThanOrEqual=function(d){return this.comp(d)<=0},v.lte=v.lessThanOrEqual,v.le=v.lessThanOrEqual,v.greaterThan=function(d){return this.comp(d)>0},v.gt=v.greaterThan,v.greaterThanOrEqual=function(d){return this.comp(d)>=0},v.gte=v.greaterThanOrEqual,v.ge=v.greaterThanOrEqual,v.compare=function(d){if(i(d)||(d=f(d)),this.eq(d))return 0;var A=this.isNegative(),U=d.isNegative();return A&&!U?-1:!A&&U?1:this.unsigned?d.high>>>0>this.high>>>0||d.high===this.high&&d.low>>>0>this.low>>>0?-1:1:this.sub(d).isNegative()?-1:1},v.comp=v.compare,v.negate=function(){return!this.unsigned&&this.eq(W)?W:this.not().add(L)},v.neg=v.negate,v.add=function(d){i(d)||(d=f(d));var A=this.high>>>16,U=this.high&65535,Z=this.low>>>16,$=this.low&65535,ne=d.high>>>16,Y=d.high&65535,Te=d.low>>>16,oe=d.low&65535,ie=0,ve=0,le=0,Ee=0;return Ee+=$+oe,le+=Ee>>>16,Ee&=65535,le+=Z+Te,ve+=le>>>16,le&=65535,ve+=U+Y,ie+=ve>>>16,ve&=65535,ie+=A+ne,ie&=65535,c(le<<16|Ee,ie<<16|ve,this.unsigned)},v.subtract=function(d){return i(d)||(d=f(d)),this.add(d.neg())},v.sub=v.subtract,v.multiply=function(d){if(this.isZero())return this;if(i(d)||(d=f(d)),e){var A=e.mul(this.low,this.high,d.low,d.high);return c(A,e.get_high(),this.unsigned)}if(d.isZero())return this.unsigned?w:k;if(this.eq(W))return d.isOdd()?W:k;if(d.eq(W))return this.isOdd()?W:k;if(this.isNegative())return d.isNegative()?this.neg().mul(d.neg()):this.neg().mul(d).neg();if(d.isNegative())return this.mul(d.neg()).neg();if(this.lt(T)&&d.lt(T))return l(this.toNumber()*d.toNumber(),this.unsigned);var U=this.high>>>16,Z=this.high&65535,$=this.low>>>16,ne=this.low&65535,Y=d.high>>>16,Te=d.high&65535,oe=d.low>>>16,ie=d.low&65535,ve=0,le=0,Ee=0,_i=0;return _i+=ne*ie,Ee+=_i>>>16,_i&=65535,Ee+=$*ie,le+=Ee>>>16,Ee&=65535,Ee+=ne*oe,le+=Ee>>>16,Ee&=65535,le+=Z*ie,ve+=le>>>16,le&=65535,le+=$*oe,ve+=le>>>16,le&=65535,le+=ne*Te,ve+=le>>>16,le&=65535,ve+=U*ie+Z*oe+$*Te+ne*Y,ve&=65535,c(Ee<<16|_i,ve<<16|le,this.unsigned)},v.mul=v.multiply,v.divide=function(d){if(i(d)||(d=f(d)),d.isZero())throw Error("division by zero");if(e){if(!this.unsigned&&this.high===-2147483648&&d.low===-1&&d.high===-1)return this;var A=(this.unsigned?e.div_u:e.div_s)(this.low,this.high,d.low,d.high);return c(A,e.get_high(),this.unsigned)}if(this.isZero())return this.unsigned?w:k;var U,Z,$;if(this.unsigned){if(d.unsigned||(d=d.toUnsigned()),d.gt(this))return w;if(d.gt(this.shru(1)))return x;$=w}else{if(this.eq(W)){if(d.eq(L)||d.eq(q))return W;if(d.eq(W))return L;var ne=this.shr(1);return U=ne.div(d).shl(1),U.eq(k)?d.isNegative()?L:q:(Z=this.sub(d.mul(U)),$=U.add(Z.div(d)),$)}else if(d.eq(W))return this.unsigned?w:k;if(this.isNegative())return d.isNegative()?this.neg().div(d.neg()):this.neg().div(d).neg();if(d.isNegative())return this.div(d.neg()).neg();$=k}for(Z=this;Z.gte(d);){U=Math.max(1,Math.floor(Z.toNumber()/d.toNumber()));for(var Y=Math.ceil(Math.log(U)/Math.LN2),Te=Y<=48?1:u(2,Y-48),oe=l(U),ie=oe.mul(d);ie.isNegative()||ie.gt(Z);)U-=Te,oe=l(U,this.unsigned),ie=oe.mul(d);oe.isZero()&&(oe=L),$=$.add(oe),Z=Z.sub(ie)}return $},v.div=v.divide,v.modulo=function(d){if(i(d)||(d=f(d)),e){var A=(this.unsigned?e.rem_u:e.rem_s)(this.low,this.high,d.low,d.high);return c(A,e.get_high(),this.unsigned)}return this.sub(this.div(d).mul(d))},v.mod=v.modulo,v.rem=v.modulo,v.not=function(){return c(~this.low,~this.high,this.unsigned)},v.countLeadingZeros=function(){return this.high?Math.clz32(this.high):Math.clz32(this.low)+32},v.clz=v.countLeadingZeros,v.countTrailingZeros=function(){return this.low?n(this.low):n(this.high)+32},v.ctz=v.countTrailingZeros,v.and=function(d){return i(d)||(d=f(d)),c(this.low&d.low,this.high&d.high,this.unsigned)},v.or=function(d){return i(d)||(d=f(d)),c(this.low|d.low,this.high|d.high,this.unsigned)},v.xor=function(d){return i(d)||(d=f(d)),c(this.low^d.low,this.high^d.high,this.unsigned)},v.shiftLeft=function(d){return i(d)&&(d=d.toInt()),(d&=63)===0?this:d<32?c(this.low<<d,this.high<<d|this.low>>>32-d,this.unsigned):c(0,this.low<<d-32,this.unsigned)},v.shl=v.shiftLeft,v.shiftRight=function(d){return i(d)&&(d=d.toInt()),(d&=63)===0?this:d<32?c(this.low>>>d|this.high<<32-d,this.high>>d,this.unsigned):c(this.high>>d-32,this.high>=0?0:-1,this.unsigned)},v.shr=v.shiftRight,v.shiftRightUnsigned=function(d){return i(d)&&(d=d.toInt()),(d&=63)===0?this:d<32?c(this.low>>>d|this.high<<32-d,this.high>>>d,this.unsigned):d===32?c(this.high,0,this.unsigned):c(this.high>>>d-32,0,this.unsigned)},v.shru=v.shiftRightUnsigned,v.shr_u=v.shiftRightUnsigned,v.rotateLeft=function(d){var A;return i(d)&&(d=d.toInt()),(d&=63)===0?this:d===32?c(this.high,this.low,this.unsigned):d<32?(A=32-d,c(this.low<<d|this.high>>>A,this.high<<d|this.low>>>A,this.unsigned)):(d-=32,A=32-d,c(this.high<<d|this.low>>>A,this.low<<d|this.high>>>A,this.unsigned))},v.rotl=v.rotateLeft,v.rotateRight=function(d){var A;return i(d)&&(d=d.toInt()),(d&=63)===0?this:d===32?c(this.high,this.low,this.unsigned):d<32?(A=32-d,c(this.high<<A|this.low>>>d,this.low<<A|this.high>>>d,this.unsigned)):(d-=32,A=32-d,c(this.low<<A|this.high>>>d,this.high<<A|this.low>>>d,this.unsigned))},v.rotr=v.rotateRight,v.toSigned=function(){return this.unsigned?c(this.low,this.high,!1):this},v.toUnsigned=function(){return this.unsigned?this:c(this.low,this.high,!0)},v.toBytes=function(d){return d?this.toBytesLE():this.toBytesBE()},v.toBytesLE=function(){var d=this.high,A=this.low;return[A&255,A>>>8&255,A>>>16&255,A>>>24,d&255,d>>>8&255,d>>>16&255,d>>>24]},v.toBytesBE=function(){var d=this.high,A=this.low;return[d>>>24,d>>>16&255,d>>>8&255,d&255,A>>>24,A>>>16&255,A>>>8&255,A&255]},t.fromBytes=function(d,A,U){return U?t.fromBytesLE(d,A):t.fromBytesBE(d,A)},t.fromBytesLE=function(d,A){return new t(d[0]|d[1]<<8|d[2]<<16|d[3]<<24,d[4]|d[5]<<8|d[6]<<16|d[7]<<24,A)},t.fromBytesBE=function(d,A){return new t(d[4]<<24|d[5]<<16|d[6]<<8|d[7],d[0]<<24|d[1]<<16|d[2]<<8|d[3],A)};var Q=t;return r.default=Q,"default"in r?r.default:r}({});typeof define=="function"&&define.amd?define([],function(){return qh}):typeof jo=="object"&&typeof Bh=="object"&&(jo.exports=qh)});var Vo=g(ue=>{"use strict";Object.defineProperty(ue,"__esModule",{value:!0});ue.loadFileDescriptorSetFromObject=ue.loadFileDescriptorSetFromBuffer=ue.fromJSON=ue.loadSync=ue.load=ue.IdempotencyLevel=ue.isAnyExtension=ue.Long=void 0;var $y=Au(),mt=Vn(),Wo=kh(),$o=Fh(),Vy=Uh();ue.Long=Vy;function Yy(r){return"@type"in r&&typeof r["@type"]=="string"}ue.isAnyExtension=Yy;var jh;(function(r){r.IDEMPOTENCY_UNKNOWN="IDEMPOTENCY_UNKNOWN",r.NO_SIDE_EFFECTS="NO_SIDE_EFFECTS",r.IDEMPOTENT="IDEMPOTENT"})(jh=ue.IdempotencyLevel||(ue.IdempotencyLevel={}));var Gh={longs:String,enums:String,bytes:String,defaults:!0,oneofs:!0,json:!0};function Ky(r,e){return r===""?e:r+"."+e}function Jy(r){return r instanceof mt.Service||r instanceof mt.Type||r instanceof mt.Enum}function Xy(r){return r instanceof mt.Namespace||r instanceof mt.Root}function Wh(r,e){let t=Ky(e,r.name);return Jy(r)?[[t,r]]:Xy(r)&&typeof r.nested<"u"?Object.keys(r.nested).map(i=>Wh(r.nested[i],t)).reduce((i,n)=>i.concat(n),[]):[]}function zh(r,e){return function(i){return r.toObject(r.decode(i),e)}}function Hh(r){return function(t){if(Array.isArray(t))throw new Error(`Failed to serialize message: expected object with ${r.name} structure, got array instead`);let i=r.fromObject(t);return r.encode(i).finish()}}function Zy(r){return(r||[]).reduce((e,t)=>{for(let[i,n]of Object.entries(t))switch(i){case"uninterpreted_option":e.uninterpreted_option.push(t.uninterpreted_option);break;default:e[i]=n}return e},{deprecated:!1,idempotency_level:jh.IDEMPOTENCY_UNKNOWN,uninterpreted_option:[]})}function Qy(r,e,t,i){let n=r.resolvedRequestType,s=r.resolvedResponseType;return{path:"/"+e+"/"+r.name,requestStream:!!r.requestStream,responseStream:!!r.responseStream,requestSerialize:Hh(n),requestDeserialize:zh(n,t),responseSerialize:Hh(s),responseDeserialize:zh(s,t),originalName:$y(r.name),requestType:Go(n,i),responseType:Go(s,i),options:Zy(r.parsedOptions)}}function e0(r,e,t,i){let n={};for(let s of r.methodsArray)n[s.name]=Qy(s,e,t,i);return n}function Go(r,e){let t=r.toDescriptor("proto3");return{format:"Protocol Buffer 3 DescriptorProto",type:t.$type.toObject(t,Gh),fileDescriptorProtos:e}}function t0(r,e){let t=r.toDescriptor("proto3");return{format:"Protocol Buffer 3 EnumDescriptorProto",type:t.$type.toObject(t,Gh),fileDescriptorProtos:e}}function i0(r,e,t,i){if(r instanceof mt.Service)return e0(r,e,t,i);if(r instanceof mt.Type)return Go(r,i);if(r instanceof mt.Enum)return t0(r,i);throw new Error("Type mismatch in reflection object handling")}function Jn(r,e){let t={};r.resolveAll();let n=r.toDescriptor("proto3").file.map(s=>Buffer.from(Wo.FileDescriptorProto.encode(s).finish()));for(let[s,a]of Wh(r,""))t[s]=i0(a,s,e,n);return t}function $h(r,e){e=e||{};let t=mt.Root.fromDescriptor(r);return t.resolveAll(),Jn(t,e)}function r0(r,e){return(0,$o.loadProtosWithOptions)(r,e).then(t=>Jn(t,e))}ue.load=r0;function n0(r,e){let t=(0,$o.loadProtosWithOptionsSync)(r,e);return Jn(t,e)}ue.loadSync=n0;function s0(r,e){e=e||{};let t=mt.Root.fromJSON(r);return t.resolveAll(),Jn(t,e)}ue.fromJSON=s0;function a0(r,e){let t=Wo.FileDescriptorSet.decode(r);return $h(t,e)}ue.loadFileDescriptorSetFromBuffer=a0;function o0(r,e){let t=Wo.FileDescriptorSet.fromObject(r);return $h(t,e)}ue.loadFileDescriptorSetFromObject=o0;(0,$o.addCommonProtos)()});var fi=g(G=>{"use strict";Object.defineProperty(G,"__esModule",{value:!0});G.setup=G.getChannelzServiceDefinition=G.getChannelzHandlers=G.unregisterChannelzRef=G.registerChannelzSocket=G.registerChannelzServer=G.registerChannelzSubchannel=G.registerChannelzChannel=G.ChannelzCallTrackerStub=G.ChannelzCallTracker=G.ChannelzChildrenTrackerStub=G.ChannelzChildrenTracker=G.ChannelzTrace=G.ChannelzTraceStub=void 0;var Vh=require("net"),hi=Kc(),xr=Be(),Dr=z(),l0=Xe(),c0=vn(),u0=ja();function Yo(r){return{channel_id:r.id,name:r.name}}function Qo(r){return{subchannel_id:r.id,name:r.name}}function d0(r){return{server_id:r.id}}function es(r){return{socket_id:r.id,name:r.name}}var Yh=32,el=100,Ko=class{constructor(){this.events=[],this.creationTimestamp=new Date,this.eventsLogged=0}addTrace(){}getTraceMessage(){return{creation_timestamp:vt(this.creationTimestamp),num_events_logged:this.eventsLogged,events:[]}}};G.ChannelzTraceStub=Ko;var Jo=class{constructor(){this.events=[],this.eventsLogged=0,this.creationTimestamp=new Date}addTrace(e,t,i){let n=new Date;this.events.push({description:t,severity:e,timestamp:n,childChannel:i?.kind==="channel"?i:void 0,childSubchannel:i?.kind==="subchannel"?i:void 0}),this.events.length>=Yh*2&&(this.events=this.events.slice(Yh)),this.eventsLogged+=1}getTraceMessage(){return{creation_timestamp:vt(this.creationTimestamp),num_events_logged:this.eventsLogged,events:this.events.map(e=>({description:e.description,severity:e.severity,timestamp:vt(e.timestamp),channel_ref:e.childChannel?Yo(e.childChannel):null,subchannel_ref:e.childSubchannel?Qo(e.childSubchannel):null}))}}};G.ChannelzTrace=Jo;var Zn=class{constructor(){this.channelChildren=new hi.OrderedMap,this.subchannelChildren=new hi.OrderedMap,this.socketChildren=new hi.OrderedMap,this.trackerMap={channel:this.channelChildren,subchannel:this.subchannelChildren,socket:this.socketChildren}}refChild(e){let t=this.trackerMap[e.kind],i=t.find(e.id);i.equals(t.end())?t.setElement(e.id,{ref:e,count:1},i):i.pointer[1].count+=1}unrefChild(e){let t=this.trackerMap[e.kind],i=t.getElementByKey(e.id);i!==void 0&&(i.count-=1,i.count===0&&t.eraseElementByKey(e.id))}getChildLists(){return{channels:this.channelChildren,subchannels:this.subchannelChildren,sockets:this.socketChildren}}};G.ChannelzChildrenTracker=Zn;var Xo=class extends Zn{refChild(){}unrefChild(){}};G.ChannelzChildrenTrackerStub=Xo;var Qn=class{constructor(){this.callsStarted=0,this.callsSucceeded=0,this.callsFailed=0,this.lastCallStartedTimestamp=null}addCallStarted(){this.callsStarted+=1,this.lastCallStartedTimestamp=new Date}addCallSucceeded(){this.callsSucceeded+=1}addCallFailed(){this.callsFailed+=1}};G.ChannelzCallTracker=Qn;var Zo=class extends Qn{addCallStarted(){}addCallSucceeded(){}addCallFailed(){}};G.ChannelzCallTrackerStub=Zo;var At={channel:new hi.OrderedMap,subchannel:new hi.OrderedMap,server:new hi.OrderedMap,socket:new hi.OrderedMap},ts=r=>{let e=1;function t(){return e++}let i=At[r];return(n,s,a)=>{let o=t(),l={id:o,name:n,kind:r};return a&&i.setElement(o,{ref:l,getInfo:s}),l}};G.registerChannelzChannel=ts("channel");G.registerChannelzSubchannel=ts("subchannel");G.registerChannelzServer=ts("server");G.registerChannelzSocket=ts("socket");function h0(r){At[r.kind].eraseElementByKey(r.id)}G.unregisterChannelzRef=h0;function f0(r){let e=Number.parseInt(r,16);return[e/256|0,e%256]}function Kh(r){if(r==="")return[];let e=r.split(":").map(i=>f0(i));return[].concat(...e)}function p0(r){if((0,Vh.isIPv4)(r))return Buffer.from(Uint8Array.from(r.split(".").map(e=>Number.parseInt(e))));if((0,Vh.isIPv6)(r)){let e,t,i=r.indexOf("::");i===-1?(e=r,t=""):(e=r.substring(0,i),t=r.substring(i+2));let n=Buffer.from(Kh(e)),s=Buffer.from(Kh(t)),a=Buffer.alloc(16-n.length-s.length,0);return Buffer.concat([n,a,s])}else return null}function Xh(r){switch(r){case xr.ConnectivityState.CONNECTING:return{state:"CONNECTING"};case xr.ConnectivityState.IDLE:return{state:"IDLE"};case xr.ConnectivityState.READY:return{state:"READY"};case xr.ConnectivityState.SHUTDOWN:return{state:"SHUTDOWN"};case xr.ConnectivityState.TRANSIENT_FAILURE:return{state:"TRANSIENT_FAILURE"};default:return{state:"UNKNOWN"}}}function vt(r){if(!r)return null;let e=r.getTime();return{seconds:e/1e3|0,nanos:e%1e3*1e6}}function Zh(r){let e=r.getInfo(),t=[],i=[];return e.children.channels.forEach(n=>{t.push(Yo(n[1].ref))}),e.children.subchannels.forEach(n=>{i.push(Qo(n[1].ref))}),{ref:Yo(r.ref),data:{target:e.target,state:Xh(e.state),calls_started:e.callTracker.callsStarted,calls_succeeded:e.callTracker.callsSucceeded,calls_failed:e.callTracker.callsFailed,last_call_started_timestamp:vt(e.callTracker.lastCallStartedTimestamp),trace:e.trace.getTraceMessage()},channel_ref:t,subchannel_ref:i}}function g0(r,e){let t=parseInt(r.request.channel_id,10),i=At.channel.getElementByKey(t);if(i===void 0){e({code:Dr.Status.NOT_FOUND,details:"No channel data found for id "+t});return}e(null,{channel:Zh(i)})}function m0(r,e){let t=parseInt(r.request.max_results,10)||el,i=[],n=parseInt(r.request.start_channel_id,10),s=At.channel,a;for(a=s.lowerBound(n);!a.equals(s.end())&&i.length<t;a=a.next())i.push(Zh(a.pointer[1]));e(null,{channel:i,end:a.equals(s.end())})}function Qh(r){let e=r.getInfo(),t=[];return e.listenerChildren.sockets.forEach(i=>{t.push(es(i[1].ref))}),{ref:d0(r.ref),data:{calls_started:e.callTracker.callsStarted,calls_succeeded:e.callTracker.callsSucceeded,calls_failed:e.callTracker.callsFailed,last_call_started_timestamp:vt(e.callTracker.lastCallStartedTimestamp),trace:e.trace.getTraceMessage()},listen_socket:t}}function v0(r,e){let t=parseInt(r.request.server_id,10),n=At.server.getElementByKey(t);if(n===void 0){e({code:Dr.Status.NOT_FOUND,details:"No server data found for id "+t});return}e(null,{server:Qh(n)})}function y0(r,e){let t=parseInt(r.request.max_results,10)||el,i=parseInt(r.request.start_server_id,10),n=At.server,s=[],a;for(a=n.lowerBound(i);!a.equals(n.end())&&s.length<t;a=a.next())s.push(Qh(a.pointer[1]));e(null,{server:s,end:a.equals(n.end())})}function S0(r,e){let t=parseInt(r.request.subchannel_id,10),i=At.subchannel.getElementByKey(t);if(i===void 0){e({code:Dr.Status.NOT_FOUND,details:"No subchannel data found for id "+t});return}let n=i.getInfo(),s=[];n.children.sockets.forEach(o=>{s.push(es(o[1].ref))});let a={ref:Qo(i.ref),data:{target:n.target,state:Xh(n.state),calls_started:n.callTracker.callsStarted,calls_succeeded:n.callTracker.callsSucceeded,calls_failed:n.callTracker.callsFailed,last_call_started_timestamp:vt(n.callTracker.lastCallStartedTimestamp),trace:n.trace.getTraceMessage()},socket_ref:s};e(null,{subchannel:a})}function Jh(r){var e;return(0,l0.isTcpSubchannelAddress)(r)?{address:"tcpip_address",tcpip_address:{ip_address:(e=p0(r.host))!==null&&e!==void 0?e:void 0,port:r.port}}:{address:"uds_address",uds_address:{filename:r.path}}}function _0(r,e){var t,i,n,s,a;let o=parseInt(r.request.socket_id,10),l=At.socket.getElementByKey(o);if(l===void 0){e({code:Dr.Status.NOT_FOUND,details:"No socket data found for id "+o});return}let c=l.getInfo(),u=c.security?{model:"tls",tls:{cipher_suite:c.security.cipherSuiteStandardName?"standard_name":"other_name",standard_name:(t=c.security.cipherSuiteStandardName)!==null&&t!==void 0?t:void 0,other_name:(i=c.security.cipherSuiteOtherName)!==null&&i!==void 0?i:void 0,local_certificate:(n=c.security.localCertificate)!==null&&n!==void 0?n:void 0,remote_certificate:(s=c.security.remoteCertificate)!==null&&s!==void 0?s:void 0}}:null,h={ref:es(l.ref),local:c.localAddress?Jh(c.localAddress):null,remote:c.remoteAddress?Jh(c.remoteAddress):null,remote_name:(a=c.remoteName)!==null&&a!==void 0?a:void 0,security:u,data:{keep_alives_sent:c.keepAlivesSent,streams_started:c.streamsStarted,streams_succeeded:c.streamsSucceeded,streams_failed:c.streamsFailed,last_local_stream_created_timestamp:vt(c.lastLocalStreamCreatedTimestamp),last_remote_stream_created_timestamp:vt(c.lastRemoteStreamCreatedTimestamp),messages_received:c.messagesReceived,messages_sent:c.messagesSent,last_message_received_timestamp:vt(c.lastMessageReceivedTimestamp),last_message_sent_timestamp:vt(c.lastMessageSentTimestamp),local_flow_control_window:c.localFlowControlWindow?{value:c.localFlowControlWindow}:null,remote_flow_control_window:c.remoteFlowControlWindow?{value:c.remoteFlowControlWindow}:null}};e(null,{socket:h})}function C0(r,e){let t=parseInt(r.request.server_id,10),i=At.server.getElementByKey(t);if(i===void 0){e({code:Dr.Status.NOT_FOUND,details:"No server data found for id "+t});return}let n=parseInt(r.request.start_socket_id,10),s=parseInt(r.request.max_results,10)||el,o=i.getInfo().sessionChildren.sockets,l=[],c;for(c=o.lowerBound(n);!c.equals(o.end())&&l.length<s;c=c.next())l.push(es(c.pointer[1].ref));e(null,{socket_ref:l,end:c.equals(o.end())})}function ef(){return{GetChannel:g0,GetTopChannels:m0,GetServer:v0,GetServers:y0,GetSubchannel:S0,GetSocket:_0,GetServerSockets:C0}}G.getChannelzHandlers=ef;var Xn=null;function tf(){if(Xn)return Xn;let r=Vo().loadSync,e=r("channelz.proto",{keepCase:!0,longs:String,enums:String,defaults:!0,oneofs:!0,includeDirs:[`${__dirname}/../../proto`]});return Xn=(0,u0.loadPackageDefinition)(e).grpc.channelz.v1.Channelz.service,Xn}G.getChannelzServiceDefinition=tf;function T0(){(0,c0.registerAdminService)(tf,ef)}G.setup=T0});var rf=g(rs=>{"use strict";Object.defineProperty(rs,"__esModule",{value:!0});rs.Subchannel=void 0;var J=Be(),E0=pr(),tl=te(),is=z(),b0=Pe(),R0=Xe(),yt=fi(),w0="subchannel",A0=~(1<<31),il=class{constructor(e,t,i,n,s){var a;this.channelTarget=e,this.subchannelAddress=t,this.options=i,this.credentials=n,this.connector=s,this.connectivityState=J.ConnectivityState.IDLE,this.transport=null,this.continueConnecting=!1,this.stateListeners=new Set,this.refcount=0,this.channelzEnabled=!0;let o={initialDelay:i["grpc.initial_reconnect_backoff_ms"],maxDelay:i["grpc.max_reconnect_backoff_ms"]};this.backoffTimeout=new E0.BackoffTimeout(()=>{this.handleBackoffTimer()},o),this.backoffTimeout.unref(),this.subchannelAddressString=(0,R0.subchannelAddressToString)(t),this.keepaliveTime=(a=i["grpc.keepalive_time_ms"])!==null&&a!==void 0?a:-1,i["grpc.enable_channelz"]===0?(this.channelzEnabled=!1,this.channelzTrace=new yt.ChannelzTraceStub,this.callTracker=new yt.ChannelzCallTrackerStub,this.childrenTracker=new yt.ChannelzChildrenTrackerStub,this.streamTracker=new yt.ChannelzCallTrackerStub):(this.channelzTrace=new yt.ChannelzTrace,this.callTracker=new yt.ChannelzCallTracker,this.childrenTracker=new yt.ChannelzChildrenTracker,this.streamTracker=new yt.ChannelzCallTracker),this.channelzRef=(0,yt.registerChannelzSubchannel)(this.subchannelAddressString,()=>this.getChannelzInfo(),this.channelzEnabled),this.channelzTrace.addTrace("CT_INFO","Subchannel created"),this.trace("Subchannel constructed with options "+JSON.stringify(i,void 0,2))}getChannelzInfo(){return{state:this.connectivityState,trace:this.channelzTrace,callTracker:this.callTracker,children:this.childrenTracker.getChildLists(),target:this.subchannelAddressString}}trace(e){tl.trace(is.LogVerbosity.DEBUG,w0,"("+this.channelzRef.id+") "+this.subchannelAddressString+" "+e)}refTrace(e){tl.trace(is.LogVerbosity.DEBUG,"subchannel_refcount","("+this.channelzRef.id+") "+this.subchannelAddressString+" "+e)}handleBackoffTimer(){this.continueConnecting?this.transitionToState([J.ConnectivityState.TRANSIENT_FAILURE],J.ConnectivityState.CONNECTING):this.transitionToState([J.ConnectivityState.TRANSIENT_FAILURE],J.ConnectivityState.IDLE)}startBackoff(){this.backoffTimeout.runOnce()}stopBackoff(){this.backoffTimeout.stop(),this.backoffTimeout.reset()}startConnectingInternal(){let e=this.options;if(e["grpc.keepalive_time_ms"]){let t=Math.min(this.keepaliveTime,A0);e=Object.assign(Object.assign({},e),{"grpc.keepalive_time_ms":t})}this.connector.connect(this.subchannelAddress,this.credentials,e).then(t=>{this.transitionToState([J.ConnectivityState.CONNECTING],J.ConnectivityState.READY)?(this.transport=t,this.channelzEnabled&&this.childrenTracker.refChild(t.getChannelzRef()),t.addDisconnectListener(i=>{this.transitionToState([J.ConnectivityState.READY],J.ConnectivityState.IDLE),i&&this.keepaliveTime>0&&(this.keepaliveTime*=2,tl.log(is.LogVerbosity.ERROR,`Connection to ${(0,b0.uriToString)(this.channelTarget)} at ${this.subchannelAddressString} rejected by server because of excess pings. Increasing ping interval to ${this.keepaliveTime} ms`))})):t.shutdown()},t=>{this.transitionToState([J.ConnectivityState.CONNECTING],J.ConnectivityState.TRANSIENT_FAILURE,`${t}`)})}transitionToState(e,t,i){var n,s;if(e.indexOf(this.connectivityState)===-1)return!1;this.trace(J.ConnectivityState[this.connectivityState]+" -> "+J.ConnectivityState[t]),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Connectivity state change to "+J.ConnectivityState[t]);let a=this.connectivityState;switch(this.connectivityState=t,t){case J.ConnectivityState.READY:this.stopBackoff();break;case J.ConnectivityState.CONNECTING:this.startBackoff(),this.startConnectingInternal(),this.continueConnecting=!1;break;case J.ConnectivityState.TRANSIENT_FAILURE:this.channelzEnabled&&this.transport&&this.childrenTracker.unrefChild(this.transport.getChannelzRef()),(n=this.transport)===null||n===void 0||n.shutdown(),this.transport=null,this.backoffTimeout.isRunning()||process.nextTick(()=>{this.handleBackoffTimer()});break;case J.ConnectivityState.IDLE:this.channelzEnabled&&this.transport&&this.childrenTracker.unrefChild(this.transport.getChannelzRef()),(s=this.transport)===null||s===void 0||s.shutdown(),this.transport=null;break;default:throw new Error(`Invalid state: unknown ConnectivityState ${t}`)}for(let o of this.stateListeners)o(this,a,t,this.keepaliveTime,i);return!0}ref(){this.refTrace("refcount "+this.refcount+" -> "+(this.refcount+1)),this.refcount+=1}unref(){this.refTrace("refcount "+this.refcount+" -> "+(this.refcount-1)),this.refcount-=1,this.refcount===0&&(this.channelzTrace.addTrace("CT_INFO","Shutting down"),(0,yt.unregisterChannelzRef)(this.channelzRef),process.nextTick(()=>{this.transitionToState([J.ConnectivityState.CONNECTING,J.ConnectivityState.READY],J.ConnectivityState.IDLE)}))}unrefIfOneRef(){return this.refcount===1?(this.unref(),!0):!1}createCall(e,t,i,n){if(!this.transport)throw new Error("Cannot create call, subchannel not READY");let s;return this.channelzEnabled?(this.callTracker.addCallStarted(),this.streamTracker.addCallStarted(),s={onCallEnd:a=>{a.code===is.Status.OK?this.callTracker.addCallSucceeded():this.callTracker.addCallFailed()}}):s={},this.transport.createCall(e,t,i,n,s)}startConnecting(){process.nextTick(()=>{this.transitionToState([J.ConnectivityState.IDLE],J.ConnectivityState.CONNECTING)||this.connectivityState===J.ConnectivityState.TRANSIENT_FAILURE&&(this.continueConnecting=!0)})}getConnectivityState(){return this.connectivityState}addConnectivityStateListener(e){this.stateListeners.add(e)}removeConnectivityStateListener(e){this.stateListeners.delete(e)}resetBackoff(){process.nextTick(()=>{this.backoffTimeout.reset(),this.transitionToState([J.ConnectivityState.TRANSIENT_FAILURE],J.ConnectivityState.CONNECTING)})}getAddress(){return this.subchannelAddressString}getChannelzRef(){return this.channelzRef}isHealthy(){return!0}addHealthStateWatcher(e){}removeHealthStateWatcher(e){}getRealSubchannel(){return this}realSubchannelEquals(e){return e.getRealSubchannel()===this}throttleKeepalive(e){e>this.keepaliveTime&&(this.keepaliveTime=e)}};rs.Subchannel=il});var al=g(Kt=>{"use strict";Object.defineProperty(Kt,"__esModule",{value:!0});Kt.setup=Kt.DEFAULT_PORT=void 0;var nf=ot(),af=require("dns"),of=require("util"),O0=oa(),rl=z(),nl=Re(),M0=te(),k0=z(),Vt=Pe(),sf=require("net"),N0=pr(),P0="dns_resolver";function Yt(r){M0.trace(k0.LogVerbosity.DEBUG,P0,r)}Kt.DEFAULT_PORT=443;var I0=3e4,x0=of.promisify(af.resolveTxt),D0=of.promisify(af.lookup),sl=class{constructor(e,t,i){var n,s,a;this.target=e,this.listener=t,this.pendingLookupPromise=null,this.pendingTxtPromise=null,this.latestLookupResult=null,this.latestServiceConfig=null,this.latestServiceConfigError=null,this.continueResolving=!1,this.isNextResolutionTimerRunning=!1,this.isServiceConfigEnabled=!0,this.returnedIpResult=!1,Yt("Resolver constructed for target "+(0,Vt.uriToString)(e));let o=(0,Vt.splitHostPort)(e.path);o===null?(this.ipResult=null,this.dnsHostname=null,this.port=null):(0,sf.isIPv4)(o.host)||(0,sf.isIPv6)(o.host)?(this.ipResult=[{addresses:[{host:o.host,port:(n=o.port)!==null&&n!==void 0?n:Kt.DEFAULT_PORT}]}],this.dnsHostname=null,this.port=null):(this.ipResult=null,this.dnsHostname=o.host,this.port=(s=o.port)!==null&&s!==void 0?s:Kt.DEFAULT_PORT),this.percentage=Math.random()*100,i["grpc.service_config_disable_resolution"]===1&&(this.isServiceConfigEnabled=!1),this.defaultResolutionError={code:rl.Status.UNAVAILABLE,details:`Name resolution failed for target ${(0,Vt.uriToString)(this.target)}`,metadata:new nl.Metadata};let l={initialDelay:i["grpc.initial_reconnect_backoff_ms"],maxDelay:i["grpc.max_reconnect_backoff_ms"]};this.backoff=new N0.BackoffTimeout(()=>{this.continueResolving&&this.startResolutionWithBackoff()},l),this.backoff.unref(),this.minTimeBetweenResolutionsMs=(a=i["grpc.dns_min_time_between_resolutions_ms"])!==null&&a!==void 0?a:I0,this.nextResolutionTimer=setTimeout(()=>{},0),clearTimeout(this.nextResolutionTimer)}startResolution(){if(this.ipResult!==null){this.returnedIpResult||(Yt("Returning IP address for target "+(0,Vt.uriToString)(this.target)),setImmediate(()=>{this.listener.onSuccessfulResolution(this.ipResult,null,null,null,{})}),this.returnedIpResult=!0),this.backoff.stop(),this.backoff.reset(),this.stopNextResolutionTimer();return}if(this.dnsHostname===null)Yt("Failed to parse DNS address "+(0,Vt.uriToString)(this.target)),setImmediate(()=>{this.listener.onError({code:rl.Status.UNAVAILABLE,details:`Failed to parse DNS address ${(0,Vt.uriToString)(this.target)}`,metadata:new nl.Metadata})}),this.stopNextResolutionTimer();else{if(this.pendingLookupPromise!==null)return;Yt("Looking up DNS hostname "+this.dnsHostname),this.latestLookupResult=null;let e=this.dnsHostname;this.pendingLookupPromise=D0(e,{all:!0}),this.pendingLookupPromise.then(t=>{if(this.pendingLookupPromise===null)return;this.pendingLookupPromise=null,this.backoff.reset(),this.backoff.stop();let i=t.map(s=>({host:s.address,port:+this.port}));this.latestLookupResult=i.map(s=>({addresses:[s]}));let n="["+i.map(s=>s.host+":"+s.port).join(",")+"]";if(Yt("Resolved addresses for target "+(0,Vt.uriToString)(this.target)+": "+n),this.latestLookupResult.length===0){this.listener.onError(this.defaultResolutionError);return}this.listener.onSuccessfulResolution(this.latestLookupResult,this.latestServiceConfig,this.latestServiceConfigError,null,{})},t=>{this.pendingLookupPromise!==null&&(Yt("Resolution error for target "+(0,Vt.uriToString)(this.target)+": "+t.message),this.pendingLookupPromise=null,this.stopNextResolutionTimer(),this.listener.onError(this.defaultResolutionError))}),this.isServiceConfigEnabled&&this.pendingTxtPromise===null&&(this.pendingTxtPromise=x0(e),this.pendingTxtPromise.then(t=>{if(this.pendingTxtPromise!==null){this.pendingTxtPromise=null;try{this.latestServiceConfig=(0,O0.extractAndSelectServiceConfig)(t,this.percentage)}catch(i){this.latestServiceConfigError={code:rl.Status.UNAVAILABLE,details:`Parsing service config failed with error ${i.message}`,metadata:new nl.Metadata}}this.latestLookupResult!==null&&this.listener.onSuccessfulResolution(this.latestLookupResult,this.latestServiceConfig,this.latestServiceConfigError,null,{})}},t=>{}))}}startNextResolutionTimer(){var e,t;clearTimeout(this.nextResolutionTimer),this.nextResolutionTimer=setTimeout(()=>{this.stopNextResolutionTimer(),this.continueResolving&&this.startResolutionWithBackoff()},this.minTimeBetweenResolutionsMs),(t=(e=this.nextResolutionTimer).unref)===null||t===void 0||t.call(e),this.isNextResolutionTimerRunning=!0}stopNextResolutionTimer(){clearTimeout(this.nextResolutionTimer),this.isNextResolutionTimerRunning=!1}startResolutionWithBackoff(){this.pendingLookupPromise===null&&(this.continueResolving=!1,this.backoff.runOnce(),this.startNextResolutionTimer(),this.startResolution())}updateResolution(){this.pendingLookupPromise===null&&(this.isNextResolutionTimerRunning||this.backoff.isRunning()?(this.isNextResolutionTimerRunning?Yt('resolution update delayed by "min time between resolutions" rate limit'):Yt("resolution update delayed by backoff timer until "+this.backoff.getEndTime().toISOString()),this.continueResolving=!0):this.startResolutionWithBackoff())}destroy(){this.continueResolving=!1,this.backoff.reset(),this.backoff.stop(),this.stopNextResolutionTimer(),this.pendingLookupPromise=null,this.pendingTxtPromise=null,this.latestLookupResult=null,this.latestServiceConfig=null,this.latestServiceConfigError=null,this.returnedIpResult=!1}static getDefaultAuthority(e){return e.path}};function L0(){(0,nf.registerResolver)("dns",sl),(0,nf.registerDefaultScheme)("dns")}Kt.setup=L0});var ol=g(Ji=>{"use strict";Object.defineProperty(Ji,"__esModule",{value:!0});Ji.getProxiedConnection=Ji.mapProxyName=void 0;var Lr=te(),Yi=z(),F0=ot(),q0=require("http"),B0=require("tls"),U0=te(),lf=Xe(),Ki=Pe(),z0=require("url"),H0=al(),j0="proxy";function Jt(r){U0.trace(Yi.LogVerbosity.DEBUG,j0,r)}function G0(){let r="",e="";if(process.env.grpc_proxy)e="grpc_proxy",r=process.env.grpc_proxy;else if(process.env.https_proxy)e="https_proxy",r=process.env.https_proxy;else if(process.env.http_proxy)e="http_proxy",r=process.env.http_proxy;else return{};let t;try{t=new z0.URL(r)}catch{return(0,Lr.log)(Yi.LogVerbosity.ERROR,`cannot parse value of "${e}" env var`),{}}if(t.protocol!=="http:")return(0,Lr.log)(Yi.LogVerbosity.ERROR,`"${t.protocol}" scheme not supported in proxy URI`),{};let i=null;t.username&&(t.password?((0,Lr.log)(Yi.LogVerbosity.INFO,"userinfo found in proxy URI"),i=decodeURIComponent(`${t.username}:${t.password}`)):i=t.username);let n=t.hostname,s=t.port;s===""&&(s="80");let a={address:`${n}:${s}`};return i&&(a.creds=i),Jt("Proxy server "+a.address+" set by environment variable "+e),a}function W0(){let r=process.env.no_grpc_proxy,e="no_grpc_proxy";return r||(r=process.env.no_proxy,e="no_proxy"),r?(Jt("No proxy server list set by environment variable "+e),r.split(",")):[]}function $0(r,e){var t;let i={target:r,extraOptions:{}};if(((t=e["grpc.enable_http_proxy"])!==null&&t!==void 0?t:1)===0||r.scheme==="unix")return i;let n=G0();if(!n.address)return i;let s=(0,Ki.splitHostPort)(r.path);if(!s)return i;let a=s.host;for(let l of W0())if(l===a)return Jt("Not using proxy for target in no_proxy list: "+(0,Ki.uriToString)(r)),i;let o={"grpc.http_connect_target":(0,Ki.uriToString)(r)};return n.creds&&(o["grpc.http_connect_creds"]=n.creds),{target:{scheme:"dns",path:n.address},extraOptions:o}}Ji.mapProxyName=$0;function V0(r,e,t){var i;if(!("grpc.http_connect_target"in e))return Promise.resolve({});let n=e["grpc.http_connect_target"],s=(0,Ki.parseUri)(n);if(s===null)return Promise.resolve({});let a=(0,Ki.splitHostPort)(s.path);if(a===null)return Promise.resolve({});let o=`${a.host}:${(i=a.port)!==null&&i!==void 0?i:H0.DEFAULT_PORT}`,l={method:"CONNECT",path:o},c={Host:o};(0,lf.isTcpSubchannelAddress)(r)?(l.host=r.host,l.port=r.port):l.socketPath=r.path,"grpc.http_connect_creds"in e&&(c["Proxy-Authorization"]="Basic "+Buffer.from(e["grpc.http_connect_creds"]).toString("base64")),l.headers=c;let u=(0,lf.subchannelAddressToString)(r);return Jt("Using proxy "+u+" to connect to "+l.path),new Promise((h,f)=>{let p=q0.request(l);p.once("connect",(E,m,b)=>{var S;if(p.removeAllListeners(),m.removeAllListeners(),E.statusCode===200)if(Jt("Successfully connected to "+l.path+" through proxy "+u),b.length>0&&m.unshift(b),"secureContext"in t){let T=(0,F0.getDefaultAuthority)(s),k=(0,Ki.splitHostPort)(T),w=(S=k?.host)!==null&&S!==void 0?S:T,L=B0.connect(Object.assign({host:w,servername:w,socket:m},t),()=>{Jt("Successfully established a TLS connection to "+l.path+" through proxy "+u),h({socket:L,realTarget:s})});L.on("error",x=>{Jt("Failed to establish a TLS connection to "+l.path+" through proxy "+u+" with error "+x.message),f()})}else Jt("Successfully established a plaintext connection to "+l.path+" through proxy "+u),h({socket:m,realTarget:s});else(0,Lr.log)(Yi.LogVerbosity.ERROR,"Failed to connect to "+l.path+" through proxy "+u+" with status "+E.statusCode),f()}),p.once("error",E=>{p.removeAllListeners(),(0,Lr.log)(Yi.LogVerbosity.ERROR,"Failed to connect to proxy "+u+" with error "+E.message),f()}),p.end()})}Ji.getProxiedConnection=V0});var cl=g(ns=>{"use strict";Object.defineProperty(ns,"__esModule",{value:!0});ns.StreamDecoder=void 0;var St;(function(r){r[r.NO_DATA=0]="NO_DATA",r[r.READING_SIZE=1]="READING_SIZE",r[r.READING_MESSAGE=2]="READING_MESSAGE"})(St||(St={}));var ll=class{constructor(e){this.maxReadMessageLength=e,this.readState=St.NO_DATA,this.readCompressFlag=Buffer.alloc(1),this.readPartialSize=Buffer.alloc(4),this.readSizeRemaining=4,this.readMessageSize=0,this.readPartialMessage=[],this.readMessageRemaining=0}write(e){let t=0,i,n=[];for(;t<e.length;)switch(this.readState){case St.NO_DATA:this.readCompressFlag=e.slice(t,t+1),t+=1,this.readState=St.READING_SIZE,this.readPartialSize.fill(0),this.readSizeRemaining=4,this.readMessageSize=0,this.readMessageRemaining=0,this.readPartialMessage=[];break;case St.READING_SIZE:if(i=Math.min(e.length-t,this.readSizeRemaining),e.copy(this.readPartialSize,4-this.readSizeRemaining,t,t+i),this.readSizeRemaining-=i,t+=i,this.readSizeRemaining===0){if(this.readMessageSize=this.readPartialSize.readUInt32BE(0),this.maxReadMessageLength!==-1&&this.readMessageSize>this.maxReadMessageLength)throw new Error(`Received message larger than max (${this.readMessageSize} vs ${this.maxReadMessageLength})`);if(this.readMessageRemaining=this.readMessageSize,this.readMessageRemaining>0)this.readState=St.READING_MESSAGE;else{let s=Buffer.concat([this.readCompressFlag,this.readPartialSize],5);this.readState=St.NO_DATA,n.push(s)}}break;case St.READING_MESSAGE:if(i=Math.min(e.length-t,this.readMessageRemaining),this.readPartialMessage.push(e.slice(t,t+i)),this.readMessageRemaining-=i,t+=i,this.readMessageRemaining===0){let s=[this.readCompressFlag,this.readPartialSize].concat(this.readPartialMessage),a=Buffer.concat(s,this.readMessageSize+5);this.readState=St.NO_DATA,n.push(a)}break;default:throw new Error("Unexpected read state")}return n}};ns.StreamDecoder=ll});var uf=g(ss=>{"use strict";Object.defineProperty(ss,"__esModule",{value:!0});ss.Http2SubchannelCall=void 0;var Ot=require("http2"),Y0=require("os"),V=z(),Mt=Re(),K0=cl(),J0=te(),X0=z(),Z0="subchannel_call";function Q0(r){for(let[e,t]of Object.entries(Y0.constants.errno))if(t===r)return e;return"Unknown system error "+r}function cf(r){let e=`Received HTTP status code ${r}`,t;switch(r){case 400:t=V.Status.INTERNAL;break;case 401:t=V.Status.UNAUTHENTICATED;break;case 403:t=V.Status.PERMISSION_DENIED;break;case 404:t=V.Status.UNIMPLEMENTED;break;case 429:case 502:case 503:case 504:t=V.Status.UNAVAILABLE;break;default:t=V.Status.UNKNOWN}return{code:t,details:e,metadata:new Mt.Metadata}}var ul=class{constructor(e,t,i,n,s){var a;this.http2Stream=e,this.callEventTracker=t,this.listener=i,this.transport=n,this.callId=s,this.isReadFilterPending=!1,this.isPushPending=!1,this.canPush=!1,this.readsClosed=!1,this.statusOutput=!1,this.unpushedReadMessages=[],this.finalStatus=null,this.internalError=null,this.serverEndedCall=!1;let o=(a=n.getOptions()["grpc.max_receive_message_length"])!==null&&a!==void 0?a:V.DEFAULT_MAX_RECEIVE_MESSAGE_LENGTH;this.decoder=new K0.StreamDecoder(o),e.on("response",(l,c)=>{let u="";for(let h of Object.keys(l))u+="		"+h+": "+l[h]+`
`;if(this.trace(`Received server headers:
`+u),this.httpStatusCode=l[":status"],c&Ot.constants.NGHTTP2_FLAG_END_STREAM)this.handleTrailers(l);else{let h;try{h=Mt.Metadata.fromHttp2Headers(l)}catch(f){this.endCall({code:V.Status.UNKNOWN,details:f.message,metadata:new Mt.Metadata});return}this.listener.onReceiveMetadata(h)}}),e.on("trailers",l=>{this.handleTrailers(l)}),e.on("data",l=>{if(this.statusOutput)return;this.trace("receive HTTP/2 data frame of length "+l.length);let c;try{c=this.decoder.write(l)}catch(u){this.cancelWithStatus(V.Status.RESOURCE_EXHAUSTED,u.message);return}for(let u of c)this.trace("parsed message of length "+u.length),this.callEventTracker.addMessageReceived(),this.tryPush(u)}),e.on("end",()=>{this.readsClosed=!0,this.maybeOutputStatus()}),e.on("close",()=>{this.serverEndedCall=!0,process.nextTick(()=>{var l;if(this.trace("HTTP/2 stream closed with code "+e.rstCode),((l=this.finalStatus)===null||l===void 0?void 0:l.code)===V.Status.OK)return;let c,u="";switch(e.rstCode){case Ot.constants.NGHTTP2_NO_ERROR:if(this.finalStatus!==null)return;if(this.httpStatusCode&&this.httpStatusCode!==200){let h=cf(this.httpStatusCode);c=h.code,u=h.details}else c=V.Status.INTERNAL,u=`Received RST_STREAM with code ${e.rstCode} (Call ended without gRPC status)`;break;case Ot.constants.NGHTTP2_REFUSED_STREAM:c=V.Status.UNAVAILABLE,u="Stream refused by server";break;case Ot.constants.NGHTTP2_CANCEL:c=V.Status.CANCELLED,u="Call cancelled";break;case Ot.constants.NGHTTP2_ENHANCE_YOUR_CALM:c=V.Status.RESOURCE_EXHAUSTED,u="Bandwidth exhausted or memory limit exceeded";break;case Ot.constants.NGHTTP2_INADEQUATE_SECURITY:c=V.Status.PERMISSION_DENIED,u="Protocol not secure enough";break;case Ot.constants.NGHTTP2_INTERNAL_ERROR:c=V.Status.INTERNAL,this.internalError===null?u=`Received RST_STREAM with code ${e.rstCode} (Internal server error)`:this.internalError.code==="ECONNRESET"||this.internalError.code==="ETIMEDOUT"?(c=V.Status.UNAVAILABLE,u=this.internalError.message):u=`Received RST_STREAM with code ${e.rstCode} triggered by internal client error: ${this.internalError.message}`;break;default:c=V.Status.INTERNAL,u=`Received RST_STREAM with code ${e.rstCode}`}this.endCall({code:c,details:u,metadata:new Mt.Metadata,rstCode:e.rstCode})})}),e.on("error",l=>{l.code!=="ERR_HTTP2_STREAM_ERROR"&&(this.trace("Node error event: message="+l.message+" code="+l.code+" errno="+Q0(l.errno)+" syscall="+l.syscall),this.internalError=l),this.callEventTracker.onStreamEnd(!1)})}getDeadlineInfo(){return[`remote_addr=${this.getPeer()}`]}onDisconnect(){this.endCall({code:V.Status.UNAVAILABLE,details:"Connection dropped",metadata:new Mt.Metadata})}outputStatus(){this.statusOutput||(this.statusOutput=!0,this.trace("ended with status: code="+this.finalStatus.code+' details="'+this.finalStatus.details+'"'),this.callEventTracker.onCallEnd(this.finalStatus),process.nextTick(()=>{this.listener.onReceiveStatus(this.finalStatus)}),this.http2Stream.resume())}trace(e){J0.trace(X0.LogVerbosity.DEBUG,Z0,"["+this.callId+"] "+e)}endCall(e){(this.finalStatus===null||this.finalStatus.code===V.Status.OK)&&(this.finalStatus=e,this.maybeOutputStatus()),this.destroyHttp2Stream()}maybeOutputStatus(){this.finalStatus!==null&&(this.finalStatus.code!==V.Status.OK||this.readsClosed&&this.unpushedReadMessages.length===0&&!this.isReadFilterPending&&!this.isPushPending)&&this.outputStatus()}push(e){this.trace("pushing to reader message of length "+(e instanceof Buffer?e.length:null)),this.canPush=!1,this.isPushPending=!0,process.nextTick(()=>{this.isPushPending=!1,!this.statusOutput&&(this.listener.onReceiveMessage(e),this.maybeOutputStatus())})}tryPush(e){this.canPush?(this.http2Stream.pause(),this.push(e)):(this.trace("unpushedReadMessages.push message of length "+e.length),this.unpushedReadMessages.push(e))}handleTrailers(e){this.serverEndedCall=!0,this.callEventTracker.onStreamEnd(!0);let t="";for(let a of Object.keys(e))t+="		"+a+": "+e[a]+`
`;this.trace(`Received server trailers:
`+t);let i;try{i=Mt.Metadata.fromHttp2Headers(e)}catch{i=new Mt.Metadata}let n=i.getMap(),s;if(typeof n["grpc-status"]=="string"){let a=Number(n["grpc-status"]);this.trace("received status code "+a+" from server"),i.remove("grpc-status");let o="";if(typeof n["grpc-message"]=="string"){try{o=decodeURI(n["grpc-message"])}catch{o=n["grpc-message"]}i.remove("grpc-message"),this.trace('received status details string "'+o+'" from server')}s={code:a,details:o,metadata:i}}else this.httpStatusCode?(s=cf(this.httpStatusCode),s.metadata=i):s={code:V.Status.UNKNOWN,details:"No status information received",metadata:i};this.endCall(s)}destroyHttp2Stream(){var e;if(!this.http2Stream.destroyed)if(this.serverEndedCall)this.http2Stream.end();else{let t;((e=this.finalStatus)===null||e===void 0?void 0:e.code)===V.Status.OK?t=Ot.constants.NGHTTP2_NO_ERROR:t=Ot.constants.NGHTTP2_CANCEL,this.trace("close http2 stream with code "+t),this.http2Stream.close(t)}}cancelWithStatus(e,t){this.trace("cancelWithStatus code: "+e+' details: "'+t+'"'),this.endCall({code:e,details:t,metadata:new Mt.Metadata})}getStatus(){return this.finalStatus}getPeer(){return this.transport.getPeerName()}getCallNumber(){return this.callId}startRead(){if(this.finalStatus!==null&&this.finalStatus.code!==V.Status.OK){this.readsClosed=!0,this.maybeOutputStatus();return}if(this.canPush=!0,this.unpushedReadMessages.length>0){let e=this.unpushedReadMessages.shift();this.push(e);return}this.http2Stream.resume()}sendMessageWithContext(e,t){this.trace("write() called with message of length "+t.length);let i=n=>{process.nextTick(()=>{var s;let a=V.Status.UNAVAILABLE;n?.code==="ERR_STREAM_WRITE_AFTER_END"&&(a=V.Status.INTERNAL),n&&this.cancelWithStatus(a,`Write error: ${n.message}`),(s=e.callback)===null||s===void 0||s.call(e)})};this.trace("sending data chunk of length "+t.length),this.callEventTracker.addMessageSent();try{this.http2Stream.write(t,i)}catch(n){this.endCall({code:V.Status.UNAVAILABLE,details:`Write failed with error ${n.message}`,metadata:new Mt.Metadata})}}halfClose(){this.trace("end() called"),this.trace("calling end() on HTTP/2 stream"),this.http2Stream.end()}};ss.Http2SubchannelCall=ul});var dl=g(as=>{"use strict";Object.defineProperty(as,"__esModule",{value:!0});as.getNextCallNumber=void 0;var eS=0;function tS(){return eS++}as.getNextCallNumber=tS});var ff=g(cs=>{"use strict";Object.defineProperty(cs,"__esModule",{value:!0});cs.Http2SubchannelConnector=void 0;var gl=require("http2"),df=require("tls"),os=fi(),Fr=z(),iS=ol(),Zi=te(),hf=ot(),ls=Xe(),Xi=Pe(),rS=require("net"),nS=uf(),sS=dl(),hl="transport",aS="transport_flowctrl",oS=Js().version,{HTTP2_HEADER_AUTHORITY:lS,HTTP2_HEADER_CONTENT_TYPE:cS,HTTP2_HEADER_METHOD:uS,HTTP2_HEADER_PATH:dS,HTTP2_HEADER_TE:hS,HTTP2_HEADER_USER_AGENT:fS}=gl.constants,pS=2e4,gS=Buffer.from("too_many_pings","ascii"),fl=class{constructor(e,t,i,n){this.session=e,this.options=i,this.remoteName=n,this.keepaliveTimer=null,this.pendingSendKeepalivePing=!1,this.activeCalls=new Set,this.disconnectListeners=[],this.disconnectHandled=!1,this.channelzEnabled=!0,this.keepalivesSent=0,this.messagesSent=0,this.messagesReceived=0,this.lastMessageSentTimestamp=null,this.lastMessageReceivedTimestamp=null,this.subchannelAddressString=(0,ls.subchannelAddressToString)(t),i["grpc.enable_channelz"]===0?(this.channelzEnabled=!1,this.streamTracker=new os.ChannelzCallTrackerStub):this.streamTracker=new os.ChannelzCallTracker,this.channelzRef=(0,os.registerChannelzSocket)(this.subchannelAddressString,()=>this.getChannelzInfo(),this.channelzEnabled),this.userAgent=[i["grpc.primary_user_agent"],`grpc-node-js/${oS}`,i["grpc.secondary_user_agent"]].filter(s=>s).join(" "),"grpc.keepalive_time_ms"in i?this.keepaliveTimeMs=i["grpc.keepalive_time_ms"]:this.keepaliveTimeMs=-1,"grpc.keepalive_timeout_ms"in i?this.keepaliveTimeoutMs=i["grpc.keepalive_timeout_ms"]:this.keepaliveTimeoutMs=pS,"grpc.keepalive_permit_without_calls"in i?this.keepaliveWithoutCalls=i["grpc.keepalive_permit_without_calls"]===1:this.keepaliveWithoutCalls=!1,e.once("close",()=>{this.trace("session closed"),this.handleDisconnect()}),e.once("goaway",(s,a,o)=>{let l=!1;s===gl.constants.NGHTTP2_ENHANCE_YOUR_CALM&&o&&o.equals(gS)&&(l=!0),this.trace("connection closed by GOAWAY with code "+s+" and data "+o?.toString()),this.reportDisconnectToOwner(l)}),e.once("error",s=>{this.trace("connection closed with error "+s.message)}),Zi.isTracerEnabled(hl)&&(e.on("remoteSettings",s=>{this.trace("new settings received"+(this.session!==e?" on the old connection":"")+": "+JSON.stringify(s))}),e.on("localSettings",s=>{this.trace("local settings acknowledged by remote"+(this.session!==e?" on the old connection":"")+": "+JSON.stringify(s))})),this.keepaliveWithoutCalls&&this.maybeStartKeepalivePingTimer()}getChannelzInfo(){var e,t,i;let n=this.session.socket,s=n.remoteAddress?(0,ls.stringToSubchannelAddress)(n.remoteAddress,n.remotePort):null,a=n.localAddress?(0,ls.stringToSubchannelAddress)(n.localAddress,n.localPort):null,o;if(this.session.encrypted){let c=n,u=c.getCipher(),h=c.getCertificate(),f=c.getPeerCertificate();o={cipherSuiteStandardName:(e=u.standardName)!==null&&e!==void 0?e:null,cipherSuiteOtherName:u.standardName?null:u.name,localCertificate:h&&"raw"in h?h.raw:null,remoteCertificate:f&&"raw"in f?f.raw:null}}else o=null;return{remoteAddress:s,localAddress:a,security:o,remoteName:this.remoteName,streamsStarted:this.streamTracker.callsStarted,streamsSucceeded:this.streamTracker.callsSucceeded,streamsFailed:this.streamTracker.callsFailed,messagesSent:this.messagesSent,messagesReceived:this.messagesReceived,keepAlivesSent:this.keepalivesSent,lastLocalStreamCreatedTimestamp:this.streamTracker.lastCallStartedTimestamp,lastRemoteStreamCreatedTimestamp:null,lastMessageSentTimestamp:this.lastMessageSentTimestamp,lastMessageReceivedTimestamp:this.lastMessageReceivedTimestamp,localFlowControlWindow:(t=this.session.state.localWindowSize)!==null&&t!==void 0?t:null,remoteFlowControlWindow:(i=this.session.state.remoteWindowSize)!==null&&i!==void 0?i:null}}trace(e){Zi.trace(Fr.LogVerbosity.DEBUG,hl,"("+this.channelzRef.id+") "+this.subchannelAddressString+" "+e)}keepaliveTrace(e){Zi.trace(Fr.LogVerbosity.DEBUG,"keepalive","("+this.channelzRef.id+") "+this.subchannelAddressString+" "+e)}flowControlTrace(e){Zi.trace(Fr.LogVerbosity.DEBUG,aS,"("+this.channelzRef.id+") "+this.subchannelAddressString+" "+e)}internalsTrace(e){Zi.trace(Fr.LogVerbosity.DEBUG,"transport_internals","("+this.channelzRef.id+") "+this.subchannelAddressString+" "+e)}reportDisconnectToOwner(e){this.disconnectHandled||(this.disconnectHandled=!0,this.disconnectListeners.forEach(t=>t(e)))}handleDisconnect(){this.clearKeepaliveTimeout(),this.reportDisconnectToOwner(!1),setImmediate(()=>{for(let e of this.activeCalls)e.onDisconnect();this.session.destroy()})}addDisconnectListener(e){this.disconnectListeners.push(e)}canSendPing(){return!this.session.destroyed&&this.keepaliveTimeMs>0&&(this.keepaliveWithoutCalls||this.activeCalls.size>0)}maybeSendPing(){var e,t;if(!this.canSendPing()){this.pendingSendKeepalivePing=!0;return}if(this.keepaliveTimer){console.error("keepaliveTimeout is not null");return}this.channelzEnabled&&(this.keepalivesSent+=1),this.keepaliveTrace("Sending ping with timeout "+this.keepaliveTimeoutMs+"ms"),this.keepaliveTimer=setTimeout(()=>{this.keepaliveTimer=null,this.keepaliveTrace("Ping timeout passed without response"),this.handleDisconnect()},this.keepaliveTimeoutMs),(t=(e=this.keepaliveTimer).unref)===null||t===void 0||t.call(e);let i="";try{this.session.ping((s,a,o)=>{this.clearKeepaliveTimeout(),s?(this.keepaliveTrace("Ping failed with error "+s.message),this.handleDisconnect()):(this.keepaliveTrace("Received ping response"),this.maybeStartKeepalivePingTimer())})||(i="Ping returned false")}catch(n){i=(n instanceof Error?n.message:"")||"Unknown error"}i&&(this.keepaliveTrace("Ping send failed: "+i),this.handleDisconnect())}maybeStartKeepalivePingTimer(){var e,t;this.canSendPing()&&(this.pendingSendKeepalivePing?(this.pendingSendKeepalivePing=!1,this.maybeSendPing()):this.keepaliveTimer||(this.keepaliveTrace("Starting keepalive timer for "+this.keepaliveTimeMs+"ms"),this.keepaliveTimer=setTimeout(()=>{this.keepaliveTimer=null,this.maybeSendPing()},this.keepaliveTimeMs),(t=(e=this.keepaliveTimer).unref)===null||t===void 0||t.call(e)))}clearKeepaliveTimeout(){this.keepaliveTimer&&(clearTimeout(this.keepaliveTimer),this.keepaliveTimer=null)}removeActiveCall(e){this.activeCalls.delete(e),this.activeCalls.size===0&&this.session.unref()}addActiveCall(e){this.activeCalls.add(e),this.activeCalls.size===1&&(this.session.ref(),this.keepaliveWithoutCalls||this.maybeStartKeepalivePingTimer())}createCall(e,t,i,n,s){let a=e.toHttp2Headers();a[lS]=t,a[fS]=this.userAgent,a[cS]="application/grpc",a[uS]="POST",a[dS]=i,a[hS]="trailers";let o;try{o=this.session.request(a)}catch(u){throw this.handleDisconnect(),u}this.flowControlTrace("local window size: "+this.session.state.localWindowSize+" remote window size: "+this.session.state.remoteWindowSize),this.internalsTrace("session.closed="+this.session.closed+" session.destroyed="+this.session.destroyed+" session.socket.destroyed="+this.session.socket.destroyed);let l,c;return this.channelzEnabled?(this.streamTracker.addCallStarted(),l={addMessageSent:()=>{var u;this.messagesSent+=1,this.lastMessageSentTimestamp=new Date,(u=s.addMessageSent)===null||u===void 0||u.call(s)},addMessageReceived:()=>{var u;this.messagesReceived+=1,this.lastMessageReceivedTimestamp=new Date,(u=s.addMessageReceived)===null||u===void 0||u.call(s)},onCallEnd:u=>{var h;(h=s.onCallEnd)===null||h===void 0||h.call(s,u),this.removeActiveCall(c)},onStreamEnd:u=>{var h;u?this.streamTracker.addCallSucceeded():this.streamTracker.addCallFailed(),(h=s.onStreamEnd)===null||h===void 0||h.call(s,u)}}):l={addMessageSent:()=>{var u;(u=s.addMessageSent)===null||u===void 0||u.call(s)},addMessageReceived:()=>{var u;(u=s.addMessageReceived)===null||u===void 0||u.call(s)},onCallEnd:u=>{var h;(h=s.onCallEnd)===null||h===void 0||h.call(s,u),this.removeActiveCall(c)},onStreamEnd:u=>{var h;(h=s.onStreamEnd)===null||h===void 0||h.call(s,u)}},c=new nS.Http2SubchannelCall(o,l,n,this,(0,sS.getNextCallNumber)()),this.addActiveCall(c),c}getChannelzRef(){return this.channelzRef}getPeerName(){return this.subchannelAddressString}getOptions(){return this.options}shutdown(){this.session.close(),(0,os.unregisterChannelzRef)(this.channelzRef)}},pl=class{constructor(e){this.channelTarget=e,this.session=null,this.isShutdown=!1}trace(e){Zi.trace(Fr.LogVerbosity.DEBUG,hl,(0,Xi.uriToString)(this.channelTarget)+" "+e)}createSession(e,t,i,n){return this.isShutdown?Promise.reject():new Promise((s,a)=>{var o,l,c,u;let h;n.realTarget?(h=(0,Xi.uriToString)(n.realTarget),this.trace("creating HTTP/2 session through proxy to "+(0,Xi.uriToString)(n.realTarget))):(h=null,this.trace("creating HTTP/2 session to "+(0,ls.subchannelAddressToString)(e)));let f=(0,hf.getDefaultAuthority)((o=n.realTarget)!==null&&o!==void 0?o:this.channelTarget),p=t._getConnectionOptions()||{};p.maxSendHeaderBlockLength=Number.MAX_SAFE_INTEGER,"grpc-node.max_session_memory"in i?p.maxSessionMemory=i["grpc-node.max_session_memory"]:p.maxSessionMemory=Number.MAX_SAFE_INTEGER;let E="http://";if("secureContext"in p){if(E="https://",i["grpc.ssl_target_name_override"]){let S=i["grpc.ssl_target_name_override"],T=(l=p.checkServerIdentity)!==null&&l!==void 0?l:df.checkServerIdentity;p.checkServerIdentity=(k,w)=>T(S,w),p.servername=S}else{let S=(u=(c=(0,Xi.splitHostPort)(f))===null||c===void 0?void 0:c.host)!==null&&u!==void 0?u:"localhost";p.servername=S}n.socket&&(p.createConnection=(S,T)=>n.socket)}else p.createConnection=(S,T)=>n.socket?n.socket:rS.connect(e);p=Object.assign(Object.assign(Object.assign({},p),e),{enableTrace:i["grpc-node.tls_enable_trace"]===1});let m=gl.connect(E+f,p);this.session=m;let b="Failed to connect";m.unref(),m.once("connect",()=>{m.removeAllListeners(),s(new fl(m,e,i,h)),this.session=null}),m.once("close",()=>{this.session=null,setImmediate(()=>{a(`${b} (${new Date().toISOString()})`)})}),m.once("error",S=>{b=S.message,this.trace("connection failed with error "+b)})})}connect(e,t,i){var n,s,a;if(this.isShutdown)return Promise.reject();let o=t._getConnectionOptions()||{};if("secureContext"in o){if(o.ALPNProtocols=["h2"],i["grpc.ssl_target_name_override"]){let l=i["grpc.ssl_target_name_override"],c=(n=o.checkServerIdentity)!==null&&n!==void 0?n:df.checkServerIdentity;o.checkServerIdentity=(u,h)=>c(l,h),o.servername=l}else if("grpc.http_connect_target"in i){let l=(0,hf.getDefaultAuthority)((s=(0,Xi.parseUri)(i["grpc.http_connect_target"]))!==null&&s!==void 0?s:{path:"localhost"}),c=(0,Xi.splitHostPort)(l);o.servername=(a=c?.host)!==null&&a!==void 0?a:l}i["grpc-node.tls_enable_trace"]&&(o.enableTrace=!0)}return(0,iS.getProxiedConnection)(e,i,o).then(l=>this.createSession(e,t,i,l))}shutdown(){var e;this.isShutdown=!0,(e=this.session)===null||e===void 0||e.close(),this.session=null}};cs.Http2SubchannelConnector=pl});var pf=g(Qi=>{"use strict";Object.defineProperty(Qi,"__esModule",{value:!0});Qi.getSubchannelPool=Qi.SubchannelPool=void 0;var mS=Wc(),vS=rf(),yS=Xe(),SS=Pe(),_S=ff(),CS=1e4,qr=class{constructor(){this.pool=Object.create(null),this.cleanupTimer=null}unrefUnusedSubchannels(){let e=!0;for(let t in this.pool){let n=this.pool[t].filter(s=>!s.subchannel.unrefIfOneRef());n.length>0&&(e=!1),this.pool[t]=n}e&&this.cleanupTimer!==null&&(clearInterval(this.cleanupTimer),this.cleanupTimer=null)}ensureCleanupTask(){var e,t;this.cleanupTimer===null&&(this.cleanupTimer=setInterval(()=>{this.unrefUnusedSubchannels()},CS),(t=(e=this.cleanupTimer).unref)===null||t===void 0||t.call(e))}getOrCreateSubchannel(e,t,i,n){this.ensureCleanupTask();let s=(0,SS.uriToString)(e);if(s in this.pool){let o=this.pool[s];for(let l of o)if((0,yS.subchannelAddressEqual)(t,l.subchannelAddress)&&(0,mS.channelOptionsEqual)(i,l.channelArguments)&&n._equals(l.channelCredentials))return l.subchannel}let a=new vS.Subchannel(e,t,i,n,new _S.Http2SubchannelConnector(e));return s in this.pool||(this.pool[s]=[]),this.pool[s].push({subchannelAddress:t,channelArguments:i,channelCredentials:n,subchannel:a}),a.ref(),a}};Qi.SubchannelPool=qr;var TS=new qr;function ES(r){return r?TS:new qr}Qi.getSubchannelPool=ES});var ml=g(er=>{"use strict";Object.defineProperty(er,"__esModule",{value:!0});er.FilterStackFactory=er.FilterStack=void 0;var us=class{constructor(e){this.filters=e}sendMetadata(e){let t=e;for(let i=0;i<this.filters.length;i++)t=this.filters[i].sendMetadata(t);return t}receiveMetadata(e){let t=e;for(let i=this.filters.length-1;i>=0;i--)t=this.filters[i].receiveMetadata(t);return t}sendMessage(e){let t=e;for(let i=0;i<this.filters.length;i++)t=this.filters[i].sendMessage(t);return t}receiveMessage(e){let t=e;for(let i=this.filters.length-1;i>=0;i--)t=this.filters[i].receiveMessage(t);return t}receiveTrailers(e){let t=e;for(let i=this.filters.length-1;i>=0;i--)t=this.filters[i].receiveTrailers(t);return t}push(e){this.filters.unshift(...e)}getFilters(){return this.filters}};er.FilterStack=us;var Br=class{constructor(e){this.factories=e}push(e){this.factories.unshift(...e)}clone(){return new Br([...this.factories])}createFilter(){return new us(this.factories.map(e=>e.createFilter()))}};er.FilterStackFactory=Br});var vl=g(ds=>{"use strict";Object.defineProperty(ds,"__esModule",{value:!0});ds.CompressionAlgorithms=void 0;var gf;(function(r){r[r.identity=0]="identity",r[r.deflate=1]="deflate",r[r.gzip=2]="gzip"})(gf||(ds.CompressionAlgorithms=gf={}))});var Sl=g(hs=>{"use strict";Object.defineProperty(hs,"__esModule",{value:!0});hs.BaseFilter=void 0;var yl=class{async sendMetadata(e){return e}receiveMetadata(e){return e}async sendMessage(e){return e}async receiveMessage(e){return e}receiveTrailers(e){return e}};hs.BaseFilter=yl});var yf=g(rr=>{"use strict";Object.defineProperty(rr,"__esModule",{value:!0});rr.CompressionFilterFactory=rr.CompressionFilter=void 0;var fs=require("zlib"),vf=vl(),tr=z(),bS=Sl(),RS=te(),wS=r=>typeof r=="number"&&typeof vf.CompressionAlgorithms[r]=="string",ir=class{async writeMessage(e,t){let i=e;t&&(i=await this.compressMessage(i));let n=Buffer.allocUnsafe(i.length+5);return n.writeUInt8(t?1:0,0),n.writeUInt32BE(i.length,1),i.copy(n,5),n}async readMessage(e){let t=e.readUInt8(0)===1,i=e.slice(5);return t&&(i=await this.decompressMessage(i)),i}},pi=class extends ir{async compressMessage(e){return e}async writeMessage(e,t){let i=Buffer.allocUnsafe(e.length+5);return i.writeUInt8(0,0),i.writeUInt32BE(e.length,1),e.copy(i,5),i}decompressMessage(e){return Promise.reject(new Error('Received compressed message but "grpc-encoding" header was identity'))}},_l=class extends ir{constructor(e){super(),this.maxRecvMessageLength=e}compressMessage(e){return new Promise((t,i)=>{fs.deflate(e,(n,s)=>{n?i(n):t(s)})})}decompressMessage(e){return new Promise((t,i)=>{let n=0,s=[],a=fs.createInflate();a.on("data",o=>{s.push(o),n+=o.byteLength,this.maxRecvMessageLength!==-1&&n>this.maxRecvMessageLength&&(a.destroy(),i({code:tr.Status.RESOURCE_EXHAUSTED,details:`Received message that decompresses to a size larger than ${this.maxRecvMessageLength}`}))}),a.on("end",()=>{t(Buffer.concat(s))}),a.write(e),a.end()})}},Cl=class extends ir{constructor(e){super(),this.maxRecvMessageLength=e}compressMessage(e){return new Promise((t,i)=>{fs.gzip(e,(n,s)=>{n?i(n):t(s)})})}decompressMessage(e){return new Promise((t,i)=>{let n=0,s=[],a=fs.createGunzip();a.on("data",o=>{s.push(o),n+=o.byteLength,this.maxRecvMessageLength!==-1&&n>this.maxRecvMessageLength&&(a.destroy(),i({code:tr.Status.RESOURCE_EXHAUSTED,details:`Received message that decompresses to a size larger than ${this.maxRecvMessageLength}`}))}),a.on("end",()=>{t(Buffer.concat(s))}),a.write(e),a.end()})}},Tl=class extends ir{constructor(e){super(),this.compressionName=e}compressMessage(e){return Promise.reject(new Error(`Received message compressed with unsupported compression method ${this.compressionName}`))}decompressMessage(e){return Promise.reject(new Error(`Compression method not supported: ${this.compressionName}`))}};function mf(r,e){switch(r){case"identity":return new pi;case"deflate":return new _l(e);case"gzip":return new Cl(e);default:return new Tl(r)}}var ps=class extends bS.BaseFilter{constructor(e,t){var i,n,s;super(),this.sharedFilterConfig=t,this.sendCompression=new pi,this.receiveCompression=new pi,this.currentCompressionAlgorithm="identity";let a=e["grpc.default_compression_algorithm"];if(this.maxReceiveMessageLength=(i=e["grpc.max_receive_message_length"])!==null&&i!==void 0?i:tr.DEFAULT_MAX_RECEIVE_MESSAGE_LENGTH,this.maxSendMessageLength=(n=e["grpc.max_send_message_length"])!==null&&n!==void 0?n:tr.DEFAULT_MAX_SEND_MESSAGE_LENGTH,a!==void 0)if(wS(a)){let o=vf.CompressionAlgorithms[a],l=(s=t.serverSupportedEncodingHeader)===null||s===void 0?void 0:s.split(",");(!l||l.includes(o))&&(this.currentCompressionAlgorithm=o,this.sendCompression=mf(this.currentCompressionAlgorithm,-1))}else RS.log(tr.LogVerbosity.ERROR,`Invalid value provided for grpc.default_compression_algorithm option: ${a}`)}async sendMetadata(e){let t=await e;return t.set("grpc-accept-encoding","identity,deflate,gzip"),t.set("accept-encoding","identity"),this.currentCompressionAlgorithm==="identity"?t.remove("grpc-encoding"):t.set("grpc-encoding",this.currentCompressionAlgorithm),t}receiveMetadata(e){let t=e.get("grpc-encoding");if(t.length>0){let n=t[0];typeof n=="string"&&(this.receiveCompression=mf(n,this.maxReceiveMessageLength))}e.remove("grpc-encoding");let i=e.get("grpc-accept-encoding")[0];return i&&(this.sharedFilterConfig.serverSupportedEncodingHeader=i,i.split(",").includes(this.currentCompressionAlgorithm)||(this.sendCompression=new pi,this.currentCompressionAlgorithm="identity")),e.remove("grpc-accept-encoding"),e}async sendMessage(e){var t;let i=await e;if(this.maxSendMessageLength!==-1&&i.message.length>this.maxSendMessageLength)throw{code:tr.Status.RESOURCE_EXHAUSTED,details:`Attempted to send message with a size larger than ${this.maxSendMessageLength}`};let n;return this.sendCompression instanceof pi?n=!1:n=(((t=i.flags)!==null&&t!==void 0?t:0)&2)===0,{message:await this.sendCompression.writeMessage(i.message,n),flags:i.flags}}async receiveMessage(e){return this.receiveCompression.readMessage(await e)}};rr.CompressionFilter=ps;var El=class{constructor(e,t){this.options=t,this.sharedFilterConfig={}}createFilter(){return new ps(this.options,this.sharedFilterConfig)}};rr.CompressionFilterFactory=El});var Ur=g(Ye=>{"use strict";Object.defineProperty(Ye,"__esModule",{value:!0});Ye.formatDateDifference=Ye.deadlineToString=Ye.getRelativeTimeout=Ye.getDeadlineTimeoutString=Ye.minDeadline=void 0;function AS(...r){let e=1/0;for(let t of r){let i=t instanceof Date?t.getTime():t;i<e&&(e=i)}return e}Ye.minDeadline=AS;var OS=[["m",1],["S",1e3],["M",60*1e3],["H",60*60*1e3]];function MS(r){let e=new Date().getTime();r instanceof Date&&(r=r.getTime());let t=Math.max(r-e,0);for(let[i,n]of OS){let s=t/n;if(s<1e8)return String(Math.ceil(s))+i}throw new Error("Deadline is too far in the future")}Ye.getDeadlineTimeoutString=MS;var kS=2147483647;function NS(r){let e=r instanceof Date?r.getTime():r,t=new Date().getTime(),i=e-t;return i<0?0:i>kS?1/0:i}Ye.getRelativeTimeout=NS;function PS(r){if(r instanceof Date)return r.toISOString();{let e=new Date(r);return Number.isNaN(e.getTime())?""+r:e.toISOString()}}Ye.deadlineToString=PS;function IS(r,e){return((e.getTime()-r.getTime())/1e3).toFixed(3)+"s"}Ye.formatDateDifference=IS});var ms=g(gs=>{"use strict";Object.defineProperty(gs,"__esModule",{value:!0});gs.restrictControlPlaneStatusCode=void 0;var _t=z(),xS=[_t.Status.OK,_t.Status.INVALID_ARGUMENT,_t.Status.NOT_FOUND,_t.Status.ALREADY_EXISTS,_t.Status.FAILED_PRECONDITION,_t.Status.ABORTED,_t.Status.OUT_OF_RANGE,_t.Status.DATA_LOSS];function DS(r,e){return xS.includes(r)?{code:_t.Status.INTERNAL,details:`Invalid status from control plane: ${r} ${_t.Status[r]} ${e}`}:{code:r,details:e}}gs.restrictControlPlaneStatusCode=DS});var Cf=g(Ss=>{"use strict";Object.defineProperty(Ss,"__esModule",{value:!0});Ss.LoadBalancingCall=void 0;var Sf=Be(),vs=z(),_f=Ur(),ys=Re(),zr=Lt(),LS=Pe(),FS=te(),bl=ms(),qS=require("http2"),BS="load_balancing_call",Rl=class{constructor(e,t,i,n,s,a,o){var l,c;this.channel=e,this.callConfig=t,this.methodName=i,this.host=n,this.credentials=s,this.deadline=a,this.callNumber=o,this.child=null,this.readPending=!1,this.pendingMessage=null,this.pendingHalfClose=!1,this.ended=!1,this.metadata=null,this.listener=null,this.onCallEnded=null,this.childStartTime=null;let u=this.methodName.split("/"),h="";u.length>=2&&(h=u[1]);let f=(c=(l=(0,LS.splitHostPort)(this.host))===null||l===void 0?void 0:l.host)!==null&&c!==void 0?c:"localhost";this.serviceUrl=`https://${f}/${h}`,this.startTime=new Date}getDeadlineInfo(){var e,t;let i=[];return this.childStartTime?(this.childStartTime>this.startTime&&(!((e=this.metadata)===null||e===void 0)&&e.getOptions().waitForReady&&i.push("wait_for_ready"),i.push(`LB pick: ${(0,_f.formatDateDifference)(this.startTime,this.childStartTime)}`)),i.push(...this.child.getDeadlineInfo()),i):(!((t=this.metadata)===null||t===void 0)&&t.getOptions().waitForReady&&i.push("wait_for_ready"),i.push("Waiting for LB pick"),i)}trace(e){FS.trace(vs.LogVerbosity.DEBUG,BS,"["+this.callNumber+"] "+e)}outputStatus(e,t){var i,n;if(!this.ended){this.ended=!0,this.trace("ended with status: code="+e.code+' details="'+e.details+'" start time='+this.startTime.toISOString());let s=Object.assign(Object.assign({},e),{progress:t});(i=this.listener)===null||i===void 0||i.onReceiveStatus(s),(n=this.onCallEnded)===null||n===void 0||n.call(this,s.code)}}doPick(){var e,t;if(this.ended)return;if(!this.metadata)throw new Error("doPick called before start");this.trace("Pick called");let i=this.metadata.clone(),n=this.channel.doPick(i,this.callConfig.pickInformation),s=n.subchannel?"("+n.subchannel.getChannelzRef().id+") "+n.subchannel.getAddress():""+n.subchannel;switch(this.trace("Pick result: "+zr.PickResultType[n.pickResultType]+" subchannel: "+s+" status: "+((e=n.status)===null||e===void 0?void 0:e.code)+" "+((t=n.status)===null||t===void 0?void 0:t.details)),n.pickResultType){case zr.PickResultType.COMPLETE:this.credentials.generateMetadata({service_url:this.serviceUrl}).then(l=>{var c,u,h;if(this.ended){this.trace("Credentials metadata generation finished after call ended");return}if(i.merge(l),i.get("authorization").length>1&&this.outputStatus({code:vs.Status.INTERNAL,details:'"authorization" metadata cannot have multiple values',metadata:new ys.Metadata},"PROCESSED"),n.subchannel.getConnectivityState()!==Sf.ConnectivityState.READY){this.trace("Picked subchannel "+s+" has state "+Sf.ConnectivityState[n.subchannel.getConnectivityState()]+" after getting credentials metadata. Retrying pick"),this.doPick();return}this.deadline!==1/0&&i.set("grpc-timeout",(0,_f.getDeadlineTimeoutString)(this.deadline));try{this.child=n.subchannel.getRealSubchannel().createCall(i,this.host,this.methodName,{onReceiveMetadata:f=>{this.trace("Received metadata"),this.listener.onReceiveMetadata(f)},onReceiveMessage:f=>{this.trace("Received message"),this.listener.onReceiveMessage(f)},onReceiveStatus:f=>{this.trace("Received status"),f.rstCode===qS.constants.NGHTTP2_REFUSED_STREAM?this.outputStatus(f,"REFUSED"):this.outputStatus(f,"PROCESSED")}}),this.childStartTime=new Date}catch(f){this.trace("Failed to start call on picked subchannel "+s+" with error "+f.message),this.outputStatus({code:vs.Status.INTERNAL,details:"Failed to start HTTP/2 stream with error "+f.message,metadata:new ys.Metadata},"NOT_STARTED");return}(u=(c=this.callConfig).onCommitted)===null||u===void 0||u.call(c),(h=n.onCallStarted)===null||h===void 0||h.call(n),this.onCallEnded=n.onCallEnded,this.trace("Created child call ["+this.child.getCallNumber()+"]"),this.readPending&&this.child.startRead(),this.pendingMessage&&this.child.sendMessageWithContext(this.pendingMessage.context,this.pendingMessage.message),this.pendingHalfClose&&this.child.halfClose()},l=>{let{code:c,details:u}=(0,bl.restrictControlPlaneStatusCode)(typeof l.code=="number"?l.code:vs.Status.UNKNOWN,`Getting metadata from plugin failed with error: ${l.message}`);this.outputStatus({code:c,details:u,metadata:new ys.Metadata},"PROCESSED")});break;case zr.PickResultType.DROP:let{code:a,details:o}=(0,bl.restrictControlPlaneStatusCode)(n.status.code,n.status.details);setImmediate(()=>{this.outputStatus({code:a,details:o,metadata:n.status.metadata},"DROP")});break;case zr.PickResultType.TRANSIENT_FAILURE:if(this.metadata.getOptions().waitForReady)this.channel.queueCallForPick(this);else{let{code:l,details:c}=(0,bl.restrictControlPlaneStatusCode)(n.status.code,n.status.details);setImmediate(()=>{this.outputStatus({code:l,details:c,metadata:n.status.metadata},"PROCESSED")})}break;case zr.PickResultType.QUEUE:this.channel.queueCallForPick(this)}}cancelWithStatus(e,t){var i;this.trace("cancelWithStatus code: "+e+' details: "'+t+'"'),(i=this.child)===null||i===void 0||i.cancelWithStatus(e,t),this.outputStatus({code:e,details:t,metadata:new ys.Metadata},"PROCESSED")}getPeer(){var e,t;return(t=(e=this.child)===null||e===void 0?void 0:e.getPeer())!==null&&t!==void 0?t:this.channel.getTarget()}start(e,t){this.trace("start called"),this.listener=t,this.metadata=e,this.doPick()}sendMessageWithContext(e,t){this.trace("write() called with message of length "+t.length),this.child?this.child.sendMessageWithContext(e,t):this.pendingMessage={context:e,message:t}}startRead(){this.trace("startRead called"),this.child?this.child.startRead():this.readPending=!0}halfClose(){this.trace("halfClose called"),this.child?this.child.halfClose():this.pendingHalfClose=!0}setCredentials(e){throw new Error("Method not implemented.")}getCallNumber(){return this.callNumber}};Ss.LoadBalancingCall=Rl});var Ef=g(_s=>{"use strict";Object.defineProperty(_s,"__esModule",{value:!0});_s.ResolvingCall=void 0;var gi=z(),mi=Ur(),Tf=Re(),US=te(),zS=ms(),HS="resolving_call",wl=class{constructor(e,t,i,n,s,a){this.channel=e,this.method=t,this.filterStackFactory=n,this.credentials=s,this.callNumber=a,this.child=null,this.readPending=!1,this.pendingMessage=null,this.pendingHalfClose=!1,this.ended=!1,this.readFilterPending=!1,this.writeFilterPending=!1,this.pendingChildStatus=null,this.metadata=null,this.listener=null,this.statusWatchers=[],this.deadlineTimer=setTimeout(()=>{},0),this.filterStack=null,this.deadlineStartTime=null,this.configReceivedTime=null,this.childStartTime=null,this.deadline=i.deadline,this.host=i.host,i.parentCall&&(i.flags&gi.Propagate.CANCELLATION&&i.parentCall.on("cancelled",()=>{this.cancelWithStatus(gi.Status.CANCELLED,"Cancelled by parent call")}),i.flags&gi.Propagate.DEADLINE&&(this.trace("Propagating deadline from parent: "+i.parentCall.getDeadline()),this.deadline=(0,mi.minDeadline)(this.deadline,i.parentCall.getDeadline()))),this.trace("Created"),this.runDeadlineTimer()}trace(e){US.trace(gi.LogVerbosity.DEBUG,HS,"["+this.callNumber+"] "+e)}runDeadlineTimer(){clearTimeout(this.deadlineTimer),this.deadlineStartTime=new Date,this.trace("Deadline: "+(0,mi.deadlineToString)(this.deadline));let e=(0,mi.getRelativeTimeout)(this.deadline);if(e!==1/0){this.trace("Deadline will be reached in "+e+"ms");let t=()=>{if(!this.deadlineStartTime){this.cancelWithStatus(gi.Status.DEADLINE_EXCEEDED,"Deadline exceeded");return}let i=[],n=new Date;i.push(`Deadline exceeded after ${(0,mi.formatDateDifference)(this.deadlineStartTime,n)}`),this.configReceivedTime?(this.configReceivedTime>this.deadlineStartTime&&i.push(`name resolution: ${(0,mi.formatDateDifference)(this.deadlineStartTime,this.configReceivedTime)}`),this.childStartTime?this.childStartTime>this.configReceivedTime&&i.push(`metadata filters: ${(0,mi.formatDateDifference)(this.configReceivedTime,this.childStartTime)}`):i.push("waiting for metadata filters")):i.push("waiting for name resolution"),this.child&&i.push(...this.child.getDeadlineInfo()),this.cancelWithStatus(gi.Status.DEADLINE_EXCEEDED,i.join(","))};e<=0?process.nextTick(t):this.deadlineTimer=setTimeout(t,e)}}outputStatus(e){if(!this.ended){this.ended=!0,this.filterStack||(this.filterStack=this.filterStackFactory.createFilter()),clearTimeout(this.deadlineTimer);let t=this.filterStack.receiveTrailers(e);this.trace("ended with status: code="+t.code+' details="'+t.details+'"'),this.statusWatchers.forEach(i=>i(t)),process.nextTick(()=>{var i;(i=this.listener)===null||i===void 0||i.onReceiveStatus(t)})}}sendMessageOnChild(e,t){if(!this.child)throw new Error("sendMessageonChild called with child not populated");let i=this.child;this.writeFilterPending=!0,this.filterStack.sendMessage(Promise.resolve({message:t,flags:e.flags})).then(n=>{this.writeFilterPending=!1,i.sendMessageWithContext(e,n.message),this.pendingHalfClose&&i.halfClose()},n=>{this.cancelWithStatus(n.code,n.details)})}getConfig(){if(this.ended)return;if(!this.metadata||!this.listener)throw new Error("getConfig called before start");let e=this.channel.getConfig(this.method,this.metadata);if(e.type==="NONE"){this.channel.queueCallForConfig(this);return}else if(e.type==="ERROR"){this.metadata.getOptions().waitForReady?this.channel.queueCallForConfig(this):this.outputStatus(e.error);return}this.configReceivedTime=new Date;let t=e.config;if(t.status!==gi.Status.OK){let{code:i,details:n}=(0,zS.restrictControlPlaneStatusCode)(t.status,"Failed to route call to method "+this.method);this.outputStatus({code:i,details:n,metadata:new Tf.Metadata});return}if(t.methodConfig.timeout){let i=new Date;i.setSeconds(i.getSeconds()+t.methodConfig.timeout.seconds),i.setMilliseconds(i.getMilliseconds()+t.methodConfig.timeout.nanos/1e6),this.deadline=(0,mi.minDeadline)(this.deadline,i),this.runDeadlineTimer()}this.filterStackFactory.push(t.dynamicFilterFactories),this.filterStack=this.filterStackFactory.createFilter(),this.filterStack.sendMetadata(Promise.resolve(this.metadata)).then(i=>{this.child=this.channel.createInnerCall(t,this.method,this.host,this.credentials,this.deadline),this.trace("Created child ["+this.child.getCallNumber()+"]"),this.childStartTime=new Date,this.child.start(i,{onReceiveMetadata:n=>{this.trace("Received metadata"),this.listener.onReceiveMetadata(this.filterStack.receiveMetadata(n))},onReceiveMessage:n=>{this.trace("Received message"),this.readFilterPending=!0,this.filterStack.receiveMessage(n).then(s=>{this.trace("Finished filtering received message"),this.readFilterPending=!1,this.listener.onReceiveMessage(s),this.pendingChildStatus&&this.outputStatus(this.pendingChildStatus)},s=>{this.cancelWithStatus(s.code,s.details)})},onReceiveStatus:n=>{this.trace("Received status"),this.readFilterPending?this.pendingChildStatus=n:this.outputStatus(n)}}),this.readPending&&this.child.startRead(),this.pendingMessage?this.sendMessageOnChild(this.pendingMessage.context,this.pendingMessage.message):this.pendingHalfClose&&this.child.halfClose()},i=>{this.outputStatus(i)})}reportResolverError(e){var t;!((t=this.metadata)===null||t===void 0)&&t.getOptions().waitForReady?this.channel.queueCallForConfig(this):this.outputStatus(e)}cancelWithStatus(e,t){var i;this.trace("cancelWithStatus code: "+e+' details: "'+t+'"'),(i=this.child)===null||i===void 0||i.cancelWithStatus(e,t),this.outputStatus({code:e,details:t,metadata:new Tf.Metadata})}getPeer(){var e,t;return(t=(e=this.child)===null||e===void 0?void 0:e.getPeer())!==null&&t!==void 0?t:this.channel.getTarget()}start(e,t){this.trace("start called"),this.metadata=e.clone(),this.listener=t,this.getConfig()}sendMessageWithContext(e,t){this.trace("write() called with message of length "+t.length),this.child?this.sendMessageOnChild(e,t):this.pendingMessage={context:e,message:t}}startRead(){this.trace("startRead called"),this.child?this.child.startRead():this.readPending=!0}halfClose(){this.trace("halfClose called"),this.child&&!this.writeFilterPending?this.child.halfClose():this.pendingHalfClose=!0}setCredentials(e){this.credentials=this.credentials.compose(e)}addStatusWatcher(e){this.statusWatchers.push(e)}getCallNumber(){return this.callNumber}};_s.ResolvingCall=wl});var bf=g(Xt=>{"use strict";Object.defineProperty(Xt,"__esModule",{value:!0});Xt.RetryingCall=Xt.MessageBufferTracker=Xt.RetryThrottler=void 0;var Cs=z(),jS=Ur(),GS=Re(),WS=te(),$S="retrying_call",Ol=class{constructor(e,t,i){this.maxTokens=e,this.tokenRatio=t,i?this.tokens=i.tokens*(e/i.maxTokens):this.tokens=e}addCallSucceeded(){this.tokens=Math.max(this.tokens+this.tokenRatio,this.maxTokens)}addCallFailed(){this.tokens=Math.min(this.tokens-1,0)}canRetryCall(){return this.tokens>this.maxTokens/2}};Xt.RetryThrottler=Ol;var Ml=class{constructor(e,t){this.totalLimit=e,this.limitPerCall=t,this.totalAllocated=0,this.allocatedPerCall=new Map}allocate(e,t){var i;let n=(i=this.allocatedPerCall.get(t))!==null&&i!==void 0?i:0;return this.limitPerCall-n<e||this.totalLimit-this.totalAllocated<e?!1:(this.allocatedPerCall.set(t,n+e),this.totalAllocated+=e,!0)}free(e,t){var i;if(this.totalAllocated<e)throw new Error(`Invalid buffer allocation state: call ${t} freed ${e} > total allocated ${this.totalAllocated}`);this.totalAllocated-=e;let n=(i=this.allocatedPerCall.get(t))!==null&&i!==void 0?i:0;if(n<e)throw new Error(`Invalid buffer allocation state: call ${t} freed ${e} > allocated for call ${n}`);this.allocatedPerCall.set(t,n-e)}freeAll(e){var t;let i=(t=this.allocatedPerCall.get(e))!==null&&t!==void 0?t:0;if(this.totalAllocated<i)throw new Error(`Invalid buffer allocation state: call ${e} allocated ${i} > total allocated ${this.totalAllocated}`);this.totalAllocated-=i,this.allocatedPerCall.delete(e)}};Xt.MessageBufferTracker=Ml;var Al="grpc-previous-rpc-attempts",kl=class{constructor(e,t,i,n,s,a,o,l,c){if(this.channel=e,this.callConfig=t,this.methodName=i,this.host=n,this.credentials=s,this.deadline=a,this.callNumber=o,this.bufferTracker=l,this.retryThrottler=c,this.listener=null,this.initialMetadata=null,this.underlyingCalls=[],this.writeBuffer=[],this.writeBufferOffset=0,this.readStarted=!1,this.transparentRetryUsed=!1,this.attempts=0,this.hedgingTimer=null,this.committedCallIndex=null,this.initialRetryBackoffSec=0,this.nextRetryBackoffSec=0,t.methodConfig.retryPolicy){this.state="RETRY";let u=t.methodConfig.retryPolicy;this.nextRetryBackoffSec=this.initialRetryBackoffSec=Number(u.initialBackoff.substring(0,u.initialBackoff.length-1))}else t.methodConfig.hedgingPolicy?this.state="HEDGING":this.state="TRANSPARENT_ONLY";this.startTime=new Date}getDeadlineInfo(){if(this.underlyingCalls.length===0)return[];let e=[],t=this.underlyingCalls[this.underlyingCalls.length-1];return this.underlyingCalls.length>1&&e.push(`previous attempts: ${this.underlyingCalls.length-1}`),t.startTime>this.startTime&&e.push(`time to current attempt start: ${(0,jS.formatDateDifference)(this.startTime,t.startTime)}`),e.push(...t.call.getDeadlineInfo()),e}getCallNumber(){return this.callNumber}trace(e){WS.trace(Cs.LogVerbosity.DEBUG,$S,"["+this.callNumber+"] "+e)}reportStatus(e){this.trace("ended with status: code="+e.code+' details="'+e.details+'" start time='+this.startTime.toISOString()),this.bufferTracker.freeAll(this.callNumber),this.writeBufferOffset=this.writeBufferOffset+this.writeBuffer.length,this.writeBuffer=[],process.nextTick(()=>{var t;(t=this.listener)===null||t===void 0||t.onReceiveStatus({code:e.code,details:e.details,metadata:e.metadata})})}cancelWithStatus(e,t){this.trace("cancelWithStatus code: "+e+' details: "'+t+'"'),this.reportStatus({code:e,details:t,metadata:new GS.Metadata});for(let{call:i}of this.underlyingCalls)i.cancelWithStatus(e,t)}getPeer(){return this.committedCallIndex!==null?this.underlyingCalls[this.committedCallIndex].call.getPeer():"unknown"}getBufferEntry(e){var t;return(t=this.writeBuffer[e-this.writeBufferOffset])!==null&&t!==void 0?t:{entryType:"FREED",allocated:!1}}getNextBufferIndex(){return this.writeBufferOffset+this.writeBuffer.length}clearSentMessages(){if(this.state!=="COMMITTED")return;let e=this.underlyingCalls[this.committedCallIndex].nextMessageToSend;for(let t=this.writeBufferOffset;t<e;t++){let i=this.getBufferEntry(t);i.allocated&&this.bufferTracker.free(i.message.message.length,this.callNumber)}this.writeBuffer=this.writeBuffer.slice(e-this.writeBufferOffset),this.writeBufferOffset=e}commitCall(e){if(this.state!=="COMMITTED"&&this.underlyingCalls[e].state!=="COMPLETED"){this.trace("Committing call ["+this.underlyingCalls[e].call.getCallNumber()+"] at index "+e),this.state="COMMITTED",this.committedCallIndex=e;for(let t=0;t<this.underlyingCalls.length;t++)t!==e&&this.underlyingCalls[t].state!=="COMPLETED"&&(this.underlyingCalls[t].state="COMPLETED",this.underlyingCalls[t].call.cancelWithStatus(Cs.Status.CANCELLED,"Discarded in favor of other hedged attempt"));this.clearSentMessages()}}commitCallWithMostMessages(){if(this.state==="COMMITTED")return;let e=-1,t=-1;for(let[i,n]of this.underlyingCalls.entries())n.state==="ACTIVE"&&n.nextMessageToSend>e&&(e=n.nextMessageToSend,t=i);t===-1?this.state="TRANSPARENT_ONLY":this.commitCall(t)}isStatusCodeInList(e,t){return e.some(i=>i===t||i.toString().toLowerCase()===Cs.Status[t].toLowerCase())}getNextRetryBackoffMs(){var e;let t=(e=this.callConfig)===null||e===void 0?void 0:e.methodConfig.retryPolicy;if(!t)return 0;let i=Math.random()*this.nextRetryBackoffSec*1e3,n=Number(t.maxBackoff.substring(0,t.maxBackoff.length-1));return this.nextRetryBackoffSec=Math.min(this.nextRetryBackoffSec*t.backoffMultiplier,n),i}maybeRetryCall(e,t){if(this.state!=="RETRY"){t(!1);return}let i=this.callConfig.methodConfig.retryPolicy;if(this.attempts>=Math.min(i.maxAttempts,5)){t(!1);return}let n;if(e===null)n=this.getNextRetryBackoffMs();else if(e<0){this.state="TRANSPARENT_ONLY",t(!1);return}else n=e,this.nextRetryBackoffSec=this.initialRetryBackoffSec;setTimeout(()=>{var s,a;if(this.state!=="RETRY"){t(!1);return}(!((a=(s=this.retryThrottler)===null||s===void 0?void 0:s.canRetryCall())!==null&&a!==void 0)||a)&&(t(!0),this.attempts+=1,this.startNewAttempt())},n)}countActiveCalls(){let e=0;for(let t of this.underlyingCalls)t?.state==="ACTIVE"&&(e+=1);return e}handleProcessedStatus(e,t,i){var n,s,a;switch(this.state){case"COMMITTED":case"TRANSPARENT_ONLY":this.commitCall(t),this.reportStatus(e);break;case"HEDGING":if(this.isStatusCodeInList((n=this.callConfig.methodConfig.hedgingPolicy.nonFatalStatusCodes)!==null&&n!==void 0?n:[],e.code)){(s=this.retryThrottler)===null||s===void 0||s.addCallFailed();let o;if(i===null)o=0;else if(i<0){this.state="TRANSPARENT_ONLY",this.commitCall(t),this.reportStatus(e);return}else o=i;setTimeout(()=>{this.maybeStartHedgingAttempt(),this.countActiveCalls()===0&&(this.commitCall(t),this.reportStatus(e))},o)}else this.commitCall(t),this.reportStatus(e);break;case"RETRY":this.isStatusCodeInList(this.callConfig.methodConfig.retryPolicy.retryableStatusCodes,e.code)?((a=this.retryThrottler)===null||a===void 0||a.addCallFailed(),this.maybeRetryCall(i,o=>{o||(this.commitCall(t),this.reportStatus(e))})):(this.commitCall(t),this.reportStatus(e));break}}getPushback(e){let t=e.get("grpc-retry-pushback-ms");if(t.length===0)return null;try{return parseInt(t[0])}catch{return-1}}handleChildStatus(e,t){var i;if(this.underlyingCalls[t].state==="COMPLETED")return;if(this.trace("state="+this.state+" handling status with progress "+e.progress+" from child ["+this.underlyingCalls[t].call.getCallNumber()+"] in state "+this.underlyingCalls[t].state),this.underlyingCalls[t].state="COMPLETED",e.code===Cs.Status.OK){(i=this.retryThrottler)===null||i===void 0||i.addCallSucceeded(),this.commitCall(t),this.reportStatus(e);return}if(this.state==="COMMITTED"){this.reportStatus(e);return}let n=this.getPushback(e.metadata);switch(e.progress){case"NOT_STARTED":this.startNewAttempt();break;case"REFUSED":this.transparentRetryUsed?this.handleProcessedStatus(e,t,n):(this.transparentRetryUsed=!0,this.startNewAttempt());break;case"DROP":this.commitCall(t),this.reportStatus(e);break;case"PROCESSED":this.handleProcessedStatus(e,t,n);break}}maybeStartHedgingAttempt(){if(this.state!=="HEDGING"||!this.callConfig.methodConfig.hedgingPolicy)return;let e=this.callConfig.methodConfig.hedgingPolicy;this.attempts>=Math.min(e.maxAttempts,5)||(this.attempts+=1,this.startNewAttempt(),this.maybeStartHedgingTimer())}maybeStartHedgingTimer(){var e,t,i;if(this.hedgingTimer&&clearTimeout(this.hedgingTimer),this.state!=="HEDGING"||!this.callConfig.methodConfig.hedgingPolicy)return;let n=this.callConfig.methodConfig.hedgingPolicy;if(this.attempts>=Math.min(n.maxAttempts,5))return;let s=(e=n.hedgingDelay)!==null&&e!==void 0?e:"0s",a=Number(s.substring(0,s.length-1));this.hedgingTimer=setTimeout(()=>{this.maybeStartHedgingAttempt()},a*1e3),(i=(t=this.hedgingTimer).unref)===null||i===void 0||i.call(t)}startNewAttempt(){let e=this.channel.createLoadBalancingCall(this.callConfig,this.methodName,this.host,this.credentials,this.deadline);this.trace("Created child call ["+e.getCallNumber()+"] for attempt "+this.attempts);let t=this.underlyingCalls.length;this.underlyingCalls.push({state:"ACTIVE",call:e,nextMessageToSend:0,startTime:new Date});let i=this.attempts-1,n=this.initialMetadata.clone();i>0&&n.set(Al,`${i}`);let s=!1;e.start(n,{onReceiveMetadata:a=>{this.trace("Received metadata from child ["+e.getCallNumber()+"]"),this.commitCall(t),s=!0,i>0&&a.set(Al,`${i}`),this.underlyingCalls[t].state==="ACTIVE"&&this.listener.onReceiveMetadata(a)},onReceiveMessage:a=>{this.trace("Received message from child ["+e.getCallNumber()+"]"),this.commitCall(t),this.underlyingCalls[t].state==="ACTIVE"&&this.listener.onReceiveMessage(a)},onReceiveStatus:a=>{this.trace("Received status from child ["+e.getCallNumber()+"]"),!s&&i>0&&a.metadata.set(Al,`${i}`),this.handleChildStatus(a,t)}}),this.sendNextChildMessage(t),this.readStarted&&e.startRead()}start(e,t){this.trace("start called"),this.listener=t,this.initialMetadata=e,this.attempts+=1,this.startNewAttempt(),this.maybeStartHedgingTimer()}handleChildWriteCompleted(e){var t,i;let n=this.underlyingCalls[e],s=n.nextMessageToSend;(i=(t=this.getBufferEntry(s)).callback)===null||i===void 0||i.call(t),this.clearSentMessages(),n.nextMessageToSend+=1,this.sendNextChildMessage(e)}sendNextChildMessage(e){let t=this.underlyingCalls[e];if(t.state!=="COMPLETED"&&this.getBufferEntry(t.nextMessageToSend)){let i=this.getBufferEntry(t.nextMessageToSend);switch(i.entryType){case"MESSAGE":t.call.sendMessageWithContext({callback:n=>{this.handleChildWriteCompleted(e)}},i.message.message);break;case"HALF_CLOSE":t.nextMessageToSend+=1,t.call.halfClose();break;case"FREED":break}}}sendMessageWithContext(e,t){var i;this.trace("write() called with message of length "+t.length);let n={message:t,flags:e.flags},s=this.getNextBufferIndex(),a={entryType:"MESSAGE",message:n,allocated:this.bufferTracker.allocate(t.length,this.callNumber)};if(this.writeBuffer.push(a),a.allocated){(i=e.callback)===null||i===void 0||i.call(e);for(let[o,l]of this.underlyingCalls.entries())l.state==="ACTIVE"&&l.nextMessageToSend===s&&l.call.sendMessageWithContext({callback:c=>{this.handleChildWriteCompleted(o)}},t)}else{if(this.commitCallWithMostMessages(),this.committedCallIndex===null)return;let o=this.underlyingCalls[this.committedCallIndex];a.callback=e.callback,o.state==="ACTIVE"&&o.nextMessageToSend===s&&o.call.sendMessageWithContext({callback:l=>{this.handleChildWriteCompleted(this.committedCallIndex)}},t)}}startRead(){this.trace("startRead called"),this.readStarted=!0;for(let e of this.underlyingCalls)e?.state==="ACTIVE"&&e.call.startRead()}halfClose(){this.trace("halfClose called");let e=this.getNextBufferIndex();this.writeBuffer.push({entryType:"HALF_CLOSE",allocated:!1});for(let t of this.underlyingCalls)t?.state==="ACTIVE"&&t.nextMessageToSend===e&&(t.nextMessageToSend+=1,t.call.halfClose())}setCredentials(e){throw new Error("Method not implemented.")}getMethod(){return this.methodName}getHost(){return this.host}};Xt.RetryingCall=kl});var Es=g(Ts=>{"use strict";Object.defineProperty(Ts,"__esModule",{value:!0});Ts.BaseSubchannelWrapper=void 0;var Nl=class{constructor(e){this.child=e,this.healthy=!0,this.healthListeners=new Set,e.addHealthStateWatcher(t=>{this.healthy&&this.updateHealthListeners()})}updateHealthListeners(){for(let e of this.healthListeners)e(this.isHealthy())}getConnectivityState(){return this.child.getConnectivityState()}addConnectivityStateListener(e){this.child.addConnectivityStateListener(e)}removeConnectivityStateListener(e){this.child.removeConnectivityStateListener(e)}startConnecting(){this.child.startConnecting()}getAddress(){return this.child.getAddress()}throttleKeepalive(e){this.child.throttleKeepalive(e)}ref(){this.child.ref()}unref(){this.child.unref()}getChannelzRef(){return this.child.getChannelzRef()}isHealthy(){return this.healthy&&this.child.isHealthy()}addHealthStateWatcher(e){this.healthListeners.add(e)}removeHealthStateWatcher(e){this.healthListeners.delete(e)}setHealthy(e){e!==this.healthy&&(this.healthy=e,this.child.isHealthy()&&this.updateHealthListeners())}getRealSubchannel(){return this.child.getRealSubchannel()}realSubchannelEquals(e){return this.getRealSubchannel()===e.getRealSubchannel()}};Ts.BaseSubchannelWrapper=Nl});var Af=g(ws=>{"use strict";Object.defineProperty(ws,"__esModule",{value:!0});ws.InternalChannel=void 0;var VS=an(),YS=Gc(),KS=pf(),Rf=Lt(),Hr=z(),JS=ml(),XS=yf(),wf=ot(),Pl=te(),ZS=ol(),bs=Pe(),Ct=Be(),jr=fi(),QS=Cf(),e_=Ur(),t_=Ef(),Il=dl(),i_=ms(),xl=bf(),r_=Es(),n_=2147483647,s_=1e3,a_=30*60*1e3,Rs=new Map,o_=1<<24,l_=1<<20,Dl=class extends r_.BaseSubchannelWrapper{constructor(e,t){super(e),this.channel=t,this.refCount=0,this.subchannelStateListener=(i,n,s,a)=>{t.throttleKeepalive(a)},e.addConnectivityStateListener(this.subchannelStateListener)}ref(){this.child.ref(),this.refCount+=1}unref(){this.child.unref(),this.refCount-=1,this.refCount<=0&&(this.child.removeConnectivityStateListener(this.subchannelStateListener),this.channel.removeWrappedSubchannel(this))}},Ll=class{constructor(e,t,i){var n,s,a,o,l,c,u,h;if(this.credentials=t,this.options=i,this.connectivityState=Ct.ConnectivityState.IDLE,this.currentPicker=new Rf.UnavailablePicker,this.configSelectionQueue=[],this.pickQueue=[],this.connectivityStateWatchers=[],this.configSelector=null,this.currentResolutionError=null,this.wrappedSubchannels=new Set,this.callCount=0,this.idleTimer=null,this.channelzEnabled=!0,this.callTracker=new jr.ChannelzCallTracker,this.childrenTracker=new jr.ChannelzChildrenTracker,this.randomChannelId=Math.floor(Math.random()*Number.MAX_SAFE_INTEGER),typeof e!="string")throw new TypeError("Channel target must be a string");if(!(t instanceof VS.ChannelCredentials))throw new TypeError("Channel credentials must be a ChannelCredentials object");if(i&&typeof i!="object")throw new TypeError("Channel options must be an object");this.originalTarget=e;let f=(0,bs.parseUri)(e);if(f===null)throw new Error(`Could not parse target name "${e}"`);let p=(0,wf.mapUriDefaultScheme)(f);if(p===null)throw new Error(`Could not find a default scheme for target name "${e}"`);this.callRefTimer=setInterval(()=>{},n_),(s=(n=this.callRefTimer).unref)===null||s===void 0||s.call(n),this.options["grpc.enable_channelz"]===0&&(this.channelzEnabled=!1),this.channelzTrace=new jr.ChannelzTrace,this.channelzRef=(0,jr.registerChannelzChannel)(e,()=>this.getChannelzInfo(),this.channelzEnabled),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Channel created"),this.options["grpc.default_authority"]?this.defaultAuthority=this.options["grpc.default_authority"]:this.defaultAuthority=(0,wf.getDefaultAuthority)(p);let E=(0,ZS.mapProxyName)(p,i);this.target=E.target,this.options=Object.assign({},this.options,E.extraOptions),this.subchannelPool=(0,KS.getSubchannelPool)(((a=i["grpc.use_local_subchannel_pool"])!==null&&a!==void 0?a:0)===0),this.retryBufferTracker=new xl.MessageBufferTracker((o=i["grpc.retry_buffer_size"])!==null&&o!==void 0?o:o_,(l=i["grpc.per_rpc_retry_buffer_size"])!==null&&l!==void 0?l:l_),this.keepaliveTime=(c=i["grpc.keepalive_time_ms"])!==null&&c!==void 0?c:-1,this.idleTimeoutMs=Math.max((u=i["grpc.client_idle_timeout_ms"])!==null&&u!==void 0?u:a_,s_);let m={createSubchannel:(S,T)=>{let k=this.subchannelPool.getOrCreateSubchannel(this.target,S,Object.assign({},this.options,T),this.credentials);k.throttleKeepalive(this.keepaliveTime),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Created subchannel or used existing subchannel",k.getChannelzRef());let w=new Dl(k,this);return this.wrappedSubchannels.add(w),w},updateState:(S,T)=>{this.currentPicker=T;let k=this.pickQueue.slice();this.pickQueue=[],k.length>0&&this.callRefTimerUnref();for(let w of k)w.doPick();this.updateState(S)},requestReresolution:()=>{throw new Error("Resolving load balancer should never call requestReresolution")},addChannelzChild:S=>{this.channelzEnabled&&this.childrenTracker.refChild(S)},removeChannelzChild:S=>{this.channelzEnabled&&this.childrenTracker.unrefChild(S)}};this.resolvingLoadBalancer=new YS.ResolvingLoadBalancer(this.target,m,i,(S,T)=>{S.retryThrottling?Rs.set(this.getTarget(),new xl.RetryThrottler(S.retryThrottling.maxTokens,S.retryThrottling.tokenRatio,Rs.get(this.getTarget()))):Rs.delete(this.getTarget()),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Address resolution succeeded"),this.configSelector=T,this.currentResolutionError=null,process.nextTick(()=>{let k=this.configSelectionQueue;this.configSelectionQueue=[],k.length>0&&this.callRefTimerUnref();for(let w of k)w.getConfig()})},S=>{this.channelzEnabled&&this.channelzTrace.addTrace("CT_WARNING","Address resolution failed with code "+S.code+' and details "'+S.details+'"'),this.configSelectionQueue.length>0&&this.trace("Name resolution failed with calls queued for config selection"),this.configSelector===null&&(this.currentResolutionError=Object.assign(Object.assign({},(0,i_.restrictControlPlaneStatusCode)(S.code,S.details)),{metadata:S.metadata}));let T=this.configSelectionQueue;this.configSelectionQueue=[],T.length>0&&this.callRefTimerUnref();for(let k of T)k.reportResolverError(S)}),this.filterStackFactory=new JS.FilterStackFactory([new XS.CompressionFilterFactory(this,this.options)]),this.trace("Channel constructed with options "+JSON.stringify(i,void 0,2));let b=new Error;(0,Pl.trace)(Hr.LogVerbosity.DEBUG,"channel_stacktrace","("+this.channelzRef.id+`) Channel constructed 
`+((h=b.stack)===null||h===void 0?void 0:h.substring(b.stack.indexOf(`
`)+1))),this.lastActivityTimestamp=new Date}getChannelzInfo(){return{target:this.originalTarget,state:this.connectivityState,trace:this.channelzTrace,callTracker:this.callTracker,children:this.childrenTracker.getChildLists()}}trace(e,t){(0,Pl.trace)(t??Hr.LogVerbosity.DEBUG,"channel","("+this.channelzRef.id+") "+(0,bs.uriToString)(this.target)+" "+e)}callRefTimerRef(){var e,t,i,n;!((t=(e=this.callRefTimer).hasRef)===null||t===void 0)&&t.call(e)||(this.trace("callRefTimer.ref | configSelectionQueue.length="+this.configSelectionQueue.length+" pickQueue.length="+this.pickQueue.length),(n=(i=this.callRefTimer).ref)===null||n===void 0||n.call(i))}callRefTimerUnref(){var e,t;(!this.callRefTimer.hasRef||this.callRefTimer.hasRef())&&(this.trace("callRefTimer.unref | configSelectionQueue.length="+this.configSelectionQueue.length+" pickQueue.length="+this.pickQueue.length),(t=(e=this.callRefTimer).unref)===null||t===void 0||t.call(e))}removeConnectivityStateWatcher(e){let t=this.connectivityStateWatchers.findIndex(i=>i===e);t>=0&&this.connectivityStateWatchers.splice(t,1)}updateState(e){(0,Pl.trace)(Hr.LogVerbosity.DEBUG,"connectivity_state","("+this.channelzRef.id+") "+(0,bs.uriToString)(this.target)+" "+Ct.ConnectivityState[this.connectivityState]+" -> "+Ct.ConnectivityState[e]),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Connectivity state change to "+Ct.ConnectivityState[e]),this.connectivityState=e;let t=this.connectivityStateWatchers.slice();for(let i of t)e!==i.currentState&&(i.timer&&clearTimeout(i.timer),this.removeConnectivityStateWatcher(i),i.callback());e!==Ct.ConnectivityState.TRANSIENT_FAILURE&&(this.currentResolutionError=null)}throttleKeepalive(e){if(e>this.keepaliveTime){this.keepaliveTime=e;for(let t of this.wrappedSubchannels)t.throttleKeepalive(e)}}removeWrappedSubchannel(e){this.wrappedSubchannels.delete(e)}doPick(e,t){return this.currentPicker.pick({metadata:e,extraPickInfo:t})}queueCallForPick(e){this.pickQueue.push(e),this.callRefTimerRef()}getConfig(e,t){return this.resolvingLoadBalancer.exitIdle(),this.configSelector?{type:"SUCCESS",config:this.configSelector(e,t,this.randomChannelId)}:this.currentResolutionError?{type:"ERROR",error:this.currentResolutionError}:{type:"NONE"}}queueCallForConfig(e){this.configSelectionQueue.push(e),this.callRefTimerRef()}enterIdle(){this.resolvingLoadBalancer.destroy(),this.updateState(Ct.ConnectivityState.IDLE),this.currentPicker=new Rf.QueuePicker(this.resolvingLoadBalancer),this.idleTimer&&(clearTimeout(this.idleTimer),this.idleTimer=null)}startIdleTimeout(e){var t,i;this.idleTimer=setTimeout(()=>{if(this.callCount>0){this.startIdleTimeout(this.idleTimeoutMs);return}let s=new Date().valueOf()-this.lastActivityTimestamp.valueOf();s>=this.idleTimeoutMs?(this.trace("Idle timer triggered after "+this.idleTimeoutMs+"ms of inactivity"),this.enterIdle()):this.startIdleTimeout(this.idleTimeoutMs-s)},e),(i=(t=this.idleTimer).unref)===null||i===void 0||i.call(t)}maybeStartIdleTimer(){this.connectivityState!==Ct.ConnectivityState.SHUTDOWN&&!this.idleTimer&&this.startIdleTimeout(this.idleTimeoutMs)}onCallStart(){this.channelzEnabled&&this.callTracker.addCallStarted(),this.callCount+=1}onCallEnd(e){this.channelzEnabled&&(e.code===Hr.Status.OK?this.callTracker.addCallSucceeded():this.callTracker.addCallFailed()),this.callCount-=1,this.lastActivityTimestamp=new Date,this.maybeStartIdleTimer()}createLoadBalancingCall(e,t,i,n,s){let a=(0,Il.getNextCallNumber)();return this.trace("createLoadBalancingCall ["+a+'] method="'+t+'"'),new QS.LoadBalancingCall(this,e,t,i,n,s,a)}createRetryingCall(e,t,i,n,s){let a=(0,Il.getNextCallNumber)();return this.trace("createRetryingCall ["+a+'] method="'+t+'"'),new xl.RetryingCall(this,e,t,i,n,s,a,this.retryBufferTracker,Rs.get(this.getTarget()))}createInnerCall(e,t,i,n,s){return this.options["grpc.enable_retries"]===0?this.createLoadBalancingCall(e,t,i,n,s):this.createRetryingCall(e,t,i,n,s)}createResolvingCall(e,t,i,n,s){let a=(0,Il.getNextCallNumber)();this.trace("createResolvingCall ["+a+'] method="'+e+'", deadline='+(0,e_.deadlineToString)(t));let o={deadline:t,flags:s??Hr.Propagate.DEFAULTS,host:i??this.defaultAuthority,parentCall:n},l=new t_.ResolvingCall(this,e,o,this.filterStackFactory.clone(),this.credentials._getCallCredentials(),a);return this.onCallStart(),l.addStatusWatcher(c=>{this.onCallEnd(c)}),l}close(){this.resolvingLoadBalancer.destroy(),this.updateState(Ct.ConnectivityState.SHUTDOWN),clearInterval(this.callRefTimer),this.idleTimer&&clearTimeout(this.idleTimer),this.channelzEnabled&&(0,jr.unregisterChannelzRef)(this.channelzRef),this.subchannelPool.unrefUnusedSubchannels()}getTarget(){return(0,bs.uriToString)(this.target)}getConnectivityState(e){let t=this.connectivityState;return e&&(this.resolvingLoadBalancer.exitIdle(),this.lastActivityTimestamp=new Date,this.maybeStartIdleTimer()),t}watchConnectivityState(e,t,i){if(this.connectivityState===Ct.ConnectivityState.SHUTDOWN)throw new Error("Channel has been shut down");let n=null;if(t!==1/0){let a=t instanceof Date?t:new Date(t),o=new Date;if(t===-1/0||a<=o){process.nextTick(i,new Error("Deadline passed without connectivity state change"));return}n=setTimeout(()=>{this.removeConnectivityStateWatcher(s),i(new Error("Deadline passed without connectivity state change"))},a.getTime()-o.getTime())}let s={currentState:e,callback:i,timer:n};this.connectivityStateWatchers.push(s)}getChannelzRef(){return this.channelzRef}createCall(e,t,i,n,s){if(typeof e!="string")throw new TypeError("Channel#createCall: method must be a string");if(!(typeof t=="number"||t instanceof Date))throw new TypeError("Channel#createCall: deadline must be a number or Date");if(this.connectivityState===Ct.ConnectivityState.SHUTDOWN)throw new Error("Channel has been shut down");return this.createResolvingCall(e,t,i,n,s)}};ws.InternalChannel=Ll});var za=g(As=>{"use strict";Object.defineProperty(As,"__esModule",{value:!0});As.ChannelImplementation=void 0;var c_=an(),u_=Af(),Fl=class{constructor(e,t,i){if(typeof e!="string")throw new TypeError("Channel target must be a string");if(!(t instanceof c_.ChannelCredentials))throw new TypeError("Channel credentials must be a ChannelCredentials object");if(i&&typeof i!="object")throw new TypeError("Channel options must be an object");this.internalChannel=new u_.InternalChannel(e,t,i)}close(){this.internalChannel.close()}getTarget(){return this.internalChannel.getTarget()}getConnectivityState(e){return this.internalChannel.getConnectivityState(e)}watchConnectivityState(e,t,i){this.internalChannel.watchConnectivityState(e,t,i)}getChannelzRef(){return this.internalChannel.getChannelzRef()}createCall(e,t,i,n,s){if(typeof e!="string")throw new TypeError("Channel#createCall: method must be a string");if(!(typeof t=="number"||t instanceof Date))throw new TypeError("Channel#createCall: deadline must be a number or Date");return this.internalChannel.createCall(e,t,i,n,s)}};As.ChannelImplementation=Fl});var Mf=g(Ke=>{"use strict";Object.defineProperty(Ke,"__esModule",{value:!0});Ke.ServerDuplexStreamImpl=Ke.ServerWritableStreamImpl=Ke.ServerReadableStreamImpl=Ke.ServerUnaryCallImpl=Ke.serverErrorToStatus=void 0;var d_=require("events"),Hl=require("stream"),jl=z(),Of=Re();function Gl(r,e){var t;let i={code:jl.Status.UNKNOWN,details:"message"in r?r.message:"Unknown Error",metadata:(t=e??r.metadata)!==null&&t!==void 0?t:null};return"code"in r&&typeof r.code=="number"&&Number.isInteger(r.code)&&(i.code=r.code,"details"in r&&typeof r.details=="string"&&(i.details=r.details)),i}Ke.serverErrorToStatus=Gl;var ql=class extends d_.EventEmitter{constructor(e,t,i,n){super(),this.path=e,this.call=t,this.metadata=i,this.request=n,this.cancelled=!1}getPeer(){return this.call.getPeer()}sendMetadata(e){this.call.sendMetadata(e)}getDeadline(){return this.call.getDeadline()}getPath(){return this.path}};Ke.ServerUnaryCallImpl=ql;var Bl=class extends Hl.Readable{constructor(e,t,i){super({objectMode:!0}),this.path=e,this.call=t,this.metadata=i,this.cancelled=!1}_read(e){this.call.startRead()}getPeer(){return this.call.getPeer()}sendMetadata(e){this.call.sendMetadata(e)}getDeadline(){return this.call.getDeadline()}getPath(){return this.path}};Ke.ServerReadableStreamImpl=Bl;var Ul=class extends Hl.Writable{constructor(e,t,i,n){super({objectMode:!0}),this.path=e,this.call=t,this.metadata=i,this.request=n,this.pendingStatus={code:jl.Status.OK,details:"OK"},this.cancelled=!1,this.trailingMetadata=new Of.Metadata,this.on("error",s=>{this.pendingStatus=Gl(s),this.end()})}getPeer(){return this.call.getPeer()}sendMetadata(e){this.call.sendMetadata(e)}getDeadline(){return this.call.getDeadline()}getPath(){return this.path}_write(e,t,i){this.call.sendMessage(e,i)}_final(e){var t;e(null),this.call.sendStatus(Object.assign(Object.assign({},this.pendingStatus),{metadata:(t=this.pendingStatus.metadata)!==null&&t!==void 0?t:this.trailingMetadata}))}end(e){return e&&(this.trailingMetadata=e),super.end()}};Ke.ServerWritableStreamImpl=Ul;var zl=class extends Hl.Duplex{constructor(e,t,i){super({objectMode:!0}),this.path=e,this.call=t,this.metadata=i,this.pendingStatus={code:jl.Status.OK,details:"OK"},this.cancelled=!1,this.trailingMetadata=new Of.Metadata,this.on("error",n=>{this.pendingStatus=Gl(n),this.end()})}getPeer(){return this.call.getPeer()}sendMetadata(e){this.call.sendMetadata(e)}getDeadline(){return this.call.getDeadline()}getPath(){return this.path}_read(e){this.call.startRead()}_write(e,t,i){this.call.sendMessage(e,i)}_final(e){var t;e(null),this.call.sendStatus(Object.assign(Object.assign({},this.pendingStatus),{metadata:(t=this.pendingStatus.metadata)!==null&&t!==void 0?t:this.trailingMetadata}))}end(e){return e&&(this.trailingMetadata=e),super.end()}};Ke.ServerDuplexStreamImpl=zl});var Wl=g(Os=>{"use strict";Object.defineProperty(Os,"__esModule",{value:!0});Os.ServerCredentials=void 0;var kf=sa(),Gr=class{static createInsecure(){return new Wr}static createSsl(e,t,i=!1){var n;if(e!==null&&!Buffer.isBuffer(e))throw new TypeError("rootCerts must be null or a Buffer");if(!Array.isArray(t))throw new TypeError("keyCertPairs must be an array");if(typeof i!="boolean")throw new TypeError("checkClientCertificate must be a boolean");let s=[],a=[];for(let o=0;o<t.length;o++){let l=t[o];if(l===null||typeof l!="object")throw new TypeError(`keyCertPair[${o}] must be an object`);if(!Buffer.isBuffer(l.private_key))throw new TypeError(`keyCertPair[${o}].private_key must be a Buffer`);if(!Buffer.isBuffer(l.cert_chain))throw new TypeError(`keyCertPair[${o}].cert_chain must be a Buffer`);s.push(l.cert_chain),a.push(l.private_key)}return new $r({ca:(n=e??(0,kf.getDefaultRootsData)())!==null&&n!==void 0?n:void 0,cert:s,key:a,requestCert:i,ciphers:kf.CIPHER_SUITES})}};Os.ServerCredentials=Gr;var Wr=class extends Gr{_isSecure(){return!1}_getSettings(){return null}_equals(e){return e instanceof Wr}},$r=class extends Gr{constructor(e){super(),this.options=e}_isSecure(){return!0}_getSettings(){return this.options}_equals(e){if(this===e)return!0;if(!(e instanceof $r))return!1;if(Buffer.isBuffer(this.options.ca)&&Buffer.isBuffer(e.options.ca)){if(!this.options.ca.equals(e.options.ca))return!1}else if(this.options.ca!==e.options.ca)return!1;if(Array.isArray(this.options.cert)&&Array.isArray(e.options.cert)){if(this.options.cert.length!==e.options.cert.length)return!1;for(let t=0;t<this.options.cert.length;t++){let i=this.options.cert[t],n=e.options.cert[t];if(Buffer.isBuffer(i)&&Buffer.isBuffer(n)){if(!i.equals(n))return!1}else if(i!==n)return!1}}else if(this.options.cert!==e.options.cert)return!1;if(Array.isArray(this.options.key)&&Array.isArray(e.options.key)){if(this.options.key.length!==e.options.key.length)return!1;for(let t=0;t<this.options.key.length;t++){let i=this.options.key[t],n=e.options.key[t];if(Buffer.isBuffer(i)&&Buffer.isBuffer(n)){if(!i.equals(n))return!1}else if(i!==n)return!1}}else if(this.options.key!==e.options.key)return!1;return this.options.requestCert===e.options.requestCert}}});var Zl=g(ke=>{"use strict";Object.defineProperty(ke,"__esModule",{value:!0});ke.getServerInterceptingCall=ke.BaseServerInterceptingCall=ke.ServerInterceptingCall=ke.ResponderBuilder=ke.isInterceptingServerListener=ke.ServerListenerBuilder=void 0;var Nf=Re(),Me=z(),nr=require("http2"),Pf=en(),If=require("zlib"),h_=cl(),Ff=te(),qf="server_call";function vi(r){Ff.trace(Me.LogVerbosity.DEBUG,qf,r)}var Vl=class{constructor(){this.metadata=void 0,this.message=void 0,this.halfClose=void 0,this.cancel=void 0}withOnReceiveMetadata(e){return this.metadata=e,this}withOnReceiveMessage(e){return this.message=e,this}withOnReceiveHalfClose(e){return this.halfClose=e,this}withOnCancel(e){return this.cancel=e,this}build(){return{onReceiveMetadata:this.metadata,onReceiveMessage:this.message,onReceiveHalfClose:this.halfClose,onCancel:this.cancel}}};ke.ServerListenerBuilder=Vl;function f_(r){return r.onReceiveMetadata!==void 0&&r.onReceiveMetadata.length===1}ke.isInterceptingServerListener=f_;var Yl=class{constructor(e,t){this.listener=e,this.nextListener=t,this.cancelled=!1,this.processingMetadata=!1,this.hasPendingMessage=!1,this.pendingMessage=null,this.processingMessage=!1,this.hasPendingHalfClose=!1}processPendingMessage(){this.hasPendingMessage&&(this.nextListener.onReceiveMessage(this.pendingMessage),this.pendingMessage=null,this.hasPendingMessage=!1)}processPendingHalfClose(){this.hasPendingHalfClose&&(this.nextListener.onReceiveHalfClose(),this.hasPendingHalfClose=!1)}onReceiveMetadata(e){this.cancelled||(this.processingMetadata=!0,this.listener.onReceiveMetadata(e,t=>{this.processingMetadata=!1,!this.cancelled&&(this.nextListener.onReceiveMetadata(t),this.processPendingMessage(),this.processPendingHalfClose())}))}onReceiveMessage(e){this.cancelled||(this.processingMessage=!0,this.listener.onReceiveMessage(e,t=>{this.processingMessage=!1,!this.cancelled&&(this.processingMetadata?(this.pendingMessage=t,this.hasPendingMessage=!0):(this.nextListener.onReceiveMessage(t),this.processPendingHalfClose()))}))}onReceiveHalfClose(){this.cancelled||this.listener.onReceiveHalfClose(()=>{this.cancelled||(this.processingMetadata||this.processingMessage?this.hasPendingHalfClose=!0:this.nextListener.onReceiveHalfClose())})}onCancel(){this.cancelled=!0,this.listener.onCancel(),this.nextListener.onCancel()}},Kl=class{constructor(){this.start=void 0,this.metadata=void 0,this.message=void 0,this.status=void 0}withStart(e){return this.start=e,this}withSendMetadata(e){return this.metadata=e,this}withSendMessage(e){return this.message=e,this}withSendStatus(e){return this.status=e,this}build(){return{start:this.start,sendMetadata:this.metadata,sendMessage:this.message,sendStatus:this.status}}};ke.ResponderBuilder=Kl;var Ms={onReceiveMetadata:(r,e)=>{e(r)},onReceiveMessage:(r,e)=>{e(r)},onReceiveHalfClose:r=>{r()},onCancel:()=>{}},ks={start:r=>{r()},sendMetadata:(r,e)=>{e(r)},sendMessage:(r,e)=>{e(r)},sendStatus:(r,e)=>{e(r)}},Jl=class{constructor(e,t){var i,n,s,a;this.nextCall=e,this.processingMetadata=!1,this.processingMessage=!1,this.pendingMessage=null,this.pendingMessageCallback=null,this.pendingStatus=null,this.responder={start:(i=t?.start)!==null&&i!==void 0?i:ks.start,sendMetadata:(n=t?.sendMetadata)!==null&&n!==void 0?n:ks.sendMetadata,sendMessage:(s=t?.sendMessage)!==null&&s!==void 0?s:ks.sendMessage,sendStatus:(a=t?.sendStatus)!==null&&a!==void 0?a:ks.sendStatus}}processPendingMessage(){this.pendingMessageCallback&&(this.nextCall.sendMessage(this.pendingMessage,this.pendingMessageCallback),this.pendingMessage=null,this.pendingMessageCallback=null)}processPendingStatus(){this.pendingStatus&&(this.nextCall.sendStatus(this.pendingStatus),this.pendingStatus=null)}start(e){this.responder.start(t=>{var i,n,s,a;let o={onReceiveMetadata:(i=t?.onReceiveMetadata)!==null&&i!==void 0?i:Ms.onReceiveMetadata,onReceiveMessage:(n=t?.onReceiveMessage)!==null&&n!==void 0?n:Ms.onReceiveMessage,onReceiveHalfClose:(s=t?.onReceiveHalfClose)!==null&&s!==void 0?s:Ms.onReceiveHalfClose,onCancel:(a=t?.onCancel)!==null&&a!==void 0?a:Ms.onCancel},l=new Yl(o,e);this.nextCall.start(l)})}sendMetadata(e){this.processingMetadata=!0,this.responder.sendMetadata(e,t=>{this.processingMetadata=!1,this.nextCall.sendMetadata(t),this.processPendingMessage(),this.processPendingStatus()})}sendMessage(e,t){this.processingMessage=!0,this.responder.sendMessage(e,i=>{this.processingMessage=!1,this.processingMetadata?(this.pendingMessage=i,this.pendingMessageCallback=t):this.nextCall.sendMessage(i,t)})}sendStatus(e){this.responder.sendStatus(e,t=>{this.processingMetadata||this.processingMessage?this.pendingStatus=t:this.nextCall.sendStatus(t)})}startRead(){this.nextCall.startRead()}getPeer(){return this.nextCall.getPeer()}getDeadline(){return this.nextCall.getDeadline()}};ke.ServerInterceptingCall=Jl;var Bf="grpc-accept-encoding",Xl="grpc-encoding",xf="grpc-message",Df="grpc-status",$l="grpc-timeout",p_=/(\d{1,8})\s*([HMSmun])/,g_={H:36e5,M:6e4,S:1e3,m:1,u:.001,n:1e-6},m_={[Bf]:"identity,deflate,gzip",[Xl]:"identity"},Lf={[nr.constants.HTTP2_HEADER_STATUS]:nr.constants.HTTP_STATUS_OK,[nr.constants.HTTP2_HEADER_CONTENT_TYPE]:"application/grpc+proto"},v_={waitForTrailers:!0},Ns=class{constructor(e,t,i,n,s){this.stream=e,this.callEventTracker=i,this.handler=n,this.listener=null,this.deadlineTimer=null,this.deadline=1/0,this.maxSendMessageSize=Me.DEFAULT_MAX_SEND_MESSAGE_LENGTH,this.maxReceiveMessageSize=Me.DEFAULT_MAX_RECEIVE_MESSAGE_LENGTH,this.cancelled=!1,this.metadataSent=!1,this.wantTrailers=!1,this.cancelNotified=!1,this.incomingEncoding="identity",this.readQueue=[],this.isReadPending=!1,this.receivedHalfClose=!1,this.streamEnded=!1,this.stream.once("error",c=>{}),this.stream.once("close",()=>{var c;vi("Request to method "+((c=this.handler)===null||c===void 0?void 0:c.path)+" stream closed with rstCode "+this.stream.rstCode),this.callEventTracker&&!this.streamEnded&&(this.streamEnded=!0,this.callEventTracker.onStreamEnd(!1),this.callEventTracker.onCallEnd({code:Me.Status.CANCELLED,details:"Stream closed before sending status",metadata:null})),this.notifyOnCancel()}),this.stream.on("data",c=>{this.handleDataFrame(c)}),this.stream.pause(),this.stream.on("end",()=>{this.handleEndEvent()}),"grpc.max_send_message_length"in s&&(this.maxSendMessageSize=s["grpc.max_send_message_length"]),"grpc.max_receive_message_length"in s&&(this.maxReceiveMessageSize=s["grpc.max_receive_message_length"]),this.decoder=new h_.StreamDecoder(this.maxReceiveMessageSize);let a=Nf.Metadata.fromHttp2Headers(t);Ff.isTracerEnabled(qf)&&vi("Request to "+this.handler.path+" received headers "+JSON.stringify(a.toJSON()));let o=a.get($l);o.length>0&&this.handleTimeoutHeader(o[0]);let l=a.get(Xl);l.length>0&&(this.incomingEncoding=l[0]),a.remove($l),a.remove(Xl),a.remove(Bf),a.remove(nr.constants.HTTP2_HEADER_ACCEPT_ENCODING),a.remove(nr.constants.HTTP2_HEADER_TE),a.remove(nr.constants.HTTP2_HEADER_CONTENT_TYPE),this.metadata=a}handleTimeoutHeader(e){let t=e.toString().match(p_);if(t===null){let s={code:Me.Status.INTERNAL,details:`Invalid ${$l} value "${e}"`,metadata:null};process.nextTick(()=>{this.sendStatus(s)});return}let i=+t[1]*g_[t[2]]|0,n=new Date;this.deadline=n.setMilliseconds(n.getMilliseconds()+i),this.deadlineTimer=setTimeout(()=>{let s={code:Me.Status.DEADLINE_EXCEEDED,details:"Deadline exceeded",metadata:null};this.sendStatus(s)},i)}checkCancelled(){return!this.cancelled&&(this.stream.destroyed||this.stream.closed)&&(this.notifyOnCancel(),this.cancelled=!0),this.cancelled}notifyOnCancel(){this.cancelNotified||(this.cancelNotified=!0,this.cancelled=!0,process.nextTick(()=>{var e;(e=this.listener)===null||e===void 0||e.onCancel()}),this.deadlineTimer&&clearTimeout(this.deadlineTimer),this.stream.resume())}maybeSendMetadata(){this.metadataSent||this.sendMetadata(new Nf.Metadata)}serializeMessage(e){let t=this.handler.serialize(e),i=t.byteLength,n=Buffer.allocUnsafe(i+5);return n.writeUInt8(0,0),n.writeUInt32BE(i,1),t.copy(n,5),n}decompressMessage(e,t){let i=e.subarray(5);if(t==="identity")return i;if(t==="deflate"||t==="gzip"){let n;return t==="deflate"?n=If.createInflate():n=If.createGunzip(),new Promise((s,a)=>{let o=0,l=[];n.on("data",c=>{l.push(c),o+=c.byteLength,this.maxReceiveMessageSize!==-1&&o>this.maxReceiveMessageSize&&(n.destroy(),a({code:Me.Status.RESOURCE_EXHAUSTED,details:`Received message that decompresses to a size larger than ${this.maxReceiveMessageSize}`}))}),n.on("end",()=>{s(Buffer.concat(l))}),n.write(i),n.end()})}else return Promise.reject({code:Me.Status.UNIMPLEMENTED,details:`Received message compressed with unsupported encoding "${t}"`})}async decompressAndMaybePush(e){if(e.type!=="COMPRESSED")throw new Error(`Invalid queue entry type: ${e.type}`);let i=e.compressedMessage.readUInt8(0)===1?this.incomingEncoding:"identity",n;try{n=await this.decompressMessage(e.compressedMessage,i)}catch(s){this.sendStatus(s);return}try{e.parsedMessage=this.handler.deserialize(n)}catch(s){this.sendStatus({code:Me.Status.INTERNAL,details:`Error deserializing request: ${s.message}`});return}e.type="READABLE",this.maybePushNextMessage()}maybePushNextMessage(){if(this.listener&&this.isReadPending&&this.readQueue.length>0&&this.readQueue[0].type!=="COMPRESSED"){this.isReadPending=!1;let e=this.readQueue.shift();e.type==="READABLE"?this.listener.onReceiveMessage(e.parsedMessage):this.listener.onReceiveHalfClose()}}handleDataFrame(e){var t;if(this.checkCancelled())return;vi("Request to "+this.handler.path+" received data frame of size "+e.length);let i;try{i=this.decoder.write(e)}catch(n){this.sendStatus({code:Me.Status.RESOURCE_EXHAUSTED,details:n.message});return}for(let n of i){this.stream.pause();let s={type:"COMPRESSED",compressedMessage:n,parsedMessage:null};this.readQueue.push(s),this.decompressAndMaybePush(s),(t=this.callEventTracker)===null||t===void 0||t.addMessageReceived()}}handleEndEvent(){this.readQueue.push({type:"HALF_CLOSE",compressedMessage:null,parsedMessage:null}),this.receivedHalfClose=!0,this.maybePushNextMessage()}start(e){vi("Request to "+this.handler.path+" start called"),!this.checkCancelled()&&(this.listener=e,e.onReceiveMetadata(this.metadata))}sendMetadata(e){if(this.checkCancelled()||this.metadataSent)return;this.metadataSent=!0;let t=e?e.toHttp2Headers():null,i=Object.assign(Object.assign(Object.assign({},Lf),m_),t);this.stream.respond(i,v_)}sendMessage(e,t){if(this.checkCancelled())return;let i;try{i=this.serializeMessage(e)}catch(n){this.sendStatus({code:Me.Status.INTERNAL,details:`Error serializing response: ${(0,Pf.getErrorMessage)(n)}`,metadata:null});return}if(this.maxSendMessageSize!==-1&&i.length-5>this.maxSendMessageSize){this.sendStatus({code:Me.Status.RESOURCE_EXHAUSTED,details:`Sent message larger than max (${i.length} vs. ${this.maxSendMessageSize})`,metadata:null});return}this.maybeSendMetadata(),vi("Request to "+this.handler.path+" sent data frame of size "+i.length),this.stream.write(i,n=>{var s;if(n){this.sendStatus({code:Me.Status.INTERNAL,details:`Error writing message: ${(0,Pf.getErrorMessage)(n)}`,metadata:null});return}(s=this.callEventTracker)===null||s===void 0||s.addMessageSent(),t()})}sendStatus(e){var t,i;if(!this.checkCancelled())if(vi("Request to method "+((t=this.handler)===null||t===void 0?void 0:t.path)+" ended with status code: "+Me.Status[e.code]+" details: "+e.details),this.metadataSent)this.wantTrailers?this.notifyOnCancel():(this.wantTrailers=!0,this.stream.once("wantTrailers",()=>{var n;this.callEventTracker&&!this.streamEnded&&(this.streamEnded=!0,this.callEventTracker.onStreamEnd(!0),this.callEventTracker.onCallEnd(e));let s=Object.assign({[Df]:e.code,[xf]:encodeURI(e.details)},(n=e.metadata)===null||n===void 0?void 0:n.toHttp2Headers());this.stream.sendTrailers(s),this.notifyOnCancel()}),this.stream.end());else{this.callEventTracker&&!this.streamEnded&&(this.streamEnded=!0,this.callEventTracker.onStreamEnd(!0),this.callEventTracker.onCallEnd(e));let n=Object.assign(Object.assign({[Df]:e.code,[xf]:encodeURI(e.details)},Lf),(i=e.metadata)===null||i===void 0?void 0:i.toHttp2Headers());this.stream.respond(n,{endStream:!0}),this.notifyOnCancel()}}startRead(){vi("Request to "+this.handler.path+" startRead called"),!this.checkCancelled()&&(this.isReadPending=!0,this.readQueue.length===0?this.receivedHalfClose||this.stream.resume():this.maybePushNextMessage())}getPeer(){var e;let t=(e=this.stream.session)===null||e===void 0?void 0:e.socket;return t?.remoteAddress?t.remotePort?`${t.remoteAddress}:${t.remotePort}`:t.remoteAddress:"unknown"}getDeadline(){return this.deadline}};ke.BaseServerInterceptingCall=Ns;function y_(r,e,t,i,n,s){let a={path:n.path,requestStream:n.type==="clientStream"||n.type==="bidi",responseStream:n.type==="serverStream"||n.type==="bidi",requestDeserialize:n.deserialize,responseSerialize:n.serialize},o=new Ns(e,t,i,n,s);return r.reduce((l,c)=>c(a,l),o)}ke.getServerInterceptingCall=y_});var Wf=g(Qt=>{"use strict";var S_=Qt&&Qt.__runInitializers||function(r,e,t){for(var i=arguments.length>2,n=0;n<e.length;n++)t=i?e[n].call(r,t):e[n].call(r);return i?t:void 0},__=Qt&&Qt.__esDecorate||function(r,e,t,i,n,s){function a(S){if(S!==void 0&&typeof S!="function")throw new TypeError("Function expected");return S}for(var o=i.kind,l=o==="getter"?"get":o==="setter"?"set":"value",c=!e&&r?i.static?r:r.prototype:null,u=e||(c?Object.getOwnPropertyDescriptor(c,i.name):{}),h,f=!1,p=t.length-1;p>=0;p--){var E={};for(var m in i)E[m]=m==="access"?{}:i[m];for(var m in i.access)E.access[m]=i.access[m];E.addInitializer=function(S){if(f)throw new TypeError("Cannot add initializers after decoration has completed");s.push(a(S||null))};var b=(0,t[p])(o==="accessor"?{get:u.get,set:u.set}:u[l],E);if(o==="accessor"){if(b===void 0)continue;if(b===null||typeof b!="object")throw new TypeError("Object expected");(h=a(b.get))&&(u.get=h),(h=a(b.set))&&(u.set=h),(h=a(b.init))&&n.unshift(h)}else(h=a(b))&&(o==="field"?n.unshift(h):u[l]=h)}c&&Object.defineProperty(c,i.name,u),f=!0};Object.defineProperty(Qt,"__esModule",{value:!0});Qt.Server=void 0;var Le=require("http2"),C_=require("util"),de=z(),ar=Mf(),T_=Wl(),Uf=ot(),Ps=te(),Zt=Xe(),st=Pe(),ye=fi(),zf=Zl(),sr=~(1<<31),Ql=~(1<<31),E_=2e4,Hf=~(1<<31),{HTTP2_HEADER_PATH:jf}=Le.constants,b_="server",Gf=Buffer.from("max_age");function R_(){}function w_(r){return function(e,t){return C_.deprecate(e,r)}}function ec(r){return{code:de.Status.UNIMPLEMENTED,details:`The server does not implement the method ${r}`}}function A_(r,e){let t=ec(e);switch(r){case"unary":return(i,n)=>{n(t,null)};case"clientStream":return(i,n)=>{n(t,null)};case"serverStream":return i=>{i.emit("error",t)};case"bidi":return i=>{i.emit("error",t)};default:throw new Error(`Invalid handlerType ${r}`)}}var O_=(()=>{var r;let e=[],t;return r=class{constructor(n){var s,a,o,l,c,u;this.boundPorts=(S_(this,e),new Map),this.http2Servers=new Map,this.sessionIdleTimeouts=new Map,this.handlers=new Map,this.sessions=new Map,this.started=!1,this.shutdown=!1,this.serverAddressString="null",this.channelzEnabled=!0,this.options=n??{},this.options["grpc.enable_channelz"]===0?(this.channelzEnabled=!1,this.channelzTrace=new ye.ChannelzTraceStub,this.callTracker=new ye.ChannelzCallTrackerStub,this.listenerChildrenTracker=new ye.ChannelzChildrenTrackerStub,this.sessionChildrenTracker=new ye.ChannelzChildrenTrackerStub):(this.channelzTrace=new ye.ChannelzTrace,this.callTracker=new ye.ChannelzCallTracker,this.listenerChildrenTracker=new ye.ChannelzChildrenTracker,this.sessionChildrenTracker=new ye.ChannelzChildrenTracker),this.channelzRef=(0,ye.registerChannelzServer)("server",()=>this.getChannelzInfo(),this.channelzEnabled),this.channelzTrace.addTrace("CT_INFO","Server created"),this.maxConnectionAgeMs=(s=this.options["grpc.max_connection_age_ms"])!==null&&s!==void 0?s:sr,this.maxConnectionAgeGraceMs=(a=this.options["grpc.max_connection_age_grace_ms"])!==null&&a!==void 0?a:sr,this.keepaliveTimeMs=(o=this.options["grpc.keepalive_time_ms"])!==null&&o!==void 0?o:Ql,this.keepaliveTimeoutMs=(l=this.options["grpc.keepalive_timeout_ms"])!==null&&l!==void 0?l:E_,this.sessionIdleTimeout=(c=this.options["grpc.max_connection_idle_ms"])!==null&&c!==void 0?c:Hf,this.commonServerOptions={maxSendHeaderBlockLength:Number.MAX_SAFE_INTEGER},"grpc-node.max_session_memory"in this.options?this.commonServerOptions.maxSessionMemory=this.options["grpc-node.max_session_memory"]:this.commonServerOptions.maxSessionMemory=Number.MAX_SAFE_INTEGER,"grpc.max_concurrent_streams"in this.options&&(this.commonServerOptions.settings={maxConcurrentStreams:this.options["grpc.max_concurrent_streams"]}),this.interceptors=(u=this.options.interceptors)!==null&&u!==void 0?u:[],this.trace("Server constructed")}getChannelzInfo(){return{trace:this.channelzTrace,callTracker:this.callTracker,listenerChildren:this.listenerChildrenTracker.getChildLists(),sessionChildren:this.sessionChildrenTracker.getChildLists()}}getChannelzSessionInfo(n){var s,a,o;let l=this.sessions.get(n),c=n.socket,u=c.remoteAddress?(0,Zt.stringToSubchannelAddress)(c.remoteAddress,c.remotePort):null,h=c.localAddress?(0,Zt.stringToSubchannelAddress)(c.localAddress,c.localPort):null,f;if(n.encrypted){let E=c,m=E.getCipher(),b=E.getCertificate(),S=E.getPeerCertificate();f={cipherSuiteStandardName:(s=m.standardName)!==null&&s!==void 0?s:null,cipherSuiteOtherName:m.standardName?null:m.name,localCertificate:b&&"raw"in b?b.raw:null,remoteCertificate:S&&"raw"in S?S.raw:null}}else f=null;return{remoteAddress:u,localAddress:h,security:f,remoteName:null,streamsStarted:l.streamTracker.callsStarted,streamsSucceeded:l.streamTracker.callsSucceeded,streamsFailed:l.streamTracker.callsFailed,messagesSent:l.messagesSent,messagesReceived:l.messagesReceived,keepAlivesSent:l.keepAlivesSent,lastLocalStreamCreatedTimestamp:null,lastRemoteStreamCreatedTimestamp:l.streamTracker.lastCallStartedTimestamp,lastMessageSentTimestamp:l.lastMessageSentTimestamp,lastMessageReceivedTimestamp:l.lastMessageReceivedTimestamp,localFlowControlWindow:(a=n.state.localWindowSize)!==null&&a!==void 0?a:null,remoteFlowControlWindow:(o=n.state.remoteWindowSize)!==null&&o!==void 0?o:null}}trace(n){Ps.trace(de.LogVerbosity.DEBUG,b_,"("+this.channelzRef.id+") "+n)}keepaliveTrace(n){Ps.trace(de.LogVerbosity.DEBUG,"keepalive","("+this.channelzRef.id+") "+n)}addProtoService(){throw new Error("Not implemented. Use addService() instead")}addService(n,s){if(n===null||typeof n!="object"||s===null||typeof s!="object")throw new Error("addService() requires two objects as arguments");let a=Object.keys(n);if(a.length===0)throw new Error("Cannot add an empty service to a server");a.forEach(o=>{let l=n[o],c;l.requestStream?l.responseStream?c="bidi":c="clientStream":l.responseStream?c="serverStream":c="unary";let u=s[o],h;if(u===void 0&&typeof l.originalName=="string"&&(u=s[l.originalName]),u!==void 0?h=u.bind(s):h=A_(c,o),this.register(l.path,h,l.responseSerialize,l.requestDeserialize,c)===!1)throw new Error(`Method handler for ${l.path} already provided.`)})}removeService(n){if(n===null||typeof n!="object")throw new Error("removeService() requires object as argument");Object.keys(n).forEach(a=>{let o=n[a];this.unregister(o.path)})}bind(n,s){throw new Error("Not implemented. Use bindAsync() instead")}registerListenerToChannelz(n){return(0,ye.registerChannelzSocket)((0,Zt.subchannelAddressToString)(n),()=>({localAddress:n,remoteAddress:null,security:null,remoteName:null,streamsStarted:0,streamsSucceeded:0,streamsFailed:0,messagesSent:0,messagesReceived:0,keepAlivesSent:0,lastLocalStreamCreatedTimestamp:null,lastRemoteStreamCreatedTimestamp:null,lastMessageSentTimestamp:null,lastMessageReceivedTimestamp:null,localFlowControlWindow:null,remoteFlowControlWindow:null}),this.channelzEnabled)}createHttp2Server(n){let s;if(n._isSecure()){let a=Object.assign(this.commonServerOptions,n._getSettings());a.enableTrace=this.options["grpc-node.tls_enable_trace"]===1,s=Le.createSecureServer(a),s.on("secureConnection",o=>{o.on("error",l=>{this.trace("An incoming TLS connection closed with error: "+l.message)})})}else s=Le.createServer(this.commonServerOptions);return s.setTimeout(0,R_),this._setupHandlers(s),s}bindOneAddress(n,s){this.trace("Attempting to bind "+(0,Zt.subchannelAddressToString)(n));let a=this.createHttp2Server(s.credentials);return new Promise((o,l)=>{let c=u=>{this.trace("Failed to bind "+(0,Zt.subchannelAddressToString)(n)+" with error "+u.message),o({port:"port"in n?n.port:1,error:u.message})};a.once("error",c),a.listen(n,()=>{let u=a.address(),h;typeof u=="string"?h={path:u}:h={host:u.address,port:u.port};let f=this.registerListenerToChannelz(h);this.listenerChildrenTracker.refChild(f),this.http2Servers.set(a,{channelzRef:f,sessions:new Set}),s.listeningServers.add(a),this.trace("Successfully bound "+(0,Zt.subchannelAddressToString)(h)),o({port:"port"in h?h.port:1}),a.removeListener("error",c)})})}async bindManyPorts(n,s){if(n.length===0)return{count:0,port:0,errors:[]};if((0,Zt.isTcpSubchannelAddress)(n[0])&&n[0].port===0){let a=await this.bindOneAddress(n[0],s);if(a.error){let o=await this.bindManyPorts(n.slice(1),s);return Object.assign(Object.assign({},o),{errors:[a.error,...o.errors]})}else{let o=n.slice(1).map(u=>(0,Zt.isTcpSubchannelAddress)(u)?{host:u.host,port:a.port}:u),l=await Promise.all(o.map(u=>this.bindOneAddress(u,s))),c=[a,...l];return{count:c.filter(u=>u.error===void 0).length,port:a.port,errors:c.filter(u=>u.error).map(u=>u.error)}}}else{let a=await Promise.all(n.map(o=>this.bindOneAddress(o,s)));return{count:a.filter(o=>o.error===void 0).length,port:a[0].port,errors:a.filter(o=>o.error).map(o=>o.error)}}}async bindAddressList(n,s){let a=await this.bindManyPorts(n,s);if(a.count>0)return a.count<n.length&&Ps.log(de.LogVerbosity.INFO,`WARNING Only ${a.count} addresses added out of total ${n.length} resolved`),a.port;{let o=`No address added out of total ${n.length} resolved`;throw Ps.log(de.LogVerbosity.ERROR,o),new Error(`${o} errors: [${a.errors.join(",")}]`)}}resolvePort(n){return new Promise((s,a)=>{let o={onSuccessfulResolution:(c,u,h)=>{o.onSuccessfulResolution=()=>{};let f=[].concat(...c.map(p=>p.addresses));if(f.length===0){a(new Error(`No addresses resolved for port ${n}`));return}s(f)},onError:c=>{a(new Error(c.details))}};(0,Uf.createResolver)(n,o,this.options).updateResolution()})}async bindPort(n,s){let a=await this.resolvePort(n);if(s.cancelled)throw this.completeUnbind(s),new Error("bindAsync operation cancelled by unbind call");let o=await this.bindAddressList(a,s);if(s.cancelled)throw this.completeUnbind(s),new Error("bindAsync operation cancelled by unbind call");return o}normalizePort(n){let s=(0,st.parseUri)(n);if(s===null)throw new Error(`Could not parse port "${n}"`);let a=(0,Uf.mapUriDefaultScheme)(s);if(a===null)throw new Error(`Could not get a default scheme for port "${n}"`);return a}bindAsync(n,s,a){if(this.shutdown)throw new Error("bindAsync called after shutdown");if(typeof n!="string")throw new TypeError("port must be a string");if(s===null||!(s instanceof T_.ServerCredentials))throw new TypeError("creds must be a ServerCredentials object");if(typeof a!="function")throw new TypeError("callback must be a function");this.trace("bindAsync port="+n);let o=this.normalizePort(n),l=(f,p)=>{process.nextTick(()=>a(f,p))},c=this.boundPorts.get((0,st.uriToString)(o));if(c){if(!s._equals(c.credentials)){l(new Error(`${n} already bound with incompatible credentials`),0);return}c.cancelled=!1,c.completionPromise?c.completionPromise.then(f=>a(null,f),f=>a(f,0)):l(null,c.portNumber);return}c={mapKey:(0,st.uriToString)(o),originalUri:o,completionPromise:null,cancelled:!1,portNumber:0,credentials:s,listeningServers:new Set};let u=(0,st.splitHostPort)(o.path),h=this.bindPort(o,c);c.completionPromise=h,u?.port===0?h.then(f=>{let p={scheme:o.scheme,authority:o.authority,path:(0,st.combineHostPort)({host:u.host,port:f})};c.mapKey=(0,st.uriToString)(p),c.completionPromise=null,c.portNumber=f,this.boundPorts.set(c.mapKey,c),a(null,f)},f=>{a(f,0)}):(this.boundPorts.set(c.mapKey,c),h.then(f=>{c.completionPromise=null,c.portNumber=f,a(null,f)},f=>{a(f,0)}))}closeServer(n,s){this.trace("Closing server with address "+JSON.stringify(n.address()));let a=this.http2Servers.get(n);n.close(()=>{a&&(this.listenerChildrenTracker.unrefChild(a.channelzRef),(0,ye.unregisterChannelzRef)(a.channelzRef)),this.http2Servers.delete(n),s?.()})}closeSession(n,s){var a;this.trace("Closing session initiated by "+((a=n.socket)===null||a===void 0?void 0:a.remoteAddress));let o=this.sessions.get(n),l=()=>{o&&(this.sessionChildrenTracker.unrefChild(o.ref),(0,ye.unregisterChannelzRef)(o.ref)),s?.()};n.closed?queueMicrotask(l):n.close(l)}completeUnbind(n){for(let s of n.listeningServers){let a=this.http2Servers.get(s);if(this.closeServer(s,()=>{n.listeningServers.delete(s)}),a)for(let o of a.sessions)this.closeSession(o)}this.boundPorts.delete(n.mapKey)}unbind(n){this.trace("unbind port="+n);let s=this.normalizePort(n),a=(0,st.splitHostPort)(s.path);if(a?.port===0)throw new Error("Cannot unbind port 0");let o=this.boundPorts.get((0,st.uriToString)(s));o&&(this.trace("unbinding "+o.mapKey+" originally bound as "+(0,st.uriToString)(o.originalUri)),o.completionPromise?o.cancelled=!0:this.completeUnbind(o))}drain(n,s){var a,o;this.trace("drain port="+n+" graceTimeMs="+s);let l=this.normalizePort(n),c=(0,st.splitHostPort)(l.path);if(c?.port===0)throw new Error("Cannot drain port 0");let u=this.boundPorts.get((0,st.uriToString)(l));if(!u)return;let h=new Set;for(let f of u.listeningServers){let p=this.http2Servers.get(f);if(p)for(let E of p.sessions)h.add(E),this.closeSession(E,()=>{h.delete(E)})}(o=(a=setTimeout(()=>{for(let f of h)f.destroy(Le.constants.NGHTTP2_CANCEL)},s)).unref)===null||o===void 0||o.call(a)}forceShutdown(){for(let n of this.boundPorts.values())n.cancelled=!0;this.boundPorts.clear();for(let n of this.http2Servers.keys())this.closeServer(n);this.sessions.forEach((n,s)=>{this.closeSession(s),s.destroy(Le.constants.NGHTTP2_CANCEL)}),this.sessions.clear(),(0,ye.unregisterChannelzRef)(this.channelzRef),this.shutdown=!0}register(n,s,a,o,l){return this.handlers.has(n)?!1:(this.handlers.set(n,{func:s,serialize:a,deserialize:o,type:l,path:n}),!0)}unregister(n){return this.handlers.delete(n)}start(){if(this.http2Servers.size===0||[...this.http2Servers.keys()].every(n=>!n.listening))throw new Error("server must be bound in order to start");if(this.started===!0)throw new Error("server is already started");this.started=!0}tryShutdown(n){var s;let a=c=>{(0,ye.unregisterChannelzRef)(this.channelzRef),n(c)},o=0;function l(){o--,o===0&&a()}this.shutdown=!0;for(let[c,u]of this.http2Servers.entries()){o++;let h=u.channelzRef.name;this.trace("Waiting for server "+h+" to close"),this.closeServer(c,()=>{this.trace("Server "+h+" finished closing"),l()});for(let f of u.sessions.keys()){o++;let p=(s=f.socket)===null||s===void 0?void 0:s.remoteAddress;this.trace("Waiting for session "+p+" to close"),this.closeSession(f,()=>{this.trace("Session "+p+" finished closing"),l()})}}o===0&&a()}addHttp2Port(){throw new Error("Not yet implemented")}getChannelzRef(){return this.channelzRef}_verifyContentType(n,s){let a=s[Le.constants.HTTP2_HEADER_CONTENT_TYPE];return typeof a!="string"||!a.startsWith("application/grpc")?(n.respond({[Le.constants.HTTP2_HEADER_STATUS]:Le.constants.HTTP_STATUS_UNSUPPORTED_MEDIA_TYPE},{endStream:!0}),!1):!0}_retrieveHandler(n){this.trace("Received call to method "+n+" at address "+this.serverAddressString);let s=this.handlers.get(n);return s===void 0?(this.trace("No handler registered for method "+n+". Sending UNIMPLEMENTED status."),null):s}_respondWithError(n,s,a=null){var o,l;let c=Object.assign({"grpc-status":(o=n.code)!==null&&o!==void 0?o:de.Status.INTERNAL,"grpc-message":n.details,[Le.constants.HTTP2_HEADER_STATUS]:Le.constants.HTTP_STATUS_OK,[Le.constants.HTTP2_HEADER_CONTENT_TYPE]:"application/grpc+proto"},(l=n.metadata)===null||l===void 0?void 0:l.toHttp2Headers());s.respond(c,{endStream:!0}),this.callTracker.addCallFailed(),a?.streamTracker.addCallFailed()}_channelzHandler(n,s){this.onStreamOpened(n);let a=this.sessions.get(n.session);if(this.callTracker.addCallStarted(),a?.streamTracker.addCallStarted(),!this._verifyContentType(n,s)){this.callTracker.addCallFailed(),a?.streamTracker.addCallFailed();return}let o=s[jf],l=this._retrieveHandler(o);if(!l){this._respondWithError(ec(o),n,a);return}let c={addMessageSent:()=>{a&&(a.messagesSent+=1,a.lastMessageSentTimestamp=new Date)},addMessageReceived:()=>{a&&(a.messagesReceived+=1,a.lastMessageReceivedTimestamp=new Date)},onCallEnd:h=>{h.code===de.Status.OK?this.callTracker.addCallSucceeded():this.callTracker.addCallFailed()},onStreamEnd:h=>{a&&(h?a.streamTracker.addCallSucceeded():a.streamTracker.addCallFailed())}},u=(0,zf.getServerInterceptingCall)(this.interceptors,n,s,c,l,this.options);this._runHandlerForCall(u,l)||(this.callTracker.addCallFailed(),a?.streamTracker.addCallFailed(),u.sendStatus({code:de.Status.INTERNAL,details:`Unknown handler type: ${l.type}`}))}_streamHandler(n,s){if(this.onStreamOpened(n),this._verifyContentType(n,s)!==!0)return;let a=s[jf],o=this._retrieveHandler(a);if(!o){this._respondWithError(ec(a),n,null);return}let l=(0,zf.getServerInterceptingCall)(this.interceptors,n,s,null,o,this.options);this._runHandlerForCall(l,o)||l.sendStatus({code:de.Status.INTERNAL,details:`Unknown handler type: ${o.type}`})}_runHandlerForCall(n,s){let{type:a}=s;if(a==="unary")M_(n,s);else if(a==="clientStream")k_(n,s);else if(a==="serverStream")N_(n,s);else if(a==="bidi")P_(n,s);else return!1;return!0}_setupHandlers(n){if(n===null)return;let s=n.address(),a="null";s&&(typeof s=="string"?a=s:a=s.address+":"+s.port),this.serverAddressString=a;let o=this.channelzEnabled?this._channelzHandler:this._streamHandler,l=this.channelzEnabled?this._channelzSessionHandler(n):this._sessionHandler(n);n.on("stream",o.bind(this)),n.on("session",l)}_sessionHandler(n){return s=>{var a,o;(a=this.http2Servers.get(n))===null||a===void 0||a.sessions.add(s);let l=null,c=null,u=null,h=!1,f=this.enableIdleTimeout(s);if(this.maxConnectionAgeMs!==sr){let S=this.maxConnectionAgeMs/10,T=Math.random()*S*2-S;l=setTimeout(()=>{var k,w;h=!0,this.trace("Connection dropped by max connection age: "+((k=s.socket)===null||k===void 0?void 0:k.remoteAddress));try{s.goaway(Le.constants.NGHTTP2_NO_ERROR,~(1<<31),Gf)}catch{s.destroy();return}s.close(),this.maxConnectionAgeGraceMs!==sr&&(c=setTimeout(()=>{s.destroy()},this.maxConnectionAgeGraceMs),(w=c.unref)===null||w===void 0||w.call(c))},this.maxConnectionAgeMs+T),(o=l.unref)===null||o===void 0||o.call(l)}let p=()=>{u&&(clearTimeout(u),u=null)},E=()=>!s.destroyed&&this.keepaliveTimeMs<Ql&&this.keepaliveTimeMs>0,m,b=()=>{var S;E()&&(this.keepaliveTrace("Starting keepalive timer for "+this.keepaliveTimeMs+"ms"),u=setTimeout(()=>{p(),m()},this.keepaliveTimeMs),(S=u.unref)===null||S===void 0||S.call(u))};m=()=>{var S;if(!E())return;this.keepaliveTrace("Sending ping with timeout "+this.keepaliveTimeoutMs+"ms");let T="";try{s.ping((w,L,x)=>{p(),w?(this.keepaliveTrace("Ping failed with error: "+w.message),h=!0,s.close()):(this.keepaliveTrace("Received ping response"),b())})||(T="Ping returned false")}catch(k){T=(k instanceof Error?k.message:"")||"Unknown error"}if(T){this.keepaliveTrace("Ping send failed: "+T),this.trace("Connection dropped due to ping send error: "+T),h=!0,s.close();return}u=setTimeout(()=>{p(),this.keepaliveTrace("Ping timeout passed without response"),this.trace("Connection dropped by keepalive timeout"),h=!0,s.close()},this.keepaliveTimeoutMs),(S=u.unref)===null||S===void 0||S.call(u)},b(),s.on("close",()=>{var S,T;h||this.trace(`Connection dropped by client ${(S=s.socket)===null||S===void 0?void 0:S.remoteAddress}`),l&&clearTimeout(l),c&&clearTimeout(c),p(),f!==null&&(clearTimeout(f.timeout),this.sessionIdleTimeouts.delete(s)),(T=this.http2Servers.get(n))===null||T===void 0||T.sessions.delete(s)})}}_channelzSessionHandler(n){return s=>{var a,o,l,c;let u=(0,ye.registerChannelzSocket)((o=(a=s.socket)===null||a===void 0?void 0:a.remoteAddress)!==null&&o!==void 0?o:"unknown",this.getChannelzSessionInfo.bind(this,s),this.channelzEnabled),h={ref:u,streamTracker:new ye.ChannelzCallTracker,messagesSent:0,messagesReceived:0,keepAlivesSent:0,lastMessageSentTimestamp:null,lastMessageReceivedTimestamp:null};(l=this.http2Servers.get(n))===null||l===void 0||l.sessions.add(s),this.sessions.set(s,h);let f=`${s.socket.remoteAddress}:${s.socket.remotePort}`;this.channelzTrace.addTrace("CT_INFO","Connection established by client "+f),this.trace("Connection established by client "+f),this.sessionChildrenTracker.refChild(u);let p=null,E=null,m=null,b=!1,S=this.enableIdleTimeout(s);if(this.maxConnectionAgeMs!==sr){let x=this.maxConnectionAgeMs/10,q=Math.random()*x*2-x;p=setTimeout(()=>{var X;b=!0,this.channelzTrace.addTrace("CT_INFO","Connection dropped by max connection age from "+f);try{s.goaway(Le.constants.NGHTTP2_NO_ERROR,~(1<<31),Gf)}catch{s.destroy();return}s.close(),this.maxConnectionAgeGraceMs!==sr&&(E=setTimeout(()=>{s.destroy()},this.maxConnectionAgeGraceMs),(X=E.unref)===null||X===void 0||X.call(E))},this.maxConnectionAgeMs+q),(c=p.unref)===null||c===void 0||c.call(p)}let T=()=>{m&&(clearTimeout(m),m=null)},k=()=>!s.destroyed&&this.keepaliveTimeMs<Ql&&this.keepaliveTimeMs>0,w,L=()=>{var x;k()&&(this.keepaliveTrace("Starting keepalive timer for "+this.keepaliveTimeMs+"ms"),m=setTimeout(()=>{T(),w()},this.keepaliveTimeMs),(x=m.unref)===null||x===void 0||x.call(m))};w=()=>{var x;if(!k())return;this.keepaliveTrace("Sending ping with timeout "+this.keepaliveTimeoutMs+"ms");let q="";try{s.ping((re,W,v)=>{T(),re?(this.keepaliveTrace("Ping failed with error: "+re.message),this.channelzTrace.addTrace("CT_INFO","Connection dropped due to error of a ping frame "+re.message+" return in "+W),b=!0,s.close()):(this.keepaliveTrace("Received ping response"),L())})||(q="Ping returned false")}catch(X){q=(X instanceof Error?X.message:"")||"Unknown error"}if(q){this.keepaliveTrace("Ping send failed: "+q),this.channelzTrace.addTrace("CT_INFO","Connection dropped due to ping send error: "+q),b=!0,s.close();return}h.keepAlivesSent+=1,m=setTimeout(()=>{T(),this.keepaliveTrace("Ping timeout passed without response"),this.channelzTrace.addTrace("CT_INFO","Connection dropped by keepalive timeout from "+f),b=!0,s.close()},this.keepaliveTimeoutMs),(x=m.unref)===null||x===void 0||x.call(m)},L(),s.on("close",()=>{var x;b||this.channelzTrace.addTrace("CT_INFO","Connection dropped by client "+f),this.sessionChildrenTracker.unrefChild(u),(0,ye.unregisterChannelzRef)(u),p&&clearTimeout(p),E&&clearTimeout(E),T(),S!==null&&(clearTimeout(S.timeout),this.sessionIdleTimeouts.delete(s)),(x=this.http2Servers.get(n))===null||x===void 0||x.sessions.delete(s),this.sessions.delete(s)})}}enableIdleTimeout(n){var s,a;if(this.sessionIdleTimeout>=Hf)return null;let o={activeStreams:0,lastIdle:Date.now(),onClose:this.onStreamClose.bind(this,n),timeout:setTimeout(this.onIdleTimeout,this.sessionIdleTimeout,this,n)};(a=(s=o.timeout).unref)===null||a===void 0||a.call(s),this.sessionIdleTimeouts.set(n,o);let{socket:l}=n;return this.trace("Enable idle timeout for "+l.remoteAddress+":"+l.remotePort),o}onIdleTimeout(n,s){let{socket:a}=s,o=n.sessionIdleTimeouts.get(s);o!==void 0&&o.activeStreams===0&&Date.now()-o.lastIdle>=n.sessionIdleTimeout&&(n.trace("Session idle timeout triggered for "+a?.remoteAddress+":"+a?.remotePort+" last idle at "+o.lastIdle),n.closeSession(s))}onStreamOpened(n){let s=n.session,a=this.sessionIdleTimeouts.get(s);a&&(a.activeStreams+=1,n.once("close",a.onClose))}onStreamClose(n){var s,a;let o=this.sessionIdleTimeouts.get(n);o&&(o.activeStreams-=1,o.activeStreams===0&&(o.lastIdle=Date.now(),o.timeout.refresh(),this.trace("Session onStreamClose"+((s=n.socket)===null||s===void 0?void 0:s.remoteAddress)+":"+((a=n.socket)===null||a===void 0?void 0:a.remotePort)+" at "+o.lastIdle)))}},(()=>{let i=typeof Symbol=="function"&&Symbol.metadata?Object.create(null):void 0;t=[w_("Calling start() is no longer necessary. It can be safely omitted.")],__(r,null,t,{kind:"method",name:"start",static:!1,private:!1,access:{has:n=>"start"in n,get:n=>n.start},metadata:i},null,e),i&&Object.defineProperty(r,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:i})})(),r})();Qt.Server=O_;async function M_(r,e){let t;function i(a,o,l,c){if(a){r.sendStatus((0,ar.serverErrorToStatus)(a,l));return}r.sendMessage(o,()=>{r.sendStatus({code:de.Status.OK,details:"OK",metadata:l??null})})}let n,s=null;r.start({onReceiveMetadata(a){n=a,r.startRead()},onReceiveMessage(a){if(s){r.sendStatus({code:de.Status.UNIMPLEMENTED,details:`Received a second request message for server streaming method ${e.path}`,metadata:null});return}s=a,r.startRead()},onReceiveHalfClose(){if(!s){r.sendStatus({code:de.Status.UNIMPLEMENTED,details:`Received no request message for server streaming method ${e.path}`,metadata:null});return}t=new ar.ServerWritableStreamImpl(e.path,r,n,s);try{e.func(t,i)}catch(a){r.sendStatus({code:de.Status.UNKNOWN,details:`Server method handler threw error ${a.message}`,metadata:null})}},onCancel(){t&&(t.cancelled=!0,t.emit("cancelled","cancelled"))}})}function k_(r,e){let t;function i(n,s,a,o){if(n){r.sendStatus((0,ar.serverErrorToStatus)(n,a));return}r.sendMessage(s,()=>{r.sendStatus({code:de.Status.OK,details:"OK",metadata:a??null})})}r.start({onReceiveMetadata(n){t=new ar.ServerDuplexStreamImpl(e.path,r,n);try{e.func(t,i)}catch(s){r.sendStatus({code:de.Status.UNKNOWN,details:`Server method handler threw error ${s.message}`,metadata:null})}},onReceiveMessage(n){t.push(n)},onReceiveHalfClose(){t.push(null)},onCancel(){t&&(t.cancelled=!0,t.emit("cancelled","cancelled"),t.destroy())}})}function N_(r,e){let t,i,n=null;r.start({onReceiveMetadata(s){i=s,r.startRead()},onReceiveMessage(s){if(n){r.sendStatus({code:de.Status.UNIMPLEMENTED,details:`Received a second request message for server streaming method ${e.path}`,metadata:null});return}n=s,r.startRead()},onReceiveHalfClose(){if(!n){r.sendStatus({code:de.Status.UNIMPLEMENTED,details:`Received no request message for server streaming method ${e.path}`,metadata:null});return}t=new ar.ServerWritableStreamImpl(e.path,r,i,n);try{e.func(t)}catch(s){r.sendStatus({code:de.Status.UNKNOWN,details:`Server method handler threw error ${s.message}`,metadata:null})}},onCancel(){t&&(t.cancelled=!0,t.emit("cancelled","cancelled"),t.destroy())}})}function P_(r,e){let t;r.start({onReceiveMetadata(i){t=new ar.ServerDuplexStreamImpl(e.path,r,i);try{e.func(t)}catch(n){r.sendStatus({code:de.Status.UNKNOWN,details:`Server method handler threw error ${n.message}`,metadata:null})}},onReceiveMessage(i){t.push(i)},onReceiveHalfClose(){t.push(null)},onCancel(){t&&(t.cancelled=!0,t.emit("cancelled","cancelled"),t.destroy())}})}});var $f=g(Is=>{"use strict";Object.defineProperty(Is,"__esModule",{value:!0});Is.StatusBuilder=void 0;var tc=class{constructor(){this.code=null,this.details=null,this.metadata=null}withCode(e){return this.code=e,this}withDetails(e){return this.details=e,this}withMetadata(e){return this.metadata=e,this}build(){let e={};return this.code!==null&&(e.code=this.code),this.details!==null&&(e.details=this.details),this.metadata!==null&&(e.metadata=this.metadata),e}};Is.StatusBuilder=tc});var ic=g(ei=>{"use strict";Object.defineProperty(ei,"__esModule",{value:!0});ei.isDuration=ei.durationToMs=ei.msToDuration=void 0;function I_(r){return{seconds:r/1e3|0,nanos:r%1e3*1e6|0}}ei.msToDuration=I_;function x_(r){return r.seconds*1e3+r.nanos/1e6|0}ei.durationToMs=x_;function D_(r){return typeof r.seconds=="number"&&typeof r.nanos=="number"}ei.isDuration=D_});var xs=g(Je=>{"use strict";Object.defineProperty(Je,"__esModule",{value:!0});Je.setup=Je.LeafLoadBalancer=Je.PickFirstLoadBalancer=Je.shuffled=Je.PickFirstLoadBalancingConfig=void 0;var nc=ni(),he=Be(),or=Lt(),L_=te(),F_=z(),Vf=Xe(),Yf=require("net"),q_="pick_first";function rc(r){L_.trace(F_.LogVerbosity.DEBUG,q_,r)}var Vr="pick_first",B_=250,ti=class{constructor(e){this.shuffleAddressList=e}getLoadBalancerName(){return Vr}toJsonObject(){return{[Vr]:{shuffleAddressList:this.shuffleAddressList}}}getShuffleAddressList(){return this.shuffleAddressList}static createFromJson(e){if("shuffleAddressList"in e&&typeof e.shuffleAddressList!="boolean")throw new Error("pick_first config field shuffleAddressList must be a boolean if provided");return new ti(e.shuffleAddressList===!0)}};Je.PickFirstLoadBalancingConfig=ti;var sc=class{constructor(e){this.subchannel=e}pick(e){return{pickResultType:or.PickResultType.COMPLETE,subchannel:this.subchannel,status:null,onCallStarted:null,onCallEnded:null}}};function Kf(r){let e=r.slice();for(let t=e.length-1;t>1;t--){let i=Math.floor(Math.random()*(t+1)),n=e[t];e[t]=e[i],e[i]=n}return e}Je.shuffled=Kf;function U_(r){let e=[],t=[],i=[],n=(0,Vf.isTcpSubchannelAddress)(r[0])&&(0,Yf.isIPv6)(r[0].host);for(let o of r)(0,Vf.isTcpSubchannelAddress)(o)&&(0,Yf.isIPv6)(o.host)?t.push(o):i.push(o);let s=n?t:i,a=n?i:t;for(let o=0;o<Math.max(s.length,a.length);o++)o<s.length&&e.push(s[o]),o<a.length&&e.push(a[o]);return e}var Jf="grpc-node.internal.pick-first.report_health_status",Yr=class{constructor(e,t){this.channelControlHelper=e,this.children=[],this.currentState=he.ConnectivityState.IDLE,this.currentSubchannelIndex=0,this.currentPick=null,this.subchannelStateListener=(i,n,s,a,o)=>{this.onSubchannelStateUpdate(i,n,s,o)},this.pickedSubchannelHealthListener=()=>this.calculateAndReportNewState(),this.triedAllSubchannels=!1,this.stickyTransientFailureMode=!1,this.requestedResolutionSinceLastUpdate=!1,this.lastError=null,this.latestAddressList=null,this.connectionDelayTimeout=setTimeout(()=>{},0),clearTimeout(this.connectionDelayTimeout),this.reportHealthStatus=t[Jf]}allChildrenHaveReportedTF(){return this.children.every(e=>e.hasReportedTransientFailure)}calculateAndReportNewState(){this.currentPick?this.reportHealthStatus&&!this.currentPick.isHealthy()?this.updateState(he.ConnectivityState.TRANSIENT_FAILURE,new or.UnavailablePicker({details:`Picked subchannel ${this.currentPick.getAddress()} is unhealthy`})):this.updateState(he.ConnectivityState.READY,new sc(this.currentPick)):this.children.length===0?this.updateState(he.ConnectivityState.IDLE,new or.QueuePicker(this)):this.stickyTransientFailureMode?this.updateState(he.ConnectivityState.TRANSIENT_FAILURE,new or.UnavailablePicker({details:`No connection established. Last error: ${this.lastError}`})):this.updateState(he.ConnectivityState.CONNECTING,new or.QueuePicker(this))}requestReresolution(){this.requestedResolutionSinceLastUpdate=!0,this.channelControlHelper.requestReresolution()}maybeEnterStickyTransientFailureMode(){if(this.allChildrenHaveReportedTF()&&(this.requestedResolutionSinceLastUpdate||this.requestReresolution(),!this.stickyTransientFailureMode)){this.stickyTransientFailureMode=!0;for(let{subchannel:e}of this.children)e.startConnecting();this.calculateAndReportNewState()}}removeCurrentPick(){if(this.currentPick!==null){let e=this.currentPick;this.currentPick=null,e.unref(),e.removeConnectivityStateListener(this.subchannelStateListener),this.channelControlHelper.removeChannelzChild(e.getChannelzRef()),this.reportHealthStatus&&e.removeHealthStateWatcher(this.pickedSubchannelHealthListener)}}onSubchannelStateUpdate(e,t,i,n){var s;if(!((s=this.currentPick)===null||s===void 0)&&s.realSubchannelEquals(e)){i!==he.ConnectivityState.READY&&(this.removeCurrentPick(),this.calculateAndReportNewState(),this.requestReresolution());return}for(let[a,o]of this.children.entries())if(e.realSubchannelEquals(o.subchannel)){i===he.ConnectivityState.READY&&this.pickSubchannel(o.subchannel),i===he.ConnectivityState.TRANSIENT_FAILURE&&(o.hasReportedTransientFailure=!0,n&&(this.lastError=n),this.maybeEnterStickyTransientFailureMode(),a===this.currentSubchannelIndex&&this.startNextSubchannelConnecting(a+1)),o.subchannel.startConnecting();return}}startNextSubchannelConnecting(e){if(clearTimeout(this.connectionDelayTimeout),!this.triedAllSubchannels){for(let[t,i]of this.children.entries())if(t>=e){let n=i.subchannel.getConnectivityState();if(n===he.ConnectivityState.IDLE||n===he.ConnectivityState.CONNECTING){this.startConnecting(t);return}}this.triedAllSubchannels=!0,this.maybeEnterStickyTransientFailureMode()}}startConnecting(e){var t,i;clearTimeout(this.connectionDelayTimeout),this.currentSubchannelIndex=e,this.children[e].subchannel.getConnectivityState()===he.ConnectivityState.IDLE&&(rc("Start connecting to subchannel with address "+this.children[e].subchannel.getAddress()),process.nextTick(()=>{var n;(n=this.children[e])===null||n===void 0||n.subchannel.startConnecting()})),this.connectionDelayTimeout=setTimeout(()=>{this.startNextSubchannelConnecting(e+1)},B_),(i=(t=this.connectionDelayTimeout).unref)===null||i===void 0||i.call(t)}pickSubchannel(e){this.currentPick&&e.realSubchannelEquals(this.currentPick)||(rc("Pick subchannel with address "+e.getAddress()),this.stickyTransientFailureMode=!1,this.removeCurrentPick(),this.currentPick=e,e.ref(),this.reportHealthStatus&&e.addHealthStateWatcher(this.pickedSubchannelHealthListener),this.channelControlHelper.addChannelzChild(e.getChannelzRef()),this.resetSubchannelList(),clearTimeout(this.connectionDelayTimeout),this.calculateAndReportNewState())}updateState(e,t){rc(he.ConnectivityState[this.currentState]+" -> "+he.ConnectivityState[e]),this.currentState=e,this.channelControlHelper.updateState(e,t)}resetSubchannelList(){for(let e of this.children)this.currentPick&&e.subchannel.realSubchannelEquals(this.currentPick)||e.subchannel.removeConnectivityStateListener(this.subchannelStateListener),e.subchannel.unref(),this.channelControlHelper.removeChannelzChild(e.subchannel.getChannelzRef());this.currentSubchannelIndex=0,this.children=[],this.triedAllSubchannels=!1,this.requestedResolutionSinceLastUpdate=!1}connectToAddressList(e){let t=e.map(i=>({subchannel:this.channelControlHelper.createSubchannel(i,{}),hasReportedTransientFailure:!1}));for(let{subchannel:i}of t)i.ref(),this.channelControlHelper.addChannelzChild(i.getChannelzRef());this.resetSubchannelList(),this.children=t;for(let{subchannel:i}of this.children)if(i.addConnectivityStateListener(this.subchannelStateListener),i.getConnectivityState()===he.ConnectivityState.READY){this.pickSubchannel(i);return}for(let i of this.children)i.subchannel.getConnectivityState()===he.ConnectivityState.TRANSIENT_FAILURE&&(i.hasReportedTransientFailure=!0);this.startNextSubchannelConnecting(0),this.calculateAndReportNewState()}updateAddressList(e,t){if(!(t instanceof ti))return;t.getShuffleAddressList()&&(e=Kf(e));let i=[].concat(...e.map(s=>s.addresses));if(i.length===0)throw new Error("No addresses in endpoint list passed to pick_first");let n=U_(i);this.latestAddressList=n,this.connectToAddressList(n)}exitIdle(){this.currentState===he.ConnectivityState.IDLE&&this.latestAddressList&&this.connectToAddressList(this.latestAddressList)}resetBackoff(){}destroy(){this.resetSubchannelList(),this.removeCurrentPick()}getTypeName(){return Vr}};Je.PickFirstLoadBalancer=Yr;var z_=new ti(!1),ac=class{constructor(e,t,i){this.endpoint=e,this.latestState=he.ConnectivityState.IDLE;let n=(0,nc.createChildChannelControlHelper)(t,{updateState:(s,a)=>{this.latestState=s,this.latestPicker=a,t.updateState(s,a)}});this.pickFirstBalancer=new Yr(n,Object.assign(Object.assign({},i),{[Jf]:!0})),this.latestPicker=new or.QueuePicker(this.pickFirstBalancer)}startConnecting(){this.pickFirstBalancer.updateAddressList([this.endpoint],z_)}updateEndpoint(e){this.endpoint=e,this.latestState!==he.ConnectivityState.IDLE&&this.startConnecting()}getConnectivityState(){return this.latestState}getPicker(){return this.latestPicker}getEndpoint(){return this.endpoint}exitIdle(){this.pickFirstBalancer.exitIdle()}destroy(){this.pickFirstBalancer.destroy()}};Je.LeafLoadBalancer=ac;function H_(){(0,nc.registerLoadBalancerType)(Vr,Yr,ti),(0,nc.registerDefaultLoadBalancerType)(Vr)}Je.setup=H_});var lc=g(I=>{"use strict";Object.defineProperty(I,"__esModule",{value:!0});I.BaseSubchannelWrapper=I.registerAdminService=I.FilterStackFactory=I.BaseFilter=I.PickResultType=I.QueuePicker=I.UnavailablePicker=I.ChildLoadBalancerHandler=I.EndpointMap=I.endpointHasAddress=I.endpointToString=I.subchannelAddressToString=I.LeafLoadBalancer=I.isLoadBalancerNameRegistered=I.parseLoadBalancingConfig=I.selectLbConfigFromList=I.registerLoadBalancerType=I.createChildChannelControlHelper=I.BackoffTimeout=I.durationToMs=I.uriToString=I.createResolver=I.registerResolver=I.log=I.trace=void 0;var Xf=te();Object.defineProperty(I,"trace",{enumerable:!0,get:function(){return Xf.trace}});Object.defineProperty(I,"log",{enumerable:!0,get:function(){return Xf.log}});var Zf=ot();Object.defineProperty(I,"registerResolver",{enumerable:!0,get:function(){return Zf.registerResolver}});Object.defineProperty(I,"createResolver",{enumerable:!0,get:function(){return Zf.createResolver}});var j_=Pe();Object.defineProperty(I,"uriToString",{enumerable:!0,get:function(){return j_.uriToString}});var G_=ic();Object.defineProperty(I,"durationToMs",{enumerable:!0,get:function(){return G_.durationToMs}});var W_=pr();Object.defineProperty(I,"BackoffTimeout",{enumerable:!0,get:function(){return W_.BackoffTimeout}});var Kr=ni();Object.defineProperty(I,"createChildChannelControlHelper",{enumerable:!0,get:function(){return Kr.createChildChannelControlHelper}});Object.defineProperty(I,"registerLoadBalancerType",{enumerable:!0,get:function(){return Kr.registerLoadBalancerType}});Object.defineProperty(I,"selectLbConfigFromList",{enumerable:!0,get:function(){return Kr.selectLbConfigFromList}});Object.defineProperty(I,"parseLoadBalancingConfig",{enumerable:!0,get:function(){return Kr.parseLoadBalancingConfig}});Object.defineProperty(I,"isLoadBalancerNameRegistered",{enumerable:!0,get:function(){return Kr.isLoadBalancerNameRegistered}});var $_=xs();Object.defineProperty(I,"LeafLoadBalancer",{enumerable:!0,get:function(){return $_.LeafLoadBalancer}});var Ds=Xe();Object.defineProperty(I,"subchannelAddressToString",{enumerable:!0,get:function(){return Ds.subchannelAddressToString}});Object.defineProperty(I,"endpointToString",{enumerable:!0,get:function(){return Ds.endpointToString}});Object.defineProperty(I,"endpointHasAddress",{enumerable:!0,get:function(){return Ds.endpointHasAddress}});Object.defineProperty(I,"EndpointMap",{enumerable:!0,get:function(){return Ds.EndpointMap}});var V_=fn();Object.defineProperty(I,"ChildLoadBalancerHandler",{enumerable:!0,get:function(){return V_.ChildLoadBalancerHandler}});var oc=Lt();Object.defineProperty(I,"UnavailablePicker",{enumerable:!0,get:function(){return oc.UnavailablePicker}});Object.defineProperty(I,"QueuePicker",{enumerable:!0,get:function(){return oc.QueuePicker}});Object.defineProperty(I,"PickResultType",{enumerable:!0,get:function(){return oc.PickResultType}});var Y_=Sl();Object.defineProperty(I,"BaseFilter",{enumerable:!0,get:function(){return Y_.BaseFilter}});var K_=ml();Object.defineProperty(I,"FilterStackFactory",{enumerable:!0,get:function(){return K_.FilterStackFactory}});var J_=vn();Object.defineProperty(I,"registerAdminService",{enumerable:!0,get:function(){return J_.registerAdminService}});var X_=Es();Object.defineProperty(I,"BaseSubchannelWrapper",{enumerable:!0,get:function(){return X_.BaseSubchannelWrapper}})});var Qf=g(Ls=>{"use strict";Object.defineProperty(Ls,"__esModule",{value:!0});Ls.setup=void 0;var Z_=ot(),cc=class{constructor(e,t,i){this.listener=t,this.hasReturnedResult=!1,this.endpoints=[];let n;e.authority===""?n="/"+e.path:n=e.path,this.endpoints=[{addresses:[{path:n}]}]}updateResolution(){this.hasReturnedResult||(this.hasReturnedResult=!0,process.nextTick(this.listener.onSuccessfulResolution,this.endpoints,null,null,null,{}))}destroy(){this.hasReturnedResult=!1}static getDefaultAuthority(e){return"localhost"}};function Q_(){(0,Z_.registerResolver)("unix",cc)}Ls.setup=Q_});var np=g(Bs=>{"use strict";Object.defineProperty(Bs,"__esModule",{value:!0});Bs.setup=void 0;var ep=require("net"),Fs=z(),uc=Re(),tp=ot(),ip=Pe(),eC=te(),tC="ip_resolver";function rp(r){eC.trace(Fs.LogVerbosity.DEBUG,tC,r)}var dc="ipv4",hc="ipv6",iC=443,qs=class{constructor(e,t,i){var n;this.listener=t,this.endpoints=[],this.error=null,this.hasReturnedResult=!1,rp("Resolver constructed for target "+(0,ip.uriToString)(e));let s=[];if(!(e.scheme===dc||e.scheme===hc)){this.error={code:Fs.Status.UNAVAILABLE,details:`Unrecognized scheme ${e.scheme} in IP resolver`,metadata:new uc.Metadata};return}let a=e.path.split(",");for(let o of a){let l=(0,ip.splitHostPort)(o);if(l===null){this.error={code:Fs.Status.UNAVAILABLE,details:`Failed to parse ${e.scheme} address ${o}`,metadata:new uc.Metadata};return}if(e.scheme===dc&&!(0,ep.isIPv4)(l.host)||e.scheme===hc&&!(0,ep.isIPv6)(l.host)){this.error={code:Fs.Status.UNAVAILABLE,details:`Failed to parse ${e.scheme} address ${o}`,metadata:new uc.Metadata};return}s.push({host:l.host,port:(n=l.port)!==null&&n!==void 0?n:iC})}this.endpoints=s.map(o=>({addresses:[o]})),rp("Parsed "+e.scheme+" address list "+s)}updateResolution(){this.hasReturnedResult||(this.hasReturnedResult=!0,process.nextTick(()=>{this.error?this.listener.onError(this.error):this.listener.onSuccessfulResolution(this.endpoints,null,null,null,{})}))}destroy(){this.hasReturnedResult=!1}static getDefaultAuthority(e){return e.path.split(",")[0]}};function rC(){(0,tp.registerResolver)(dc,qs),(0,tp.registerResolver)(hc,qs)}Bs.setup=rC});var lp=g(lr=>{"use strict";Object.defineProperty(lr,"__esModule",{value:!0});lr.setup=lr.RoundRobinLoadBalancer=void 0;var op=ni(),Fe=Be(),fc=Lt(),nC=te(),sC=z(),sp=Xe(),aC=xs(),oC="round_robin";function ap(r){nC.trace(sC.LogVerbosity.DEBUG,oC,r)}var Us="round_robin",Jr=class{getLoadBalancerName(){return Us}constructor(){}toJsonObject(){return{[Us]:{}}}static createFromJson(e){return new Jr}},pc=class{constructor(e,t=0){this.children=e,this.nextIndex=t}pick(e){let t=this.children[this.nextIndex].picker;return this.nextIndex=(this.nextIndex+1)%this.children.length,t.pick(e)}peekNextEndpoint(){return this.children[this.nextIndex].endpoint}},zs=class{constructor(e,t){this.channelControlHelper=e,this.options=t,this.children=[],this.currentState=Fe.ConnectivityState.IDLE,this.currentReadyPicker=null,this.updatesPaused=!1,this.lastError=null,this.childChannelControlHelper=(0,op.createChildChannelControlHelper)(e,{updateState:(i,n)=>{this.calculateAndUpdateState()}})}countChildrenWithState(e){return this.children.filter(t=>t.getConnectivityState()===e).length}calculateAndUpdateState(){if(!this.updatesPaused){if(this.countChildrenWithState(Fe.ConnectivityState.READY)>0){let e=this.children.filter(i=>i.getConnectivityState()===Fe.ConnectivityState.READY),t=0;if(this.currentReadyPicker!==null){let i=this.currentReadyPicker.peekNextEndpoint();t=e.findIndex(n=>(0,sp.endpointEqual)(n.getEndpoint(),i)),t<0&&(t=0)}this.updateState(Fe.ConnectivityState.READY,new pc(e.map(i=>({endpoint:i.getEndpoint(),picker:i.getPicker()})),t))}else this.countChildrenWithState(Fe.ConnectivityState.CONNECTING)>0?this.updateState(Fe.ConnectivityState.CONNECTING,new fc.QueuePicker(this)):this.countChildrenWithState(Fe.ConnectivityState.TRANSIENT_FAILURE)>0?this.updateState(Fe.ConnectivityState.TRANSIENT_FAILURE,new fc.UnavailablePicker({details:`No connection established. Last error: ${this.lastError}`})):this.updateState(Fe.ConnectivityState.IDLE,new fc.QueuePicker(this));for(let e of this.children)e.getConnectivityState()===Fe.ConnectivityState.IDLE&&e.exitIdle()}}updateState(e,t){ap(Fe.ConnectivityState[this.currentState]+" -> "+Fe.ConnectivityState[e]),e===Fe.ConnectivityState.READY?this.currentReadyPicker=t:this.currentReadyPicker=null,this.currentState=e,this.channelControlHelper.updateState(e,t)}resetSubchannelList(){for(let e of this.children)e.destroy()}updateAddressList(e,t){this.resetSubchannelList(),ap("Connect to endpoint list "+e.map(sp.endpointToString)),this.updatesPaused=!0,this.children=e.map(i=>new aC.LeafLoadBalancer(i,this.childChannelControlHelper,this.options));for(let i of this.children)i.startConnecting();this.updatesPaused=!1,this.calculateAndUpdateState()}exitIdle(){}resetBackoff(){}destroy(){this.resetSubchannelList()}getTypeName(){return Us}};lr.RoundRobinLoadBalancer=zs;function lC(){(0,op.registerLoadBalancerType)(Us,zs,Jr)}lr.setup=lC});var dp=g(ii=>{"use strict";var gc;Object.defineProperty(ii,"__esModule",{value:!0});ii.setup=ii.OutlierDetectionLoadBalancer=ii.OutlierDetectionLoadBalancingConfig=void 0;var cC=Be(),cp=z(),yi=ic(),up=lc(),uC=ni(),dC=fn(),hC=Lt(),mc=Xe(),fC=Es(),pC=te(),gC="outlier_detection";function Se(r){pC.trace(cp.LogVerbosity.DEBUG,gC,r)}var Tc="outlier_detection",mC=((gc=process.env.GRPC_EXPERIMENTAL_ENABLE_OUTLIER_DETECTION)!==null&&gc!==void 0?gc:"true")==="true",vC={stdev_factor:1900,enforcement_percentage:100,minimum_hosts:5,request_volume:100},yC={threshold:85,enforcement_percentage:100,minimum_hosts:5,request_volume:50};function cr(r,e,t,i){if(e in r&&r[e]!==void 0&&typeof r[e]!==t){let n=i?`${i}.${e}`:e;throw new Error(`outlier detection config ${n} parse error: expected ${t}, got ${typeof r[e]}`)}}function vc(r,e,t){let i=t?`${t}.${e}`:e;if(e in r&&r[e]!==void 0){if(!(0,yi.isDuration)(r[e]))throw new Error(`outlier detection config ${i} parse error: expected Duration, got ${typeof r[e]}`);if(!(r[e].seconds>=0&&r[e].seconds<=315576e6&&r[e].nanos>=0&&r[e].nanos<=999999999))throw new Error(`outlier detection config ${i} parse error: values out of range for non-negative Duaration`)}}function Hs(r,e,t){let i=t?`${t}.${e}`:e;if(cr(r,e,"number",t),e in r&&r[e]!==void 0&&!(r[e]>=0&&r[e]<=100))throw new Error(`outlier detection config ${i} parse error: value out of range for percentage (0-100)`)}var Si=class{constructor(e,t,i,n,s,a,o){if(this.childPolicy=o,o.getLoadBalancerName()==="pick_first")throw new Error("outlier_detection LB policy cannot have a pick_first child policy");this.intervalMs=e??1e4,this.baseEjectionTimeMs=t??3e4,this.maxEjectionTimeMs=i??3e5,this.maxEjectionPercent=n??10,this.successRateEjection=s?Object.assign(Object.assign({},vC),s):null,this.failurePercentageEjection=a?Object.assign(Object.assign({},yC),a):null}getLoadBalancerName(){return Tc}toJsonObject(){var e,t;return{outlier_detection:{interval:(0,yi.msToDuration)(this.intervalMs),base_ejection_time:(0,yi.msToDuration)(this.baseEjectionTimeMs),max_ejection_time:(0,yi.msToDuration)(this.maxEjectionTimeMs),max_ejection_percent:this.maxEjectionPercent,success_rate_ejection:(e=this.successRateEjection)!==null&&e!==void 0?e:void 0,failure_percentage_ejection:(t=this.failurePercentageEjection)!==null&&t!==void 0?t:void 0,child_policy:[this.childPolicy.toJsonObject()]}}}getIntervalMs(){return this.intervalMs}getBaseEjectionTimeMs(){return this.baseEjectionTimeMs}getMaxEjectionTimeMs(){return this.maxEjectionTimeMs}getMaxEjectionPercent(){return this.maxEjectionPercent}getSuccessRateEjectionConfig(){return this.successRateEjection}getFailurePercentageEjectionConfig(){return this.failurePercentageEjection}getChildPolicy(){return this.childPolicy}static createFromJson(e){var t;if(vc(e,"interval"),vc(e,"base_ejection_time"),vc(e,"max_ejection_time"),Hs(e,"max_ejection_percent"),"success_rate_ejection"in e&&e.success_rate_ejection!==void 0){if(typeof e.success_rate_ejection!="object")throw new Error("outlier detection config success_rate_ejection must be an object");cr(e.success_rate_ejection,"stdev_factor","number","success_rate_ejection"),Hs(e.success_rate_ejection,"enforcement_percentage","success_rate_ejection"),cr(e.success_rate_ejection,"minimum_hosts","number","success_rate_ejection"),cr(e.success_rate_ejection,"request_volume","number","success_rate_ejection")}if("failure_percentage_ejection"in e&&e.failure_percentage_ejection!==void 0){if(typeof e.failure_percentage_ejection!="object")throw new Error("outlier detection config failure_percentage_ejection must be an object");Hs(e.failure_percentage_ejection,"threshold","failure_percentage_ejection"),Hs(e.failure_percentage_ejection,"enforcement_percentage","failure_percentage_ejection"),cr(e.failure_percentage_ejection,"minimum_hosts","number","failure_percentage_ejection"),cr(e.failure_percentage_ejection,"request_volume","number","failure_percentage_ejection")}if(!("child_policy"in e)||!Array.isArray(e.child_policy))throw new Error("outlier detection config child_policy must be an array");let i=(0,uC.selectLbConfigFromList)(e.child_policy);if(!i)throw new Error("outlier detection config child_policy: no valid recognized policy found");return new Si(e.interval?(0,yi.durationToMs)(e.interval):null,e.base_ejection_time?(0,yi.durationToMs)(e.base_ejection_time):null,e.max_ejection_time?(0,yi.durationToMs)(e.max_ejection_time):null,(t=e.max_ejection_percent)!==null&&t!==void 0?t:null,e.success_rate_ejection,e.failure_percentage_ejection,i)}};ii.OutlierDetectionLoadBalancingConfig=Si;var Sc=class extends fC.BaseSubchannelWrapper{constructor(e,t){super(e),this.mapEntry=t,this.refCount=0}ref(){this.child.ref(),this.refCount+=1}unref(){if(this.child.unref(),this.refCount-=1,this.refCount<=0&&this.mapEntry){let e=this.mapEntry.subchannelWrappers.indexOf(this);e>=0&&this.mapEntry.subchannelWrappers.splice(e,1)}}eject(){this.setHealthy(!1)}uneject(){this.setHealthy(!0)}getMapEntry(){return this.mapEntry}getWrappedSubchannel(){return this.child}};function yc(){return{success:0,failure:0}}var _c=class{constructor(){this.activeBucket=yc(),this.inactiveBucket=yc()}addSuccess(){this.activeBucket.success+=1}addFailure(){this.activeBucket.failure+=1}switchBuckets(){this.inactiveBucket=this.activeBucket,this.activeBucket=yc()}getLastSuccesses(){return this.inactiveBucket.success}getLastFailures(){return this.inactiveBucket.failure}},Cc=class{constructor(e,t){this.wrappedPicker=e,this.countCalls=t}pick(e){let t=this.wrappedPicker.pick(e);if(t.pickResultType===hC.PickResultType.COMPLETE){let i=t.subchannel,n=i.getMapEntry();if(n){let s=t.onCallEnded;return this.countCalls&&(s=a=>{var o;a===cp.Status.OK?n.counter.addSuccess():n.counter.addFailure(),(o=t.onCallEnded)===null||o===void 0||o.call(t,a)}),Object.assign(Object.assign({},t),{subchannel:i.getWrappedSubchannel(),onCallEnded:s})}else return Object.assign(Object.assign({},t),{subchannel:i.getWrappedSubchannel()})}else return t}},js=class{constructor(e,t){this.entryMap=new mc.EndpointMap,this.latestConfig=null,this.timerStartTime=null,this.childBalancer=new dC.ChildLoadBalancerHandler((0,up.createChildChannelControlHelper)(e,{createSubchannel:(i,n)=>{let s=e.createSubchannel(i,n),a=this.entryMap.getForSubchannelAddress(i),o=new Sc(s,a);return a?.currentEjectionTimestamp!==null&&o.eject(),a?.subchannelWrappers.push(o),o},updateState:(i,n)=>{i===cC.ConnectivityState.READY?e.updateState(i,new Cc(n,this.isCountingEnabled())):e.updateState(i,n)}}),t),this.ejectionTimer=setInterval(()=>{},0),clearInterval(this.ejectionTimer)}isCountingEnabled(){return this.latestConfig!==null&&(this.latestConfig.getSuccessRateEjectionConfig()!==null||this.latestConfig.getFailurePercentageEjectionConfig()!==null)}getCurrentEjectionPercent(){let e=0;for(let t of this.entryMap.values())t.currentEjectionTimestamp!==null&&(e+=1);return e*100/this.entryMap.size}runSuccessRateCheck(e){if(!this.latestConfig)return;let t=this.latestConfig.getSuccessRateEjectionConfig();if(!t)return;Se("Running success rate check");let i=t.request_volume,n=0,s=[];for(let[h,f]of this.entryMap.entries()){let p=f.counter.getLastSuccesses(),E=f.counter.getLastFailures();Se("Stats for "+(0,mc.endpointToString)(h)+": successes="+p+" failures="+E+" targetRequestVolume="+i),p+E>=i&&(n+=1,s.push(p/(p+E)))}if(Se("Found "+n+" success rate candidates; currentEjectionPercent="+this.getCurrentEjectionPercent()+" successRates=["+s+"]"),n<t.minimum_hosts)return;let a=s.reduce((h,f)=>h+f)/s.length,o=0;for(let h of s){let f=h-a;o+=f*f}let l=o/s.length,c=Math.sqrt(l),u=a-c*(t.stdev_factor/1e3);Se("stdev="+c+" ejectionThreshold="+u);for(let[h,f]of this.entryMap.entries()){if(this.getCurrentEjectionPercent()>=this.latestConfig.getMaxEjectionPercent())break;let p=f.counter.getLastSuccesses(),E=f.counter.getLastFailures();if(p+E<i)continue;let m=p/(p+E);if(Se("Checking candidate "+h+" successRate="+m),m<u){let b=Math.random()*100;Se("Candidate "+h+" randomNumber="+b+" enforcement_percentage="+t.enforcement_percentage),b<t.enforcement_percentage&&(Se("Ejecting candidate "+h),this.eject(f,e))}}}runFailurePercentageCheck(e){if(!this.latestConfig)return;let t=this.latestConfig.getFailurePercentageEjectionConfig();if(!t)return;Se("Running failure percentage check. threshold="+t.threshold+" request volume threshold="+t.request_volume);let i=0;for(let n of this.entryMap.values()){let s=n.counter.getLastSuccesses(),a=n.counter.getLastFailures();s+a>=t.request_volume&&(i+=1)}if(!(i<t.minimum_hosts))for(let[n,s]of this.entryMap.entries()){if(this.getCurrentEjectionPercent()>=this.latestConfig.getMaxEjectionPercent())break;let a=s.counter.getLastSuccesses(),o=s.counter.getLastFailures();if(Se("Candidate successes="+a+" failures="+o),a+o<t.request_volume)continue;if(o*100/(o+a)>t.threshold){let c=Math.random()*100;Se("Candidate "+n+" randomNumber="+c+" enforcement_percentage="+t.enforcement_percentage),c<t.enforcement_percentage&&(Se("Ejecting candidate "+n),this.eject(s,e))}}}eject(e,t){e.currentEjectionTimestamp=new Date,e.ejectionTimeMultiplier+=1;for(let i of e.subchannelWrappers)i.eject()}uneject(e){e.currentEjectionTimestamp=null;for(let t of e.subchannelWrappers)t.uneject()}switchAllBuckets(){for(let e of this.entryMap.values())e.counter.switchBuckets()}startTimer(e){var t,i;this.ejectionTimer=setTimeout(()=>this.runChecks(),e),(i=(t=this.ejectionTimer).unref)===null||i===void 0||i.call(t)}runChecks(){let e=new Date;if(Se("Ejection timer running"),this.switchAllBuckets(),!!this.latestConfig){this.timerStartTime=e,this.startTimer(this.latestConfig.getIntervalMs()),this.runSuccessRateCheck(e),this.runFailurePercentageCheck(e);for(let[t,i]of this.entryMap.entries())if(i.currentEjectionTimestamp===null)i.ejectionTimeMultiplier>0&&(i.ejectionTimeMultiplier-=1);else{let n=this.latestConfig.getBaseEjectionTimeMs(),s=this.latestConfig.getMaxEjectionTimeMs(),a=new Date(i.currentEjectionTimestamp.getTime());a.setMilliseconds(a.getMilliseconds()+Math.min(n*i.ejectionTimeMultiplier,Math.max(n,s))),a<new Date&&(Se("Unejecting "+t),this.uneject(i))}}}updateAddressList(e,t,i){if(!(t instanceof Si))return;for(let s of e)this.entryMap.has(s)||(Se("Adding map entry for "+(0,mc.endpointToString)(s)),this.entryMap.set(s,{counter:new _c,currentEjectionTimestamp:null,ejectionTimeMultiplier:0,subchannelWrappers:[]}));this.entryMap.deleteMissing(e);let n=t.getChildPolicy();if(this.childBalancer.updateAddressList(e,n,i),t.getSuccessRateEjectionConfig()||t.getFailurePercentageEjectionConfig())if(this.timerStartTime){Se("Previous timer existed. Replacing timer"),clearTimeout(this.ejectionTimer);let s=t.getIntervalMs()-(new Date().getTime()-this.timerStartTime.getTime());this.startTimer(s)}else Se("Starting new timer"),this.timerStartTime=new Date,this.startTimer(t.getIntervalMs()),this.switchAllBuckets();else{Se("Counting disabled. Cancelling timer."),this.timerStartTime=null,clearTimeout(this.ejectionTimer);for(let s of this.entryMap.values())this.uneject(s),s.ejectionTimeMultiplier=0}this.latestConfig=t}exitIdle(){this.childBalancer.exitIdle()}resetBackoff(){this.childBalancer.resetBackoff()}destroy(){clearTimeout(this.ejectionTimer),this.childBalancer.destroy()}getTypeName(){return Tc}};ii.OutlierDetectionLoadBalancer=js;function SC(){mC&&(0,up.registerLoadBalancerType)(Tc,js,Si)}ii.setup=SC});var gp=g(O=>{"use strict";Object.defineProperty(O,"__esModule",{value:!0});O.experimental=O.ServerInterceptingCall=O.ResponderBuilder=O.ServerListenerBuilder=O.addAdminServicesToServer=O.getChannelzHandlers=O.getChannelzServiceDefinition=O.InterceptorConfigurationError=O.InterceptingCall=O.RequesterBuilder=O.ListenerBuilder=O.StatusBuilder=O.getClientChannel=O.ServerCredentials=O.Server=O.setLogVerbosity=O.setLogger=O.load=O.loadObject=O.CallCredentials=O.ChannelCredentials=O.waitForClientReady=O.closeClient=O.Channel=O.makeGenericClientConstructor=O.makeClientConstructor=O.loadPackageDefinition=O.Client=O.compressionAlgorithms=O.propagate=O.connectivityState=O.status=O.logVerbosity=O.Metadata=O.credentials=void 0;var Gs=ra();Object.defineProperty(O,"CallCredentials",{enumerable:!0,get:function(){return Gs.CallCredentials}});var _C=za();Object.defineProperty(O,"Channel",{enumerable:!0,get:function(){return _C.ChannelImplementation}});var CC=vl();Object.defineProperty(O,"compressionAlgorithms",{enumerable:!0,get:function(){return CC.CompressionAlgorithms}});var TC=Be();Object.defineProperty(O,"connectivityState",{enumerable:!0,get:function(){return TC.ConnectivityState}});var Ws=an();Object.defineProperty(O,"ChannelCredentials",{enumerable:!0,get:function(){return Ws.ChannelCredentials}});var hp=Ua();Object.defineProperty(O,"Client",{enumerable:!0,get:function(){return hp.Client}});var Ec=z();Object.defineProperty(O,"logVerbosity",{enumerable:!0,get:function(){return Ec.LogVerbosity}});Object.defineProperty(O,"status",{enumerable:!0,get:function(){return Ec.Status}});Object.defineProperty(O,"propagate",{enumerable:!0,get:function(){return Ec.Propagate}});var fp=te(),bc=ja();Object.defineProperty(O,"loadPackageDefinition",{enumerable:!0,get:function(){return bc.loadPackageDefinition}});Object.defineProperty(O,"makeClientConstructor",{enumerable:!0,get:function(){return bc.makeClientConstructor}});Object.defineProperty(O,"makeGenericClientConstructor",{enumerable:!0,get:function(){return bc.makeClientConstructor}});var EC=Re();Object.defineProperty(O,"Metadata",{enumerable:!0,get:function(){return EC.Metadata}});var bC=Wf();Object.defineProperty(O,"Server",{enumerable:!0,get:function(){return bC.Server}});var RC=Wl();Object.defineProperty(O,"ServerCredentials",{enumerable:!0,get:function(){return RC.ServerCredentials}});var wC=$f();Object.defineProperty(O,"StatusBuilder",{enumerable:!0,get:function(){return wC.StatusBuilder}});O.credentials={combineChannelCredentials:(r,...e)=>e.reduce((t,i)=>t.compose(i),r),combineCallCredentials:(r,...e)=>e.reduce((t,i)=>t.compose(i),r),createInsecure:Ws.ChannelCredentials.createInsecure,createSsl:Ws.ChannelCredentials.createSsl,createFromSecureContext:Ws.ChannelCredentials.createFromSecureContext,createFromMetadataGenerator:Gs.CallCredentials.createFromMetadataGenerator,createFromGoogleCredential:Gs.CallCredentials.createFromGoogleCredential,createEmpty:Gs.CallCredentials.createEmpty};var AC=r=>r.close();O.closeClient=AC;var OC=(r,e,t)=>r.waitForReady(e,t);O.waitForClientReady=OC;var MC=(r,e)=>{throw new Error("Not available in this library. Use @grpc/proto-loader and loadPackageDefinition instead")};O.loadObject=MC;var kC=(r,e,t)=>{throw new Error("Not available in this library. Use @grpc/proto-loader and loadPackageDefinition instead")};O.load=kC;var NC=r=>{fp.setLogger(r)};O.setLogger=NC;var PC=r=>{fp.setLoggerVerbosity(r)};O.setLogVerbosity=PC;var IC=r=>hp.Client.prototype.getChannel.call(r);O.getClientChannel=IC;var $s=Fa();Object.defineProperty(O,"ListenerBuilder",{enumerable:!0,get:function(){return $s.ListenerBuilder}});Object.defineProperty(O,"RequesterBuilder",{enumerable:!0,get:function(){return $s.RequesterBuilder}});Object.defineProperty(O,"InterceptingCall",{enumerable:!0,get:function(){return $s.InterceptingCall}});Object.defineProperty(O,"InterceptorConfigurationError",{enumerable:!0,get:function(){return $s.InterceptorConfigurationError}});var pp=fi();Object.defineProperty(O,"getChannelzServiceDefinition",{enumerable:!0,get:function(){return pp.getChannelzServiceDefinition}});Object.defineProperty(O,"getChannelzHandlers",{enumerable:!0,get:function(){return pp.getChannelzHandlers}});var xC=vn();Object.defineProperty(O,"addAdminServicesToServer",{enumerable:!0,get:function(){return xC.addAdminServicesToServer}});var Rc=Zl();Object.defineProperty(O,"ServerListenerBuilder",{enumerable:!0,get:function(){return Rc.ServerListenerBuilder}});Object.defineProperty(O,"ResponderBuilder",{enumerable:!0,get:function(){return Rc.ResponderBuilder}});Object.defineProperty(O,"ServerInterceptingCall",{enumerable:!0,get:function(){return Rc.ServerInterceptingCall}});var DC=lc();O.experimental=DC;var LC=al(),FC=Qf(),qC=np(),BC=xs(),UC=lp(),zC=dp(),HC=fi();LC.setup(),FC.setup(),qC.setup(),BC.setup(),UC.setup(),zC.setup(),HC.setup()});var vp=g((rb,wc)=>{"use strict";var jC=/at\s{1}(?:.*\.)?plugin\s{1}.*\n\s*(.*)/,GC=/(\w*(\.\w*)*)\..*/;wc.exports=function(e){if(e.name.length>0)return e.name;let t=Error.stackTraceLimit;Error.stackTraceLimit=10;try{throw new Error("anonymous function")}catch(i){return Error.stackTraceLimit=t,mp(i.stack)}};function mp(r){let e=r.match(jC);return e?e[1].split(/[/\\]/).slice(-1)[0].match(GC)[1]:"anonymous"}wc.exports.extractPluginName=mp});var Sp=g((nb,yp)=>{"use strict";yp.exports=function(e){return e[0]==="@"&&(e=e.slice(1).replace("/","-")),e.replace(/-(.)/g,function(i,n){return n.toUpperCase()})}});var _p=g((sb,Vs)=>{"use strict";var WC=vp(),$C=Sp(),VC=0;function Ac(r,e={}){let t=!1;if(typeof r.default<"u"&&(r=r.default),typeof r!="function")throw new TypeError(`fastify-plugin expects a function, instead got a '${typeof r}'`);if(typeof e=="string"&&(e={fastify:e}),typeof e!="object"||Array.isArray(e)||e===null)throw new TypeError("The options object should be an object");if(e.fastify!==void 0&&typeof e.fastify!="string")throw new TypeError(`fastify-plugin expects a version string, instead got '${typeof e.fastify}'`);e.name||(t=!0,e.name=WC(r)+"-auto-"+VC++),r[Symbol.for("skip-override")]=e.encapsulate!==!0,r[Symbol.for("fastify.display-name")]=e.name,r[Symbol.for("plugin-meta")]=e,r.default||(r.default=r);let i=$C(e.name);return!t&&!r[i]&&(r[i]=r),r}Vs.exports=Ac;Vs.exports.default=Ac;Vs.exports.fastifyPlugin=Ac});var JC={};Mp(JC,{default:()=>KC});module.exports=kp(JC);var Ys=Qr(gp()),Cp=Qr(Vo()),Tp=Qr(_p()),Ep=Qr(require("path")),YC=(0,Tp.default)(async r=>{try{let e=Ep.default.resolve(process.cwd(),"./proto/user.proto"),t=Cp.loadSync(e),i=Ys.loadPackageDefinition(t);if(!r.config.GRPC_CLIENT_USER){r.log.error("Env config grpc client user empty or undifined");return}let s=new i.user.service.UserService(`${r.config.GRPC_CLIENT_USER}`,Ys.credentials.createInsecure());r.grpcUserClient||(r.grpcUserClient=s);let o=new Date;o.setSeconds(o.getSeconds()+1),s.waitForReady(o,l=>{if(l){r.log.error("Grpc client user falsed to coonnect error",l.stack);return}s.Healcheck({},(c,u)=>{if(c){r.log.error("Grpc client user healcheck error",c.stack);return}r.log.info("Grpc client user healcheck success")})}),r&&r.log.info("Load config grpc client user successs")}catch(e){r.log.error("Connect grpc client user error",e)}}),KC=YC;0&&(module.exports={});
/*! Bundled license information:

@grpc/proto-loader/build/src/util.js:
  (**
   * @license
   * Copyright 2018 gRPC authors.
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *     http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *
   *)

long/umd/index.js:
  (**
   * @license
   * Copyright 2009 The Closure Library Authors
   * Copyright 2020 Daniel Wirtz / The long.js Authors.
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *     http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *
   * SPDX-License-Identifier: Apache-2.0
   *)

@grpc/proto-loader/build/src/index.js:
  (**
   * @license
   * Copyright 2018 gRPC authors.
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *     http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *
   *)
*/
//# sourceMappingURL=grpc-client-user.plugin.js.map
