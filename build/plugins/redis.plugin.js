"use strict";var Ti=Object.create;var xe=Object.defineProperty;var Mi=Object.getOwnPropertyDescriptor;var Ri=Object.getOwnPropertyNames;var Bi=Object.getPrototypeOf,Ii=Object.prototype.hasOwnProperty;var d=(s,e)=>()=>(e||s((e={exports:{}}).exports,e),e.exports),Pi=(s,e)=>{for(var t in e)xe(s,t,{get:e[t],enumerable:!0})},ks=(s,e,t,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let i of Ri(e))!Ii.call(s,i)&&i!==t&&xe(s,i,{get:()=>e[i],enumerable:!(r=Mi(e,i))||r.enumerable});return s};var Cs=(s,e,t)=>(t=s!=null?Ti(Bi(s)):{},ks(e||!s||!s.__esModule?xe(t,"default",{value:s,enumerable:!0}):t,s)),Di=s=>ks(xe({},"__esModule",{value:!0}),s);var ws=d((Tc,Ze)=>{"use strict";var Fi=/at\s{1}(?:.*\.)?plugin\s{1}.*\n\s*(.*)/,Ni=/(\w*(\.\w*)*)\..*/;Ze.exports=function(e){if(e.name.length>0)return e.name;let t=Error.stackTraceLimit;Error.stackTraceLimit=10;try{throw new Error("anonymous function")}catch(r){return Error.stackTraceLimit=t,_s(r.stack)}};function _s(s){let e=s.match(Fi);return e?e[1].split(/[/\\]/).slice(-1)[0].match(Ni)[1]:"anonymous"}Ze.exports.extractPluginName=_s});var Es=d((Mc,xs)=>{"use strict";xs.exports=function(e){return e[0]==="@"&&(e=e.slice(1).replace("/","-")),e.replace(/-(.)/g,function(r,i){return i.toUpperCase()})}});var vs=d((Rc,Ee)=>{"use strict";var ji=ws(),qi=Es(),Qi=0;function $e(s,e={}){let t=!1;if(typeof s.default<"u"&&(s=s.default),typeof s!="function")throw new TypeError(`fastify-plugin expects a function, instead got a '${typeof s}'`);if(typeof e=="string"&&(e={fastify:e}),typeof e!="object"||Array.isArray(e)||e===null)throw new TypeError("The options object should be an object");if(e.fastify!==void 0&&typeof e.fastify!="string")throw new TypeError(`fastify-plugin expects a version string, instead got '${typeof e.fastify}'`);e.name||(t=!0,e.name=ji(s)+"-auto-"+Qi++),s[Symbol.for("skip-override")]=e.encapsulate!==!0,s[Symbol.for("fastify.display-name")]=e.name,s[Symbol.for("plugin-meta")]=e,s.default||(s.default=s);let r=qi(e.name);return!t&&!s[r]&&(s[r]=s),s}Ee.exports=$e;Ee.exports.default=$e;Ee.exports.fastifyPlugin=$e});var As=d((Bc,Li)=>{Li.exports={acl:{arity:-2,flags:[],keyStart:0,keyStop:0,step:0},append:{arity:3,flags:["write","denyoom","fast"],keyStart:1,keyStop:1,step:1},asking:{arity:1,flags:["fast"],keyStart:0,keyStop:0,step:0},auth:{arity:-2,flags:["noscript","loading","stale","fast","no_auth","allow_busy"],keyStart:0,keyStop:0,step:0},bgrewriteaof:{arity:1,flags:["admin","noscript","no_async_loading"],keyStart:0,keyStop:0,step:0},bgsave:{arity:-1,flags:["admin","noscript","no_async_loading"],keyStart:0,keyStop:0,step:0},bitcount:{arity:-2,flags:["readonly"],keyStart:1,keyStop:1,step:1},bitfield:{arity:-2,flags:["write","denyoom"],keyStart:1,keyStop:1,step:1},bitfield_ro:{arity:-2,flags:["readonly","fast"],keyStart:1,keyStop:1,step:1},bitop:{arity:-4,flags:["write","denyoom"],keyStart:2,keyStop:-1,step:1},bitpos:{arity:-3,flags:["readonly"],keyStart:1,keyStop:1,step:1},blmove:{arity:6,flags:["write","denyoom","noscript","blocking"],keyStart:1,keyStop:2,step:1},blmpop:{arity:-5,flags:["write","blocking","movablekeys"],keyStart:0,keyStop:0,step:0},blpop:{arity:-3,flags:["write","noscript","blocking"],keyStart:1,keyStop:-2,step:1},brpop:{arity:-3,flags:["write","noscript","blocking"],keyStart:1,keyStop:-2,step:1},brpoplpush:{arity:4,flags:["write","denyoom","noscript","blocking"],keyStart:1,keyStop:2,step:1},bzmpop:{arity:-5,flags:["write","blocking","movablekeys"],keyStart:0,keyStop:0,step:0},bzpopmax:{arity:-3,flags:["write","noscript","blocking","fast"],keyStart:1,keyStop:-2,step:1},bzpopmin:{arity:-3,flags:["write","noscript","blocking","fast"],keyStart:1,keyStop:-2,step:1},client:{arity:-2,flags:[],keyStart:0,keyStop:0,step:0},cluster:{arity:-2,flags:[],keyStart:0,keyStop:0,step:0},command:{arity:-1,flags:["loading","stale"],keyStart:0,keyStop:0,step:0},config:{arity:-2,flags:[],keyStart:0,keyStop:0,step:0},copy:{arity:-3,flags:["write","denyoom"],keyStart:1,keyStop:2,step:1},dbsize:{arity:1,flags:["readonly","fast"],keyStart:0,keyStop:0,step:0},debug:{arity:-2,flags:["admin","noscript","loading","stale"],keyStart:0,keyStop:0,step:0},decr:{arity:2,flags:["write","denyoom","fast"],keyStart:1,keyStop:1,step:1},decrby:{arity:3,flags:["write","denyoom","fast"],keyStart:1,keyStop:1,step:1},del:{arity:-2,flags:["write"],keyStart:1,keyStop:-1,step:1},discard:{arity:1,flags:["noscript","loading","stale","fast","allow_busy"],keyStart:0,keyStop:0,step:0},dump:{arity:2,flags:["readonly"],keyStart:1,keyStop:1,step:1},echo:{arity:2,flags:["fast"],keyStart:0,keyStop:0,step:0},eval:{arity:-3,flags:["noscript","stale","skip_monitor","no_mandatory_keys","movablekeys"],keyStart:0,keyStop:0,step:0},eval_ro:{arity:-3,flags:["readonly","noscript","stale","skip_monitor","no_mandatory_keys","movablekeys"],keyStart:0,keyStop:0,step:0},evalsha:{arity:-3,flags:["noscript","stale","skip_monitor","no_mandatory_keys","movablekeys"],keyStart:0,keyStop:0,step:0},evalsha_ro:{arity:-3,flags:["readonly","noscript","stale","skip_monitor","no_mandatory_keys","movablekeys"],keyStart:0,keyStop:0,step:0},exec:{arity:1,flags:["noscript","loading","stale","skip_slowlog"],keyStart:0,keyStop:0,step:0},exists:{arity:-2,flags:["readonly","fast"],keyStart:1,keyStop:-1,step:1},expire:{arity:-3,flags:["write","fast"],keyStart:1,keyStop:1,step:1},expireat:{arity:-3,flags:["write","fast"],keyStart:1,keyStop:1,step:1},expiretime:{arity:2,flags:["readonly","fast"],keyStart:1,keyStop:1,step:1},failover:{arity:-1,flags:["admin","noscript","stale"],keyStart:0,keyStop:0,step:0},fcall:{arity:-3,flags:["noscript","stale","skip_monitor","no_mandatory_keys","movablekeys"],keyStart:0,keyStop:0,step:0},fcall_ro:{arity:-3,flags:["readonly","noscript","stale","skip_monitor","no_mandatory_keys","movablekeys"],keyStart:0,keyStop:0,step:0},flushall:{arity:-1,flags:["write"],keyStart:0,keyStop:0,step:0},flushdb:{arity:-1,flags:["write"],keyStart:0,keyStop:0,step:0},function:{arity:-2,flags:[],keyStart:0,keyStop:0,step:0},geoadd:{arity:-5,flags:["write","denyoom"],keyStart:1,keyStop:1,step:1},geodist:{arity:-4,flags:["readonly"],keyStart:1,keyStop:1,step:1},geohash:{arity:-2,flags:["readonly"],keyStart:1,keyStop:1,step:1},geopos:{arity:-2,flags:["readonly"],keyStart:1,keyStop:1,step:1},georadius:{arity:-6,flags:["write","denyoom","movablekeys"],keyStart:1,keyStop:1,step:1},georadius_ro:{arity:-6,flags:["readonly"],keyStart:1,keyStop:1,step:1},georadiusbymember:{arity:-5,flags:["write","denyoom","movablekeys"],keyStart:1,keyStop:1,step:1},georadiusbymember_ro:{arity:-5,flags:["readonly"],keyStart:1,keyStop:1,step:1},geosearch:{arity:-7,flags:["readonly"],keyStart:1,keyStop:1,step:1},geosearchstore:{arity:-8,flags:["write","denyoom"],keyStart:1,keyStop:2,step:1},get:{arity:2,flags:["readonly","fast"],keyStart:1,keyStop:1,step:1},getbit:{arity:3,flags:["readonly","fast"],keyStart:1,keyStop:1,step:1},getdel:{arity:2,flags:["write","fast"],keyStart:1,keyStop:1,step:1},getex:{arity:-2,flags:["write","fast"],keyStart:1,keyStop:1,step:1},getrange:{arity:4,flags:["readonly"],keyStart:1,keyStop:1,step:1},getset:{arity:3,flags:["write","denyoom","fast"],keyStart:1,keyStop:1,step:1},hdel:{arity:-3,flags:["write","fast"],keyStart:1,keyStop:1,step:1},hello:{arity:-1,flags:["noscript","loading","stale","fast","no_auth","allow_busy"],keyStart:0,keyStop:0,step:0},hexists:{arity:3,flags:["readonly","fast"],keyStart:1,keyStop:1,step:1},hget:{arity:3,flags:["readonly","fast"],keyStart:1,keyStop:1,step:1},hgetall:{arity:2,flags:["readonly"],keyStart:1,keyStop:1,step:1},hincrby:{arity:4,flags:["write","denyoom","fast"],keyStart:1,keyStop:1,step:1},hincrbyfloat:{arity:4,flags:["write","denyoom","fast"],keyStart:1,keyStop:1,step:1},hkeys:{arity:2,flags:["readonly"],keyStart:1,keyStop:1,step:1},hlen:{arity:2,flags:["readonly","fast"],keyStart:1,keyStop:1,step:1},hmget:{arity:-3,flags:["readonly","fast"],keyStart:1,keyStop:1,step:1},hmset:{arity:-4,flags:["write","denyoom","fast"],keyStart:1,keyStop:1,step:1},hrandfield:{arity:-2,flags:["readonly"],keyStart:1,keyStop:1,step:1},hscan:{arity:-3,flags:["readonly"],keyStart:1,keyStop:1,step:1},hset:{arity:-4,flags:["write","denyoom","fast"],keyStart:1,keyStop:1,step:1},hsetnx:{arity:4,flags:["write","denyoom","fast"],keyStart:1,keyStop:1,step:1},hstrlen:{arity:3,flags:["readonly","fast"],keyStart:1,keyStop:1,step:1},hvals:{arity:2,flags:["readonly"],keyStart:1,keyStop:1,step:1},incr:{arity:2,flags:["write","denyoom","fast"],keyStart:1,keyStop:1,step:1},incrby:{arity:3,flags:["write","denyoom","fast"],keyStart:1,keyStop:1,step:1},incrbyfloat:{arity:3,flags:["write","denyoom","fast"],keyStart:1,keyStop:1,step:1},info:{arity:-1,flags:["loading","stale"],keyStart:0,keyStop:0,step:0},keys:{arity:2,flags:["readonly"],keyStart:0,keyStop:0,step:0},lastsave:{arity:1,flags:["loading","stale","fast"],keyStart:0,keyStop:0,step:0},latency:{arity:-2,flags:[],keyStart:0,keyStop:0,step:0},lcs:{arity:-3,flags:["readonly"],keyStart:1,keyStop:2,step:1},lindex:{arity:3,flags:["readonly"],keyStart:1,keyStop:1,step:1},linsert:{arity:5,flags:["write","denyoom"],keyStart:1,keyStop:1,step:1},llen:{arity:2,flags:["readonly","fast"],keyStart:1,keyStop:1,step:1},lmove:{arity:5,flags:["write","denyoom"],keyStart:1,keyStop:2,step:1},lmpop:{arity:-4,flags:["write","movablekeys"],keyStart:0,keyStop:0,step:0},lolwut:{arity:-1,flags:["readonly","fast"],keyStart:0,keyStop:0,step:0},lpop:{arity:-2,flags:["write","fast"],keyStart:1,keyStop:1,step:1},lpos:{arity:-3,flags:["readonly"],keyStart:1,keyStop:1,step:1},lpush:{arity:-3,flags:["write","denyoom","fast"],keyStart:1,keyStop:1,step:1},lpushx:{arity:-3,flags:["write","denyoom","fast"],keyStart:1,keyStop:1,step:1},lrange:{arity:4,flags:["readonly"],keyStart:1,keyStop:1,step:1},lrem:{arity:4,flags:["write"],keyStart:1,keyStop:1,step:1},lset:{arity:4,flags:["write","denyoom"],keyStart:1,keyStop:1,step:1},ltrim:{arity:4,flags:["write"],keyStart:1,keyStop:1,step:1},memory:{arity:-2,flags:[],keyStart:0,keyStop:0,step:0},mget:{arity:-2,flags:["readonly","fast"],keyStart:1,keyStop:-1,step:1},migrate:{arity:-6,flags:["write","movablekeys"],keyStart:3,keyStop:3,step:1},module:{arity:-2,flags:[],keyStart:0,keyStop:0,step:0},monitor:{arity:1,flags:["admin","noscript","loading","stale"],keyStart:0,keyStop:0,step:0},move:{arity:3,flags:["write","fast"],keyStart:1,keyStop:1,step:1},mset:{arity:-3,flags:["write","denyoom"],keyStart:1,keyStop:-1,step:2},msetnx:{arity:-3,flags:["write","denyoom"],keyStart:1,keyStop:-1,step:2},multi:{arity:1,flags:["noscript","loading","stale","fast","allow_busy"],keyStart:0,keyStop:0,step:0},object:{arity:-2,flags:[],keyStart:0,keyStop:0,step:0},persist:{arity:2,flags:["write","fast"],keyStart:1,keyStop:1,step:1},pexpire:{arity:-3,flags:["write","fast"],keyStart:1,keyStop:1,step:1},pexpireat:{arity:-3,flags:["write","fast"],keyStart:1,keyStop:1,step:1},pexpiretime:{arity:2,flags:["readonly","fast"],keyStart:1,keyStop:1,step:1},pfadd:{arity:-2,flags:["write","denyoom","fast"],keyStart:1,keyStop:1,step:1},pfcount:{arity:-2,flags:["readonly"],keyStart:1,keyStop:-1,step:1},pfdebug:{arity:3,flags:["write","denyoom","admin"],keyStart:2,keyStop:2,step:1},pfmerge:{arity:-2,flags:["write","denyoom"],keyStart:1,keyStop:-1,step:1},pfselftest:{arity:1,flags:["admin"],keyStart:0,keyStop:0,step:0},ping:{arity:-1,flags:["fast"],keyStart:0,keyStop:0,step:0},psetex:{arity:4,flags:["write","denyoom"],keyStart:1,keyStop:1,step:1},psubscribe:{arity:-2,flags:["pubsub","noscript","loading","stale"],keyStart:0,keyStop:0,step:0},psync:{arity:-3,flags:["admin","noscript","no_async_loading","no_multi"],keyStart:0,keyStop:0,step:0},pttl:{arity:2,flags:["readonly","fast"],keyStart:1,keyStop:1,step:1},publish:{arity:3,flags:["pubsub","loading","stale","fast"],keyStart:0,keyStop:0,step:0},pubsub:{arity:-2,flags:[],keyStart:0,keyStop:0,step:0},punsubscribe:{arity:-1,flags:["pubsub","noscript","loading","stale"],keyStart:0,keyStop:0,step:0},quit:{arity:-1,flags:["noscript","loading","stale","fast","no_auth","allow_busy"],keyStart:0,keyStop:0,step:0},randomkey:{arity:1,flags:["readonly"],keyStart:0,keyStop:0,step:0},readonly:{arity:1,flags:["loading","stale","fast"],keyStart:0,keyStop:0,step:0},readwrite:{arity:1,flags:["loading","stale","fast"],keyStart:0,keyStop:0,step:0},rename:{arity:3,flags:["write"],keyStart:1,keyStop:2,step:1},renamenx:{arity:3,flags:["write","fast"],keyStart:1,keyStop:2,step:1},replconf:{arity:-1,flags:["admin","noscript","loading","stale","allow_busy"],keyStart:0,keyStop:0,step:0},replicaof:{arity:3,flags:["admin","noscript","stale","no_async_loading"],keyStart:0,keyStop:0,step:0},reset:{arity:1,flags:["noscript","loading","stale","fast","no_auth","allow_busy"],keyStart:0,keyStop:0,step:0},restore:{arity:-4,flags:["write","denyoom"],keyStart:1,keyStop:1,step:1},"restore-asking":{arity:-4,flags:["write","denyoom","asking"],keyStart:1,keyStop:1,step:1},role:{arity:1,flags:["noscript","loading","stale","fast"],keyStart:0,keyStop:0,step:0},rpop:{arity:-2,flags:["write","fast"],keyStart:1,keyStop:1,step:1},rpoplpush:{arity:3,flags:["write","denyoom"],keyStart:1,keyStop:2,step:1},rpush:{arity:-3,flags:["write","denyoom","fast"],keyStart:1,keyStop:1,step:1},rpushx:{arity:-3,flags:["write","denyoom","fast"],keyStart:1,keyStop:1,step:1},sadd:{arity:-3,flags:["write","denyoom","fast"],keyStart:1,keyStop:1,step:1},save:{arity:1,flags:["admin","noscript","no_async_loading","no_multi"],keyStart:0,keyStop:0,step:0},scan:{arity:-2,flags:["readonly"],keyStart:0,keyStop:0,step:0},scard:{arity:2,flags:["readonly","fast"],keyStart:1,keyStop:1,step:1},script:{arity:-2,flags:[],keyStart:0,keyStop:0,step:0},sdiff:{arity:-2,flags:["readonly"],keyStart:1,keyStop:-1,step:1},sdiffstore:{arity:-3,flags:["write","denyoom"],keyStart:1,keyStop:-1,step:1},select:{arity:2,flags:["loading","stale","fast"],keyStart:0,keyStop:0,step:0},set:{arity:-3,flags:["write","denyoom"],keyStart:1,keyStop:1,step:1},setbit:{arity:4,flags:["write","denyoom"],keyStart:1,keyStop:1,step:1},setex:{arity:4,flags:["write","denyoom"],keyStart:1,keyStop:1,step:1},setnx:{arity:3,flags:["write","denyoom","fast"],keyStart:1,keyStop:1,step:1},setrange:{arity:4,flags:["write","denyoom"],keyStart:1,keyStop:1,step:1},shutdown:{arity:-1,flags:["admin","noscript","loading","stale","no_multi","allow_busy"],keyStart:0,keyStop:0,step:0},sinter:{arity:-2,flags:["readonly"],keyStart:1,keyStop:-1,step:1},sintercard:{arity:-3,flags:["readonly","movablekeys"],keyStart:0,keyStop:0,step:0},sinterstore:{arity:-3,flags:["write","denyoom"],keyStart:1,keyStop:-1,step:1},sismember:{arity:3,flags:["readonly","fast"],keyStart:1,keyStop:1,step:1},slaveof:{arity:3,flags:["admin","noscript","stale","no_async_loading"],keyStart:0,keyStop:0,step:0},slowlog:{arity:-2,flags:[],keyStart:0,keyStop:0,step:0},smembers:{arity:2,flags:["readonly"],keyStart:1,keyStop:1,step:1},smismember:{arity:-3,flags:["readonly","fast"],keyStart:1,keyStop:1,step:1},smove:{arity:4,flags:["write","fast"],keyStart:1,keyStop:2,step:1},sort:{arity:-2,flags:["write","denyoom","movablekeys"],keyStart:1,keyStop:1,step:1},sort_ro:{arity:-2,flags:["readonly","movablekeys"],keyStart:1,keyStop:1,step:1},spop:{arity:-2,flags:["write","fast"],keyStart:1,keyStop:1,step:1},spublish:{arity:3,flags:["pubsub","loading","stale","fast"],keyStart:1,keyStop:1,step:1},srandmember:{arity:-2,flags:["readonly"],keyStart:1,keyStop:1,step:1},srem:{arity:-3,flags:["write","fast"],keyStart:1,keyStop:1,step:1},sscan:{arity:-3,flags:["readonly"],keyStart:1,keyStop:1,step:1},ssubscribe:{arity:-2,flags:["pubsub","noscript","loading","stale"],keyStart:1,keyStop:-1,step:1},strlen:{arity:2,flags:["readonly","fast"],keyStart:1,keyStop:1,step:1},subscribe:{arity:-2,flags:["pubsub","noscript","loading","stale"],keyStart:0,keyStop:0,step:0},substr:{arity:4,flags:["readonly"],keyStart:1,keyStop:1,step:1},sunion:{arity:-2,flags:["readonly"],keyStart:1,keyStop:-1,step:1},sunionstore:{arity:-3,flags:["write","denyoom"],keyStart:1,keyStop:-1,step:1},sunsubscribe:{arity:-1,flags:["pubsub","noscript","loading","stale"],keyStart:1,keyStop:-1,step:1},swapdb:{arity:3,flags:["write","fast"],keyStart:0,keyStop:0,step:0},sync:{arity:1,flags:["admin","noscript","no_async_loading","no_multi"],keyStart:0,keyStop:0,step:0},time:{arity:1,flags:["loading","stale","fast"],keyStart:0,keyStop:0,step:0},touch:{arity:-2,flags:["readonly","fast"],keyStart:1,keyStop:-1,step:1},ttl:{arity:2,flags:["readonly","fast"],keyStart:1,keyStop:1,step:1},type:{arity:2,flags:["readonly","fast"],keyStart:1,keyStop:1,step:1},unlink:{arity:-2,flags:["write","fast"],keyStart:1,keyStop:-1,step:1},unsubscribe:{arity:-1,flags:["pubsub","noscript","loading","stale"],keyStart:0,keyStop:0,step:0},unwatch:{arity:1,flags:["noscript","loading","stale","fast","allow_busy"],keyStart:0,keyStop:0,step:0},wait:{arity:3,flags:["noscript"],keyStart:0,keyStop:0,step:0},watch:{arity:-2,flags:["noscript","loading","stale","fast","allow_busy"],keyStart:1,keyStop:-1,step:1},xack:{arity:-4,flags:["write","fast"],keyStart:1,keyStop:1,step:1},xadd:{arity:-5,flags:["write","denyoom","fast"],keyStart:1,keyStop:1,step:1},xautoclaim:{arity:-6,flags:["write","fast"],keyStart:1,keyStop:1,step:1},xclaim:{arity:-6,flags:["write","fast"],keyStart:1,keyStop:1,step:1},xdel:{arity:-3,flags:["write","fast"],keyStart:1,keyStop:1,step:1},xgroup:{arity:-2,flags:[],keyStart:0,keyStop:0,step:0},xinfo:{arity:-2,flags:[],keyStart:0,keyStop:0,step:0},xlen:{arity:2,flags:["readonly","fast"],keyStart:1,keyStop:1,step:1},xpending:{arity:-3,flags:["readonly"],keyStart:1,keyStop:1,step:1},xrange:{arity:-4,flags:["readonly"],keyStart:1,keyStop:1,step:1},xread:{arity:-4,flags:["readonly","blocking","movablekeys"],keyStart:0,keyStop:0,step:0},xreadgroup:{arity:-7,flags:["write","blocking","movablekeys"],keyStart:0,keyStop:0,step:0},xrevrange:{arity:-4,flags:["readonly"],keyStart:1,keyStop:1,step:1},xsetid:{arity:-3,flags:["write","denyoom","fast"],keyStart:1,keyStop:1,step:1},xtrim:{arity:-4,flags:["write"],keyStart:1,keyStop:1,step:1},zadd:{arity:-4,flags:["write","denyoom","fast"],keyStart:1,keyStop:1,step:1},zcard:{arity:2,flags:["readonly","fast"],keyStart:1,keyStop:1,step:1},zcount:{arity:4,flags:["readonly","fast"],keyStart:1,keyStop:1,step:1},zdiff:{arity:-3,flags:["readonly","movablekeys"],keyStart:0,keyStop:0,step:0},zdiffstore:{arity:-4,flags:["write","denyoom","movablekeys"],keyStart:1,keyStop:1,step:1},zincrby:{arity:4,flags:["write","denyoom","fast"],keyStart:1,keyStop:1,step:1},zinter:{arity:-3,flags:["readonly","movablekeys"],keyStart:0,keyStop:0,step:0},zintercard:{arity:-3,flags:["readonly","movablekeys"],keyStart:0,keyStop:0,step:0},zinterstore:{arity:-4,flags:["write","denyoom","movablekeys"],keyStart:1,keyStop:1,step:1},zlexcount:{arity:4,flags:["readonly","fast"],keyStart:1,keyStop:1,step:1},zmpop:{arity:-4,flags:["write","movablekeys"],keyStart:0,keyStop:0,step:0},zmscore:{arity:-3,flags:["readonly","fast"],keyStart:1,keyStop:1,step:1},zpopmax:{arity:-2,flags:["write","fast"],keyStart:1,keyStop:1,step:1},zpopmin:{arity:-2,flags:["write","fast"],keyStart:1,keyStop:1,step:1},zrandmember:{arity:-2,flags:["readonly"],keyStart:1,keyStop:1,step:1},zrange:{arity:-4,flags:["readonly"],keyStart:1,keyStop:1,step:1},zrangebylex:{arity:-4,flags:["readonly"],keyStart:1,keyStop:1,step:1},zrangebyscore:{arity:-4,flags:["readonly"],keyStart:1,keyStop:1,step:1},zrangestore:{arity:-5,flags:["write","denyoom"],keyStart:1,keyStop:2,step:1},zrank:{arity:3,flags:["readonly","fast"],keyStart:1,keyStop:1,step:1},zrem:{arity:-3,flags:["write","fast"],keyStart:1,keyStop:1,step:1},zremrangebylex:{arity:4,flags:["write"],keyStart:1,keyStop:1,step:1},zremrangebyrank:{arity:4,flags:["write"],keyStart:1,keyStop:1,step:1},zremrangebyscore:{arity:4,flags:["write"],keyStart:1,keyStop:1,step:1},zrevrange:{arity:-4,flags:["readonly"],keyStart:1,keyStop:1,step:1},zrevrangebylex:{arity:-4,flags:["readonly"],keyStart:1,keyStop:1,step:1},zrevrangebyscore:{arity:-4,flags:["readonly"],keyStart:1,keyStop:1,step:1},zrevrank:{arity:3,flags:["readonly","fast"],keyStart:1,keyStop:1,step:1},zscan:{arity:-3,flags:["readonly"],keyStart:1,keyStop:1,step:1},zscore:{arity:3,flags:["readonly","fast"],keyStart:1,keyStop:1,step:1},zunion:{arity:-3,flags:["readonly","movablekeys"],keyStart:0,keyStop:0,step:0},zunionstore:{arity:-4,flags:["write","denyoom","movablekeys"],keyStart:1,keyStop:1,step:1}}});var re=d(O=>{"use strict";var zi=O&&O.__importDefault||function(s){return s&&s.__esModule?s:{default:s}};Object.defineProperty(O,"__esModule",{value:!0});O.getKeyIndexes=O.hasFlag=O.exists=O.list=void 0;var ve=zi(As());O.list=Object.keys(ve.default);var et={};O.list.forEach(s=>{et[s]=ve.default[s].flags.reduce(function(e,t){return e[t]=!0,e},{})});function Ui(s){return!!ve.default[s]}O.exists=Ui;function Gi(s,e){if(!et[s])throw new Error("Unknown command "+s);return!!et[s][e]}O.hasFlag=Gi;function Yi(s,e,t){let r=ve.default[s];if(!r)throw new Error("Unknown command "+s);if(!Array.isArray(e))throw new Error("Expect args to be an array");let i=[],n=!!(t&&t.parseExternalKey),o=(a,u)=>{let l=[],f=Number(a[u]);for(let h=0;h<f;h++)l.push(h+u+1);return l},c=(a,u,l)=>{for(let f=u;f<a.length-1;f+=1)if(String(a[f]).toLowerCase()===l.toLowerCase())return f+1;return null};switch(s){case"zunionstore":case"zinterstore":case"zdiffstore":i.push(0,...o(e,1));break;case"eval":case"evalsha":case"eval_ro":case"evalsha_ro":case"fcall":case"fcall_ro":case"blmpop":case"bzmpop":i.push(...o(e,1));break;case"sintercard":case"lmpop":case"zunion":case"zinter":case"zmpop":case"zintercard":case"zdiff":{i.push(...o(e,0));break}case"georadius":{i.push(0);let a=c(e,5,"STORE");a&&i.push(a);let u=c(e,5,"STOREDIST");u&&i.push(u);break}case"georadiusbymember":{i.push(0);let a=c(e,4,"STORE");a&&i.push(a);let u=c(e,4,"STOREDIST");u&&i.push(u);break}case"sort":case"sort_ro":i.push(0);for(let a=1;a<e.length-1;a++){let u=e[a];if(typeof u!="string")continue;let l=u.toUpperCase();l==="GET"?(a+=1,u=e[a],u!=="#"&&(n?i.push([a,Os(u)]):i.push(a))):l==="BY"?(a+=1,n?i.push([a,Os(e[a])]):i.push(a)):l==="STORE"&&(a+=1,i.push(a))}break;case"migrate":if(e[2]==="")for(let a=5;a<e.length-1;a++){let u=e[a];if(typeof u=="string"&&u.toUpperCase()==="KEYS"){for(let l=a+1;l<e.length;l++)i.push(l);break}}else i.push(2);break;case"xreadgroup":case"xread":for(let a=s==="xread"?0:3;a<e.length-1;a++)if(String(e[a]).toUpperCase()==="STREAMS"){for(let u=a+1;u<=a+(e.length-1-a)/2;u++)i.push(u);break}break;default:if(r.step>0){let a=r.keyStart-1,u=r.keyStop>0?r.keyStop:e.length+r.keyStop+1;for(let l=a;l<u;l+=r.step)i.push(l)}break}return i}O.getKeyIndexes=Yi;function Os(s){typeof s!="string"&&(s=String(s));let e=s.indexOf("->");return e===-1?s.length:e}});var Ts=d(L=>{"use strict";Object.defineProperty(L,"__esModule",{value:!0});L.tryCatch=L.errorObj=void 0;L.errorObj={e:{}};var tt;function Vi(s,e){try{let t=tt;return tt=null,t.apply(this,arguments)}catch(t){return L.errorObj.e=t,L.errorObj}}function Hi(s){return tt=s,Vi}L.tryCatch=Hi});var z=d(st=>{"use strict";Object.defineProperty(st,"__esModule",{value:!0});var ie=Ts();function Ms(s){setTimeout(function(){throw s},0)}function Ki(s,e,t){return typeof e=="function"&&s.then(r=>{let i;t!==void 0&&Object(t).spread&&Array.isArray(r)?i=ie.tryCatch(e).apply(void 0,[null].concat(r)):i=r===void 0?ie.tryCatch(e)(null):ie.tryCatch(e)(null,r),i===ie.errorObj&&Ms(i.e)},r=>{if(!r){let n=new Error(r+"");Object.assign(n,{cause:r}),r=n}let i=ie.tryCatch(e)(r);i===ie.errorObj&&Ms(i.e)}),s}st.default=Ki});var Is=d((Fc,Bs)=>{"use strict";var Rs=require("assert"),pe=require("util");function ne(s){Object.defineProperty(this,"message",{value:s||"",configurable:!0,writable:!0}),Error.captureStackTrace(this,this.constructor)}pe.inherits(ne,Error);Object.defineProperty(ne.prototype,"name",{value:"RedisError",configurable:!0,writable:!0});function rt(s,e,t){Rs(e),Rs.strictEqual(typeof t,"number"),Object.defineProperty(this,"message",{value:s||"",configurable:!0,writable:!0});let r=Error.stackTraceLimit;Error.stackTraceLimit=2,Error.captureStackTrace(this,this.constructor),Error.stackTraceLimit=r,this.offset=t,this.buffer=e}pe.inherits(rt,ne);Object.defineProperty(rt.prototype,"name",{value:"ParserError",configurable:!0,writable:!0});function it(s){Object.defineProperty(this,"message",{value:s||"",configurable:!0,writable:!0});let e=Error.stackTraceLimit;Error.stackTraceLimit=2,Error.captureStackTrace(this,this.constructor),Error.stackTraceLimit=e}pe.inherits(it,ne);Object.defineProperty(it.prototype,"name",{value:"ReplyError",configurable:!0,writable:!0});function Ae(s){Object.defineProperty(this,"message",{value:s||"",configurable:!0,writable:!0}),Error.captureStackTrace(this,this.constructor)}pe.inherits(Ae,ne);Object.defineProperty(Ae.prototype,"name",{value:"AbortError",configurable:!0,writable:!0});function nt(s){Object.defineProperty(this,"message",{value:s||"",configurable:!0,writable:!0}),Error.captureStackTrace(this,this.constructor)}pe.inherits(nt,Ae);Object.defineProperty(nt.prototype,"name",{value:"InterruptError",configurable:!0,writable:!0});Bs.exports={RedisError:ne,ParserError:rt,ReplyError:it,AbortError:Ae,InterruptError:nt}});var Fs=d((Nc,Ds)=>{"use strict";var Ps=require("assert"),oe=class extends Error{get name(){return this.constructor.name}},ot=class extends oe{constructor(e,t,r){Ps(t),Ps.strictEqual(typeof r,"number");let i=Error.stackTraceLimit;Error.stackTraceLimit=2,super(e),Error.stackTraceLimit=i,this.offset=r,this.buffer=t}get name(){return this.constructor.name}},at=class extends oe{constructor(e){let t=Error.stackTraceLimit;Error.stackTraceLimit=2,super(e),Error.stackTraceLimit=t}get name(){return this.constructor.name}},Oe=class extends oe{get name(){return this.constructor.name}},ct=class extends Oe{get name(){return this.constructor.name}};Ds.exports={RedisError:oe,ParserError:ot,ReplyError:at,AbortError:Oe,InterruptError:ct}});var Z=d((jc,Ns)=>{"use strict";var Wi=process.version.charCodeAt(1)<55&&process.version.charCodeAt(2)===46?Is():Fs();Ns.exports=Wi});var Te=d((qc,lt)=>{var js=[0,4129,8258,12387,16516,20645,24774,28903,33032,37161,41290,45419,49548,53677,57806,61935,4657,528,12915,8786,21173,17044,29431,25302,37689,33560,45947,41818,54205,50076,62463,58334,9314,13379,1056,5121,25830,29895,17572,21637,42346,46411,34088,38153,58862,62927,50604,54669,13907,9842,5649,1584,30423,26358,22165,18100,46939,42874,38681,34616,63455,59390,55197,51132,18628,22757,26758,30887,2112,6241,10242,14371,51660,55789,59790,63919,35144,39273,43274,47403,23285,19156,31415,27286,6769,2640,14899,10770,56317,52188,64447,60318,39801,35672,47931,43802,27814,31879,19684,23749,11298,15363,3168,7233,60846,64911,52716,56781,44330,48395,36200,40265,32407,28342,24277,20212,15891,11826,7761,3696,65439,61374,57309,53244,48923,44858,40793,36728,37256,33193,45514,41451,53516,49453,61774,57711,4224,161,12482,8419,20484,16421,28742,24679,33721,37784,41979,46042,49981,54044,58239,62302,689,4752,8947,13010,16949,21012,25207,29270,46570,42443,38312,34185,62830,58703,54572,50445,13538,9411,5280,1153,29798,25671,21540,17413,42971,47098,34713,38840,59231,63358,50973,55100,9939,14066,1681,5808,26199,30326,17941,22068,55628,51565,63758,59695,39368,35305,47498,43435,22596,18533,30726,26663,6336,2273,14466,10403,52093,56156,60223,64286,35833,39896,43963,48026,19061,23124,27191,31254,2801,6864,10931,14994,64814,60687,56684,52557,48554,44427,40424,36297,31782,27655,23652,19525,15522,11395,7392,3265,61215,65342,53085,57212,44955,49082,36825,40952,28183,32310,20053,24180,11923,16050,3793,7920],Ji=function(e){for(var t,r=0,i=0,n=[],o=e.length;r<o;r++)t=e.charCodeAt(r),t<128?n[i++]=t:t<2048?(n[i++]=t>>6|192,n[i++]=t&63|128):(t&64512)===55296&&r+1<e.length&&(e.charCodeAt(r+1)&64512)===56320?(t=65536+((t&1023)<<10)+(e.charCodeAt(++r)&1023),n[i++]=t>>18|240,n[i++]=t>>12&63|128,n[i++]=t>>6&63|128,n[i++]=t&63|128):(n[i++]=t>>12|224,n[i++]=t>>6&63|128,n[i++]=t&63|128);return n},qs=lt.exports=function(e){for(var t,r=0,i=-1,n=0,o=0,c=typeof e=="string"?Ji(e):e,a=c.length;r<a;){if(t=c[r++],i===-1)t===123&&(i=r);else if(t!==125)o=js[(t^o>>8)&255]^o<<8;else if(r-1!==i)return o&16383;n=js[(t^n>>8)&255]^n<<8}return n&16383};lt.exports.generateMulti=function(e){for(var t=1,r=e.length,i=qs(e[0]);t<r;)if(qs(e[t++])!==i)return-1;return i}});var Hs=d((Qc,Vs)=>{var Ls=9007199254740991,Xi="[object Arguments]",Zi="[object Function]",$i="[object GeneratorFunction]",en=/^(?:0|[1-9]\d*)$/;function zs(s,e,t){switch(t.length){case 0:return s.call(e);case 1:return s.call(e,t[0]);case 2:return s.call(e,t[0],t[1]);case 3:return s.call(e,t[0],t[1],t[2])}return s.apply(e,t)}function tn(s,e){for(var t=-1,r=Array(s);++t<s;)r[t]=e(t);return r}var ye=Object.prototype,ge=ye.hasOwnProperty,Us=ye.toString,sn=ye.propertyIsEnumerable,Qs=Math.max;function rn(s,e){var t=pn(s)||dn(s)?tn(s.length,String):[],r=t.length,i=!!r;for(var n in s)(e||ge.call(s,n))&&!(i&&(n=="length"||Ys(n,r)))&&t.push(n);return t}function nn(s,e,t,r){return s===void 0||ut(s,ye[t])&&!ge.call(r,t)?e:s}function on(s,e,t){var r=s[e];(!(ge.call(s,e)&&ut(r,t))||t===void 0&&!(e in s))&&(s[e]=t)}function an(s){if(!ht(s))return hn(s);var e=fn(s),t=[];for(var r in s)r=="constructor"&&(e||!ge.call(s,r))||t.push(r);return t}function Gs(s,e){return e=Qs(e===void 0?s.length-1:e,0),function(){for(var t=arguments,r=-1,i=Qs(t.length-e,0),n=Array(i);++r<i;)n[r]=t[e+r];r=-1;for(var o=Array(e+1);++r<e;)o[r]=t[r];return o[e]=n,zs(s,this,o)}}function cn(s,e,t,r){t||(t={});for(var i=-1,n=e.length;++i<n;){var o=e[i],c=r?r(t[o],s[o],o,t,s):void 0;on(t,o,c===void 0?s[o]:c)}return t}function ln(s){return Gs(function(e,t){var r=-1,i=t.length,n=i>1?t[i-1]:void 0,o=i>2?t[2]:void 0;for(n=s.length>3&&typeof n=="function"?(i--,n):void 0,o&&un(t[0],t[1],o)&&(n=i<3?void 0:n,i=1),e=Object(e);++r<i;){var c=t[r];c&&s(e,c,r,n)}return e})}function Ys(s,e){return e=e??Ls,!!e&&(typeof s=="number"||en.test(s))&&s>-1&&s%1==0&&s<e}function un(s,e,t){if(!ht(t))return!1;var r=typeof e;return(r=="number"?ft(t)&&Ys(e,t.length):r=="string"&&e in t)?ut(t[e],s):!1}function fn(s){var e=s&&s.constructor,t=typeof e=="function"&&e.prototype||ye;return s===t}function hn(s){var e=[];if(s!=null)for(var t in Object(s))e.push(t);return e}function ut(s,e){return s===e||s!==s&&e!==e}function dn(s){return yn(s)&&ge.call(s,"callee")&&(!sn.call(s,"callee")||Us.call(s)==Xi)}var pn=Array.isArray;function ft(s){return s!=null&&mn(s.length)&&!gn(s)}function yn(s){return bn(s)&&ft(s)}function gn(s){var e=ht(s)?Us.call(s):"";return e==Zi||e==$i}function mn(s){return typeof s=="number"&&s>-1&&s%1==0&&s<=Ls}function ht(s){var e=typeof s;return!!s&&(e=="object"||e=="function")}function bn(s){return!!s&&typeof s=="object"}var Sn=ln(function(s,e,t,r){cn(e,Cn(e),s,r)}),kn=Gs(function(s){return s.push(void 0,nn),zs(Sn,void 0,s)});function Cn(s){return ft(s)?rn(s,!0):an(s)}Vs.exports=kn});var Js=d((Lc,Ws)=>{var _n=9007199254740991,wn="[object Arguments]",xn="[object Function]",En="[object GeneratorFunction]",dt=Object.prototype,vn=dt.hasOwnProperty,Ks=dt.toString,An=dt.propertyIsEnumerable;function On(s){return Mn(s)&&vn.call(s,"callee")&&(!An.call(s,"callee")||Ks.call(s)==wn)}function Tn(s){return s!=null&&Bn(s.length)&&!Rn(s)}function Mn(s){return Pn(s)&&Tn(s)}function Rn(s){var e=In(s)?Ks.call(s):"";return e==xn||e==En}function Bn(s){return typeof s=="number"&&s>-1&&s%1==0&&s<=_n}function In(s){var e=typeof s;return!!s&&(e=="object"||e=="function")}function Pn(s){return!!s&&typeof s=="object"}Ws.exports=On});var Me=d(U=>{"use strict";Object.defineProperty(U,"__esModule",{value:!0});U.isArguments=U.defaults=U.noop=void 0;var Dn=Hs();U.defaults=Dn;var Fn=Js();U.isArguments=Fn;function Nn(){}U.noop=Nn});var Zs=d((Uc,Xs)=>{var ae=1e3,ce=ae*60,le=ce*60,$=le*24,jn=$*7,qn=$*365.25;Xs.exports=function(s,e){e=e||{};var t=typeof s;if(t==="string"&&s.length>0)return Qn(s);if(t==="number"&&isFinite(s))return e.long?zn(s):Ln(s);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(s))};function Qn(s){if(s=String(s),!(s.length>100)){var e=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(s);if(e){var t=parseFloat(e[1]),r=(e[2]||"ms").toLowerCase();switch(r){case"years":case"year":case"yrs":case"yr":case"y":return t*qn;case"weeks":case"week":case"w":return t*jn;case"days":case"day":case"d":return t*$;case"hours":case"hour":case"hrs":case"hr":case"h":return t*le;case"minutes":case"minute":case"mins":case"min":case"m":return t*ce;case"seconds":case"second":case"secs":case"sec":case"s":return t*ae;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return t;default:return}}}}function Ln(s){var e=Math.abs(s);return e>=$?Math.round(s/$)+"d":e>=le?Math.round(s/le)+"h":e>=ce?Math.round(s/ce)+"m":e>=ae?Math.round(s/ae)+"s":s+"ms"}function zn(s){var e=Math.abs(s);return e>=$?Re(s,e,$,"day"):e>=le?Re(s,e,le,"hour"):e>=ce?Re(s,e,ce,"minute"):e>=ae?Re(s,e,ae,"second"):s+" ms"}function Re(s,e,t,r){var i=e>=t*1.5;return Math.round(s/t)+" "+r+(i?"s":"")}});var pt=d((Gc,$s)=>{function Un(s){t.debug=t,t.default=t,t.coerce=a,t.disable=n,t.enable=i,t.enabled=o,t.humanize=Zs(),t.destroy=u,Object.keys(s).forEach(l=>{t[l]=s[l]}),t.names=[],t.skips=[],t.formatters={};function e(l){let f=0;for(let h=0;h<l.length;h++)f=(f<<5)-f+l.charCodeAt(h),f|=0;return t.colors[Math.abs(f)%t.colors.length]}t.selectColor=e;function t(l){let f,h=null,p,m;function F(...R){if(!F.enabled)return;let X=F,_e=Number(new Date),vi=_e-(f||_e);X.diff=vi,X.prev=f,X.curr=_e,f=_e,R[0]=t.coerce(R[0]),typeof R[0]!="string"&&R.unshift("%O");let we=0;R[0]=R[0].replace(/%([a-zA-Z%])/g,(Xe,Ai)=>{if(Xe==="%%")return"%";we++;let Ss=t.formatters[Ai];if(typeof Ss=="function"){let Oi=R[we];Xe=Ss.call(X,Oi),R.splice(we,1),we--}return Xe}),t.formatArgs.call(X,R),(X.log||t.log).apply(X,R)}return F.namespace=l,F.useColors=t.useColors(),F.color=t.selectColor(l),F.extend=r,F.destroy=t.destroy,Object.defineProperty(F,"enabled",{enumerable:!0,configurable:!1,get:()=>h!==null?h:(p!==t.namespaces&&(p=t.namespaces,m=t.enabled(l)),m),set:R=>{h=R}}),typeof t.init=="function"&&t.init(F),F}function r(l,f){let h=t(this.namespace+(typeof f>"u"?":":f)+l);return h.log=this.log,h}function i(l){t.save(l),t.namespaces=l,t.names=[],t.skips=[];let f,h=(typeof l=="string"?l:"").split(/[\s,]+/),p=h.length;for(f=0;f<p;f++)h[f]&&(l=h[f].replace(/\*/g,".*?"),l[0]==="-"?t.skips.push(new RegExp("^"+l.slice(1)+"$")):t.names.push(new RegExp("^"+l+"$")))}function n(){let l=[...t.names.map(c),...t.skips.map(c).map(f=>"-"+f)].join(",");return t.enable(""),l}function o(l){if(l[l.length-1]==="*")return!0;let f,h;for(f=0,h=t.skips.length;f<h;f++)if(t.skips[f].test(l))return!1;for(f=0,h=t.names.length;f<h;f++)if(t.names[f].test(l))return!0;return!1}function c(l){return l.toString().substring(2,l.toString().length-2).replace(/\.\*\?$/,"*")}function a(l){return l instanceof Error?l.stack||l.message:l}function u(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return t.enable(t.load()),t}$s.exports=Un});var er=d((T,Be)=>{T.formatArgs=Yn;T.save=Vn;T.load=Hn;T.useColors=Gn;T.storage=Kn();T.destroy=(()=>{let s=!1;return()=>{s||(s=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})();T.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function Gn(){return typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs)?!0:typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/)?!1:typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function Yn(s){if(s[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+s[0]+(this.useColors?"%c ":" ")+"+"+Be.exports.humanize(this.diff),!this.useColors)return;let e="color: "+this.color;s.splice(1,0,e,"color: inherit");let t=0,r=0;s[0].replace(/%[a-zA-Z%]/g,i=>{i!=="%%"&&(t++,i==="%c"&&(r=t))}),s.splice(r,0,e)}T.log=console.debug||console.log||(()=>{});function Vn(s){try{s?T.storage.setItem("debug",s):T.storage.removeItem("debug")}catch{}}function Hn(){let s;try{s=T.storage.getItem("debug")}catch{}return!s&&typeof process<"u"&&"env"in process&&(s=process.env.DEBUG),s}function Kn(){try{return localStorage}catch{}}Be.exports=pt()(T);var{formatters:Wn}=Be.exports;Wn.j=function(s){try{return JSON.stringify(s)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}}});var sr=d((Yc,tr)=>{"use strict";tr.exports=(s,e)=>{e=e||process.argv;let t=s.startsWith("-")?"":s.length===1?"-":"--",r=e.indexOf(t+s),i=e.indexOf("--");return r!==-1&&(i===-1?!0:r<i)}});var ir=d((Vc,rr)=>{"use strict";var Jn=require("os"),P=sr(),_=process.env,ue;P("no-color")||P("no-colors")||P("color=false")?ue=!1:(P("color")||P("colors")||P("color=true")||P("color=always"))&&(ue=!0);"FORCE_COLOR"in _&&(ue=_.FORCE_COLOR.length===0||parseInt(_.FORCE_COLOR,10)!==0);function Xn(s){return s===0?!1:{level:s,hasBasic:!0,has256:s>=2,has16m:s>=3}}function Zn(s){if(ue===!1)return 0;if(P("color=16m")||P("color=full")||P("color=truecolor"))return 3;if(P("color=256"))return 2;if(s&&!s.isTTY&&ue!==!0)return 0;let e=ue?1:0;if(process.platform==="win32"){let t=Jn.release().split(".");return Number(process.versions.node.split(".")[0])>=8&&Number(t[0])>=10&&Number(t[2])>=10586?Number(t[2])>=14931?3:2:1}if("CI"in _)return["TRAVIS","CIRCLECI","APPVEYOR","GITLAB_CI"].some(t=>t in _)||_.CI_NAME==="codeship"?1:e;if("TEAMCITY_VERSION"in _)return/^(9\.(0*[1-9]\d*)\.|\d{2,}\.)/.test(_.TEAMCITY_VERSION)?1:0;if(_.COLORTERM==="truecolor")return 3;if("TERM_PROGRAM"in _){let t=parseInt((_.TERM_PROGRAM_VERSION||"").split(".")[0],10);switch(_.TERM_PROGRAM){case"iTerm.app":return t>=3?3:2;case"Apple_Terminal":return 2}}return/-256(color)?$/i.test(_.TERM)?2:/^screen|^xterm|^vt100|^vt220|^rxvt|color|ansi|cygwin|linux/i.test(_.TERM)||"COLORTERM"in _?1:(_.TERM==="dumb",e)}function yt(s){let e=Zn(s);return Xn(e)}rr.exports={supportsColor:yt,stdout:yt(process.stdout),stderr:yt(process.stderr)}});var or=d((C,Pe)=>{var $n=require("tty"),Ie=require("util");C.init=oo;C.log=ro;C.formatArgs=to;C.save=io;C.load=no;C.useColors=eo;C.destroy=Ie.deprecate(()=>{},"Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.");C.colors=[6,2,3,4,5,1];try{let s=ir();s&&(s.stderr||s).level>=2&&(C.colors=[20,21,26,27,32,33,38,39,40,41,42,43,44,45,56,57,62,63,68,69,74,75,76,77,78,79,80,81,92,93,98,99,112,113,128,129,134,135,148,149,160,161,162,163,164,165,166,167,168,169,170,171,172,173,178,179,184,185,196,197,198,199,200,201,202,203,204,205,206,207,208,209,214,215,220,221])}catch{}C.inspectOpts=Object.keys(process.env).filter(s=>/^debug_/i.test(s)).reduce((s,e)=>{let t=e.substring(6).toLowerCase().replace(/_([a-z])/g,(i,n)=>n.toUpperCase()),r=process.env[e];return/^(yes|on|true|enabled)$/i.test(r)?r=!0:/^(no|off|false|disabled)$/i.test(r)?r=!1:r==="null"?r=null:r=Number(r),s[t]=r,s},{});function eo(){return"colors"in C.inspectOpts?!!C.inspectOpts.colors:$n.isatty(process.stderr.fd)}function to(s){let{namespace:e,useColors:t}=this;if(t){let r=this.color,i="\x1B[3"+(r<8?r:"8;5;"+r),n=`  ${i};1m${e} \x1B[0m`;s[0]=n+s[0].split(`
`).join(`
`+n),s.push(i+"m+"+Pe.exports.humanize(this.diff)+"\x1B[0m")}else s[0]=so()+e+" "+s[0]}function so(){return C.inspectOpts.hideDate?"":new Date().toISOString()+" "}function ro(...s){return process.stderr.write(Ie.formatWithOptions(C.inspectOpts,...s)+`
`)}function io(s){s?process.env.DEBUG=s:delete process.env.DEBUG}function no(){return process.env.DEBUG}function oo(s){s.inspectOpts={};let e=Object.keys(C.inspectOpts);for(let t=0;t<e.length;t++)s.inspectOpts[e[t]]=C.inspectOpts[e[t]]}Pe.exports=pt()(C);var{formatters:nr}=Pe.exports;nr.o=function(s){return this.inspectOpts.colors=this.useColors,Ie.inspect(s,this.inspectOpts).split(`
`).map(e=>e.trim()).join(" ")};nr.O=function(s){return this.inspectOpts.colors=this.useColors,Ie.inspect(s,this.inspectOpts)}});var ar=d((Hc,gt)=>{typeof process>"u"||process.type==="renderer"||process.browser===!0||process.__nwjs?gt.exports=er():gt.exports=or()});var ur=d(j=>{"use strict";Object.defineProperty(j,"__esModule",{value:!0});j.genRedactedString=j.getStringValue=j.MAX_ARGUMENT_LENGTH=void 0;var ao=ar(),mt=200;j.MAX_ARGUMENT_LENGTH=mt;var co="ioredis";function cr(s){if(s!==null)switch(typeof s){case"boolean":return;case"number":return;case"object":if(Buffer.isBuffer(s))return s.toString("hex");if(Array.isArray(s))return s.join(",");try{return JSON.stringify(s)}catch{return}case"string":return s}}j.getStringValue=cr;function lr(s,e){let{length:t}=s;return t<=e?s:s.slice(0,e)+' ... <REDACTED full-length="'+t+'">'}j.genRedactedString=lr;function lo(s){let e=(0,ao.default)(`${co}:${s}`);function t(...r){if(e.enabled){for(let i=1;i<r.length;i++){let n=cr(r[i]);typeof n=="string"&&n.length>mt&&(r[i]=lr(n,mt))}return e.apply(null,r)}}return Object.defineProperties(t,{namespace:{get(){return e.namespace}},enabled:{get(){return e.enabled}},destroy:{get(){return e.destroy}},log:{get(){return e.log},set(r){e.log=r}}}),t}j.default=lo});var hr=d(bt=>{"use strict";Object.defineProperty(bt,"__esModule",{value:!0});var fr=`-----BEGIN CERTIFICATE-----
MIIDTzCCAjegAwIBAgIJAKSVpiDswLcwMA0GCSqGSIb3DQEBBQUAMD4xFjAUBgNV
BAoMDUdhcmFudGlhIERhdGExJDAiBgNVBAMMG1NTTCBDZXJ0aWZpY2F0aW9uIEF1
dGhvcml0eTAeFw0xMzEwMDExMjE0NTVaFw0yMzA5MjkxMjE0NTVaMD4xFjAUBgNV
BAoMDUdhcmFudGlhIERhdGExJDAiBgNVBAMMG1NTTCBDZXJ0aWZpY2F0aW9uIEF1
dGhvcml0eTCCASIwDQYJKoZIhvcNAQEBBQADggEPADCCAQoCggEBALZqkh/DczWP
JnxnHLQ7QL0T4B4CDKWBKCcisriGbA6ZePWVNo4hfKQC6JrzfR+081NeD6VcWUiz
rmd+jtPhIY4c+WVQYm5PKaN6DT1imYdxQw7aqO5j2KUCEh/cznpLxeSHoTxlR34E
QwF28Wl3eg2vc5ct8LjU3eozWVk3gb7alx9mSA2SgmuX5lEQawl++rSjsBStemY2
BDwOpAMXIrdEyP/cVn8mkvi/BDs5M5G+09j0gfhyCzRWMQ7Hn71u1eolRxwVxgi3
TMn+/vTaFSqxKjgck6zuAYjBRPaHe7qLxHNr1So/Mc9nPy+3wHebFwbIcnUojwbp
4nctkWbjb2cCAwEAAaNQME4wHQYDVR0OBBYEFP1whtcrydmW3ZJeuSoKZIKjze3w
MB8GA1UdIwQYMBaAFP1whtcrydmW3ZJeuSoKZIKjze3wMAwGA1UdEwQFMAMBAf8w
DQYJKoZIhvcNAQEFBQADggEBAG2erXhwRAa7+ZOBs0B6X57Hwyd1R4kfmXcs0rta
lbPpvgULSiB+TCbf3EbhJnHGyvdCY1tvlffLjdA7HJ0PCOn+YYLBA0pTU/dyvrN6
Su8NuS5yubnt9mb13nDGYo1rnt0YRfxN+8DM3fXIVr038A30UlPX2Ou1ExFJT0MZ
uFKY6ZvLdI6/1cbgmguMlAhM+DhKyV6Sr5699LM3zqeI816pZmlREETYkGr91q7k
BpXJu/dtHaGxg1ZGu6w/PCsYGUcECWENYD4VQPd8N32JjOfu6vEgoEAwfPP+3oGp
Z4m3ewACcWOAenqflb+cQYC4PsF7qbXDmRaWrbKntOlZ3n0=
-----END CERTIFICATE-----
-----BEGIN CERTIFICATE-----
MIIGMTCCBBmgAwIBAgICEAAwDQYJKoZIhvcNAQELBQAwajELMAkGA1UEBhMCVVMx
CzAJBgNVBAgMAkNBMQswCQYDVQQHDAJDQTESMBAGA1UECgwJUmVkaXNMYWJzMS0w
KwYDVQQDDCRSZWRpc0xhYnMgUm9vdCBDZXJ0aWZpY2F0ZSBBdXRob3JpdHkwHhcN
MTgwMjI1MTUzNzM3WhcNMjgwMjIzMTUzNzM3WjBfMQswCQYDVQQGEwJVUzELMAkG
A1UECAwCQ0ExEjAQBgNVBAoMCVJlZGlzTGFiczEvMC0GA1UEAwwmUkNQIEludGVy
bWVkaWF0ZSBDZXJ0aWZpY2F0ZSBBdXRob3JpdHkwggIiMA0GCSqGSIb3DQEBAQUA
A4ICDwAwggIKAoICAQDf9dqbxc8Bq7Ctq9rWcxrGNKKHivqLAFpPq02yLPx6fsOv
Tq7GsDChAYBBc4v7Y2Ap9RD5Vs3dIhEANcnolf27QwrG9RMnnvzk8pCvp1o6zSU4
VuOE1W66/O1/7e2rVxyrnTcP7UgK43zNIXu7+tiAqWsO92uSnuMoGPGpeaUm1jym
hjWKtkAwDFSqvHY+XL5qDVBEjeUe+WHkYUg40cAXjusAqgm2hZt29c2wnVrxW25W
P0meNlzHGFdA2AC5z54iRiqj57dTfBTkHoBczQxcyw6hhzxZQ4e5I5zOKjXXEhZN
r0tA3YC14CTabKRus/JmZieyZzRgEy2oti64tmLYTqSlAD78pRL40VNoaSYetXLw
hhNsXCHgWaY6d5bLOc/aIQMAV5oLvZQKvuXAF1IDmhPA+bZbpWipp0zagf1P1H3s
UzsMdn2KM0ejzgotbtNlj5TcrVwpmvE3ktvUAuA+hi3FkVx1US+2Gsp5x4YOzJ7u
P1WPk6ShF0JgnJH2ILdj6kttTWwFzH17keSFICWDfH/+kM+k7Y1v3EXMQXE7y0T9
MjvJskz6d/nv+sQhY04xt64xFMGTnZjlJMzfQNi7zWFLTZnDD0lPowq7l3YiPoTT
t5Xky83lu0KZsZBo0WlWaDG00gLVdtRgVbcuSWxpi5BdLb1kRab66JptWjxwXQID
AQABo4HrMIHoMDoGA1UdHwQzMDEwL6AtoCuGKWh0dHBzOi8vcmwtY2Etc2VydmVy
LnJlZGlzbGFicy5jb20vdjEvY3JsMEYGCCsGAQUFBwEBBDowODA2BggrBgEFBQcw
AYYqaHR0cHM6Ly9ybC1jYS1zZXJ2ZXIucmVkaXNsYWJzLmNvbS92MS9vY3NwMB0G
A1UdDgQWBBQHar5OKvQUpP2qWt6mckzToeCOHDAfBgNVHSMEGDAWgBQi42wH6hM4
L2sujEvLM0/u8lRXTzASBgNVHRMBAf8ECDAGAQH/AgEAMA4GA1UdDwEB/wQEAwIB
hjANBgkqhkiG9w0BAQsFAAOCAgEAirEn/iTsAKyhd+pu2W3Z5NjCko4NPU0EYUbr
AP7+POK2rzjIrJO3nFYQ/LLuC7KCXG+2qwan2SAOGmqWst13Y+WHp44Kae0kaChW
vcYLXXSoGQGC8QuFSNUdaeg3RbMDYFT04dOkqufeWVccoHVxyTSg9eD8LZuHn5jw
7QDLiEECBmIJHk5Eeo2TAZrx4Yx6ufSUX5HeVjlAzqwtAqdt99uCJ/EL8bgpWbe+
XoSpvUv0SEC1I1dCAhCKAvRlIOA6VBcmzg5Am12KzkqTul12/VEFIgzqu0Zy2Jbc
AUPrYVu/+tOGXQaijy7YgwH8P8n3s7ZeUa1VABJHcxrxYduDDJBLZi+MjheUDaZ1
jQRHYevI2tlqeSBqdPKG4zBY5lS0GiAlmuze5oENt0P3XboHoZPHiqcK3VECgTVh
/BkJcuudETSJcZDmQ8YfoKfBzRQNg2sv/hwvUv73Ss51Sco8GEt2lD8uEdib1Q6z
zDT5lXJowSzOD5ZA9OGDjnSRL+2riNtKWKEqvtEG3VBJoBzu9GoxbAc7wIZLxmli
iF5a/Zf5X+UXD3s4TMmy6C4QZJpAA2egsSQCnraWO2ULhh7iXMysSkF/nzVfZn43
iqpaB8++9a37hWq14ZmOv0TJIDz//b2+KC4VFXWQ5W5QC6whsjT+OlG4p5ZYG0jo
616pxqo=
-----END CERTIFICATE-----
-----BEGIN CERTIFICATE-----
MIIFujCCA6KgAwIBAgIJAJ1aTT1lu2ScMA0GCSqGSIb3DQEBCwUAMGoxCzAJBgNV
BAYTAlVTMQswCQYDVQQIDAJDQTELMAkGA1UEBwwCQ0ExEjAQBgNVBAoMCVJlZGlz
TGFiczEtMCsGA1UEAwwkUmVkaXNMYWJzIFJvb3QgQ2VydGlmaWNhdGUgQXV0aG9y
aXR5MB4XDTE4MDIyNTE1MjA0MloXDTM4MDIyMDE1MjA0MlowajELMAkGA1UEBhMC
VVMxCzAJBgNVBAgMAkNBMQswCQYDVQQHDAJDQTESMBAGA1UECgwJUmVkaXNMYWJz
MS0wKwYDVQQDDCRSZWRpc0xhYnMgUm9vdCBDZXJ0aWZpY2F0ZSBBdXRob3JpdHkw
ggIiMA0GCSqGSIb3DQEBAQUAA4ICDwAwggIKAoICAQDLEjXy7YrbN5Waau5cd6g1
G5C2tMmeTpZ0duFAPxNU4oE3RHS5gGiok346fUXuUxbZ6QkuzeN2/2Z+RmRcJhQY
Dm0ZgdG4x59An1TJfnzKKoWj8ISmoHS/TGNBdFzXV7FYNLBuqZouqePI6ReC6Qhl
pp45huV32Q3a6IDrrvx7Wo5ZczEQeFNbCeCOQYNDdTmCyEkHqc2AGo8eoIlSTutT
ULOC7R5gzJVTS0e1hesQ7jmqHjbO+VQS1NAL4/5K6cuTEqUl+XhVhPdLWBXJQ5ag
54qhX4v+ojLzeU1R/Vc6NjMvVtptWY6JihpgplprN0Yh2556ewcXMeturcKgXfGJ
xeYzsjzXerEjrVocX5V8BNrg64NlifzTMKNOOv4fVZszq1SIHR8F9ROrqiOdh8iC
JpUbLpXH9hWCSEO6VRMB2xJoKu3cgl63kF30s77x7wLFMEHiwsQRKxooE1UhgS9K
2sO4TlQ1eWUvFvHSTVDQDlGQ6zu4qjbOpb3Q8bQwoK+ai2alkXVR4Ltxe9QlgYK3
StsnPhruzZGA0wbXdpw0bnM+YdlEm5ffSTpNIfgHeaa7Dtb801FtA71ZlH7A6TaI
SIQuUST9EKmv7xrJyx0W1pGoPOLw5T029aTjnICSLdtV9bLwysrLhIYG5bnPq78B
cS+jZHFGzD7PUVGQD01nOQIDAQABo2MwYTAdBgNVHQ4EFgQUIuNsB+oTOC9rLoxL
yzNP7vJUV08wHwYDVR0jBBgwFoAUIuNsB+oTOC9rLoxLyzNP7vJUV08wDwYDVR0T
AQH/BAUwAwEB/zAOBgNVHQ8BAf8EBAMCAYYwDQYJKoZIhvcNAQELBQADggIBAHfg
z5pMNUAKdMzK1aS1EDdK9yKz4qicILz5czSLj1mC7HKDRy8cVADUxEICis++CsCu
rYOvyCVergHQLREcxPq4rc5Nq1uj6J6649NEeh4WazOOjL4ZfQ1jVznMbGy+fJm3
3Hoelv6jWRG9iqeJZja7/1s6YC6bWymI/OY1e4wUKeNHAo+Vger7MlHV+RuabaX+
hSJ8bJAM59NCM7AgMTQpJCncrcdLeceYniGy5Q/qt2b5mJkQVkIdy4TPGGB+AXDJ
D0q3I/JDRkDUFNFdeW0js7fHdsvCR7O3tJy5zIgEV/o/BCkmJVtuwPYOrw/yOlKj
TY/U7ATAx9VFF6/vYEOMYSmrZlFX+98L6nJtwDqfLB5VTltqZ4H/KBxGE3IRSt9l
FXy40U+LnXzhhW+7VBAvyYX8GEXhHkKU8Gqk1xitrqfBXY74xKgyUSTolFSfFVgj
mcM/X4K45bka+qpkj7Kfv/8D4j6aZekwhN2ly6hhC1SmQ8qjMjpG/mrWOSSHZFmf
ybu9iD2AYHeIOkshIl6xYIa++Q/00/vs46IzAbQyriOi0XxlSMMVtPx0Q3isp+ji
n8Mq9eOuxYOEQ4of8twUkUDd528iwGtEdwf0Q01UyT84S62N8AySl1ZBKXJz6W4F
UhWfa/HQYOAPDdEjNgnVwLI23b8t0TozyCWw7q8h
-----END CERTIFICATE-----

-----BEGIN CERTIFICATE-----
MIIEjzCCA3egAwIBAgIQe55B/ALCKJDZtdNT8kD6hTANBgkqhkiG9w0BAQsFADBM
MSAwHgYDVQQLExdHbG9iYWxTaWduIFJvb3QgQ0EgLSBSMzETMBEGA1UEChMKR2xv
YmFsU2lnbjETMBEGA1UEAxMKR2xvYmFsU2lnbjAeFw0yMjAxMjYxMjAwMDBaFw0y
NTAxMjYwMDAwMDBaMFgxCzAJBgNVBAYTAkJFMRkwFwYDVQQKExBHbG9iYWxTaWdu
IG52LXNhMS4wLAYDVQQDEyVHbG9iYWxTaWduIEF0bGFzIFIzIE9WIFRMUyBDQSAy
MDIyIFEyMIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAmGmg1LW9b7Lf
8zDD83yBDTEkt+FOxKJZqF4veWc5KZsQj9HfnUS2e5nj/E+JImlGPsQuoiosLuXD
BVBNAMcUFa11buFMGMeEMwiTmCXoXRrXQmH0qjpOfKgYc5gHG3BsRGaRrf7VR4eg
ofNMG9wUBw4/g/TT7+bQJdA4NfE7Y4d5gEryZiBGB/swaX6Jp/8MF4TgUmOWmalK
dZCKyb4sPGQFRTtElk67F7vU+wdGcrcOx1tDcIB0ncjLPMnaFicagl+daWGsKqTh
counQb6QJtYHa91KvCfKWocMxQ7OIbB5UARLPmC4CJ1/f8YFm35ebfzAeULYdGXu
jE9CLor0OwIDAQABo4IBXzCCAVswDgYDVR0PAQH/BAQDAgGGMB0GA1UdJQQWMBQG
CCsGAQUFBwMBBggrBgEFBQcDAjASBgNVHRMBAf8ECDAGAQH/AgEAMB0GA1UdDgQW
BBSH5Zq7a7B/t95GfJWkDBpA8HHqdjAfBgNVHSMEGDAWgBSP8Et/qC5FJK5NUPpj
move4t0bvDB7BggrBgEFBQcBAQRvMG0wLgYIKwYBBQUHMAGGImh0dHA6Ly9vY3Nw
Mi5nbG9iYWxzaWduLmNvbS9yb290cjMwOwYIKwYBBQUHMAKGL2h0dHA6Ly9zZWN1
cmUuZ2xvYmFsc2lnbi5jb20vY2FjZXJ0L3Jvb3QtcjMuY3J0MDYGA1UdHwQvMC0w
K6ApoCeGJWh0dHA6Ly9jcmwuZ2xvYmFsc2lnbi5jb20vcm9vdC1yMy5jcmwwIQYD
VR0gBBowGDAIBgZngQwBAgIwDAYKKwYBBAGgMgoBAjANBgkqhkiG9w0BAQsFAAOC
AQEAKRic9/f+nmhQU/wz04APZLjgG5OgsuUOyUEZjKVhNGDwxGTvKhyXGGAMW2B/
3bRi+aElpXwoxu3pL6fkElbX3B0BeS5LoDtxkyiVEBMZ8m+sXbocwlPyxrPbX6mY
0rVIvnuUeBH8X0L5IwfpNVvKnBIilTbcebfHyXkPezGwz7E1yhUULjJFm2bt0SdX
y+4X/WeiiYIv+fTVgZZgl+/2MKIsu/qdBJc3f3TvJ8nz+Eax1zgZmww+RSQWeOj3
15Iw6Z5FX+NwzY/Ab+9PosR5UosSeq+9HhtaxZttXG1nVh+avYPGYddWmiMT90J5
ZgKnO/Fx2hBgTxhOTMYaD312kg==
-----END CERTIFICATE-----

-----BEGIN CERTIFICATE-----
MIIDXzCCAkegAwIBAgILBAAAAAABIVhTCKIwDQYJKoZIhvcNAQELBQAwTDEgMB4G
A1UECxMXR2xvYmFsU2lnbiBSb290IENBIC0gUjMxEzARBgNVBAoTCkdsb2JhbFNp
Z24xEzARBgNVBAMTCkdsb2JhbFNpZ24wHhcNMDkwMzE4MTAwMDAwWhcNMjkwMzE4
MTAwMDAwWjBMMSAwHgYDVQQLExdHbG9iYWxTaWduIFJvb3QgQ0EgLSBSMzETMBEG
A1UEChMKR2xvYmFsU2lnbjETMBEGA1UEAxMKR2xvYmFsU2lnbjCCASIwDQYJKoZI
hvcNAQEBBQADggEPADCCAQoCggEBAMwldpB5BngiFvXAg7aEyiie/QV2EcWtiHL8
RgJDx7KKnQRfJMsuS+FggkbhUqsMgUdwbN1k0ev1LKMPgj0MK66X17YUhhB5uzsT
gHeMCOFJ0mpiLx9e+pZo34knlTifBtc+ycsmWQ1z3rDI6SYOgxXG71uL0gRgykmm
KPZpO/bLyCiR5Z2KYVc3rHQU3HTgOu5yLy6c+9C7v/U9AOEGM+iCK65TpjoWc4zd
QQ4gOsC0p6Hpsk+QLjJg6VfLuQSSaGjlOCZgdbKfd/+RFO+uIEn8rUAVSNECMWEZ
XriX7613t2Saer9fwRPvm2L7DWzgVGkWqQPabumDk3F2xmmFghcCAwEAAaNCMEAw
DgYDVR0PAQH/BAQDAgEGMA8GA1UdEwEB/wQFMAMBAf8wHQYDVR0OBBYEFI/wS3+o
LkUkrk1Q+mOai97i3Ru8MA0GCSqGSIb3DQEBCwUAA4IBAQBLQNvAUKr+yAzv95ZU
RUm7lgAJQayzE4aGKAczymvmdLm6AC2upArT9fHxD4q/c2dKg8dEe3jgr25sbwMp
jjM5RcOO5LlXbKr8EpbsU8Yt5CRsuZRj+9xTaGdWPoO4zzUhw8lo/s7awlOqzJCK
6fBdRoyV3XpYKBovHd7NADdBj+1EbddTKJd+82cEHhXXipa0095MJ6RMG3NzdvQX
mcIfeg7jLQitChws/zyrVQ4PkX4268NXSb7hLi18YIvDQVETI53O9zJrlAGomecs
Mx86OyXShkDOOyyGeMlhLxS67ttVb9+E7gUJTb0o2HLO02JQZR7rkpeDMdmztcpH
WD9f
-----END CERTIFICATE-----`,uo={RedisCloudFixed:{ca:fr},RedisCloudFlexible:{ca:fr}};bt.default=uo});var w=d(y=>{"use strict";Object.defineProperty(y,"__esModule",{value:!0});y.noop=y.defaults=y.Debug=y.zipMap=y.CONNECTION_CLOSED_ERROR_MSG=y.shuffle=y.sample=y.resolveTLSProfile=y.parseURL=y.optimizeErrorStack=y.toArg=y.convertMapToArray=y.convertObjectToArray=y.timeout=y.packObject=y.isInt=y.wrapMultiResult=y.convertBufferToString=void 0;var dr=require("url"),St=Me();Object.defineProperty(y,"defaults",{enumerable:!0,get:function(){return St.defaults}});Object.defineProperty(y,"noop",{enumerable:!0,get:function(){return St.noop}});var fo=ur();y.Debug=fo.default;var ho=hr();function pr(s,e){if(s instanceof Buffer)return s.toString(e);if(Array.isArray(s)){let t=s.length,r=Array(t);for(let i=0;i<t;++i)r[i]=s[i]instanceof Buffer&&e==="utf8"?s[i].toString():pr(s[i],e);return r}return s}y.convertBufferToString=pr;function po(s){if(!s)return null;let e=[],t=s.length;for(let r=0;r<t;++r){let i=s[r];i instanceof Error?e.push([i]):e.push([null,i])}return e}y.wrapMultiResult=po;function yr(s){let e=parseFloat(s);return!isNaN(s)&&(e|0)===e}y.isInt=yr;function yo(s){let e={},t=s.length;for(let r=1;r<t;r+=2)e[s[r-1]]=s[r];return e}y.packObject=yo;function go(s,e){let t=null,r=function(){t&&(clearTimeout(t),t=null,s.apply(this,arguments))};return t=setTimeout(r,e,new Error("timeout")),r}y.timeout=go;function mo(s){let e=[],t=Object.keys(s);for(let r=0,i=t.length;r<i;r++)e.push(t[r],s[t[r]]);return e}y.convertObjectToArray=mo;function bo(s){let e=[],t=0;return s.forEach(function(r,i){e[t]=i,e[t+1]=r,t+=2}),e}y.convertMapToArray=bo;function So(s){return s===null||typeof s>"u"?"":String(s)}y.toArg=So;function ko(s,e,t){let r=e.split(`
`),i="",n;for(n=1;n<r.length&&r[n].indexOf(t)!==-1;++n);for(let o=n;o<r.length;++o)i+=`
`+r[o];if(s.stack){let o=s.stack.indexOf(`
`);s.stack=s.stack.slice(0,o)+i}return s}y.optimizeErrorStack=ko;function Co(s){if(yr(s))return{port:s};let e=(0,dr.parse)(s,!0,!0);!e.slashes&&s[0]!=="/"&&(s="//"+s,e=(0,dr.parse)(s,!0,!0));let t=e.query||{},r={};if(e.auth){let i=e.auth.indexOf(":");r.username=i===-1?e.auth:e.auth.slice(0,i),r.password=i===-1?"":e.auth.slice(i+1)}if(e.pathname&&(e.protocol==="redis:"||e.protocol==="rediss:"?e.pathname.length>1&&(r.db=e.pathname.slice(1)):r.path=e.pathname),e.host&&(r.host=e.hostname),e.port&&(r.port=e.port),typeof t.family=="string"){let i=Number.parseInt(t.family,10);Number.isNaN(i)||(r.family=i)}return(0,St.defaults)(r,t),r}y.parseURL=Co;function _o(s){let e=s?.tls;typeof e=="string"&&(e={profile:e});let t=ho.default[e?.profile];return t&&(e=Object.assign({},t,e),delete e.profile,s=Object.assign({},s,{tls:e})),s}y.resolveTLSProfile=_o;function wo(s,e=0){let t=s.length;return e>=t?null:s[e+Math.floor(Math.random()*(t-e))]}y.sample=wo;function xo(s){let e=s.length;for(;e>0;){let t=Math.floor(Math.random()*e);e--,[s[e],s[t]]=[s[t],s[e]]}return s}y.shuffle=xo;y.CONNECTION_CLOSED_ERROR_MSG="Connection is closed.";function Eo(s,e){let t=new Map;return s.forEach((r,i)=>{t.set(r,e[i])}),t}y.zipMap=Eo});var q=d(Ct=>{"use strict";Object.defineProperty(Ct,"__esModule",{value:!0});var gr=re(),vo=Te(),Ao=z(),ee=w(),v=class{constructor(e,t=[],r={},i){if(this.name=e,this.inTransaction=!1,this.isResolved=!1,this.transformed=!1,this.replyEncoding=r.replyEncoding,this.errorStack=r.errorStack,this.args=t.flat(),this.callback=i,this.initPromise(),r.keyPrefix){let n=r.keyPrefix instanceof Buffer,o=n?r.keyPrefix:null;this._iterateKeys(c=>c instanceof Buffer?(o===null&&(o=Buffer.from(r.keyPrefix)),Buffer.concat([o,c])):n?Buffer.concat([r.keyPrefix,Buffer.from(String(c))]):r.keyPrefix+c)}r.readOnly&&(this.isReadOnly=!0)}static checkFlag(e,t){return!!this.getFlagMap()[e][t]}static setArgumentTransformer(e,t){this._transformer.argument[e]=t}static setReplyTransformer(e,t){this._transformer.reply[e]=t}static getFlagMap(){return this.flagMap||(this.flagMap=Object.keys(v.FLAGS).reduce((e,t)=>(e[t]={},v.FLAGS[t].forEach(r=>{e[t][r]=!0}),e),{})),this.flagMap}getSlot(){if(typeof this.slot>"u"){let e=this.getKeys()[0];this.slot=e==null?null:vo(e)}return this.slot}getKeys(){return this._iterateKeys()}toWritable(e){let t,r="*"+(this.args.length+1)+`\r
$`+Buffer.byteLength(this.name)+`\r
`+this.name+`\r
`;if(this.bufferMode){let i=new kt;i.push(r);for(let n=0;n<this.args.length;++n){let o=this.args[n];o instanceof Buffer?o.length===0?i.push(`$0\r
\r
`):(i.push("$"+o.length+`\r
`),i.push(o),i.push(`\r
`)):i.push("$"+Buffer.byteLength(o)+`\r
`+o+`\r
`)}t=i.toBuffer()}else{t=r;for(let i=0;i<this.args.length;++i){let n=this.args[i];t+="$"+Buffer.byteLength(n)+`\r
`+n+`\r
`}}return t}stringifyArguments(){for(let e=0;e<this.args.length;++e){let t=this.args[e];typeof t=="string"||(t instanceof Buffer?this.bufferMode=!0:this.args[e]=(0,ee.toArg)(t))}}transformReply(e){this.replyEncoding&&(e=(0,ee.convertBufferToString)(e,this.replyEncoding));let t=v._transformer.reply[this.name];return t&&(e=t(e)),e}setTimeout(e){this._commandTimeoutTimer||(this._commandTimeoutTimer=setTimeout(()=>{this.isResolved||this.reject(new Error("Command timed out"))},e))}initPromise(){let e=new Promise((t,r)=>{if(!this.transformed){this.transformed=!0;let i=v._transformer.argument[this.name];i&&(this.args=i(this.args)),this.stringifyArguments()}this.resolve=this._convertValue(t),this.errorStack?this.reject=i=>{r((0,ee.optimizeErrorStack)(i,this.errorStack.stack,__dirname))}:this.reject=r});this.promise=(0,Ao.default)(e,this.callback)}_iterateKeys(e=t=>t){if(typeof this.keys>"u"&&(this.keys=[],(0,gr.exists)(this.name))){let t=(0,gr.getKeyIndexes)(this.name,this.args);for(let r of t)this.args[r]=e(this.args[r]),this.keys.push(this.args[r])}return this.keys}_convertValue(e){return t=>{try{let r=this._commandTimeoutTimer;r&&(clearTimeout(r),delete this._commandTimeoutTimer),e(this.transformReply(t)),this.isResolved=!0}catch(r){this.reject(r)}return this.promise}}};Ct.default=v;v.FLAGS={VALID_IN_SUBSCRIBER_MODE:["subscribe","psubscribe","unsubscribe","punsubscribe","ssubscribe","sunsubscribe","ping","quit"],VALID_IN_MONITOR_MODE:["monitor","auth"],ENTER_SUBSCRIBER_MODE:["subscribe","psubscribe","ssubscribe"],EXIT_SUBSCRIBER_MODE:["unsubscribe","punsubscribe","sunsubscribe"],WILL_DISCONNECT:["quit"]};v._transformer={argument:{},reply:{}};var mr=function(s){if(s.length===1){if(s[0]instanceof Map)return(0,ee.convertMapToArray)(s[0]);if(typeof s[0]=="object"&&s[0]!==null)return(0,ee.convertObjectToArray)(s[0])}return s},br=function(s){if(s.length===2){if(s[1]instanceof Map)return[s[0]].concat((0,ee.convertMapToArray)(s[1]));if(typeof s[1]=="object"&&s[1]!==null)return[s[0]].concat((0,ee.convertObjectToArray)(s[1]))}return s};v.setArgumentTransformer("mset",mr);v.setArgumentTransformer("msetnx",mr);v.setArgumentTransformer("hset",br);v.setArgumentTransformer("hmset",br);v.setReplyTransformer("hgetall",function(s){if(Array.isArray(s)){let e={};for(let t=0;t<s.length;t+=2){let r=s[t],i=s[t+1];r in e?Object.defineProperty(e,r,{value:i,configurable:!0,enumerable:!0,writable:!0}):e[r]=i}return e}return s});var kt=class{constructor(){this.length=0,this.items=[]}push(e){this.length+=Buffer.byteLength(e),this.items.push(e)}toBuffer(){let e=Buffer.allocUnsafe(this.length),t=0;for(let r of this.items){let i=Buffer.byteLength(r);Buffer.isBuffer(r)?r.copy(e,t):e.write(r,t,i),t+=i}return e}}});var Sr=d(_t=>{"use strict";Object.defineProperty(_t,"__esModule",{value:!0});var Oo=Z(),De=class extends Oo.RedisError{constructor(e,t){super(e),this.lastNodeError=t,Error.captureStackTrace(this,this.constructor)}get name(){return this.constructor.name}};_t.default=De;De.defaultMessage="Failed to refresh slots cache."});var Fe=d(xt=>{"use strict";Object.defineProperty(xt,"__esModule",{value:!0});var To=require("stream"),wt=class extends To.Readable{constructor(e){super(e),this.opt=e,this._redisCursor="0",this._redisDrained=!1}_read(){if(this._redisDrained){this.push(null);return}let e=[this._redisCursor];this.opt.key&&e.unshift(this.opt.key),this.opt.match&&e.push("MATCH",this.opt.match),this.opt.type&&e.push("TYPE",this.opt.type),this.opt.count&&e.push("COUNT",String(this.opt.count)),this.opt.redis[this.opt.command](e,(t,r)=>{if(t){this.emit("error",t);return}this._redisCursor=r[0]instanceof Buffer?r[0].toString():r[0],this._redisCursor==="0"&&(this._redisDrained=!0),this.push(r[1])})}close(){this._redisDrained=!0}};xt.default=wt});var Er=d(S=>{"use strict";Object.defineProperty(S,"__esModule",{value:!0});S.executeWithAutoPipelining=S.getFirstValueInFlattenedArray=S.shouldUseAutoPipelining=S.notAllowedAutoPipelineCommands=S.kCallbacks=S.kExec=void 0;var Cr=Me(),Mo=Te(),kr=z();S.kExec=Symbol("exec");S.kCallbacks=Symbol("callbacks");S.notAllowedAutoPipelineCommands=["auth","info","script","quit","cluster","pipeline","multi","subscribe","psubscribe","unsubscribe","unpsubscribe","select"];function _r(s,e){if(s._runningAutoPipelines.has(e)||!s._autoPipelines.has(e))return;s._runningAutoPipelines.add(e);let t=s._autoPipelines.get(e);s._autoPipelines.delete(e);let r=t[S.kCallbacks];t[S.kCallbacks]=null,t.exec(function(i,n){if(s._runningAutoPipelines.delete(e),i)for(let o=0;o<r.length;o++)process.nextTick(r[o],i);else for(let o=0;o<r.length;o++)process.nextTick(r[o],...n[o]);s._autoPipelines.has(e)&&_r(s,e)})}function Ro(s,e,t){return e&&s.options.enableAutoPipelining&&!s.isPipeline&&!S.notAllowedAutoPipelineCommands.includes(t)&&!s.options.autoPipeliningIgnoredCommands.includes(t)}S.shouldUseAutoPipelining=Ro;function wr(s){for(let e=0;e<s.length;e++){let t=s[e];if(typeof t=="string")return t;if(Array.isArray(t)||(0,Cr.isArguments)(t)){if(t.length===0)continue;return t[0]}let r=[t].flat();if(r.length>0)return r[0]}}S.getFirstValueInFlattenedArray=wr;function xr(s,e,t,r,i){if(s.isCluster&&!s.slots.length)return s.status==="wait"&&s.connect().catch(Cr.noop),(0,kr.default)(new Promise(function(u,l){s.delayUntilReady(f=>{if(f){l(f);return}xr(s,e,t,r,null).then(u,l)})}),i);let n=s.options.keyPrefix||"",o=s.isCluster?s.slots[Mo(`${n}${wr(r)}`)].join(","):"main";if(!s._autoPipelines.has(o)){let u=s.pipeline();u[S.kExec]=!1,u[S.kCallbacks]=[],s._autoPipelines.set(o,u)}let c=s._autoPipelines.get(o);c[S.kExec]||(c[S.kExec]=!0,setImmediate(_r,s,o));let a=new Promise(function(u,l){c[S.kCallbacks].push(function(f,h){if(f){l(f);return}u(h)}),e==="call"&&r.unshift(t),c[e](...r)});return(0,kr.default)(a,i)}S.executeWithAutoPipelining=xr});var vr=d(vt=>{"use strict";Object.defineProperty(vt,"__esModule",{value:!0});var Bo=require("crypto"),Io=q(),Po=z(),Et=class{constructor(e,t=null,r="",i=!1){this.lua=e,this.numberOfKeys=t,this.keyPrefix=r,this.readOnly=i,this.sha=(0,Bo.createHash)("sha1").update(e).digest("hex");let n=this.sha,o=new WeakSet;this.Command=class extends Io.default{toWritable(a){let u=this.reject;return this.reject=l=>{l.message.indexOf("NOSCRIPT")!==-1&&o.delete(a),u.call(this,l)},o.has(a)?this.name==="eval"&&(this.name="evalsha",this.args[0]=n):(o.add(a),this.name="eval",this.args[0]=e),super.toWritable(a)}}}execute(e,t,r,i){typeof this.numberOfKeys=="number"&&t.unshift(this.numberOfKeys),this.keyPrefix&&(r.keyPrefix=this.keyPrefix),this.readOnly&&(r.readOnly=!0);let n=new this.Command("evalsha",[this.sha,...t],r);return n.promise=n.promise.catch(o=>{if(o.message.indexOf("NOSCRIPT")===-1)throw o;let c=new this.Command("evalsha",[this.sha,...t],r);return(e.isPipeline?e.redis:e).sendCommand(c)}),(0,Po.default)(n.promise,i),e.sendCommand(n)}};vt.default=Et});var je=d(Ot=>{"use strict";Object.defineProperty(Ot,"__esModule",{value:!0});var Do=re(),Ne=Er(),Fo=q(),No=vr(),Q=class{constructor(){this.options={},this.scriptsSet={},this.addedBuiltinSet=new Set}getBuiltinCommands(){return At.slice(0)}createBuiltinCommand(e){return{string:G(null,e,"utf8"),buffer:G(null,e,null)}}addBuiltinCommand(e){this.addedBuiltinSet.add(e),this[e]=G(e,e,"utf8"),this[e+"Buffer"]=G(e+"Buffer",e,null)}defineCommand(e,t){let r=new No.default(t.lua,t.numberOfKeys,this.options.keyPrefix,t.readOnly);this.scriptsSet[e]=r,this[e]=Ar(e,e,r,"utf8"),this[e+"Buffer"]=Ar(e+"Buffer",e,r,null)}sendCommand(e,t,r){throw new Error('"sendCommand" is not implemented')}},At=Do.list.filter(s=>s!=="monitor");At.push("sentinel");At.forEach(function(s){Q.prototype[s]=G(s,s,"utf8"),Q.prototype[s+"Buffer"]=G(s+"Buffer",s,null)});Q.prototype.call=G("call","utf8");Q.prototype.callBuffer=G("callBuffer",null);Q.prototype.send_command=Q.prototype.call;function G(s,e,t){return typeof t>"u"&&(t=e,e=null),function(...r){let i=e||r.shift(),n=r[r.length-1];typeof n=="function"?r.pop():n=void 0;let o={errorStack:this.options.showFriendlyErrorStack?new Error:void 0,keyPrefix:this.options.keyPrefix,replyEncoding:t};return(0,Ne.shouldUseAutoPipelining)(this,s,i)?(0,Ne.executeWithAutoPipelining)(this,s,i,r,n):this.sendCommand(new Fo.default(i,r,o,n))}}function Ar(s,e,t,r){return function(...i){let n=typeof i[i.length-1]=="function"?i.pop():void 0,o={replyEncoding:r};return this.options.showFriendlyErrorStack&&(o.errorStack=new Error),(0,Ne.shouldUseAutoPipelining)(this,s,e)?(0,Ne.executeWithAutoPipelining)(this,s,e,i,n):t.execute(this,i,o,n)}}Ot.default=Q});var Rt=d(Mt=>{"use strict";Object.defineProperty(Mt,"__esModule",{value:!0});var Tt=Te(),Or=re(),Tr=z(),jo=require("util"),qo=q(),Qo=w(),Lo=je();function zo(s,e){let t=Tt(e[0]),r=s._groupsBySlot[t];for(let i=1;i<e.length;i++)if(s._groupsBySlot[Tt(e[i])]!==r)return-1;return t}var Y=class extends Lo.default{constructor(e){super(),this.redis=e,this.isPipeline=!0,this.replyPending=0,this._queue=[],this._result=[],this._transactions=0,this._shaToScript={},this.isCluster=this.redis.constructor.name==="Cluster"||this.redis.isCluster,this.options=e.options,Object.keys(e.scriptsSet).forEach(r=>{let i=e.scriptsSet[r];this._shaToScript[i.sha]=i,this[r]=e[r],this[r+"Buffer"]=e[r+"Buffer"]}),e.addedBuiltinSet.forEach(r=>{this[r]=e[r],this[r+"Buffer"]=e[r+"Buffer"]}),this.promise=new Promise((r,i)=>{this.resolve=r,this.reject=i});let t=this;Object.defineProperty(this,"length",{get:function(){return t._queue.length}})}fillResult(e,t){if(this._queue[t].name==="exec"&&Array.isArray(e[1])){let i=e[1].length;for(let n=0;n<i;n++){if(e[1][n]instanceof Error)continue;let o=this._queue[t-(i-n)];try{e[1][n]=o.transformReply(e[1][n])}catch(c){e[1][n]=c}}}if(this._result[t]=e,--this.replyPending)return;if(this.isCluster){let i=!0,n;for(let o=0;o<this._result.length;++o){let c=this._result[o][0],a=this._queue[o];if(c){if(a.name==="exec"&&c.message==="EXECABORT Transaction discarded because of previous errors.")continue;if(!n)n={name:c.name,message:c.message};else if(n.name!==c.name||n.message!==c.message){i=!1;break}}else if(!a.inTransaction&&!((0,Or.exists)(a.name)&&(0,Or.hasFlag)(a.name,"readonly"))){i=!1;break}}if(n&&i){let o=this,c=n.message.split(" "),a=this._queue,u=!1;this._queue=[];for(let p=0;p<a.length;++p){if(c[0]==="ASK"&&!u&&a[p].name!=="asking"&&(!a[p-1]||a[p-1].name!=="asking")){let m=new qo.default("asking");m.ignore=!0,this.sendCommand(m)}a[p].initPromise(),this.sendCommand(a[p]),u=a[p].inTransaction}let l=!0;typeof this.leftRedirections>"u"&&(this.leftRedirections={});let f=function(){o.exec()},h=this.redis;if(h.handleError(n,this.leftRedirections,{moved:function(p,m){o.preferKey=m,h.slots[c[1]]=[m],h._groupsBySlot[c[1]]=h._groupsIds[h.slots[c[1]].join(";")],h.refreshSlotsCache(),o.exec()},ask:function(p,m){o.preferKey=m,o.exec()},tryagain:f,clusterDown:f,connectionClosed:f,maxRedirections:()=>{l=!1},defaults:()=>{l=!1}}),l)return}}let r=0;for(let i=0;i<this._queue.length-r;++i)this._queue[i+r].ignore&&(r+=1),this._result[i]=this._result[i+r];this.resolve(this._result.slice(0,this._result.length-r))}sendCommand(e){this._transactions>0&&(e.inTransaction=!0);let t=this._queue.length;return e.pipelineIndex=t,e.promise.then(r=>{this.fillResult([null,r],t)}).catch(r=>{this.fillResult([r],t)}),this._queue.push(e),this}addBatch(e){let t,r,i;for(let n=0;n<e.length;++n)t=e[n],r=t[0],i=t.slice(1),this[r].apply(this,i);return this}};Mt.default=Y;var Uo=Y.prototype.multi;Y.prototype.multi=function(){return this._transactions+=1,Uo.apply(this,arguments)};var Mr=Y.prototype.execBuffer;Y.prototype.execBuffer=(0,jo.deprecate)(function(){return this._transactions>0&&(this._transactions-=1),Mr.apply(this,arguments)},"Pipeline#execBuffer: Use Pipeline#exec instead");Y.prototype.exec=function(s){if(this.isCluster&&!this.redis.slots.length)return this.redis.status==="wait"&&this.redis.connect().catch(Qo.noop),s&&!this.nodeifiedPromise&&(this.nodeifiedPromise=!0,(0,Tr.default)(this.promise,s)),this.redis.delayUntilReady(i=>{if(i){this.reject(i);return}this.exec(s)}),this.promise;if(this._transactions>0)return this._transactions-=1,Mr.apply(this,arguments);this.nodeifiedPromise||(this.nodeifiedPromise=!0,(0,Tr.default)(this.promise,s)),this._queue.length||this.resolve([]);let e;if(this.isCluster){let i=[];for(let n=0;n<this._queue.length;n++){let o=this._queue[n].getKeys();if(o.length&&i.push(o[0]),o.length&&Tt.generateMulti(o)<0)return this.reject(new Error("All the keys in a pipeline command should belong to the same slot")),this.promise}if(i.length){if(e=zo(this.redis,i),e<0)return this.reject(new Error("All keys in the pipeline should belong to the same slots allocation group")),this.promise}else e=Math.random()*16384|0}let t=this;return r(),this.promise;function r(){let i=t.replyPending=t._queue.length,n;t.isCluster&&(n={slot:e,redis:t.redis.connectionPool.nodes.all[t.preferKey]});let o="",c,a={isPipeline:!0,destination:t.isCluster?n:{redis:t.redis},write(u){typeof u!="string"?(c||(c=[]),o&&(c.push(Buffer.from(o,"utf8")),o=""),c.push(u)):o+=u,--i||(c?(o&&c.push(Buffer.from(o,"utf8")),a.destination.redis.stream.write(Buffer.concat(c))):a.destination.redis.stream.write(o),i=t._queue.length,o="",c=void 0)}};for(let u=0;u<t._queue.length;++u)t.redis.sendCommand(t._queue[u],a,n);return t.promise}}});var Pt=d(qe=>{"use strict";Object.defineProperty(qe,"__esModule",{value:!0});qe.addTransactionSupport=void 0;var Bt=w(),It=z(),Rr=Rt();function Go(s){s.pipeline=function(r){let i=new Rr.default(this);return Array.isArray(r)&&i.addBatch(r),i};let{multi:e}=s;s.multi=function(r,i){if(typeof i>"u"&&!Array.isArray(r)&&(i=r,r=null),i&&i.pipeline===!1)return e.call(this);let n=new Rr.default(this);n.multi(),Array.isArray(r)&&n.addBatch(r);let o=n.exec;n.exec=function(a){if(this.isCluster&&!this.redis.slots.length)return this.redis.status==="wait"&&this.redis.connect().catch(Bt.noop),(0,It.default)(new Promise((l,f)=>{this.redis.delayUntilReady(h=>{if(h){f(h);return}this.exec(n).then(l,f)})}),a);if(this._transactions>0&&o.call(n),this.nodeifiedPromise)return o.call(n);let u=o.call(n);return(0,It.default)(u.then(function(l){let f=l[l.length-1];if(typeof f>"u")throw new Error("Pipeline cannot be used to send any commands when the `exec()` has been called on it.");if(f[0]){f[0].previousErrors=[];for(let h=0;h<l.length-1;++h)l[h][0]&&f[0].previousErrors.push(l[h][0]);throw f[0]}return(0,Bt.wrapMultiResult)(f[1])}),a)};let{execBuffer:c}=n;return n.execBuffer=function(a){return this._transactions>0&&c.call(n),n.exec(a)},n};let{exec:t}=s;s.exec=function(r){return(0,It.default)(t.call(this).then(function(i){return Array.isArray(i)&&(i=(0,Bt.wrapMultiResult)(i)),i}),r)}}qe.addTransactionSupport=Go});var Ft=d(Dt=>{"use strict";Object.defineProperty(Dt,"__esModule",{value:!0});function Yo(s,e){Object.getOwnPropertyNames(e.prototype).forEach(t=>{Object.defineProperty(s.prototype,t,Object.getOwnPropertyDescriptor(e.prototype,t))})}Dt.default=Yo});var Ir=d(Qe=>{"use strict";Object.defineProperty(Qe,"__esModule",{value:!0});Qe.DEFAULT_CLUSTER_OPTIONS=void 0;var Br=require("dns");Qe.DEFAULT_CLUSTER_OPTIONS={clusterRetryStrategy:s=>Math.min(100+s*2,2e3),enableOfflineQueue:!0,enableReadyCheck:!0,scaleReads:"master",maxRedirections:16,retryDelayOnMoved:0,retryDelayOnFailover:100,retryDelayOnClusterDown:100,retryDelayOnTryAgain:100,slotsRefreshTimeout:1e3,useSRVRecords:!1,resolveSrv:Br.resolveSrv,dnsLookup:Br.lookup,enableAutoPipelining:!1,autoPipeliningIgnoredCommands:[]}});var Le=d(x=>{"use strict";Object.defineProperty(x,"__esModule",{value:!0});x.getConnectionName=x.weightSrvRecords=x.groupSrvRecords=x.getUniqueHostnamesFromOptions=x.normalizeNodeOptions=x.nodeKeyToRedisOptions=x.getNodeKey=void 0;var Pr=w(),Vo=require("net");function Ho(s){return s.port=s.port||6379,s.host=s.host||"127.0.0.1",s.host+":"+s.port}x.getNodeKey=Ho;function Ko(s){let e=s.lastIndexOf(":");if(e===-1)throw new Error(`Invalid node key ${s}`);return{host:s.slice(0,e),port:Number(s.slice(e+1))}}x.nodeKeyToRedisOptions=Ko;function Wo(s){return s.map(e=>{let t={};if(typeof e=="object")Object.assign(t,e);else if(typeof e=="string")Object.assign(t,(0,Pr.parseURL)(e));else if(typeof e=="number")t.port=e;else throw new Error("Invalid argument "+e);return typeof t.port=="string"&&(t.port=parseInt(t.port,10)),delete t.db,t.port||(t.port=6379),t.host||(t.host="127.0.0.1"),(0,Pr.resolveTLSProfile)(t)})}x.normalizeNodeOptions=Wo;function Jo(s){let e={};return s.forEach(t=>{e[t.host]=!0}),Object.keys(e).filter(t=>!(0,Vo.isIP)(t))}x.getUniqueHostnamesFromOptions=Jo;function Xo(s){let e={};for(let t of s)e.hasOwnProperty(t.priority)?(e[t.priority].totalWeight+=t.weight,e[t.priority].records.push(t)):e[t.priority]={totalWeight:t.weight,records:[t]};return e}x.groupSrvRecords=Xo;function Zo(s){if(s.records.length===1)return s.totalWeight=0,s.records.shift();let e=Math.floor(Math.random()*(s.totalWeight+s.records.length)),t=0;for(let[r,i]of s.records.entries())if(t+=1+i.weight,t>e)return s.totalWeight-=i.weight,s.records.splice(r,1),i}x.weightSrvRecords=Zo;function $o(s,e){let t=`ioredis-cluster(${s})`;return e?`${t}:${e}`:t}x.getConnectionName=$o});var Fr=d(qt=>{"use strict";Object.defineProperty(qt,"__esModule",{value:!0});var Dr=Le(),Nt=w(),ea=V(),N=(0,Nt.Debug)("cluster:subscriber"),jt=class{constructor(e,t){this.connectionPool=e,this.emitter=t,this.started=!1,this.subscriber=null,this.onSubscriberEnd=()=>{if(!this.started){N("subscriber has disconnected, but ClusterSubscriber is not started, so not reconnecting.");return}N("subscriber has disconnected, selecting a new one..."),this.selectSubscriber()},this.connectionPool.on("-node",(r,i)=>{!this.started||!this.subscriber||(0,Dr.getNodeKey)(this.subscriber.options)===i&&(N("subscriber has left, selecting a new one..."),this.selectSubscriber())}),this.connectionPool.on("+node",()=>{!this.started||this.subscriber||(N("a new node is discovered and there is no subscriber, selecting a new one..."),this.selectSubscriber())})}getInstance(){return this.subscriber}start(){this.started=!0,this.selectSubscriber(),N("started")}stop(){this.started=!1,this.subscriber&&(this.subscriber.disconnect(),this.subscriber=null),N("stopped")}selectSubscriber(){let e=this.lastActiveSubscriber;e&&(e.off("end",this.onSubscriberEnd),e.disconnect()),this.subscriber&&(this.subscriber.off("end",this.onSubscriberEnd),this.subscriber.disconnect());let t=(0,Nt.sample)(this.connectionPool.getNodes());if(!t){N("selecting subscriber failed since there is no node discovered in the cluster yet"),this.subscriber=null;return}let{options:r}=t;N("selected a subscriber %s:%s",r.host,r.port),this.subscriber=new ea.default({port:r.port,host:r.host,username:r.username,password:r.password,enableReadyCheck:!0,connectionName:(0,Dr.getConnectionName)("subscriber",r.connectionName),lazyConnect:!0,tls:r.tls,retryStrategy:null}),this.subscriber.on("error",Nt.noop),this.subscriber.once("end",this.onSubscriberEnd);let i={subscribe:[],psubscribe:[],ssubscribe:[]};if(e){let n=e.condition||e.prevCondition;n&&n.subscriber&&(i.subscribe=n.subscriber.channels("subscribe"),i.psubscribe=n.subscriber.channels("psubscribe"),i.ssubscribe=n.subscriber.channels("ssubscribe"))}if(i.subscribe.length||i.psubscribe.length||i.ssubscribe.length){let n=0;for(let o of["subscribe","psubscribe","ssubscribe"]){let c=i[o];c.length&&(n+=1,N("%s %d channels",o,c.length),this.subscriber[o](c).then(()=>{--n||(this.lastActiveSubscriber=this.subscriber)}).catch(()=>{N("failed to %s %d channels",o,c.length)}))}}else this.lastActiveSubscriber=this.subscriber;for(let n of["message","messageBuffer","smessage","smessageBuffer"])this.subscriber.on(n,(o,c)=>{this.emitter.emit(n,o,c)});for(let n of["pmessage","pmessageBuffer"])this.subscriber.on(n,(o,c,a)=>{this.emitter.emit(n,o,c,a)})}};qt.default=jt});var jr=d(Lt=>{"use strict";Object.defineProperty(Lt,"__esModule",{value:!0});var ta=require("events"),ze=w(),Nr=Le(),sa=V(),me=(0,ze.Debug)("cluster:connectionPool"),Qt=class extends ta.EventEmitter{constructor(e){super(),this.redisOptions=e,this.nodes={all:{},master:{},slave:{}},this.specifiedOptions={}}getNodes(e="all"){let t=this.nodes[e];return Object.keys(t).map(r=>t[r])}getInstanceByKey(e){return this.nodes.all[e]}getSampleInstance(e){let t=Object.keys(this.nodes[e]),r=(0,ze.sample)(t);return this.nodes[e][r]}findOrCreate(e,t=!1){let r=(0,Nr.getNodeKey)(e);t=!!t,this.specifiedOptions[r]?Object.assign(e,this.specifiedOptions[r]):this.specifiedOptions[r]=e;let i;return this.nodes.all[r]?(i=this.nodes.all[r],i.options.readOnly!==t&&(i.options.readOnly=t,me("Change role of %s to %s",r,t?"slave":"master"),i[t?"readonly":"readwrite"]().catch(ze.noop),t?(delete this.nodes.master[r],this.nodes.slave[r]=i):(delete this.nodes.slave[r],this.nodes.master[r]=i))):(me("Connecting to %s as %s",r,t?"slave":"master"),i=new sa.default((0,ze.defaults)({retryStrategy:null,enableOfflineQueue:!0,readOnly:t},e,this.redisOptions,{lazyConnect:!0})),this.nodes.all[r]=i,this.nodes[t?"slave":"master"][r]=i,i.once("end",()=>{this.removeNode(r),this.emit("-node",i,r),Object.keys(this.nodes.all).length||this.emit("drain")}),this.emit("+node",i,r),i.on("error",function(n){this.emit("nodeError",n,r)})),i}reset(e){me("Reset with %O",e);let t={};e.forEach(r=>{let i=(0,Nr.getNodeKey)(r);r.readOnly&&t[i]||(t[i]=r)}),Object.keys(this.nodes.all).forEach(r=>{t[r]||(me("Disconnect %s because the node does not hold any slot",r),this.nodes.all[r].disconnect(),this.removeNode(r))}),Object.keys(t).forEach(r=>{let i=t[r];this.findOrCreate(i,i.readOnly)})}removeNode(e){let{nodes:t}=this;t.all[e]&&(me("Remove %s from the pool",e),delete t.all[e]),delete t.master[e],delete t.slave[e]}};Lt.default=Qt});var Ue=d((fl,qr)=>{"use strict";function b(s,t){var t=t||{};this._capacity=t.capacity,this._head=0,this._tail=0,Array.isArray(s)?this._fromArray(s):(this._capacityMask=3,this._list=new Array(4))}b.prototype.peekAt=function(e){var t=e;if(t===(t|0)){var r=this.size();if(!(t>=r||t<-r))return t<0&&(t+=r),t=this._head+t&this._capacityMask,this._list[t]}};b.prototype.get=function(e){return this.peekAt(e)};b.prototype.peek=function(){if(this._head!==this._tail)return this._list[this._head]};b.prototype.peekFront=function(){return this.peek()};b.prototype.peekBack=function(){return this.peekAt(-1)};Object.defineProperty(b.prototype,"length",{get:function(){return this.size()}});b.prototype.size=function(){return this._head===this._tail?0:this._head<this._tail?this._tail-this._head:this._capacityMask+1-(this._head-this._tail)};b.prototype.unshift=function(e){if(arguments.length===0)return this.size();var t=this._list.length;return this._head=this._head-1+t&this._capacityMask,this._list[this._head]=e,this._tail===this._head&&this._growArray(),this._capacity&&this.size()>this._capacity&&this.pop(),this._head<this._tail?this._tail-this._head:this._capacityMask+1-(this._head-this._tail)};b.prototype.shift=function(){var e=this._head;if(e!==this._tail){var t=this._list[e];return this._list[e]=void 0,this._head=e+1&this._capacityMask,e<2&&this._tail>1e4&&this._tail<=this._list.length>>>2&&this._shrinkArray(),t}};b.prototype.push=function(e){if(arguments.length===0)return this.size();var t=this._tail;return this._list[t]=e,this._tail=t+1&this._capacityMask,this._tail===this._head&&this._growArray(),this._capacity&&this.size()>this._capacity&&this.shift(),this._head<this._tail?this._tail-this._head:this._capacityMask+1-(this._head-this._tail)};b.prototype.pop=function(){var e=this._tail;if(e!==this._head){var t=this._list.length;this._tail=e-1+t&this._capacityMask;var r=this._list[this._tail];return this._list[this._tail]=void 0,this._head<2&&e>1e4&&e<=t>>>2&&this._shrinkArray(),r}};b.prototype.removeOne=function(e){var t=e;if(t===(t|0)&&this._head!==this._tail){var r=this.size(),i=this._list.length;if(!(t>=r||t<-r)){t<0&&(t+=r),t=this._head+t&this._capacityMask;var n=this._list[t],o;if(e<r/2){for(o=e;o>0;o--)this._list[t]=this._list[t=t-1+i&this._capacityMask];this._list[t]=void 0,this._head=this._head+1+i&this._capacityMask}else{for(o=r-1-e;o>0;o--)this._list[t]=this._list[t=t+1+i&this._capacityMask];this._list[t]=void 0,this._tail=this._tail-1+i&this._capacityMask}return n}}};b.prototype.remove=function(e,t){var r=e,i,n=t;if(r===(r|0)&&this._head!==this._tail){var o=this.size(),c=this._list.length;if(!(r>=o||r<-o||t<1)){if(r<0&&(r+=o),t===1||!t)return i=new Array(1),i[0]=this.removeOne(r),i;if(r===0&&r+t>=o)return i=this.toArray(),this.clear(),i;r+t>o&&(t=o-r);var a;for(i=new Array(t),a=0;a<t;a++)i[a]=this._list[this._head+r+a&this._capacityMask];if(r=this._head+r&this._capacityMask,e+t===o){for(this._tail=this._tail-t+c&this._capacityMask,a=t;a>0;a--)this._list[r=r+1+c&this._capacityMask]=void 0;return i}if(e===0){for(this._head=this._head+t+c&this._capacityMask,a=t-1;a>0;a--)this._list[r=r+1+c&this._capacityMask]=void 0;return i}if(r<o/2){for(this._head=this._head+e+t+c&this._capacityMask,a=e;a>0;a--)this.unshift(this._list[r=r-1+c&this._capacityMask]);for(r=this._head-1+c&this._capacityMask;n>0;)this._list[r=r-1+c&this._capacityMask]=void 0,n--;e<0&&(this._tail=r)}else{for(this._tail=r,r=r+t+c&this._capacityMask,a=o-(t+e);a>0;a--)this.push(this._list[r++]);for(r=this._tail;n>0;)this._list[r=r+1+c&this._capacityMask]=void 0,n--}return this._head<2&&this._tail>1e4&&this._tail<=c>>>2&&this._shrinkArray(),i}}};b.prototype.splice=function(e,t){var r=e;if(r===(r|0)){var i=this.size();if(r<0&&(r+=i),!(r>i))if(arguments.length>2){var n,o,c,a=arguments.length,u=this._list.length,l=2;if(!i||r<i/2){for(o=new Array(r),n=0;n<r;n++)o[n]=this._list[this._head+n&this._capacityMask];for(t===0?(c=[],r>0&&(this._head=this._head+r+u&this._capacityMask)):(c=this.remove(r,t),this._head=this._head+r+u&this._capacityMask);a>l;)this.unshift(arguments[--a]);for(n=r;n>0;n--)this.unshift(o[n-1])}else{o=new Array(i-(r+t));var f=o.length;for(n=0;n<f;n++)o[n]=this._list[this._head+r+t+n&this._capacityMask];for(t===0?(c=[],r!=i&&(this._tail=this._head+r+u&this._capacityMask)):(c=this.remove(r,t),this._tail=this._tail-f+u&this._capacityMask);l<a;)this.push(arguments[l++]);for(n=0;n<f;n++)this.push(o[n])}return c}else return this.remove(r,t)}};b.prototype.clear=function(){this._list=new Array(this._list.length),this._head=0,this._tail=0};b.prototype.isEmpty=function(){return this._head===this._tail};b.prototype.toArray=function(){return this._copyArray(!1)};b.prototype._fromArray=function(e){var t=e.length,r=this._nextPowerOf2(t);this._list=new Array(r),this._capacityMask=r-1,this._tail=t;for(var i=0;i<t;i++)this._list[i]=e[i]};b.prototype._copyArray=function(e,t){var r=this._list,i=r.length,n=this.length;if(t=t|n,t==n&&this._head<this._tail)return this._list.slice(this._head,this._tail);var o=new Array(t),c=0,a;if(e||this._head>this._tail){for(a=this._head;a<i;a++)o[c++]=r[a];for(a=0;a<this._tail;a++)o[c++]=r[a]}else for(a=this._head;a<this._tail;a++)o[c++]=r[a];return o};b.prototype._growArray=function(){if(this._head!=0){var e=this._copyArray(!0,this._list.length<<1);this._tail=this._list.length,this._head=0,this._list=e}else this._tail=this._list.length,this._list.length<<=1;this._capacityMask=this._capacityMask<<1|1};b.prototype._shrinkArray=function(){this._list.length>>>=1,this._capacityMask>>>=1};b.prototype._nextPowerOf2=function(e){var t=Math.log(e)/Math.log(2),r=1<<t+1;return Math.max(r,4)};qr.exports=b});var Qr=d(Ut=>{"use strict";Object.defineProperty(Ut,"__esModule",{value:!0});var ra=w(),ia=Ue(),na=(0,ra.Debug)("delayqueue"),zt=class{constructor(){this.queues={},this.timeouts={}}push(e,t,r){let i=r.callback||process.nextTick;this.queues[e]||(this.queues[e]=new ia),this.queues[e].push(t),this.timeouts[e]||(this.timeouts[e]=setTimeout(()=>{i(()=>{this.timeouts[e]=null,this.execute(e)})},r.timeout))}execute(e){let t=this.queues[e];if(!t)return;let{length:r}=t;if(r)for(na("send %d commands in %s queue",r,e),this.queues[e]=null;t.length>0;)t.shift()()}};Ut.default=zt});var Vt=d(Yt=>{"use strict";Object.defineProperty(Yt,"__esModule",{value:!0});var Lr=re(),Vr=require("events"),Ge=Z(),zr=z(),Ur=q(),Gt=Sr(),oa=V(),aa=Fe(),ca=Pt(),M=w(),la=Ft(),ua=je(),fa=Ir(),ha=Fr(),da=jr(),pa=Qr(),fe=Le(),Gr=Ue(),k=(0,M.Debug)("cluster"),Yr=new WeakSet,te=class extends ua.default{constructor(e,t={}){if(super(),this.slots=[],this._groupsIds={},this._groupsBySlot=Array(16384),this.isCluster=!0,this.retryAttempts=0,this.delayQueue=new pa.default,this.offlineQueue=new Gr,this.isRefreshing=!1,this._refreshSlotsCacheCallbacks=[],this._autoPipelines=new Map,this._runningAutoPipelines=new Set,this._readyDelayedCallbacks=[],this.connectionEpoch=0,Vr.EventEmitter.call(this),this.startupNodes=e,this.options=(0,M.defaults)({},t,fa.DEFAULT_CLUSTER_OPTIONS,this.options),this.options.redisOptions&&this.options.redisOptions.keyPrefix&&!this.options.keyPrefix&&(this.options.keyPrefix=this.options.redisOptions.keyPrefix),typeof this.options.scaleReads!="function"&&["all","master","slave"].indexOf(this.options.scaleReads)===-1)throw new Error('Invalid option scaleReads "'+this.options.scaleReads+'". Expected "all", "master", "slave" or a custom function');this.connectionPool=new da.default(this.options.redisOptions),this.connectionPool.on("-node",(r,i)=>{this.emit("-node",r)}),this.connectionPool.on("+node",r=>{this.emit("+node",r)}),this.connectionPool.on("drain",()=>{this.setStatus("close")}),this.connectionPool.on("nodeError",(r,i)=>{this.emit("node error",r,i)}),this.subscriber=new ha.default(this.connectionPool,this),this.options.scripts&&Object.entries(this.options.scripts).forEach(([r,i])=>{this.defineCommand(r,i)}),this.options.lazyConnect?this.setStatus("wait"):this.connect().catch(r=>{k("connecting failed: %s",r)})}connect(){return new Promise((e,t)=>{if(this.status==="connecting"||this.status==="connect"||this.status==="ready"){t(new Error("Redis is already connecting/connected"));return}let r=++this.connectionEpoch;this.setStatus("connecting"),this.resolveStartupNodeHostnames().then(i=>{if(this.connectionEpoch!==r){k("discard connecting after resolving startup nodes because epoch not match: %d != %d",r,this.connectionEpoch),t(new Ge.RedisError("Connection is discarded because a new connection is made"));return}if(this.status!=="connecting"){k("discard connecting after resolving startup nodes because the status changed to %s",this.status),t(new Ge.RedisError("Connection is aborted"));return}this.connectionPool.reset(i);let n=()=>{this.setStatus("ready"),this.retryAttempts=0,this.executeOfflineCommands(),this.resetNodesRefreshInterval(),e()},o,c=()=>{this.invokeReadyDelayedCallbacks(void 0),this.removeListener("close",o),this.manuallyClosing=!1,this.setStatus("connect"),this.options.enableReadyCheck?this.readyCheck((a,u)=>{a||u?(k("Ready check failed (%s). Reconnecting...",a||u),this.status==="connect"&&this.disconnect(!0)):n()}):n()};o=()=>{let a=new Error("None of startup nodes is available");this.removeListener("refresh",c),this.invokeReadyDelayedCallbacks(a),t(a)},this.once("refresh",c),this.once("close",o),this.once("close",this.handleCloseEvent.bind(this)),this.refreshSlotsCache(a=>{a&&a.message===Gt.default.defaultMessage&&(oa.default.prototype.silentEmit.call(this,"error",a),this.connectionPool.reset([]))}),this.subscriber.start()}).catch(i=>{this.setStatus("close"),this.handleCloseEvent(i),this.invokeReadyDelayedCallbacks(i),t(i)})})}disconnect(e=!1){let t=this.status;this.setStatus("disconnecting"),e||(this.manuallyClosing=!0),this.reconnectTimeout&&!e&&(clearTimeout(this.reconnectTimeout),this.reconnectTimeout=null,k("Canceled reconnecting attempts")),this.clearNodesRefreshInterval(),this.subscriber.stop(),t==="wait"?(this.setStatus("close"),this.handleCloseEvent()):this.connectionPool.reset([])}quit(e){let t=this.status;if(this.setStatus("disconnecting"),this.manuallyClosing=!0,this.reconnectTimeout&&(clearTimeout(this.reconnectTimeout),this.reconnectTimeout=null),this.clearNodesRefreshInterval(),this.subscriber.stop(),t==="wait"){let r=(0,zr.default)(Promise.resolve("OK"),e);return setImmediate(function(){this.setStatus("close"),this.handleCloseEvent()}.bind(this)),r}return(0,zr.default)(Promise.all(this.nodes().map(r=>r.quit().catch(i=>{if(i.message===M.CONNECTION_CLOSED_ERROR_MSG)return"OK";throw i}))).then(()=>"OK"),e)}duplicate(e=[],t={}){let r=e.length>0?e:this.startupNodes.slice(0),i=Object.assign({},this.options,t);return new te(r,i)}nodes(e="all"){if(e!=="all"&&e!=="master"&&e!=="slave")throw new Error('Invalid role "'+e+'". Expected "all", "master" or "slave"');return this.connectionPool.getNodes(e)}delayUntilReady(e){this._readyDelayedCallbacks.push(e)}get autoPipelineQueueSize(){let e=0;for(let t of this._autoPipelines.values())e+=t.length;return e}refreshSlotsCache(e){if(e&&this._refreshSlotsCacheCallbacks.push(e),this.isRefreshing)return;this.isRefreshing=!0;let t=this,r=c=>{this.isRefreshing=!1;for(let a of this._refreshSlotsCacheCallbacks)a(c);this._refreshSlotsCacheCallbacks=[]},i=(0,M.shuffle)(this.connectionPool.getNodes()),n=null;function o(c){if(c===i.length){let l=new Gt.default(Gt.default.defaultMessage,n);return r(l)}let a=i[c],u=`${a.options.host}:${a.options.port}`;k("getting slot cache from %s",u),t.getInfoFromNode(a,function(l){switch(t.status){case"close":case"end":return r(new Error("Cluster is disconnected."));case"disconnecting":return r(new Error("Cluster is disconnecting."))}l?(t.emit("node error",l,u),n=l,o(c+1)):(t.emit("refresh"),r())})}o(0)}sendCommand(e,t,r){if(this.status==="wait"&&this.connect().catch(M.noop),this.status==="end")return e.reject(new Error(M.CONNECTION_CLOSED_ERROR_MSG)),e.promise;let i=this.options.scaleReads;i!=="master"&&(e.isReadOnly||(0,Lr.exists)(e.name)&&(0,Lr.hasFlag)(e.name,"readonly")||(i="master"));let n=r?r.slot:e.getSlot(),o={},c=this;if(!r&&!Yr.has(e)){Yr.add(e);let u=e.reject;e.reject=function(l){let f=a.bind(null,!0);c.handleError(l,o,{moved:function(h,p){k("command %s is moved to %s",e.name,p),n=Number(h),c.slots[h]?c.slots[h][0]=p:c.slots[h]=[p],c._groupsBySlot[h]=c._groupsIds[c.slots[h].join(";")],c.connectionPool.findOrCreate(c.natMapper(p)),a(),k("refreshing slot caches... (triggered by MOVED error)"),c.refreshSlotsCache()},ask:function(h,p){k("command %s is required to ask %s:%s",e.name,p);let m=c.natMapper(p);c.connectionPool.findOrCreate(m),a(!1,`${m.host}:${m.port}`)},tryagain:f,clusterDown:f,connectionClosed:f,maxRedirections:function(h){u.call(e,h)},defaults:function(){u.call(e,l)}})}}a();function a(u,l){if(c.status==="end"){e.reject(new Ge.AbortError("Cluster is ended."));return}let f;if(c.status==="ready"||e.name==="cluster"){if(r&&r.redis)f=r.redis;else if(Ur.default.checkFlag("ENTER_SUBSCRIBER_MODE",e.name)||Ur.default.checkFlag("EXIT_SUBSCRIBER_MODE",e.name)){if(f=c.subscriber.getInstance(),!f){e.reject(new Ge.AbortError("No subscriber for the cluster"));return}}else{if(!u){if(typeof n=="number"&&c.slots[n]){let h=c.slots[n];if(typeof i=="function"){let p=h.map(function(m){return c.connectionPool.getInstanceByKey(m)});f=i(p,e),Array.isArray(f)&&(f=(0,M.sample)(f)),f||(f=p[0])}else{let p;i==="all"?p=(0,M.sample)(h):i==="slave"&&h.length>1?p=(0,M.sample)(h,1):p=h[0],f=c.connectionPool.getInstanceByKey(p)}}l&&(f=c.connectionPool.getInstanceByKey(l),f.asking())}f||(f=(typeof i=="function"?null:c.connectionPool.getSampleInstance(i))||c.connectionPool.getSampleInstance("all"))}r&&!r.redis&&(r.redis=f)}f?f.sendCommand(e,t):c.options.enableOfflineQueue?c.offlineQueue.push({command:e,stream:t,node:r}):e.reject(new Error("Cluster isn't ready and enableOfflineQueue options is false"))}return e.promise}sscanStream(e,t){return this.createScanStream("sscan",{key:e,options:t})}sscanBufferStream(e,t){return this.createScanStream("sscanBuffer",{key:e,options:t})}hscanStream(e,t){return this.createScanStream("hscan",{key:e,options:t})}hscanBufferStream(e,t){return this.createScanStream("hscanBuffer",{key:e,options:t})}zscanStream(e,t){return this.createScanStream("zscan",{key:e,options:t})}zscanBufferStream(e,t){return this.createScanStream("zscanBuffer",{key:e,options:t})}handleError(e,t,r){if(typeof t.value>"u"?t.value=this.options.maxRedirections:t.value-=1,t.value<=0){r.maxRedirections(new Error("Too many Cluster redirections. Last error: "+e));return}let i=e.message.split(" ");if(i[0]==="MOVED"){let n=this.options.retryDelayOnMoved;n&&typeof n=="number"?this.delayQueue.push("moved",r.moved.bind(null,i[1],i[2]),{timeout:n}):r.moved(i[1],i[2])}else i[0]==="ASK"?r.ask(i[1],i[2]):i[0]==="TRYAGAIN"?this.delayQueue.push("tryagain",r.tryagain,{timeout:this.options.retryDelayOnTryAgain}):i[0]==="CLUSTERDOWN"&&this.options.retryDelayOnClusterDown>0?this.delayQueue.push("clusterdown",r.connectionClosed,{timeout:this.options.retryDelayOnClusterDown,callback:this.refreshSlotsCache.bind(this)}):e.message===M.CONNECTION_CLOSED_ERROR_MSG&&this.options.retryDelayOnFailover>0&&this.status==="ready"?this.delayQueue.push("failover",r.connectionClosed,{timeout:this.options.retryDelayOnFailover,callback:this.refreshSlotsCache.bind(this)}):r.defaults()}resetOfflineQueue(){this.offlineQueue=new Gr}clearNodesRefreshInterval(){this.slotsTimer&&(clearTimeout(this.slotsTimer),this.slotsTimer=null)}resetNodesRefreshInterval(){if(this.slotsTimer||!this.options.slotsRefreshInterval)return;let e=()=>{this.slotsTimer=setTimeout(()=>{k('refreshing slot caches... (triggered by "slotsRefreshInterval" option)'),this.refreshSlotsCache(()=>{e()})},this.options.slotsRefreshInterval)};e()}setStatus(e){k("status: %s -> %s",this.status||"[empty]",e),this.status=e,process.nextTick(()=>{this.emit(e)})}handleCloseEvent(e){e&&k("closed because %s",e);let t;!this.manuallyClosing&&typeof this.options.clusterRetryStrategy=="function"&&(t=this.options.clusterRetryStrategy.call(this,++this.retryAttempts,e)),typeof t=="number"?(this.setStatus("reconnecting"),this.reconnectTimeout=setTimeout(()=>{this.reconnectTimeout=null,k("Cluster is disconnected. Retrying after %dms",t),this.connect().catch(function(r){k("Got error %s when reconnecting. Ignoring...",r)})},t)):(this.setStatus("end"),this.flushQueue(new Error("None of startup nodes is available")))}flushQueue(e){let t;for(;t=this.offlineQueue.shift();)t.command.reject(e)}executeOfflineCommands(){if(this.offlineQueue.length){k("send %d commands in offline queue",this.offlineQueue.length);let e=this.offlineQueue;this.resetOfflineQueue();let t;for(;t=e.shift();)this.sendCommand(t.command,t.stream,t.node)}}natMapper(e){if(this.options.natMap&&typeof this.options.natMap=="object"){let t=typeof e=="string"?e:`${e.host}:${e.port}`,r=this.options.natMap[t];if(r)return k("NAT mapping %s -> %O",t,r),Object.assign({},r)}return typeof e=="string"?(0,fe.nodeKeyToRedisOptions)(e):e}getInfoFromNode(e,t){if(!e)return t(new Error("Node is disconnected"));let r=e.duplicate({enableOfflineQueue:!0,enableReadyCheck:!1,retryStrategy:null,connectionName:(0,fe.getConnectionName)("refresher",this.options.redisOptions&&this.options.redisOptions.connectionName)});r.on("error",M.noop),r.cluster("SLOTS",(0,M.timeout)((i,n)=>{if(r.disconnect(),i)return t(i);if(this.status==="disconnecting"||this.status==="close"||this.status==="end"){k("ignore CLUSTER.SLOTS results (count: %d) since cluster status is %s",n.length,this.status),t();return}let o=[];k("cluster slots result count: %d",n.length);for(let a=0;a<n.length;++a){let u=n[a],l=u[0],f=u[1],h=[];for(let p=2;p<u.length;p++){if(!u[p][0])continue;let m=this.natMapper({host:u[p][0],port:u[p][1]});m.readOnly=p!==2,o.push(m),h.push(m.host+":"+m.port)}k("cluster slots result [%d]: slots %d~%d served by %s",a,l,f,h);for(let p=l;p<=f;p++)this.slots[p]=h}this._groupsIds=Object.create(null);let c=0;for(let a=0;a<16384;a++){let u=(this.slots[a]||[]).join(";");if(!u.length){this._groupsBySlot[a]=void 0;continue}this._groupsIds[u]||(this._groupsIds[u]=++c),this._groupsBySlot[a]=this._groupsIds[u]}this.connectionPool.reset(o),t()},this.options.slotsRefreshTimeout))}invokeReadyDelayedCallbacks(e){for(let t of this._readyDelayedCallbacks)process.nextTick(t,e);this._readyDelayedCallbacks=[]}readyCheck(e){this.cluster("INFO",(t,r)=>{if(t)return e(t);if(typeof r!="string")return e();let i,n=r.split(`\r
`);for(let o=0;o<n.length;++o){let c=n[o].split(":");if(c[0]==="cluster_state"){i=c[1];break}}i==="fail"?(k("cluster state not ok (%s)",i),e(null,i)):e()})}resolveSrv(e){return new Promise((t,r)=>{this.options.resolveSrv(e,(i,n)=>{if(i)return r(i);let o=this,c=(0,fe.groupSrvRecords)(n),a=Object.keys(c).sort((l,f)=>parseInt(l)-parseInt(f));function u(l){if(!a.length)return r(l);let f=a[0],h=c[f],p=(0,fe.weightSrvRecords)(h);h.records.length||a.shift(),o.dnsLookup(p.name).then(m=>t({host:m,port:p.port}),u)}u()})})}dnsLookup(e){return new Promise((t,r)=>{this.options.dnsLookup(e,(i,n)=>{i?(k("failed to resolve hostname %s to IP: %s",e,i.message),r(i)):(k("resolved hostname %s to IP %s",e,n),t(n))})})}async resolveStartupNodeHostnames(){if(!Array.isArray(this.startupNodes)||this.startupNodes.length===0)throw new Error("`startupNodes` should contain at least one node.");let e=(0,fe.normalizeNodeOptions)(this.startupNodes),t=(0,fe.getUniqueHostnamesFromOptions)(e);if(t.length===0)return e;let r=await Promise.all(t.map((this.options.useSRVRecords?this.resolveSrv:this.dnsLookup).bind(this))),i=(0,M.zipMap)(t,r);return e.map(n=>{let o=i.get(n.host);return o?this.options.useSRVRecords?Object.assign({},n,o):Object.assign({},n,{host:o}):n})}createScanStream(e,{key:t,options:r={}}){return new aa.default({objectMode:!0,key:t,redis:this,command:e,...r})}};(0,la.default)(te,Vr.EventEmitter);(0,ca.addTransactionSupport)(te.prototype);Yt.default=te});var Ye=d(Kt=>{"use strict";Object.defineProperty(Kt,"__esModule",{value:!0});var ya=w(),ga=(0,ya.Debug)("AbstractConnector"),Ht=class{constructor(e){this.connecting=!1,this.disconnectTimeout=e}check(e){return!0}disconnect(){if(this.connecting=!1,this.stream){let e=this.stream,t=setTimeout(()=>{ga("stream %s:%s still open, destroying it",e.remoteAddress,e.remotePort),e.destroy()},this.disconnectTimeout);e.on("close",()=>clearTimeout(t)),e.end()}}};Kt.default=Ht});var Hr=d(Jt=>{"use strict";Object.defineProperty(Jt,"__esModule",{value:!0});var ma=require("net"),ba=require("tls"),Sa=w(),ka=Ye(),Wt=class extends ka.default{constructor(e){super(e.disconnectTimeout),this.options=e}connect(e){let{options:t}=this;this.connecting=!0;let r;return"path"in t&&t.path?r={path:t.path}:(r={},"port"in t&&t.port!=null&&(r.port=t.port),"host"in t&&t.host!=null&&(r.host=t.host),"family"in t&&t.family!=null&&(r.family=t.family)),t.tls&&Object.assign(r,t.tls),new Promise((i,n)=>{process.nextTick(()=>{if(!this.connecting){n(new Error(Sa.CONNECTION_CLOSED_ERROR_MSG));return}try{t.tls?this.stream=(0,ba.connect)(r):this.stream=(0,ma.createConnection)(r)}catch(o){n(o);return}this.stream.once("error",o=>{this.firstError=o}),i(this.stream)})})}};Jt.default=Wt});var Kr=d(Zt=>{"use strict";Object.defineProperty(Zt,"__esModule",{value:!0});function Ca(s,e){return(s.host||"127.0.0.1")===(e.host||"127.0.0.1")&&(s.port||26379)===(e.port||26379)}var Xt=class{constructor(e){this.cursor=0,this.sentinels=e.slice(0)}next(){let e=this.cursor>=this.sentinels.length;return{done:e,value:e?void 0:this.sentinels[this.cursor++]}}reset(e){e&&this.sentinels.length>1&&this.cursor!==1&&this.sentinels.unshift(...this.sentinels.splice(this.cursor-1)),this.cursor=0}add(e){for(let t=0;t<this.sentinels.length;t++)if(Ca(e,this.sentinels[t]))return!1;return this.sentinels.push(e),!0}toString(){return`${JSON.stringify(this.sentinels)} @${this.cursor}`}};Zt.default=Xt});var Jr=d(Ve=>{"use strict";Object.defineProperty(Ve,"__esModule",{value:!0});Ve.FailoverDetector=void 0;var _a=w(),$t=(0,_a.Debug)("FailoverDetector"),Wr="+switch-master",es=class{constructor(e,t){this.isDisconnected=!1,this.connector=e,this.sentinels=t}cleanup(){this.isDisconnected=!0;for(let e of this.sentinels)e.client.disconnect()}async subscribe(){$t("Starting FailoverDetector");let e=[];for(let t of this.sentinels){let r=t.client.subscribe(Wr).catch(i=>{$t("Failed to subscribe to failover messages on sentinel %s:%s (%s)",t.address.host||"127.0.0.1",t.address.port||26739,i.message)});e.push(r),t.client.on("message",i=>{!this.isDisconnected&&i===Wr&&this.disconnect()})}await Promise.all(e)}disconnect(){this.isDisconnected=!0,$t("Failover detected, disconnecting"),this.connector.disconnect()}};Ve.FailoverDetector=es});var He=d(Se=>{"use strict";Object.defineProperty(Se,"__esModule",{value:!0});Se.SentinelIterator=void 0;var wa=require("net"),be=w(),xa=require("tls"),Xr=Kr();Se.SentinelIterator=Xr.default;var Ea=Ye(),va=V(),Aa=Jr(),he=(0,be.Debug)("SentinelConnector"),ts=class extends Ea.default{constructor(e){if(super(e.disconnectTimeout),this.options=e,this.emitter=null,this.failoverDetector=null,!this.options.sentinels.length)throw new Error("Requires at least one sentinel to connect to.");if(!this.options.name)throw new Error("Requires the name of master.");this.sentinelIterator=new Xr.default(this.options.sentinels)}check(e){let t=!e.role||this.options.role===e.role;return t||(he("role invalid, expected %s, but got %s",this.options.role,e.role),this.sentinelIterator.next(),this.sentinelIterator.next(),this.sentinelIterator.reset(!0)),t}disconnect(){super.disconnect(),this.failoverDetector&&this.failoverDetector.cleanup()}connect(e){this.connecting=!0,this.retryAttempts=0;let t,r=async()=>{let i=this.sentinelIterator.next();if(i.done){this.sentinelIterator.reset(!1);let a=typeof this.options.sentinelRetryStrategy=="function"?this.options.sentinelRetryStrategy(++this.retryAttempts):null,u=typeof a!="number"?"All sentinels are unreachable and retry is disabled.":`All sentinels are unreachable. Retrying from scratch after ${a}ms.`;t&&(u+=` Last error: ${t.message}`),he(u);let l=new Error(u);if(typeof a=="number")return e("error",l),await new Promise(f=>setTimeout(f,a)),r();throw l}let n=null,o=null;try{n=await this.resolve(i.value)}catch(a){o=a}if(!this.connecting)throw new Error(be.CONNECTION_CLOSED_ERROR_MSG);let c=i.value.host+":"+i.value.port;if(n)return he("resolved: %s:%s from sentinel %s",n.host,n.port,c),this.options.enableTLSForSentinelMode&&this.options.tls?(Object.assign(n,this.options.tls),this.stream=(0,xa.connect)(n),this.stream.once("secureConnect",this.initFailoverDetector.bind(this))):(this.stream=(0,wa.createConnection)(n),this.stream.once("connect",this.initFailoverDetector.bind(this))),this.stream.once("error",a=>{this.firstError=a}),this.stream;{let a=o?"failed to connect to sentinel "+c+" because "+o.message:"connected to sentinel "+c+" successfully, but got an invalid reply: "+n;return he(a),e("sentinelError",new Error(a)),o&&(t=o),r()}};return r()}async updateSentinels(e){if(!this.options.updateSentinels)return;let t=await e.sentinel("sentinels",this.options.name);Array.isArray(t)&&(t.map(be.packObject).forEach(r=>{if((r.flags?r.flags.split(","):[]).indexOf("disconnected")===-1&&r.ip&&r.port){let n=this.sentinelNatResolve(Zr(r));this.sentinelIterator.add(n)&&he("adding sentinel %s:%s",n.host,n.port)}}),he("Updated internal sentinels: %s",this.sentinelIterator))}async resolveMaster(e){let t=await e.sentinel("get-master-addr-by-name",this.options.name);return await this.updateSentinels(e),this.sentinelNatResolve(Array.isArray(t)?{host:t[0],port:Number(t[1])}:null)}async resolveSlave(e){let t=await e.sentinel("slaves",this.options.name);if(!Array.isArray(t))return null;let r=t.map(be.packObject).filter(i=>i.flags&&!i.flags.match(/(disconnected|s_down|o_down)/));return this.sentinelNatResolve(Oa(r,this.options.preferredSlaves))}sentinelNatResolve(e){return!e||!this.options.natMap?e:this.options.natMap[`${e.host}:${e.port}`]||e}connectToSentinel(e,t){return new va.default({port:e.port||26379,host:e.host,username:this.options.sentinelUsername||null,password:this.options.sentinelPassword||null,family:e.family||("path"in this.options&&this.options.path?void 0:this.options.family),tls:this.options.sentinelTLS,retryStrategy:null,enableReadyCheck:!1,connectTimeout:this.options.connectTimeout,commandTimeout:this.options.sentinelCommandTimeout,...t})}async resolve(e){let t=this.connectToSentinel(e);t.on("error",Ta);try{return this.options.role==="slave"?await this.resolveSlave(t):await this.resolveMaster(t)}finally{t.disconnect()}}async initFailoverDetector(){var e;if(!this.options.failoverDetector)return;this.sentinelIterator.reset(!0);let t=[];for(;t.length<this.options.sentinelMaxConnections;){let{done:r,value:i}=this.sentinelIterator.next();if(r)break;let n=this.connectToSentinel(i,{lazyConnect:!0,retryStrategy:this.options.sentinelReconnectStrategy});n.on("reconnecting",()=>{var o;(o=this.emitter)===null||o===void 0||o.emit("sentinelReconnecting")}),t.push({address:i,client:n})}this.sentinelIterator.reset(!1),this.failoverDetector&&this.failoverDetector.cleanup(),this.failoverDetector=new Aa.FailoverDetector(this,t),await this.failoverDetector.subscribe(),(e=this.emitter)===null||e===void 0||e.emit("failoverSubscribed")}};Se.default=ts;function Oa(s,e){if(s.length===0)return null;let t;if(typeof e=="function")t=e(s);else if(e!==null&&typeof e=="object"){let r=Array.isArray(e)?e:[e];r.sort((i,n)=>(i.prio||(i.prio=1),n.prio||(n.prio=1),i.prio<n.prio?-1:i.prio>n.prio?1:0));for(let i=0;i<r.length;i++){for(let n=0;n<s.length;n++){let o=s[n];if(o.ip===r[i].ip&&o.port===r[i].port){t=o;break}}if(t)break}}return t||(t=(0,be.sample)(s)),Zr(t)}function Zr(s){return{host:s.ip,port:Number(s.port)}}function Ta(){}});var $r=d(de=>{"use strict";Object.defineProperty(de,"__esModule",{value:!0});de.SentinelConnector=de.StandaloneConnector=void 0;var Ma=Hr();de.StandaloneConnector=Ma.default;var Ra=He();de.SentinelConnector=Ra.default});var ei=d(rs=>{"use strict";Object.defineProperty(rs,"__esModule",{value:!0});var Ba=Z(),ss=class extends Ba.AbortError{constructor(e){let t=`Reached the max retries per request limit (which is ${e}). Refer to "maxRetriesPerRequest" option for details.`;super(t),Error.captureStackTrace(this,this.constructor)}get name(){return this.constructor.name}};rs.default=ss});var ti=d(Ke=>{"use strict";Object.defineProperty(Ke,"__esModule",{value:!0});Ke.MaxRetriesPerRequestError=void 0;var Ia=ei();Ke.MaxRetriesPerRequestError=Ia.default});var ci=d((_l,ai)=>{"use strict";var ls=require("buffer").Buffer,Pa=require("string_decoder").StringDecoder,is=new Pa,si=Z(),Da=si.ReplyError,Fa=si.ParserError,D=ls.allocUnsafe(32*1024),A=0,We=null,ke=0,ns=0;function Na(s){let e=s.buffer.length-1;var t=s.offset,r=0,i=1;for(s.buffer[t]===45&&(i=-1,t++);t<e;){let n=s.buffer[t++];if(n===13)return s.offset=t+1,i*r;r=r*10+(n-48)}}function ja(s){let e=s.buffer.length-1;var t=s.offset,r=0,i="";for(s.buffer[t]===45&&(i+="-",t++);t<e;){var n=s.buffer[t++];if(n===13)return s.offset=t+1,r!==0&&(i+=r),i;r>429496728?(i+=r*10+(n-48),r=0):n===48&&r===0?i+=0:r=r*10+(n-48)}}function ri(s){let e=s.offset,t=s.buffer,r=t.length-1;for(var i=e;i<r;)if(t[i++]===13)return s.offset=i+1,s.optionReturnBuffers===!0?s.buffer.slice(e,i-1):s.buffer.toString("utf8",e,i-1)}function ii(s){let e=s.buffer.length-1;for(var t=s.offset,r=0;t<e;){let i=s.buffer[t++];if(i===13)return s.offset=t+1,r;r=r*10+(i-48)}}function qa(s){return s.optionStringNumbers===!0?ja(s):Na(s)}function Qa(s){let e=ii(s);if(e===void 0)return;if(e<0)return null;let t=s.offset+e;if(t+2>s.buffer.length){s.bigStrSize=t+2,s.totalChunkSize=s.buffer.length,s.bufferCache.push(s.buffer);return}let r=s.offset;return s.offset=t+2,s.optionReturnBuffers===!0?s.buffer.slice(r,t):s.buffer.toString("utf8",r,t)}function La(s){var e=ri(s);if(e!==void 0)return s.optionReturnBuffers===!0&&(e=e.toString()),new Da(e)}function za(s,e){let t=new Fa("Protocol error, got "+JSON.stringify(String.fromCharCode(e))+" as reply type byte",JSON.stringify(s.buffer),s.offset);s.buffer=null,s.returnFatalError(t)}function Ua(s){let e=ii(s);if(e===void 0)return;if(e<0)return null;let t=new Array(e);return ni(s,t,0)}function os(s,e,t){s.arrayCache.push(e),s.arrayPos.push(t)}function as(s){let e=s.arrayCache.pop();var t=s.arrayPos.pop();if(s.arrayCache.length){let r=as(s);if(r===void 0){os(s,e,t);return}e[t++]=r}return ni(s,e,t)}function ni(s,e,t){let r=s.buffer.length;for(;t<e.length;){let i=s.offset;if(s.offset>=r){os(s,e,t);return}let n=oi(s,s.buffer[s.offset++]);if(n===void 0){s.arrayCache.length||s.bufferCache.length||(s.offset=i),os(s,e,t);return}e[t]=n,t++}return e}function oi(s,e){switch(e){case 36:return Qa(s);case 43:return ri(s);case 42:return Ua(s);case 58:return qa(s);case 45:return La(s);default:return za(s,e)}}function Ga(){if(D.length>50*1024)if(ke===1||ns>ke*2){let s=Math.floor(D.length/10),e=s<A?A:s;A=0,D=D.slice(e,D.length)}else ns++,ke--;else clearInterval(We),ke=0,ns=0,We=null}function Ya(s){if(D.length<s+A){let e=s>78643200?2:3;A>1024*1024*111&&(A=1024*1024*50),D=ls.allocUnsafe(s*e+A),A=0,ke++,We===null&&(We=setInterval(Ga,50))}}function Va(s){let e=s.bufferCache,t=s.offset;var r=e.length,i=s.bigStrSize-s.totalChunkSize;if(s.offset=i,i<=2){if(r===2)return e[0].toString("utf8",t,e[0].length+i-2);r--,i=e[e.length-2].length+i}for(var n=is.write(e[0].slice(t)),o=1;o<r-1;o++)n+=is.write(e[o]);return n+=is.end(e[o].slice(0,i-2)),n}function Ha(s){let e=s.bufferCache,t=s.offset,r=s.bigStrSize-t-2;var i=e.length,n=s.bigStrSize-s.totalChunkSize;if(s.offset=n,n<=2){if(i===2)return e[0].slice(t,e[0].length+n-2);i--,n=e[e.length-2].length+n}Ya(r);let o=A;e[0].copy(D,o,t,e[0].length),A+=e[0].length-t;for(var c=1;c<i-1;c++)e[c].copy(D,A),A+=e[c].length;return e[c].copy(D,A,0,n-2),A+=n-2,D.slice(o,A)}var cs=class{constructor(e){if(!e)throw new TypeError("Options are mandatory.");if(typeof e.returnError!="function"||typeof e.returnReply!="function")throw new TypeError("The returnReply and returnError options have to be functions.");this.setReturnBuffers(!!e.returnBuffers),this.setStringNumbers(!!e.stringNumbers),this.returnError=e.returnError,this.returnFatalError=e.returnFatalError||e.returnError,this.returnReply=e.returnReply,this.reset()}reset(){this.offset=0,this.buffer=null,this.bigStrSize=0,this.totalChunkSize=0,this.bufferCache=[],this.arrayCache=[],this.arrayPos=[]}setReturnBuffers(e){if(typeof e!="boolean")throw new TypeError("The returnBuffers argument has to be a boolean");this.optionReturnBuffers=e}setStringNumbers(e){if(typeof e!="boolean")throw new TypeError("The stringNumbers argument has to be a boolean");this.optionStringNumbers=e}execute(e){if(this.buffer===null)this.buffer=e,this.offset=0;else if(this.bigStrSize===0){let r=this.buffer.length,i=r-this.offset,n=ls.allocUnsafe(i+e.length);if(this.buffer.copy(n,0,this.offset,r),e.copy(n,i,0,e.length),this.buffer=n,this.offset=0,this.arrayCache.length){let o=as(this);if(o===void 0)return;this.returnReply(o)}}else if(this.totalChunkSize+e.length>=this.bigStrSize){this.bufferCache.push(e);var t=this.optionReturnBuffers?Ha(this):Va(this);if(this.bigStrSize=0,this.bufferCache=[],this.buffer=e,this.arrayCache.length&&(this.arrayCache[0][this.arrayPos[0]++]=t,t=as(this),t===void 0))return;this.returnReply(t)}else{this.bufferCache.push(e),this.totalChunkSize+=e.length;return}for(;this.offset<this.buffer.length;){let r=this.offset,i=this.buffer[this.offset++],n=oi(this,i);if(n===void 0){this.arrayCache.length||this.bufferCache.length||(this.offset=r);return}i===45?this.returnError(n):this.returnReply(n)}this.buffer=null}};ai.exports=cs});var ui=d((wl,li)=>{"use strict";li.exports=ci()});var fi=d(hs=>{"use strict";Object.defineProperty(hs,"__esModule",{value:!0});var fs=class{constructor(){this.set={subscribe:{},psubscribe:{},ssubscribe:{}}}add(e,t){this.set[us(e)][t]=!0}del(e,t){delete this.set[us(e)][t]}channels(e){return Object.keys(this.set[us(e)])}isEmpty(){return this.channels("subscribe").length===0&&this.channels("psubscribe").length===0&&this.channels("ssubscribe").length===0}};hs.default=fs;function us(s){return s==="unsubscribe"?"subscribe":s==="punsubscribe"?"psubscribe":s==="sunsubscribe"?"ssubscribe":s}});var yi=d(ps=>{"use strict";Object.defineProperty(ps,"__esModule",{value:!0});var hi=q(),Ka=w(),Wa=ui(),Ja=fi(),Xa=(0,Ka.Debug)("dataHandler"),ds=class{constructor(e,t){this.redis=e;let r=new Wa({stringNumbers:t.stringNumbers,returnBuffers:!0,returnError:i=>{this.returnError(i)},returnFatalError:i=>{this.returnFatalError(i)},returnReply:i=>{this.returnReply(i)}});e.stream.on("data",i=>{r.execute(i)})}returnFatalError(e){e.message+=". Please report this.",this.redis.recoverFromFatalError(e,e,{offlineQueue:!1})}returnError(e){let t=this.shiftCommand(e);t&&(e.command={name:t.command.name,args:t.command.args},this.redis.handleReconnection(e,t))}returnReply(e){if(this.handleMonitorReply(e)||this.handleSubscriberReply(e))return;let t=this.shiftCommand(e);t&&(hi.default.checkFlag("ENTER_SUBSCRIBER_MODE",t.command.name)?(this.redis.condition.subscriber=new Ja.default,this.redis.condition.subscriber.add(t.command.name,e[1].toString()),di(t.command,e[2])||this.redis.commandQueue.unshift(t)):hi.default.checkFlag("EXIT_SUBSCRIBER_MODE",t.command.name)?pi(t.command,e[2])||this.redis.commandQueue.unshift(t):t.command.resolve(e))}handleSubscriberReply(e){if(!this.redis.condition.subscriber)return!1;let t=Array.isArray(e)?e[0].toString():null;switch(Xa('receive reply "%s" in subscriber mode',t),t){case"message":this.redis.listeners("message").length>0&&this.redis.emit("message",e[1].toString(),e[2]?e[2].toString():""),this.redis.emit("messageBuffer",e[1],e[2]);break;case"pmessage":{let r=e[1].toString();this.redis.listeners("pmessage").length>0&&this.redis.emit("pmessage",r,e[2].toString(),e[3].toString()),this.redis.emit("pmessageBuffer",r,e[2],e[3]);break}case"smessage":{this.redis.listeners("smessage").length>0&&this.redis.emit("smessage",e[1].toString(),e[2]?e[2].toString():""),this.redis.emit("smessageBuffer",e[1],e[2]);break}case"ssubscribe":case"subscribe":case"psubscribe":{let r=e[1].toString();this.redis.condition.subscriber.add(t,r);let i=this.shiftCommand(e);if(!i)return;di(i.command,e[2])||this.redis.commandQueue.unshift(i);break}case"sunsubscribe":case"unsubscribe":case"punsubscribe":{let r=e[1]?e[1].toString():null;r&&this.redis.condition.subscriber.del(t,r);let i=e[2];Number(i)===0&&(this.redis.condition.subscriber=!1);let n=this.shiftCommand(e);if(!n)return;pi(n.command,i)||this.redis.commandQueue.unshift(n);break}default:{let r=this.shiftCommand(e);if(!r)return;r.command.resolve(e)}}return!0}handleMonitorReply(e){if(this.redis.status!=="monitoring")return!1;let t=e.toString();if(t==="OK")return!1;let r=t.indexOf(" "),i=t.slice(0,r),n=t.indexOf('"'),o=t.slice(n+1,-1).split('" "').map(a=>a.replace(/\\"/g,'"')),c=t.slice(r+2,n-2).split(" ");return this.redis.emit("monitor",i,o,c[1],c[0]),!0}shiftCommand(e){let t=this.redis.commandQueue.shift();if(!t){let r="Command queue state error. If you can reproduce this, please report it.",i=new Error(r+(e instanceof Error?` Last error: ${e.message}`:` Last reply: ${e.toString()}`));return this.redis.emit("error",i),null}return t}};ps.default=ds;var H=new WeakMap;function di(s,e){let t=H.has(s)?H.get(s):s.args.length;return t-=1,t<=0?(s.resolve(e),H.delete(s),!0):(H.set(s,t),!1)}function pi(s,e){let t=H.has(s)?H.get(s):s.args.length;return t===0?Number(e)===0?(H.delete(s),s.resolve(e),!0):!1:(t-=1,t<=0?(s.resolve(e),!0):(H.set(s,t),!1))}});var gi=d(B=>{"use strict";Object.defineProperty(B,"__esModule",{value:!0});B.readyHandler=B.errorHandler=B.closeHandler=B.connectHandler=void 0;var Za=Z(),$a=q(),ec=ti(),Ce=w(),tc=yi(),E=(0,Ce.Debug)("connection");function sc(s){return function(){s.setStatus("connect"),s.resetCommandQueue();let e=!1,{connectionEpoch:t}=s;s.condition.auth&&s.auth(s.condition.auth,function(r){t===s.connectionEpoch&&r&&(r.message.indexOf("no password is set")!==-1?console.warn("[WARN] Redis server does not require a password, but a password was supplied."):r.message.indexOf("without any password configured for the default user")!==-1?console.warn("[WARN] This Redis server's `default` user does not require a password, but a password was supplied"):r.message.indexOf("wrong number of arguments for 'auth' command")!==-1?console.warn(`[ERROR] The server returned "wrong number of arguments for 'auth' command". You are probably passing both username and password to Redis version 5 or below. You should only pass the 'password' option for Redis version 5 and under.`):(e=!0,s.recoverFromFatalError(r,r)))}),s.condition.select&&s.select(s.condition.select).catch(r=>{s.silentEmit("error",r)}),s.options.enableReadyCheck||B.readyHandler(s)(),new tc.default(s,{stringNumbers:s.options.stringNumbers}),s.options.enableReadyCheck&&s._readyCheck(function(r,i){t===s.connectionEpoch&&(r?e||s.recoverFromFatalError(new Error("Ready check failed: "+r.message),r):s.connector.check(i)?B.readyHandler(s)():s.disconnect(!0))})}}B.connectHandler=sc;function ys(s){let e=new Za.AbortError("Command aborted due to connection close");return e.command={name:s.name,args:s.args},e}function rc(s){var e;let t=0;for(let r=0;r<s.length;){let i=(e=s.peekAt(r))===null||e===void 0?void 0:e.command,n=i.pipelineIndex;if((n===void 0||n===0)&&(t=0),n!==void 0&&n!==t++){s.remove(r,1),i.reject(ys(i));continue}r++}}function ic(s){var e;for(let t=0;t<s.length;){let r=(e=s.peekAt(t))===null||e===void 0?void 0:e.command;if(r.name==="multi")break;if(r.name==="exec"){s.remove(t,1),r.reject(ys(r));break}r.inTransaction?(s.remove(t,1),r.reject(ys(r))):t++}}function nc(s){return function(){let t=s.status;if(s.setStatus("close"),s.commandQueue.length&&rc(s.commandQueue),s.offlineQueue.length&&ic(s.offlineQueue),t==="ready"&&(s.prevCondition||(s.prevCondition=s.condition),s.commandQueue.length&&(s.prevCommandQueue=s.commandQueue)),s.manuallyClosing)return s.manuallyClosing=!1,E("skip reconnecting since the connection is manually closed."),e();if(typeof s.options.retryStrategy!="function")return E("skip reconnecting because `retryStrategy` is not a function"),e();let r=s.options.retryStrategy(++s.retryAttempts);if(typeof r!="number")return E("skip reconnecting because `retryStrategy` doesn't return a number"),e();E("reconnect in %sms",r),s.setStatus("reconnecting",r),s.reconnectTimeout=setTimeout(function(){s.reconnectTimeout=null,s.connect().catch(Ce.noop)},r);let{maxRetriesPerRequest:i}=s.options;typeof i=="number"&&(i<0?E("maxRetriesPerRequest is negative, ignoring..."):s.retryAttempts%(i+1)===0&&(E("reach maxRetriesPerRequest limitation, flushing command queue..."),s.flushQueue(new ec.MaxRetriesPerRequestError(i))))};function e(){s.setStatus("end"),s.flushQueue(new Error(Ce.CONNECTION_CLOSED_ERROR_MSG))}}B.closeHandler=nc;function oc(s){return function(e){E("error: %s",e),s.silentEmit("error",e)}}B.errorHandler=oc;function ac(s){return function(){if(s.setStatus("ready"),s.retryAttempts=0,s.options.monitor){s.call("monitor").then(()=>s.setStatus("monitoring"),r=>s.emit("error",r));let{sendCommand:t}=s;s.sendCommand=function(r){return $a.default.checkFlag("VALID_IN_MONITOR_MODE",r.name)?t.call(s,r):(r.reject(new Error("Connection is in monitoring mode, can't process commands.")),r.promise)},s.once("close",function(){delete s.sendCommand});return}let e=s.prevCondition?s.prevCondition.select:s.condition.select;if(s.options.connectionName&&(E("set the connection name [%s]",s.options.connectionName),s.client("setname",s.options.connectionName).catch(Ce.noop)),s.options.readOnly&&(E("set the connection to readonly mode"),s.readonly().catch(Ce.noop)),s.prevCondition){let t=s.prevCondition;if(s.prevCondition=null,t.subscriber&&s.options.autoResubscribe){s.condition.select!==e&&(E("connect to db [%d]",e),s.select(e));let r=t.subscriber.channels("subscribe");r.length&&(E("subscribe %d channels",r.length),s.subscribe(r));let i=t.subscriber.channels("psubscribe");i.length&&(E("psubscribe %d channels",i.length),s.psubscribe(i));let n=t.subscriber.channels("ssubscribe");n.length&&(E("ssubscribe %d channels",n.length),s.ssubscribe(n))}}if(s.prevCommandQueue)if(s.options.autoResendUnfulfilledCommands)for(E("resend %d unfulfilled commands",s.prevCommandQueue.length);s.prevCommandQueue.length>0;){let t=s.prevCommandQueue.shift();t.select!==s.condition.select&&t.command.name!=="select"&&s.select(t.select),s.sendCommand(t.command,t.stream)}else s.prevCommandQueue=null;if(s.offlineQueue.length){E("send %d commands in offline queue",s.offlineQueue.length);let t=s.offlineQueue;for(s.resetOfflineQueue();t.length>0;){let r=t.shift();r.select!==s.condition.select&&r.command.name!=="select"&&s.select(r.select),s.sendCommand(r.command,r.stream)}}s.condition.select!==e&&(E("connect to db [%d]",e),s.select(e))}}B.readyHandler=ac});var mi=d(Je=>{"use strict";Object.defineProperty(Je,"__esModule",{value:!0});Je.DEFAULT_REDIS_OPTIONS=void 0;Je.DEFAULT_REDIS_OPTIONS={port:6379,host:"localhost",family:4,connectTimeout:1e4,disconnectTimeout:2e3,retryStrategy:function(s){return Math.min(s*50,2e3)},keepAlive:0,noDelay:!0,connectionName:null,sentinels:null,name:null,role:"master",sentinelRetryStrategy:function(s){return Math.min(s*10,1e3)},sentinelReconnectStrategy:function(){return 6e4},natMap:null,enableTLSForSentinelMode:!1,updateSentinels:!0,failoverDetector:!1,username:null,password:null,db:0,enableOfflineQueue:!0,enableReadyCheck:!0,autoResubscribe:!0,autoResendUnfulfilledCommands:!0,lazyConnect:!1,keyPrefix:"",reconnectOnError:null,readOnly:!1,stringNumbers:!1,maxRetriesPerRequest:20,maxLoadingRetryTime:1e4,enableAutoPipelining:!1,autoPipeliningIgnoredCommands:[],sentinelMaxConnections:10}});var V=d(bs=>{"use strict";Object.defineProperty(bs,"__esModule",{value:!0});var bi=re(),ki=require("events"),gs=z(),cc=Vt(),ms=q(),lc=$r(),uc=He(),K=gi(),fc=mi(),hc=Fe(),dc=Pt(),se=w(),pc=Ft(),yc=je(),W=Me(),Si=Ue(),J=(0,se.Debug)("redis"),I=class extends yc.default{constructor(e,t,r){if(super(),this.status="wait",this.isCluster=!1,this.reconnectTimeout=null,this.connectionEpoch=0,this.retryAttempts=0,this.manuallyClosing=!1,this._autoPipelines=new Map,this._runningAutoPipelines=new Set,this.parseOptions(e,t,r),ki.EventEmitter.call(this),this.resetCommandQueue(),this.resetOfflineQueue(),this.options.Connector)this.connector=new this.options.Connector(this.options);else if(this.options.sentinels){let i=new uc.default(this.options);i.emitter=this,this.connector=i}else this.connector=new lc.StandaloneConnector(this.options);this.options.scripts&&Object.entries(this.options.scripts).forEach(([i,n])=>{this.defineCommand(i,n)}),this.options.lazyConnect?this.setStatus("wait"):this.connect().catch(W.noop)}static createClient(...e){return new I(...e)}get autoPipelineQueueSize(){let e=0;for(let t of this._autoPipelines.values())e+=t.length;return e}connect(e){let t=new Promise((r,i)=>{if(this.status==="connecting"||this.status==="connect"||this.status==="ready"){i(new Error("Redis is already connecting/connected"));return}this.connectionEpoch+=1,this.setStatus("connecting");let{options:n}=this;this.condition={select:n.db,auth:n.username?[n.username,n.password]:n.password,subscriber:!1};let o=this;(0,gs.default)(this.connector.connect(function(c,a){o.silentEmit(c,a)}),function(c,a){if(c){o.flushQueue(c),o.silentEmit("error",c),i(c),o.setStatus("end");return}let u=n.tls?"secureConnect":"connect";if("sentinels"in n&&n.sentinels&&!n.enableTLSForSentinelMode&&(u="connect"),o.stream=a,n.noDelay&&a.setNoDelay(!0),typeof n.keepAlive=="number"&&(a.connecting?a.once(u,()=>{a.setKeepAlive(!0,n.keepAlive)}):a.setKeepAlive(!0,n.keepAlive)),a.connecting){if(a.once(u,K.connectHandler(o)),n.connectTimeout){let h=!1;a.setTimeout(n.connectTimeout,function(){if(h)return;a.setTimeout(0),a.destroy();let p=new Error("connect ETIMEDOUT");p.errorno="ETIMEDOUT",p.code="ETIMEDOUT",p.syscall="connect",K.errorHandler(o)(p)}),a.once(u,function(){h=!0,a.setTimeout(0)})}}else if(a.destroyed){let h=o.connector.firstError;h&&process.nextTick(()=>{K.errorHandler(o)(h)}),process.nextTick(K.closeHandler(o))}else process.nextTick(K.connectHandler(o));a.destroyed||(a.once("error",K.errorHandler(o)),a.once("close",K.closeHandler(o)));let l=function(){o.removeListener("close",f),r()};var f=function(){o.removeListener("ready",l),i(new Error(se.CONNECTION_CLOSED_ERROR_MSG))};o.once("ready",l),o.once("close",f)})});return(0,gs.default)(t,e)}disconnect(e=!1){e||(this.manuallyClosing=!0),this.reconnectTimeout&&!e&&(clearTimeout(this.reconnectTimeout),this.reconnectTimeout=null),this.status==="wait"?K.closeHandler(this)():this.connector.disconnect()}end(){this.disconnect()}duplicate(e){return new I({...this.options,...e})}get mode(){var e;return this.options.monitor?"monitor":!((e=this.condition)===null||e===void 0)&&e.subscriber?"subscriber":"normal"}monitor(e){let t=this.duplicate({monitor:!0,lazyConnect:!1});return(0,gs.default)(new Promise(function(r,i){t.once("error",i),t.once("monitoring",function(){r(t)})}),e)}sendCommand(e,t){var r,i;if(this.status==="wait"&&this.connect().catch(W.noop),this.status==="end")return e.reject(new Error(se.CONNECTION_CLOSED_ERROR_MSG)),e.promise;if(!((r=this.condition)===null||r===void 0)&&r.subscriber&&!ms.default.checkFlag("VALID_IN_SUBSCRIBER_MODE",e.name))return e.reject(new Error("Connection in subscriber mode, only subscriber commands may be used")),e.promise;typeof this.options.commandTimeout=="number"&&e.setTimeout(this.options.commandTimeout);let n=this.status==="ready"||!t&&this.status==="connect"&&(0,bi.exists)(e.name)&&(0,bi.hasFlag)(e.name,"loading");if(this.stream&&this.stream.writable?this.stream._writableState&&this.stream._writableState.ended&&(n=!1):n=!1,n)J.enabled&&J("write command[%s]: %d -> %s(%o)",this._getDescription(),(i=this.condition)===null||i===void 0?void 0:i.select,e.name,e.args),t?"isPipeline"in t&&t.isPipeline?t.write(e.toWritable(t.destination.redis.stream)):t.write(e.toWritable(t)):this.stream.write(e.toWritable(this.stream)),this.commandQueue.push({command:e,stream:t,select:this.condition.select}),ms.default.checkFlag("WILL_DISCONNECT",e.name)&&(this.manuallyClosing=!0),this.options.socketTimeout!==void 0&&this.socketTimeoutTimer===void 0&&this.setSocketTimeout();else{if(!this.options.enableOfflineQueue)return e.reject(new Error("Stream isn't writeable and enableOfflineQueue options is false")),e.promise;if(e.name==="quit"&&this.offlineQueue.length===0)return this.disconnect(),e.resolve(Buffer.from("OK")),e.promise;J.enabled&&J("queue command[%s]: %d -> %s(%o)",this._getDescription(),this.condition.select,e.name,e.args),this.offlineQueue.push({command:e,stream:t,select:this.condition.select})}if(e.name==="select"&&(0,se.isInt)(e.args[0])){let o=parseInt(e.args[0],10);this.condition.select!==o&&(this.condition.select=o,this.emit("select",o),J("switch to db [%d]",this.condition.select))}return e.promise}setSocketTimeout(){this.socketTimeoutTimer=setTimeout(()=>{this.stream.destroy(new Error(`Socket timeout. Expecting data, but didn't receive any in ${this.options.socketTimeout}ms.`)),this.socketTimeoutTimer=void 0},this.options.socketTimeout),this.stream.once("data",()=>{clearTimeout(this.socketTimeoutTimer),this.socketTimeoutTimer=void 0,this.commandQueue.length!==0&&this.setSocketTimeout()})}scanStream(e){return this.createScanStream("scan",{options:e})}scanBufferStream(e){return this.createScanStream("scanBuffer",{options:e})}sscanStream(e,t){return this.createScanStream("sscan",{key:e,options:t})}sscanBufferStream(e,t){return this.createScanStream("sscanBuffer",{key:e,options:t})}hscanStream(e,t){return this.createScanStream("hscan",{key:e,options:t})}hscanBufferStream(e,t){return this.createScanStream("hscanBuffer",{key:e,options:t})}zscanStream(e,t){return this.createScanStream("zscan",{key:e,options:t})}zscanBufferStream(e,t){return this.createScanStream("zscanBuffer",{key:e,options:t})}silentEmit(e,t){let r;if(!(e==="error"&&(r=t,this.status==="end"||this.manuallyClosing&&r instanceof Error&&(r.message===se.CONNECTION_CLOSED_ERROR_MSG||r.syscall==="connect"||r.syscall==="read"))))return this.listeners(e).length>0?this.emit.apply(this,arguments):(r&&r instanceof Error&&console.error("[ioredis] Unhandled error event:",r.stack),!1)}recoverFromFatalError(e,t,r){this.flushQueue(t,r),this.silentEmit("error",t),this.disconnect(!0)}handleReconnection(e,t){var r;let i=!1;switch(this.options.reconnectOnError&&(i=this.options.reconnectOnError(e)),i){case 1:case!0:this.status!=="reconnecting"&&this.disconnect(!0),t.command.reject(e);break;case 2:this.status!=="reconnecting"&&this.disconnect(!0),((r=this.condition)===null||r===void 0?void 0:r.select)!==t.select&&t.command.name!=="select"&&this.select(t.select),this.sendCommand(t.command);break;default:t.command.reject(e)}}_getDescription(){let e;return"path"in this.options&&this.options.path?e=this.options.path:this.stream&&this.stream.remoteAddress&&this.stream.remotePort?e=this.stream.remoteAddress+":"+this.stream.remotePort:"host"in this.options&&this.options.host?e=this.options.host+":"+this.options.port:e="",this.options.connectionName&&(e+=` (${this.options.connectionName})`),e}resetCommandQueue(){this.commandQueue=new Si}resetOfflineQueue(){this.offlineQueue=new Si}parseOptions(...e){let t={},r=!1;for(let i=0;i<e.length;++i){let n=e[i];if(!(n===null||typeof n>"u"))if(typeof n=="object")(0,W.defaults)(t,n);else if(typeof n=="string")(0,W.defaults)(t,(0,se.parseURL)(n)),n.startsWith("rediss://")&&(r=!0);else if(typeof n=="number")t.port=n;else throw new Error("Invalid argument "+n)}r&&(0,W.defaults)(t,{tls:!0}),(0,W.defaults)(t,I.defaultOptions),typeof t.port=="string"&&(t.port=parseInt(t.port,10)),typeof t.db=="string"&&(t.db=parseInt(t.db,10)),this.options=(0,se.resolveTLSProfile)(t)}setStatus(e,t){J.enabled&&J("status[%s]: %s -> %s",this._getDescription(),this.status||"[empty]",e),this.status=e,process.nextTick(this.emit.bind(this,e,t))}createScanStream(e,{key:t,options:r={}}){return new hc.default({objectMode:!0,key:t,redis:this,command:e,...r})}flushQueue(e,t){t=(0,W.defaults)({},t,{offlineQueue:!0,commandQueue:!0});let r;if(t.offlineQueue)for(;r=this.offlineQueue.shift();)r.command.reject(e);if(t.commandQueue&&this.commandQueue.length>0)for(this.stream&&this.stream.removeAllListeners("data");r=this.commandQueue.shift();)r.command.reject(e)}_readyCheck(e){let t=this;this.info(function(r,i){if(r)return r.message&&r.message.includes("NOPERM")?(console.warn(`Skipping the ready check because INFO command fails: "${r.message}". You can disable ready check with "enableReadyCheck". More: https://github.com/luin/ioredis/wiki/Disable-ready-check.`),e(null,{})):e(r);if(typeof i!="string")return e(null,i);let n={},o=i.split(`\r
`);for(let c=0;c<o.length;++c){let[a,...u]=o[c].split(":"),l=u.join(":");l&&(n[a]=l)}if(!n.loading||n.loading==="0")e(null,n);else{let c=(n.loading_eta_seconds||1)*1e3,a=t.options.maxLoadingRetryTime&&t.options.maxLoadingRetryTime<c?t.options.maxLoadingRetryTime:c;J("Redis server still loading, trying again in "+a+"ms"),setTimeout(function(){t._readyCheck(e)},a)}}).catch(W.noop)}};I.Cluster=cc.default;I.Command=ms.default;I.defaultOptions=fc.DEFAULT_REDIS_OPTIONS;(0,pc.default)(I,ki.EventEmitter);(0,dc.addTransactionSupport)(I.prototype);bs.default=I});var wi=d((g,_i)=>{"use strict";Object.defineProperty(g,"__esModule",{value:!0});g.print=g.ReplyError=g.SentinelIterator=g.SentinelConnector=g.AbstractConnector=g.Pipeline=g.ScanStream=g.Command=g.Cluster=g.Redis=g.default=void 0;g=_i.exports=V().default;var gc=V();Object.defineProperty(g,"default",{enumerable:!0,get:function(){return gc.default}});var mc=V();Object.defineProperty(g,"Redis",{enumerable:!0,get:function(){return mc.default}});var bc=Vt();Object.defineProperty(g,"Cluster",{enumerable:!0,get:function(){return bc.default}});var Sc=q();Object.defineProperty(g,"Command",{enumerable:!0,get:function(){return Sc.default}});var kc=Fe();Object.defineProperty(g,"ScanStream",{enumerable:!0,get:function(){return kc.default}});var Cc=Rt();Object.defineProperty(g,"Pipeline",{enumerable:!0,get:function(){return Cc.default}});var _c=Ye();Object.defineProperty(g,"AbstractConnector",{enumerable:!0,get:function(){return _c.default}});var Ci=He();Object.defineProperty(g,"SentinelConnector",{enumerable:!0,get:function(){return Ci.default}});Object.defineProperty(g,"SentinelIterator",{enumerable:!0,get:function(){return Ci.SentinelIterator}});g.ReplyError=Z().ReplyError;Object.defineProperty(g,"Promise",{get(){return console.warn("ioredis v5 does not support plugging third-party Promise library anymore. Native Promise will be used."),Promise},set(s){console.warn("ioredis v5 does not support plugging third-party Promise library anymore. Native Promise will be used.")}});function wc(s,e){console.log(s?"Error: "+s:"Reply: "+e)}g.print=wc});var vc={};Pi(vc,{default:()=>Ec});module.exports=Di(vc);var xi=Cs(vs()),Ei=Cs(wi()),xc=(0,xi.default)(async s=>{try{let e=new Ei.default({host:s.config.REDIS_CLIENT,port:s.config.REDIS_PORT,username:s.config.REDIS_USER,password:s.config.REDIS_PASSWORD});s.decorate("redis",e),s.addHook("onClose",(t,r)=>{t?.redis!==void 0&&t.redis?.disconnect(),r()}),s.log.info("Connect redis success")}catch(e){s.log.error(`Connect redis error ${e}`)}}),Ec=xc;0&&(module.exports={});
//# sourceMappingURL=redis.plugin.js.map
