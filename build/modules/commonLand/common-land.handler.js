"use strict";var rt=Object.defineProperty;var ci=Object.getOwnPropertyDescriptor;var ui=Object.getOwnPropertyNames;var mi=Object.prototype.hasOwnProperty;var fi=(r,e,t)=>e in r?rt(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var di=(r,e)=>{for(var t in e)rt(r,t,{get:e[t],enumerable:!0})},pi=(r,e,t,i)=>{if(e&&typeof e=="object"||typeof e=="function")for(let n of ui(e))!mi.call(r,n)&&n!==t&&rt(r,n,{get:()=>e[n],enumerable:!(i=ci(e,n))||i.enumerable});return r};var hi=r=>pi(rt({},"__esModule",{value:!0}),r);var l=(r,e,t)=>(fi(r,typeof e!="symbol"?e+"":e,t),t),wr=(r,e,t)=>{if(!e.has(r))throw TypeError("Cannot "+t)};var br=(r,e,t)=>(wr(r,e,"read from private field"),t?t.call(r):e.get(r)),Sr=(r,e,t)=>{if(e.has(r))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(r):e.set(r,t)},Nr=(r,e,t,i)=>(wr(r,e,"write to private field"),i?i.call(r,t):e.set(r,t),t);var ts={};di(ts,{default:()=>Ft});module.exports=hi(ts);var it=class{static convertStringToSlug(e){let{text:t,slugConvert:i="-"}=e;if(!t||t===null)return"";let n;return n=t.toLowerCase(),n=t.toLowerCase(),n=n.replace(/á|à|ả|ạ|ã|ă|ắ|ằ|ẳ|ẵ|ặ|â|ấ|ầ|ẩ|ẫ|ậ/gi,"a"),n=n.replace(/é|è|ẻ|ẽ|ẹ|ê|ế|ề|ể|ễ|ệ/gi,"e"),n=n.replace(/i|í|ì|ỉ|ĩ|ị/gi,"i"),n=n.replace(/ó|ò|ỏ|õ|ọ|ô|ố|ồ|ổ|ỗ|ộ|ơ|ớ|ờ|ở|ỡ|ợ/gi,"o"),n=n.replace(/ú|ù|ủ|ũ|ụ|ư|ứ|ừ|ử|ữ|ự/gi,"u"),n=n.replace(/ý|ỳ|ỷ|ỹ|ỵ/gi,"y"),n=n.replace(/đ/gi,"d"),n=n.replace(/\`|\~|\!|\@|\#|\||\$|\%|\^|\&|\*|\(|\)|\+|\=|\,|\.|\/|\?|\>|\<|\'|\"|\:|\;|_/gi,""),n=n.replace(/ /gi,i),n=n.replace(/\-\-\-\-\-/gi,"-"),n=n.replace(/\-\-\-\-/gi,"-"),n=n.replace(/\-\-\-/gi,"-"),n=n.replace(/\-\-/gi,"-"),n="@"+n+"@",n=n.replace(/\@\-|\-\@|\@/gi,""),n?.trim()}static isPathImage(e){return e.match(/\.(jpeg|jpg|gif|png)$/)!=null}};var a=Symbol.for("drizzle:entityKind"),ns=Symbol.for("drizzle:hasOwnEntityKind");function u(r,e){if(!r||typeof r!="object")return!1;if(r instanceof e)return!0;if(!Object.prototype.hasOwnProperty.call(e,a))throw new Error(`Class "${e.name??"<unknown>"}" doesn't look like a Drizzle entity. If this is incorrect and the class is provided by Drizzle, please report this as a bug.`);let t=r.constructor;if(t)for(;t;){if(a in t&&t[a]===e[a])return!0;t=Object.getPrototypeOf(t)}return!1}var yi,T=class{constructor(e,t){this.table=e,this.config=t,this.name=t.name,this.notNull=t.notNull,this.default=t.default,this.defaultFn=t.defaultFn,this.onUpdateFn=t.onUpdateFn,this.hasDefault=t.hasDefault,this.primary=t.primaryKey,this.isUnique=t.isUnique,this.uniqueName=t.uniqueName,this.uniqueType=t.uniqueType,this.dataType=t.dataType,this.columnType=t.columnType}name;primary;notNull;default;defaultFn;onUpdateFn;hasDefault;isUnique;uniqueName;uniqueType;dataType;columnType;enumValues=void 0;config;mapFromDriverValue(e){return e}mapToDriverValue(e){return e}};yi=a,l(T,yi,"Column");var gi,Ke=class{config;constructor(e,t,i){this.config={name:e,notNull:!1,default:void 0,hasDefault:!1,primaryKey:!1,isUnique:!1,uniqueName:void 0,uniqueType:void 0,dataType:t,columnType:i}}$type(){return this}notNull(){return this.config.notNull=!0,this}default(e){return this.config.default=e,this.config.hasDefault=!0,this}$defaultFn(e){return this.config.defaultFn=e,this.config.hasDefault=!0,this}$default=this.$defaultFn;$onUpdateFn(e){return this.config.onUpdateFn=e,this.config.hasDefault=!0,this}$onUpdate=this.$onUpdateFn;primaryKey(){return this.config.primaryKey=!0,this.config.notNull=!0,this}};gi=a,l(Ke,gi,"ColumnBuilder");var nt=Symbol.for("drizzle:Name"),Bt=Symbol.for("drizzle:Schema"),xr=Symbol.for("drizzle:Columns"),$r=Symbol.for("drizzle:ExtraConfigColumns"),Vt=Symbol.for("drizzle:OriginalName"),Mt=Symbol.for("drizzle:BaseName"),Tr=Symbol.for("drizzle:IsAlias"),Cr=Symbol.for("drizzle:ExtraConfigBuilder"),wi=Symbol.for("drizzle:IsDrizzleTable"),bi,h=class{[(bi=a,nt)];[Vt];[Bt];[xr];[$r];[Mt];[Tr]=!1;[Cr]=void 0;[wi]=!0;constructor(e,t,i){this[nt]=this[Vt]=e,this[Bt]=t,this[Mt]=i}};l(h,bi,"Table"),l(h,"Symbol",{Name:nt,Schema:Bt,OriginalName:Vt,Columns:xr,ExtraConfigColumns:$r,BaseName:Mt,IsAlias:Tr,ExtraConfigBuilder:Cr});function fe(r){return r[nt]}var Rt=Symbol.for("drizzle:PgInlineForeignKeys"),Si,B=class extends h{[(Si=a,Rt)]=[];[h.Symbol.ExtraConfigBuilder]=void 0};l(B,Si,"PgTable"),l(B,"Symbol",Object.assign({},h.Symbol,{InlineForeignKeys:Rt}));function Ut(r,e,t,i,n=r){let o=new B(r,i,n),c=Object.fromEntries(Object.entries(e).map(([m,y])=>{let b=y,N=b.build(o);return o[Rt].push(...b.buildForeignKeys(N,o)),[m,N]})),f=Object.fromEntries(Object.entries(e).map(([m,y])=>{let N=y.buildExtraConfigColumn(o);return[m,N]})),d=Object.assign(o,c);return d[h.Symbol.Columns]=c,d[h.Symbol.ExtraConfigColumns]=f,t&&(d[B.Symbol.ExtraConfigBuilder]=t),d}var Wt=(r,e,t)=>Ut(r,e,t,void 0);var Ni,Ie=class{reference;_onUpdate="no action";_onDelete="no action";constructor(e,t){this.reference=()=>{let{name:i,columns:n,foreignColumns:o}=e();return{name:i,columns:n,foreignTable:o[0].table,foreignColumns:o}},t&&(this._onUpdate=t.onUpdate,this._onDelete=t.onDelete)}onUpdate(e){return this._onUpdate=e===void 0?"no action":e,this}onDelete(e){return this._onDelete=e===void 0?"no action":e,this}build(e){return new st(e,this)}};Ni=a,l(Ie,Ni,"PgForeignKeyBuilder");var xi,st=class{constructor(e,t){this.table=e,this.reference=t.reference,this.onUpdate=t._onUpdate,this.onDelete=t._onDelete}reference;onUpdate;onDelete;getName(){let{name:e,columns:t,foreignColumns:i}=this.reference(),n=t.map(f=>f.name),o=i.map(f=>f.name),c=[this.table[B.Symbol.Name],...n,i[0].table[B.Symbol.Name],...o];return e??`${c.join("_")}_fk`}};xi=a,l(st,xi,"PgForeignKey");function ot(r,...e){return r(...e)}function Ht(r,e){return`${r[B.Symbol.Name]}_${e.join("_")}_unique`}var $i,at=class{constructor(e,t){this.name=t,this.columns=e}columns;nullsNotDistinctConfig=!1;nullsNotDistinct(){return this.nullsNotDistinctConfig=!0,this}build(e){return new lt(e,this.columns,this.nullsNotDistinctConfig,this.name)}};$i=a,l(at,$i,"PgUniqueConstraintBuilder");var Ti,Jt=class{name;constructor(e){this.name=e}on(...e){return new at(e,this.name)}};Ti=a,l(Jt,Ti,"PgUniqueOnConstraintBuilder");var Ci,lt=class{constructor(e,t,i,n){this.table=e,this.columns=t,this.name=n??Ht(this.table,this.columns.map(o=>o.name)),this.nullsNotDistinct=i}columns;name;nullsNotDistinct=!1;getName(){return this.name}};Ci=a,l(lt,Ci,"PgUniqueConstraint");function vr(r,e,t){for(let i=e;i<r.length;i++){let n=r[i];if(n==="\\"){i++;continue}if(n==='"')return[r.slice(e,i).replace(/\\/g,""),i+1];if(!t&&(n===","||n==="}"))return[r.slice(e,i).replace(/\\/g,""),i]}return[r.slice(e).replace(/\\/g,""),r.length]}function qr(r,e=0){let t=[],i=e,n=!1;for(;i<r.length;){let o=r[i];if(o===","){(n||i===e)&&t.push(""),n=!0,i++;continue}if(n=!1,o==="\\"){i+=2;continue}if(o==='"'){let[d,m]=vr(r,i+1,!0);t.push(d),i=m;continue}if(o==="}")return[t,i+1];if(o==="{"){let[d,m]=qr(r,i+1);t.push(d),i=m;continue}let[c,f]=vr(r,i,!1);t.push(c),i=f}return[t,i]}function _r(r){let[e]=qr(r,1);return e}function kt(r){return`{${r.map(e=>Array.isArray(e)?kt(e):typeof e=="string"?`"${e.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}"`:`${e}`).join(",")}}`}var vi,C=class extends Ke{foreignKeyConfigs=[];array(e){return new ut(this.config.name,this,e)}references(e,t={}){return this.foreignKeyConfigs.push({ref:e,actions:t}),this}unique(e,t){return this.config.isUnique=!0,this.config.uniqueName=e,this.config.uniqueType=t?.nulls,this}buildForeignKeys(e,t){return this.foreignKeyConfigs.map(({ref:i,actions:n})=>ot((o,c)=>{let f=new Ie(()=>{let d=o();return{columns:[e],foreignColumns:[d]}});return c.onUpdate&&f.onUpdate(c.onUpdate),c.onDelete&&f.onDelete(c.onDelete),f.build(t)},i,n))}buildExtraConfigColumn(e){return new ct(e,this.config)}};vi=a,l(C,vi,"PgColumnBuilder");var qi,w=class extends T{constructor(e,t){t.uniqueName||(t.uniqueName=Ht(e,[t.name])),super(e,t),this.table=e}};qi=a,l(w,qi,"PgColumn");var _i,ct=class extends w{getSQLType(){return this.getSQLType()}indexConfig={order:this.config.order??"asc",nulls:this.config.nulls??"last",opClass:this.config.opClass};defaultConfig={order:"asc",nulls:"last",opClass:void 0};asc(){return this.indexConfig.order="asc",this}desc(){return this.indexConfig.order="desc",this}nullsFirst(){return this.indexConfig.nulls="first",this}nullsLast(){return this.indexConfig.nulls="last",this}op(e){return this.indexConfig.opClass=e,this}};_i=a,l(ct,_i,"ExtraConfigColumn");var Oi,le=class{constructor(e,t,i){this.name=e,this.type=t,this.indexConfig=i}name;type;indexConfig};Oi=a,l(le,Oi,"IndexedColumn");var Pi,ut=class extends C{constructor(e,t,i){super(e,"array","PgArray"),this.config.baseBuilder=t,this.config.size=i}build(e){let t=this.config.baseBuilder.build(e);return new mt(e,this.config,t)}};Pi=a,l(ut,Pi,"PgArrayBuilder");var Ei,Gt=class extends w{constructor(e,t,i,n){super(e,t),this.baseColumn=i,this.range=n,this.size=t.size}size;getSQLType(){return`${this.baseColumn.getSQLType()}[${typeof this.size=="number"?this.size:""}]`}mapFromDriverValue(e){return typeof e=="string"&&(e=_r(e)),e.map(t=>this.baseColumn.mapFromDriverValue(t))}mapToDriverValue(e,t=!1){let i=e.map(n=>n===null?null:u(this.baseColumn,Gt)?this.baseColumn.mapToDriverValue(n,!0):this.baseColumn.mapToDriverValue(n));return t?i:kt(i)}},mt=Gt;Ei=a,l(mt,Ei,"PgArray");var Yt=Symbol.for("drizzle:isPgEnum");function Or(r){return!!r&&typeof r=="function"&&Yt in r&&r[Yt]===!0}var Ai,ft=class extends C{constructor(e,t){super(e,"string","PgEnumColumn"),this.config.enum=t}build(e){return new dt(e,this.config)}};Ai=a,l(ft,Ai,"PgEnumColumnBuilder");var ji,dt=class extends w{enum=this.config.enum;enumValues=this.config.enum.enumValues;constructor(e,t){super(e,t),this.enum=t.enum}getSQLType(){return this.enum.enumName}};ji=a,l(dt,ji,"PgEnumColumn");function Pr(r,e,t){let i=Object.assign(n=>new ft(n,i),{enumName:r,enumValues:e,schema:t,[Yt]:!0});return i}var Di,Q=class{constructor(e,t,i,n=!1){this._={brand:"Subquery",sql:e,selectedFields:t,alias:i,isWith:n}}};Di=a,l(Q,Di,"Subquery");var Qi,Be=class extends Q{};Qi=a,l(Be,Qi,"WithSubquery");var Er="0.31.2";var Xt,Zt,Ve={startActiveSpan(r,e){return Xt?(Zt||(Zt=Xt.trace.getTracer("drizzle-orm",Er)),ot((t,i)=>i.startActiveSpan(r,n=>{try{return e(n)}catch(o){throw n.setStatus({code:t.SpanStatusCode.ERROR,message:o instanceof Error?o.message:"Unknown error"}),o}finally{n.end()}}),Xt,Zt)):e()}};var v=Symbol.for("drizzle:ViewBaseConfig");var zi,er=class{};zi=a,l(er,zi,"FakePrimitiveParam");function tr(r){return r!=null&&typeof r.getSQL=="function"}function Li(r){let e={sql:"",params:[]};for(let t of r)e.sql+=t.sql,e.params.push(...t.params),t.typings?.length&&(e.typings||(e.typings=[]),e.typings.push(...t.typings));return e}var Fi,O=class{value;constructor(e){this.value=Array.isArray(e)?e:[e]}getSQL(){return new p([this])}};Fi=a,l(O,Fi,"StringChunk");var Ki,de=class{constructor(e){this.queryChunks=e}decoder=jr;shouldInlineParams=!1;append(e){return this.queryChunks.push(...e.queryChunks),this}toQuery(e){return Ve.startActiveSpan("drizzle.buildSQL",t=>{let i=this.buildQueryFromSourceParams(this.queryChunks,e);return t?.setAttributes({"drizzle.query.text":i.sql,"drizzle.query.params":JSON.stringify(i.params)}),i})}buildQueryFromSourceParams(e,t){let i=Object.assign({},t,{inlineParams:t.inlineParams||this.shouldInlineParams,paramStartIndex:t.paramStartIndex||{value:0}}),{escapeName:n,escapeParam:o,prepareTyping:c,inlineParams:f,paramStartIndex:d}=i;return Li(e.map(m=>{if(u(m,O))return{sql:m.value.join(""),params:[]};if(u(m,pe))return{sql:n(m.value),params:[]};if(m===void 0)return{sql:"",params:[]};if(Array.isArray(m)){let y=[new O("(")];for(let[b,N]of m.entries())y.push(N),b<m.length-1&&y.push(new O(", "));return y.push(new O(")")),this.buildQueryFromSourceParams(y,i)}if(u(m,de))return this.buildQueryFromSourceParams(m.queryChunks,{...i,inlineParams:f||m.shouldInlineParams});if(u(m,h)){let y=m[h.Symbol.Schema],b=m[h.Symbol.Name];return{sql:y===void 0?n(b):n(y)+"."+n(b),params:[]}}if(u(m,T))return t.invokeSource==="indexes"?{sql:n(m.name),params:[]}:{sql:n(m.table[h.Symbol.Name])+"."+n(m.name),params:[]};if(u(m,M)){let y=m[v].schema,b=m[v].name;return{sql:y===void 0?n(b):n(y)+"."+n(b),params:[]}}if(u(m,H)){let y=m.value===null?null:m.encoder.mapToDriverValue(m.value);if(u(y,de))return this.buildQueryFromSourceParams([y],i);if(f)return{sql:this.mapInlineParam(y,i),params:[]};let b;return c!==void 0&&(b=[c(m.encoder)]),{sql:o(d.value++,y),params:[y],typings:b}}return u(m,ce)?{sql:o(d.value++,m),params:[m]}:u(m,de.Aliased)&&m.fieldAlias!==void 0?{sql:n(m.fieldAlias),params:[]}:u(m,Q)?m._.isWith?{sql:n(m._.alias),params:[]}:this.buildQueryFromSourceParams([new O("("),m._.sql,new O(") "),new pe(m._.alias)],i):Or(m)?m.schema?{sql:n(m.schema)+"."+n(m.enumName),params:[]}:{sql:n(m.enumName),params:[]}:tr(m)?this.buildQueryFromSourceParams([new O("("),m.getSQL(),new O(")")],i):f?{sql:this.mapInlineParam(m,i),params:[]}:{sql:o(d.value++,m),params:[m]}}))}mapInlineParam(e,{escapeString:t}){if(e===null)return"null";if(typeof e=="number"||typeof e=="boolean")return e.toString();if(typeof e=="string")return t(e);if(typeof e=="object"){let i=e.toString();return t(i==="[object Object]"?JSON.stringify(e):i)}throw new Error("Unexpected param value: "+e)}getSQL(){return this}as(e){return e===void 0?this:new de.Aliased(this,e)}mapWith(e){return this.decoder=typeof e=="function"?{mapFromDriverValue:e}:e,this}inlineParams(){return this.shouldInlineParams=!0,this}if(e){return e?this:void 0}},p=de;Ki=a,l(p,Ki,"SQL");var Ii,pe=class{constructor(e){this.value=e}brand;getSQL(){return new p([this])}};Ii=a,l(pe,Ii,"Name");function Ar(r){return typeof r=="object"&&r!==null&&"mapToDriverValue"in r&&typeof r.mapToDriverValue=="function"}var jr={mapFromDriverValue:r=>r},Dr={mapToDriverValue:r=>r},io={...jr,...Dr},Bi,H=class{constructor(e,t=Dr){this.value=e,this.encoder=t}brand;getSQL(){return new p([this])}};Bi=a,l(H,Bi,"Param");function s(r,...e){let t=[];(e.length>0||r.length>0&&r[0]!=="")&&t.push(new O(r[0]));for(let[i,n]of e.entries())t.push(n,new O(r[i+1]));return new p(t)}(r=>{function e(){return new p([])}r.empty=e;function t(d){return new p(d)}r.fromList=t;function i(d){return new p([new O(d)])}r.raw=i;function n(d,m){let y=[];for(let[b,N]of d.entries())b>0&&m!==void 0&&y.push(m),y.push(N);return new p(y)}r.join=n;function o(d){return new pe(d)}r.identifier=o;function c(d){return new ce(d)}r.placeholder=c;function f(d,m){return new H(d,m)}r.param=f})(s||(s={}));(r=>{class e{constructor(i,n){this.sql=i,this.fieldAlias=n}static[a]="SQL.Aliased";isSelectionField=!1;getSQL(){return this.sql}clone(){return new e(this.sql,this.fieldAlias)}}r.Aliased=e})(p||(p={}));var Vi,ce=class{constructor(e){this.name=e}getSQL(){return new p([this])}};Vi=a,l(ce,Vi,"Placeholder");var Mi,M=class{[(Mi=a,v)];constructor({name:e,schema:t,selectedFields:i,query:n}){this[v]={name:e,originalName:e,schema:t,selectedFields:i,query:n,isExisting:!n,isAlias:!1}}getSQL(){return new p([this])}};l(M,Mi,"View");T.prototype.getSQL=function(){return new p([this])};h.prototype.getSQL=function(){return new p([this])};Q.prototype.getSQL=function(){return new p([this])};var Ri,ne=class{constructor(e){this.table=e}get(e,t){return t==="table"?this.table:e[t]}};Ri=a,l(ne,Ri,"ColumnAliasProxyHandler");var Ui,ue=class{constructor(e,t){this.alias=e,this.replaceOriginalName=t}get(e,t){if(t===h.Symbol.IsAlias)return!0;if(t===h.Symbol.Name)return this.alias;if(this.replaceOriginalName&&t===h.Symbol.OriginalName)return this.alias;if(t===v)return{...e[v],name:this.alias,isAlias:!0};if(t===h.Symbol.Columns){let n=e[h.Symbol.Columns];if(!n)return n;let o={};return Object.keys(n).map(c=>{o[c]=new Proxy(n[c],new ne(new Proxy(e,this)))}),o}let i=e[t];return u(i,T)?new Proxy(i,new ne(new Proxy(e,this))):i}};Ui=a,l(ue,Ui,"TableAliasProxyHandler");var Wi,rr=class{constructor(e){this.alias=e}get(e,t){return t==="sourceTable"?Me(e.sourceTable,this.alias):e[t]}};Wi=a,l(rr,Wi,"RelationTableAliasProxyHandler");function Me(r,e){return new Proxy(r,new ue(e,!1))}function Y(r,e){return new Proxy(r,new ne(new Proxy(r.table,new ue(e,!1))))}function ir(r,e){return new p.Aliased(Re(r.sql,e),r.fieldAlias)}function Re(r,e){return s.join(r.queryChunks.map(t=>u(t,T)?Y(t,e):u(t,p)?Re(t,e):u(t,p.Aliased)?ir(t,e):t))}var Ji,k=class extends C{defaultNow(){return this.default(s`now()`)}};Ji=a,l(k,Ji,"PgDateColumnBaseBuilder");var Hi,nr=class extends k{constructor(e){super(e,"date","PgDate")}build(e){return new he(e,this.config)}};Hi=a,l(nr,Hi,"PgDateBuilder");var ki,he=class extends w{getSQLType(){return"date"}mapFromDriverValue(e){return new Date(e)}mapToDriverValue(e){return e.toISOString()}};ki=a,l(he,ki,"PgDate");var Gi,sr=class extends k{constructor(e){super(e,"string","PgDateString")}build(e){return new ye(e,this.config)}};Gi=a,l(sr,Gi,"PgDateStringBuilder");var Yi,ye=class extends w{getSQLType(){return"date"}};Yi=a,l(ye,Yi,"PgDateString");var Xi,pt=class extends C{constructor(e){super(e,"number","PgInteger")}build(e){return new ht(e,this.config)}};Xi=a,l(pt,Xi,"PgIntegerBuilder");var Zi,ht=class extends w{getSQLType(){return"integer"}mapFromDriverValue(e){return typeof e=="string"?Number.parseInt(e):e}};Zi=a,l(ht,Zi,"PgInteger");function x(r){return new pt(r)}var en,or=class extends C{constructor(e){super(e,"json","PgJson")}build(e){return new ge(e,this.config)}};en=a,l(or,en,"PgJsonBuilder");var tn,ge=class extends w{constructor(e,t){super(e,t)}getSQLType(){return"json"}mapToDriverValue(e){return JSON.stringify(e)}mapFromDriverValue(e){if(typeof e=="string")try{return JSON.parse(e)}catch{return e}return e}};tn=a,l(ge,tn,"PgJson");var rn,ar=class extends C{constructor(e){super(e,"json","PgJsonb")}build(e){return new we(e,this.config)}};rn=a,l(ar,rn,"PgJsonbBuilder");var nn,we=class extends w{constructor(e,t){super(e,t)}getSQLType(){return"jsonb"}mapToDriverValue(e){return JSON.stringify(e)}mapFromDriverValue(e){if(typeof e=="string")try{return JSON.parse(e)}catch{return e}return e}};nn=a,l(we,nn,"PgJsonb");var sn,yt=class extends C{constructor(e,t,i){super(e,"string","PgNumeric"),this.config.precision=t,this.config.scale=i}build(e){return new be(e,this.config)}};sn=a,l(yt,sn,"PgNumericBuilder");var on,be=class extends w{precision;scale;constructor(e,t){super(e,t),this.precision=t.precision,this.scale=t.scale}getSQLType(){return this.precision!==void 0&&this.scale!==void 0?`numeric(${this.precision}, ${this.scale})`:this.precision===void 0?"numeric":`numeric(${this.precision})`}};on=a,l(be,on,"PgNumeric");function lr(r,e){return new yt(r,e?.precision,e?.scale)}var an,gt=class extends C{constructor(e,t){super(e,"number","PgReal"),this.config.length=t}build(e){return new wt(e,this.config)}};an=a,l(gt,an,"PgRealBuilder");var ln,wt=class extends w{constructor(e,t){super(e,t)}getSQLType(){return"real"}mapFromDriverValue=e=>typeof e=="string"?Number.parseFloat(e):e};ln=a,l(wt,ln,"PgReal");function se(r){return new gt(r)}var cn,bt=class extends C{constructor(e,t){super(e,"string","PgText"),this.config.enumValues=t.enum}build(e){return new St(e,this.config)}};cn=a,l(bt,cn,"PgTextBuilder");var un,St=class extends w{enumValues=this.config.enumValues;getSQLType(){return"text"}};un=a,l(St,un,"PgText");function X(r,e={}){return new bt(r,e)}var mn,cr=class extends k{constructor(e,t,i){super(e,"string","PgTime"),this.withTimezone=t,this.precision=i,this.config.withTimezone=t,this.config.precision=i}build(e){return new Se(e,this.config)}};mn=a,l(cr,mn,"PgTimeBuilder");var fn,Se=class extends w{withTimezone;precision;constructor(e,t){super(e,t),this.withTimezone=t.withTimezone,this.precision=t.precision}getSQLType(){return`time${this.precision===void 0?"":`(${this.precision})`}${this.withTimezone?" with time zone":""}`}};fn=a,l(Se,fn,"PgTime");var dn,Nt=class extends k{constructor(e,t,i){super(e,"date","PgTimestamp"),this.config.withTimezone=t,this.config.precision=i}build(e){return new Ne(e,this.config)}};dn=a,l(Nt,dn,"PgTimestampBuilder");var pn,Ne=class extends w{withTimezone;precision;constructor(e,t){super(e,t),this.withTimezone=t.withTimezone,this.precision=t.precision}getSQLType(){return`timestamp${this.precision===void 0?"":` (${this.precision})`}${this.withTimezone?" with time zone":""}`}mapFromDriverValue=e=>new Date(this.withTimezone?e:e+"+0000");mapToDriverValue=e=>e.toISOString()};pn=a,l(Ne,pn,"PgTimestamp");var hn,xt=class extends k{constructor(e,t,i){super(e,"string","PgTimestampString"),this.config.withTimezone=t,this.config.precision=i}build(e){return new xe(e,this.config)}};hn=a,l(xt,hn,"PgTimestampStringBuilder");var yn,xe=class extends w{withTimezone;precision;constructor(e,t){super(e,t),this.withTimezone=t.withTimezone,this.precision=t.precision}getSQLType(){return`timestamp${this.precision===void 0?"":`(${this.precision})`}${this.withTimezone?" with time zone":""}`}};yn=a,l(xe,yn,"PgTimestampString");function F(r,e={}){return e.mode==="string"?new xt(r,e.withTimezone??!1,e.precision):new Nt(r,e.withTimezone??!1,e.precision)}var gn,$t=class extends C{constructor(e){super(e,"string","PgUUID")}defaultRandom(){return this.default(s`gen_random_uuid()`)}build(e){return new $e(e,this.config)}};gn=a,l($t,gn,"PgUUIDBuilder");var wn,$e=class extends w{getSQLType(){return"uuid"}};wn=a,l($e,wn,"PgUUID");function K(r){return new $t(r)}var bn,Tt=class extends C{constructor(e,t){super(e,"string","PgVarchar"),this.config.length=t.length,this.config.enumValues=t.enum}build(e){return new Ct(e,this.config)}};bn=a,l(Tt,bn,"PgVarcharBuilder");var Sn,Ct=class extends w{length=this.config.length;enumValues=this.config.enumValues;getSQLType(){return this.length===void 0?"varchar":`varchar(${this.length})`}};Sn=a,l(Ct,Sn,"PgVarchar");function g(r,e={}){return new Tt(r,e)}var Nn,Ue=class{[(Nn=a,Symbol.toStringTag)]="QueryPromise";catch(e){return this.then(void 0,e)}finally(e){return this.then(t=>(e?.(),t),t=>{throw e?.(),t})}then(e,t){return this.execute().then(e,t)}};l(Ue,Nn,"QueryPromise");function Te(r,e){return Object.entries(r).reduce((t,[i,n])=>{if(typeof i!="string")return t;let o=e?[...e,i]:[i];return u(n,T)||u(n,p)||u(n,p.Aliased)?t.push({path:o,field:n}):u(n,h)?t.push(...Te(n[h.Symbol.Columns],o)):t.push(...Te(n,o)),t},[])}function ur(r,e){let t=Object.keys(r),i=Object.keys(e);if(t.length!==i.length)return!1;for(let[n,o]of t.entries())if(o!==i[n])return!1;return!0}function Qr(r,e){for(let t of e)for(let i of Object.getOwnPropertyNames(t.prototype))i!=="constructor"&&Object.defineProperty(r.prototype,i,Object.getOwnPropertyDescriptor(t.prototype,i)||Object.create(null))}function We(r){return r[h.Symbol.Columns]}function mr(r){return u(r,Q)?r._.alias:u(r,M)?r[v].name:u(r,p)?void 0:r[h.Symbol.IsAlias]?r[h.Symbol.Name]:r[h.Symbol.BaseName]}var xn,Ce=class extends Error{constructor({message:e,cause:t}){super(e),this.name="DrizzleError",this.cause=t}};xn=a,l(Ce,xn,"DrizzleError");var $n,fr=class extends Ce{constructor(){super({message:"Rollback"})}};$n=a,l(fr,$n,"TransactionRollbackError");function U(r,e){return Ar(e)&&!tr(r)&&!u(r,H)&&!u(r,ce)&&!u(r,T)&&!u(r,h)&&!u(r,M)?new H(r,e):r}var oe=(r,e)=>s`${r} = ${U(e,r)}`,Lr=(r,e)=>s`${r} <> ${U(e,r)}`;function ae(...r){let e=r.filter(t=>t!==void 0);if(e.length!==0)return e.length===1?new p(e):new p([new O("("),s.join(e,new O(" and ")),new O(")")])}function zr(...r){let e=r.filter(t=>t!==void 0);if(e.length!==0)return e.length===1?new p(e):new p([new O("("),s.join(e,new O(" or ")),new O(")")])}function Fr(r){return s`not ${r}`}var Kr=(r,e)=>s`${r} > ${U(e,r)}`,Ir=(r,e)=>s`${r} >= ${U(e,r)}`,Br=(r,e)=>s`${r} < ${U(e,r)}`,Vr=(r,e)=>s`${r} <= ${U(e,r)}`;function vt(r,e){if(Array.isArray(e)){if(e.length===0)throw new Error("inArray requires at least one value");return s`${r} in ${e.map(t=>U(t,r))}`}return s`${r} in ${U(e,r)}`}function Mr(r,e){if(Array.isArray(e)){if(e.length===0)throw new Error("notInArray requires at least one value");return s`${r} not in ${e.map(t=>U(t,r))}`}return s`${r} not in ${U(e,r)}`}function Rr(r){return s`${r} is null`}function Ur(r){return s`${r} is not null`}function Wr(r){return s`exists ${r}`}function Jr(r){return s`not exists ${r}`}function Hr(r,e,t){return s`${r} between ${U(e,r)} and ${U(t,r)}`}function kr(r,e,t){return s`${r} not between ${U(e,r)} and ${U(t,r)}`}function Gr(r,e){return s`${r} like ${e}`}function Yr(r,e){return s`${r} not like ${e}`}function Xr(r,e){return s`${r} ilike ${e}`}function Zr(r,e){return s`${r} not ilike ${e}`}function ei(r){return s`${r} asc`}function ti(r){return s`${r} desc`}var Tn,Je=class{constructor(e,t,i){this.sourceTable=e,this.referencedTable=t,this.relationName=i,this.referencedTableName=t[h.Symbol.Name]}referencedTableName;fieldName};Tn=a,l(Je,Tn,"Relation");var Cn,dr=class{constructor(e,t){this.table=e,this.config=t}};Cn=a,l(dr,Cn,"Relations");var vn,pr=class extends Je{constructor(e,t,i,n){super(e,t,i?.relationName),this.config=i,this.isNullable=n}withFieldName(e){let t=new pr(this.sourceTable,this.referencedTable,this.config,this.isNullable);return t.fieldName=e,t}},me=pr;vn=a,l(me,vn,"One");var qn,hr=class extends Je{constructor(e,t,i){super(e,t,i?.relationName),this.config=i}withFieldName(e){let t=new hr(this.sourceTable,this.referencedTable,this.config);return t.fieldName=e,t}},He=hr;qn=a,l(He,qn,"Many");function ri(){return{and:ae,between:Hr,eq:oe,exists:Wr,gt:Kr,gte:Ir,ilike:Xr,inArray:vt,isNull:Rr,isNotNull:Ur,like:Gr,lt:Br,lte:Vr,ne:Lr,not:Fr,notBetween:kr,notExists:Jr,notLike:Yr,notIlike:Zr,notInArray:Mr,or:zr,sql:s}}function ii(){return{sql:s,asc:ei,desc:ti}}function ni(r,e,t){if(u(t,me)&&t.config)return{fields:t.config.fields,references:t.config.references};let i=e[t.referencedTable[h.Symbol.Name]];if(!i)throw new Error(`Table "${t.referencedTable[h.Symbol.Name]}" not found in schema`);let n=r[i];if(!n)throw new Error(`Table "${i}" not found in schema`);let o=t.sourceTable,c=e[o[h.Symbol.Name]];if(!c)throw new Error(`Table "${o[h.Symbol.Name]}" not found in schema`);let f=[];for(let d of Object.values(n.relations))(t.relationName&&t!==d&&d.relationName===t.relationName||!t.relationName&&d.referencedTable===t.sourceTable)&&f.push(d);if(f.length>1)throw t.relationName?new Error(`There are multiple relations with name "${t.relationName}" in table "${i}"`):new Error(`There are multiple relations between "${i}" and "${t.sourceTable[h.Symbol.Name]}". Please specify relation name`);if(f[0]&&u(f[0],me)&&f[0].config)return{fields:f[0].config.references,references:f[0].config.fields};throw new Error(`There is not enough information to infer relation "${c}.${t.fieldName}"`)}var _n,Z=class extends M{};_n=a,l(Z,_n,"PgViewBase");var On,ke=class{async migrate(e,t,i){let n=typeof i=="string"?"__drizzle_migrations":i.migrationsTable??"__drizzle_migrations",o=typeof i=="string"?"drizzle":i.migrationsSchema??"drizzle",c=s`
			CREATE TABLE IF NOT EXISTS ${s.identifier(o)}.${s.identifier(n)} (
				id SERIAL PRIMARY KEY,
				hash text NOT NULL,
				created_at bigint
			)
		`;await t.execute(s`CREATE SCHEMA IF NOT EXISTS ${s.identifier(o)}`),await t.execute(c);let d=(await t.all(s`select id, hash, created_at from ${s.identifier(o)}.${s.identifier(n)} order by created_at desc limit 1`))[0];await t.transaction(async m=>{for await(let y of e)if(!d||Number(d.created_at)<y.folderMillis){for(let b of y.sql)await m.execute(s.raw(b));await m.execute(s`insert into ${s.identifier(o)}.${s.identifier(n)} ("hash", "created_at") values(${y.hash}, ${y.folderMillis})`)}})}escapeName(e){return`"${e}"`}escapeParam(e){return`$${e+1}`}escapeString(e){return`'${e.replace(/'/g,"''")}'`}buildWithCTE(e){if(!e?.length)return;let t=[s`with `];for(let[i,n]of e.entries())t.push(s`${s.identifier(n._.alias)} as (${n._.sql})`),i<e.length-1&&t.push(s`, `);return t.push(s` `),s.join(t)}buildDeleteQuery({table:e,where:t,returning:i,withList:n}){let o=this.buildWithCTE(n),c=i?s` returning ${this.buildSelection(i,{isSingleTable:!0})}`:void 0,f=t?s` where ${t}`:void 0;return s`${o}delete from ${e}${f}${c}`}buildUpdateSet(e,t){let i=e[h.Symbol.Columns],n=Object.keys(i).filter(c=>t[c]!==void 0||i[c]?.onUpdateFn!==void 0),o=n.length;return s.join(n.flatMap((c,f)=>{let d=i[c],m=t[c]??s.param(d.onUpdateFn(),d),y=s`${s.identifier(d.name)} = ${m}`;return f<o-1?[y,s.raw(", ")]:[y]}))}buildUpdateQuery({table:e,set:t,where:i,returning:n,withList:o}){let c=this.buildWithCTE(o),f=this.buildUpdateSet(e,t),d=n?s` returning ${this.buildSelection(n,{isSingleTable:!0})}`:void 0,m=i?s` where ${i}`:void 0;return s`${c}update ${e} set ${f}${m}${d}`}buildSelection(e,{isSingleTable:t=!1}={}){let i=e.length,n=e.flatMap(({field:o},c)=>{let f=[];if(u(o,p.Aliased)&&o.isSelectionField)f.push(s.identifier(o.fieldAlias));else if(u(o,p.Aliased)||u(o,p)){let d=u(o,p.Aliased)?o.sql:o;t?f.push(new p(d.queryChunks.map(m=>u(m,w)?s.identifier(m.name):m))):f.push(d),u(o,p.Aliased)&&f.push(s` as ${s.identifier(o.fieldAlias)}`)}else u(o,T)&&(t?f.push(s.identifier(o.name)):f.push(o));return c<i-1&&f.push(s`, `),f});return s.join(n)}buildSelectQuery({withList:e,fields:t,fieldsFlat:i,where:n,having:o,table:c,joins:f,orderBy:d,groupBy:m,limit:y,offset:b,lockingClause:N,distinct:V,setOperators:A}){let I=i??Te(t);for(let _ of I)if(u(_.field,T)&&fe(_.field.table)!==(u(c,Q)?c._.alias:u(c,Z)?c[v].name:u(c,p)?void 0:fe(c))&&!(D=>f?.some(({alias:W})=>W===(D[h.Symbol.IsAlias]?fe(D):D[h.Symbol.BaseName])))(_.field.table)){let D=fe(_.field.table);throw new Error(`Your "${_.path.join("->")}" field references a column "${D}"."${_.field.name}", but the table "${D}" is not part of the query! Did you forget to join it?`)}let q=!f||f.length===0,j=this.buildWithCTE(e),L;V&&(L=V===!0?s` distinct`:s` distinct on (${s.join(V.on,s`, `)})`);let z=this.buildSelection(I,{isSingleTable:q}),P=(()=>{if(u(c,h)&&c[h.Symbol.OriginalName]!==c[h.Symbol.Name]){let _=s`${s.identifier(c[h.Symbol.OriginalName])}`;return c[h.Symbol.Schema]&&(_=s`${s.identifier(c[h.Symbol.Schema])}.${_}`),s`${_} ${s.identifier(c[h.Symbol.Name])}`}return c})(),R=[];if(f)for(let[_,D]of f.entries()){_===0&&R.push(s` `);let W=D.table,Qe=D.lateral?s` lateral`:void 0;if(u(W,B)){let It=W[B.Symbol.Name],Le=W[B.Symbol.Schema],ze=W[B.Symbol.OriginalName],Fe=It===ze?void 0:D.alias;R.push(s`${s.raw(D.joinType)} join${Qe} ${Le?s`${s.identifier(Le)}.`:void 0}${s.identifier(ze)}${Fe&&s` ${s.identifier(Fe)}`} on ${D.on}`)}else if(u(W,M)){let It=W[v].name,Le=W[v].schema,ze=W[v].originalName,Fe=It===ze?void 0:D.alias;R.push(s`${s.raw(D.joinType)} join${Qe} ${Le?s`${s.identifier(Le)}.`:void 0}${s.identifier(ze)}${Fe&&s` ${s.identifier(Fe)}`} on ${D.on}`)}else R.push(s`${s.raw(D.joinType)} join${Qe} ${W} on ${D.on}`);_<f.length-1&&R.push(s` `)}let re=s.join(R),S=n?s` where ${n}`:void 0,$=o?s` having ${o}`:void 0,G;d&&d.length>0&&(G=s` order by ${s.join(d,s`, `)}`);let je;m&&m.length>0&&(je=s` group by ${s.join(m,s`, `)}`);let Kt=y?s` limit ${y}`:void 0,De=b?s` offset ${b}`:void 0,ie=s.empty();if(N){let _=s` for ${s.raw(N.strength)}`;N.config.of&&_.append(s` of ${s.join(Array.isArray(N.config.of)?N.config.of:[N.config.of],s`, `)}`),N.config.noWait?_.append(s` no wait`):N.config.skipLocked&&_.append(s` skip locked`),ie.append(_)}let tt=s`${j}select${L} ${z} from ${P}${re}${S}${je}${$}${G}${Kt}${De}${ie}`;return A.length>0?this.buildSetOperations(tt,A):tt}buildSetOperations(e,t){let[i,...n]=t;if(!i)throw new Error("Cannot pass undefined values to any set operator");return n.length===0?this.buildSetOperationQuery({leftSelect:e,setOperator:i}):this.buildSetOperations(this.buildSetOperationQuery({leftSelect:e,setOperator:i}),n)}buildSetOperationQuery({leftSelect:e,setOperator:{type:t,isAll:i,rightSelect:n,limit:o,orderBy:c,offset:f}}){let d=s`(${e.getSQL()}) `,m=s`(${n.getSQL()})`,y;if(c&&c.length>0){let A=[];for(let I of c)if(u(I,w))A.push(s.identifier(I.name));else if(u(I,p)){for(let q=0;q<I.queryChunks.length;q++){let j=I.queryChunks[q];u(j,w)&&(I.queryChunks[q]=s.identifier(j.name))}A.push(s`${I}`)}else A.push(s`${I}`);y=s` order by ${s.join(A,s`, `)} `}let b=o?s` limit ${o}`:void 0,N=s.raw(`${t} ${i?"all ":""}`),V=f?s` offset ${f}`:void 0;return s`${d}${N}${m}${y}${b}${V}`}buildInsertQuery({table:e,values:t,onConflict:i,returning:n,withList:o}){let c=[],f=e[h.Symbol.Columns],d=Object.entries(f),m=d.map(([,A])=>s.identifier(A.name));for(let[A,I]of t.entries()){let q=[];for(let[j,L]of d){let z=I[j];if(z===void 0||u(z,H)&&z.value===void 0)if(L.defaultFn!==void 0){let P=L.defaultFn(),R=u(P,p)?P:s.param(P,L);q.push(R)}else if(!L.default&&L.onUpdateFn!==void 0){let P=L.onUpdateFn(),R=u(P,p)?P:s.param(P,L);q.push(R)}else q.push(s`default`);else q.push(z)}c.push(q),A<t.length-1&&c.push(s`, `)}let y=this.buildWithCTE(o),b=s.join(c),N=n?s` returning ${this.buildSelection(n,{isSingleTable:!0})}`:void 0,V=i?s` on conflict ${i}`:void 0;return s`${y}insert into ${e} ${m} values ${b}${V}${N}`}buildRefreshMaterializedViewQuery({view:e,concurrently:t,withNoData:i}){let n=t?s` concurrently`:void 0,o=i?s` with no data`:void 0;return s`refresh materialized view${n} ${e}${o}`}prepareTyping(e){return u(e,we)||u(e,ge)?"json":u(e,be)?"decimal":u(e,Se)?"time":u(e,Ne)||u(e,xe)?"timestamp":u(e,he)||u(e,ye)?"date":u(e,$e)?"uuid":"none"}sqlToQuery(e,t){return e.toQuery({escapeName:this.escapeName,escapeParam:this.escapeParam,escapeString:this.escapeString,prepareTyping:this.prepareTyping,invokeSource:t})}buildRelationalQueryWithoutPK({fullSchema:e,schema:t,tableNamesMap:i,table:n,tableConfig:o,queryConfig:c,tableAlias:f,nestedQueryRelation:d,joinOn:m}){let y=[],b,N,V=[],A,I=[];if(c===!0)y=Object.entries(o.columns).map(([L,z])=>({dbKey:z.name,tsKey:L,field:Y(z,f),relationTableTsKey:void 0,isJson:!1,selection:[]}));else{let j=Object.fromEntries(Object.entries(o.columns).map(([S,$])=>[S,Y($,f)]));if(c.where){let S=typeof c.where=="function"?c.where(j,ri()):c.where;A=S&&Re(S,f)}let L=[],z=[];if(c.columns){let S=!1;for(let[$,G]of Object.entries(c.columns))G!==void 0&&$ in o.columns&&(!S&&G===!0&&(S=!0),z.push($));z.length>0&&(z=S?z.filter($=>c.columns?.[$]===!0):Object.keys(o.columns).filter($=>!z.includes($)))}else z=Object.keys(o.columns);for(let S of z){let $=o.columns[S];L.push({tsKey:S,value:$})}let P=[];c.with&&(P=Object.entries(c.with).filter(S=>!!S[1]).map(([S,$])=>({tsKey:S,queryConfig:$,relation:o.relations[S]})));let R;if(c.extras){R=typeof c.extras=="function"?c.extras(j,{sql:s}):c.extras;for(let[S,$]of Object.entries(R))L.push({tsKey:S,value:ir($,f)})}for(let{tsKey:S,value:$}of L)y.push({dbKey:u($,p.Aliased)?$.fieldAlias:o.columns[S].name,tsKey:S,field:u($,T)?Y($,f):$,relationTableTsKey:void 0,isJson:!1,selection:[]});let re=typeof c.orderBy=="function"?c.orderBy(j,ii()):c.orderBy??[];Array.isArray(re)||(re=[re]),V=re.map(S=>u(S,T)?Y(S,f):Re(S,f)),b=c.limit,N=c.offset;for(let{tsKey:S,queryConfig:$,relation:G}of P){let je=ni(t,i,G),Kt=G.referencedTable[h.Symbol.Name],De=i[Kt],ie=`${f}_${S}`,tt=ae(...je.fields.map((W,Qe)=>oe(Y(je.references[Qe],ie),Y(W,f)))),_=this.buildRelationalQueryWithoutPK({fullSchema:e,schema:t,tableNamesMap:i,table:e[De],tableConfig:t[De],queryConfig:u(G,me)?$===!0?{limit:1}:{...$,limit:1}:$,tableAlias:ie,joinOn:tt,nestedQueryRelation:G}),D=s`${s.identifier(ie)}.${s.identifier("data")}`.as(S);I.push({on:s`true`,table:new Q(_.sql,{},ie),alias:ie,joinType:"left",lateral:!0}),y.push({dbKey:S,tsKey:S,field:D,relationTableTsKey:De,isJson:!0,selection:_.selection})}}if(y.length===0)throw new Ce({message:`No fields selected for table "${o.tsName}" ("${f}")`});let q;if(A=ae(m,A),d){let j=s`json_build_array(${s.join(y.map(({field:P,tsKey:R,isJson:re})=>re?s`${s.identifier(`${f}_${R}`)}.${s.identifier("data")}`:u(P,p.Aliased)?P.sql:P),s`, `)})`;u(d,He)&&(j=s`coalesce(json_agg(${j}${V.length>0?s` order by ${s.join(V,s`, `)}`:void 0}), '[]'::json)`);let L=[{dbKey:"data",tsKey:"data",field:j.as("data"),isJson:!0,relationTableTsKey:o.tsName,selection:y}];b!==void 0||N!==void 0||V.length>0?(q=this.buildSelectQuery({table:Me(n,f),fields:{},fieldsFlat:[{path:[],field:s.raw("*")}],where:A,limit:b,offset:N,orderBy:V,setOperators:[]}),A=void 0,b=void 0,N=void 0,V=[]):q=Me(n,f),q=this.buildSelectQuery({table:u(q,B)?q:new Q(q,{},f),fields:{},fieldsFlat:L.map(({field:P})=>({path:[],field:u(P,T)?Y(P,f):P})),joins:I,where:A,limit:b,offset:N,orderBy:V,setOperators:[]})}else q=this.buildSelectQuery({table:Me(n,f),fields:{},fieldsFlat:y.map(({field:j})=>({path:[],field:u(j,T)?Y(j,f):j})),joins:I,where:A,limit:b,offset:N,orderBy:V,setOperators:[]});return{tableTsKey:o.tsName,sql:q,selection:y}}};On=a,l(ke,On,"PgDialect");var Pn,yr=class{config;constructor(e){this.config={...e}}get(e,t){if(t==="_")return{...e._,selectedFields:new Proxy(e._.selectedFields,this)};if(t===v)return{...e[v],selectedFields:new Proxy(e[v].selectedFields,this)};if(typeof t=="symbol")return e[t];let n=(u(e,Q)?e._.selectedFields:u(e,M)?e[v].selectedFields:e)[t];if(u(n,p.Aliased)){if(this.config.sqlAliasedBehavior==="sql"&&!n.isSelectionField)return n.sql;let o=n.clone();return o.isSelectionField=!0,o}if(u(n,p)){if(this.config.sqlBehavior==="sql")return n;throw new Error(`You tried to reference "${t}" field from a subquery, which is a raw SQL field, but it doesn't have an alias declared. Please add an alias to the field using ".as('alias')" method.`)}return u(n,T)?this.config.alias?new Proxy(n,new ne(new Proxy(n.table,new ue(this.config.alias,this.config.replaceOriginalName??!1)))):n:typeof n!="object"||n===null?n:new Proxy(n,new yr(this.config))}},E=yr;Pn=a,l(E,Pn,"SelectionProxyHandler");var En,Ge=class{getSelectedFields(){return this._.selectedFields}};En=a,l(Ge,En,"TypedQueryBuilder");var Kn,ee=class{fields;session;dialect;withList=[];distinct;constructor(e){this.fields=e.fields,this.session=e.session,this.dialect=e.dialect,e.withList&&(this.withList=e.withList),this.distinct=e.distinct}from(e){let t=!!this.fields,i;return this.fields?i=this.fields:u(e,Q)?i=Object.fromEntries(Object.keys(e._.selectedFields).map(n=>[n,e[n]])):u(e,Z)?i=e[v].selectedFields:u(e,p)?i={}:i=We(e),new Ye({table:e,fields:i,isPartialSelect:t,session:this.session,dialect:this.dialect,withList:this.withList,distinct:this.distinct})}};Kn=a,l(ee,Kn,"PgSelectBuilder");var In,qt=class extends Ge{_;config;joinsNotNullableMap;tableName;isPartialSelect;session;dialect;constructor({table:e,fields:t,isPartialSelect:i,session:n,dialect:o,withList:c,distinct:f}){super(),this.config={withList:c,table:e,fields:{...t},distinct:f,setOperators:[]},this.isPartialSelect=i,this.session=n,this.dialect=o,this._={selectedFields:t},this.tableName=mr(e),this.joinsNotNullableMap=typeof this.tableName=="string"?{[this.tableName]:!0}:{}}createJoin(e){return(t,i)=>{let n=this.tableName,o=mr(t);if(typeof o=="string"&&this.config.joins?.some(c=>c.alias===o))throw new Error(`Alias "${o}" is already used in this query`);if(!this.isPartialSelect&&(Object.keys(this.joinsNotNullableMap).length===1&&typeof n=="string"&&(this.config.fields={[n]:this.config.fields}),typeof o=="string"&&!u(t,p))){let c=u(t,Q)?t._.selectedFields:u(t,M)?t[v].selectedFields:t[h.Symbol.Columns];this.config.fields[o]=c}if(typeof i=="function"&&(i=i(new Proxy(this.config.fields,new E({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))),this.config.joins||(this.config.joins=[]),this.config.joins.push({on:i,table:t,joinType:e,alias:o}),typeof o=="string")switch(e){case"left":{this.joinsNotNullableMap[o]=!1;break}case"right":{this.joinsNotNullableMap=Object.fromEntries(Object.entries(this.joinsNotNullableMap).map(([c])=>[c,!1])),this.joinsNotNullableMap[o]=!0;break}case"inner":{this.joinsNotNullableMap[o]=!0;break}case"full":{this.joinsNotNullableMap=Object.fromEntries(Object.entries(this.joinsNotNullableMap).map(([c])=>[c,!1])),this.joinsNotNullableMap[o]=!1;break}}return this}}leftJoin=this.createJoin("left");rightJoin=this.createJoin("right");innerJoin=this.createJoin("inner");fullJoin=this.createJoin("full");createSetOperator(e,t){return i=>{let n=typeof i=="function"?i(An()):i;if(!ur(this.getSelectedFields(),n.getSelectedFields()))throw new Error("Set operator error (union / intersect / except): selected fields are not the same or are in a different order");return this.config.setOperators.push({type:e,isAll:t,rightSelect:n}),this}}union=this.createSetOperator("union",!1);unionAll=this.createSetOperator("union",!0);intersect=this.createSetOperator("intersect",!1);intersectAll=this.createSetOperator("intersect",!0);except=this.createSetOperator("except",!1);exceptAll=this.createSetOperator("except",!0);addSetOperators(e){return this.config.setOperators.push(...e),this}where(e){return typeof e=="function"&&(e=e(new Proxy(this.config.fields,new E({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))),this.config.where=e,this}having(e){return typeof e=="function"&&(e=e(new Proxy(this.config.fields,new E({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))),this.config.having=e,this}groupBy(...e){if(typeof e[0]=="function"){let t=e[0](new Proxy(this.config.fields,new E({sqlAliasedBehavior:"alias",sqlBehavior:"sql"})));this.config.groupBy=Array.isArray(t)?t:[t]}else this.config.groupBy=e;return this}orderBy(...e){if(typeof e[0]=="function"){let t=e[0](new Proxy(this.config.fields,new E({sqlAliasedBehavior:"alias",sqlBehavior:"sql"}))),i=Array.isArray(t)?t:[t];this.config.setOperators.length>0?this.config.setOperators.at(-1).orderBy=i:this.config.orderBy=i}else{let t=e;this.config.setOperators.length>0?this.config.setOperators.at(-1).orderBy=t:this.config.orderBy=t}return this}limit(e){return this.config.setOperators.length>0?this.config.setOperators.at(-1).limit=e:this.config.limit=e,this}offset(e){return this.config.setOperators.length>0?this.config.setOperators.at(-1).offset=e:this.config.offset=e,this}for(e,t={}){return this.config.lockingClause={strength:e,config:t},this}getSQL(){return this.dialect.buildSelectQuery(this.config)}toSQL(){let{typings:e,...t}=this.dialect.sqlToQuery(this.getSQL());return t}as(e){return new Proxy(new Q(this.getSQL(),this.config.fields,e),new E({alias:e,sqlAliasedBehavior:"alias",sqlBehavior:"error"}))}getSelectedFields(){return new Proxy(this.config.fields,new E({alias:this.tableName,sqlAliasedBehavior:"alias",sqlBehavior:"error"}))}$dynamic(){return this}};In=a,l(qt,In,"PgSelectQueryBuilder");var Bn,Ye=class extends qt{_prepare(e){let{session:t,config:i,dialect:n,joinsNotNullableMap:o}=this;if(!t)throw new Error("Cannot execute a query on a query builder. Please use a database instance instead.");return Ve.startActiveSpan("drizzle.prepareQuery",()=>{let c=Te(i.fields),f=t.prepareQuery(n.sqlToQuery(this.getSQL()),c,e,!0);return f.joinsNotNullableMap=o,f})}prepare(e){return this._prepare(e)}execute=e=>Ve.startActiveSpan("drizzle.operation",()=>this._prepare().execute(e))};Bn=a,l(Ye,Bn,"PgSelect");Qr(Ye,[Ue]);function ve(r,e){return(t,i,...n)=>{let o=[i,...n].map(c=>({type:r,isAll:e,rightSelect:c}));for(let c of o)if(!ur(t.getSelectedFields(),c.rightSelect.getSelectedFields()))throw new Error("Set operator error (union / intersect / except): selected fields are not the same or are in a different order");return t.addSetOperators(o)}}var An=()=>({union:jn,unionAll:Dn,intersect:Qn,intersectAll:Ln,except:zn,exceptAll:Fn}),jn=ve("union",!1),Dn=ve("union",!0),Qn=ve("intersect",!1),Ln=ve("intersect",!0),zn=ve("except",!1),Fn=ve("except",!0);var Vn,qe=class{dialect;$with(e){let t=this;return{as(i){return typeof i=="function"&&(i=i(t)),new Proxy(new Be(i.getSQL(),i.getSelectedFields(),e,!0),new E({alias:e,sqlAliasedBehavior:"alias",sqlBehavior:"error"}))}}}with(...e){let t=this;function i(c){return new ee({fields:c??void 0,session:void 0,dialect:t.getDialect(),withList:e})}function n(c){return new ee({fields:c??void 0,session:void 0,dialect:t.getDialect(),distinct:!0})}function o(c,f){return new ee({fields:f??void 0,session:void 0,dialect:t.getDialect(),distinct:{on:c}})}return{select:i,selectDistinct:n,selectDistinctOn:o}}select(e){return new ee({fields:e??void 0,session:void 0,dialect:this.getDialect()})}selectDistinct(e){return new ee({fields:e??void 0,session:void 0,dialect:this.getDialect(),distinct:!0})}selectDistinctOn(e,t){return new ee({fields:t??void 0,session:void 0,dialect:this.getDialect(),distinct:{on:e}})}getDialect(){return this.dialect||(this.dialect=new ke),this.dialect}};Vn=a,l(qe,Vn,"PgQueryBuilder");var Mn,_t=class{constructor(e,t){this.unique=e,this.name=t}on(...e){return new _e(e.map(t=>{if(u(t,p))return t;t=t;let i=new le(t.name,t.columnType,t.indexConfig);return t.indexConfig=JSON.parse(JSON.stringify(t.defaultConfig)),i}),this.unique,!1,this.name)}onOnly(...e){return new _e(e.map(t=>{if(u(t,p))return t;t=t;let i=new le(t.name,t.columnType,t.indexConfig);return t.indexConfig=t.defaultConfig,i}),this.unique,!0,this.name)}using(e,...t){return new _e(t.map(i=>{if(u(i,p))return i;i=i;let n=new le(i.name,i.columnType,i.indexConfig);return i.indexConfig=JSON.parse(JSON.stringify(i.defaultConfig)),n}),this.unique,!0,this.name,e)}};Mn=a,l(_t,Mn,"PgIndexBuilderOn");var Rn,_e=class{config;constructor(e,t,i,n,o="btree"){this.config={name:n,columns:e,unique:t,only:i,method:o}}concurrently(){return this.config.concurrently=!0,this}with(e){return this.config.with=e,this}where(e){return this.config.where=e,this}build(e){return new Ot(this.config,e)}};Rn=a,l(_e,Rn,"PgIndexBuilder");var Un,Ot=class{config;constructor(e,t){this.config={...e,table:t}}};Un=a,l(Ot,Un,"PgIndex");function te(r){return new _t(!1,r)}var gr=Symbol.for("drizzle:PgViewConfig");var Wn,Xe=class{constructor(e,t){this.name=e,this.schema=t}config={};with(e){return this.config.with=e,this}};Wn=a,l(Xe,Wn,"PgDefaultViewBuilderCore");var Jn,Pt=class extends Xe{as(e){typeof e=="function"&&(e=e(new qe));let t=new E({alias:this.name,sqlBehavior:"error",sqlAliasedBehavior:"alias",replaceOriginalName:!0}),i=new Proxy(e.getSelectedFields(),t);return new Proxy(new Oe({pgConfig:this.config,config:{name:this.name,schema:this.schema,selectedFields:i,query:e.getSQL().inlineParams()}}),t)}};Jn=a,l(Pt,Jn,"PgViewBuilder");var Hn,Et=class extends Xe{columns;constructor(e,t,i){super(e,i),this.columns=We(Wt(e,t))}existing(){return new Proxy(new Oe({pgConfig:void 0,config:{name:this.name,schema:this.schema,selectedFields:this.columns,query:void 0}}),new E({alias:this.name,sqlBehavior:"error",sqlAliasedBehavior:"alias",replaceOriginalName:!0}))}as(e){return new Proxy(new Oe({pgConfig:this.config,config:{name:this.name,schema:this.schema,selectedFields:this.columns,query:e.inlineParams()}}),new E({alias:this.name,sqlBehavior:"error",sqlAliasedBehavior:"alias",replaceOriginalName:!0}))}};Hn=a,l(Et,Hn,"PgManualViewBuilder");var kn,Ze=class{constructor(e,t){this.name=e,this.schema=t}config={};using(e){return this.config.using=e,this}with(e){return this.config.with=e,this}tablespace(e){return this.config.tablespace=e,this}withNoData(){return this.config.withNoData=!0,this}};kn=a,l(Ze,kn,"PgMaterializedViewBuilderCore");var Gn,At=class extends Ze{as(e){typeof e=="function"&&(e=e(new qe));let t=new E({alias:this.name,sqlBehavior:"error",sqlAliasedBehavior:"alias",replaceOriginalName:!0}),i=new Proxy(e.getSelectedFields(),t);return new Proxy(new Pe({pgConfig:{with:this.config.with,using:this.config.using,tablespace:this.config.tablespace,withNoData:this.config.withNoData},config:{name:this.name,schema:this.schema,selectedFields:i,query:e.getSQL().inlineParams()}}),t)}};Gn=a,l(At,Gn,"PgMaterializedViewBuilder");var Yn,jt=class extends Ze{columns;constructor(e,t,i){super(e,i),this.columns=We(Wt(e,t))}existing(){return new Proxy(new Pe({pgConfig:void 0,config:{name:this.name,schema:this.schema,selectedFields:this.columns,query:void 0}}),new E({alias:this.name,sqlBehavior:"error",sqlAliasedBehavior:"alias",replaceOriginalName:!0}))}as(e){return new Proxy(new Pe({pgConfig:void 0,config:{name:this.name,schema:this.schema,selectedFields:this.columns,query:e.inlineParams()}}),new E({alias:this.name,sqlBehavior:"error",sqlAliasedBehavior:"alias",replaceOriginalName:!0}))}};Yn=a,l(jt,Yn,"PgManualMaterializedViewBuilder");var Xn,Oe=class extends Z{[(Xn=a,gr)];constructor({pgConfig:e,config:t}){super(t),e&&(this[gr]={with:e.with})}};l(Oe,Xn,"PgView");var si=Symbol.for("drizzle:PgMaterializedViewConfig"),Zn,Pe=class extends Z{[(Zn=a,si)];constructor({pgConfig:e,config:t}){super(t),this[si]={with:e?.with,using:e?.using,tablespace:e?.tablespace,withNoData:e?.withNoData}}};l(Pe,Zn,"PgMaterializedView");function oi(r,e,t){return e?new Et(r,e,t):new Pt(r,t)}function ai(r,e,t){return e?new jt(r,e,t):new At(r,t)}var es,Dt=class{constructor(e){this.schemaName=e}table=(e,t,i)=>Ut(e,t,i,this.schemaName);view=(e,t)=>oi(e,t,this.schemaName);materializedView=(e,t)=>ai(e,t,this.schemaName);enum=(e,t)=>Pr(e,t,this.schemaName)};es=a,l(Dt,es,"PgSchema");function J(r){if(r==="public")throw new Error("You can't specify 'public' as schema name. Postgres is using public schema by default. If you want to use 'public' schema, just use pgTable() instead of creating a schema");return new Dt(r)}var Ee=J(process.env.SCHEMA_POSTGRES||"").table("post_estate",{id:K("id").default(s`gen_random_uuid()`).primaryKey(),title:g("title",{length:255}).notNull(),slug:g("slug",{length:255}).notNull(),code:g("code",{length:255}).notNull(),address:g("title",{length:255}),street:g("street",{length:255}),lat:se("lat").default(0),lang:se("lang").default(0),type:x("type").notNull().default(0),youtubeUrl:X("youtube_url"),point:se("point").notNull(),provinceCode:x("province_code").notNull(),districtCode:x("district_code").notNull(),wardCode:x("ward_code").notNull(),customerId:K("customer_id").notNull(),noteVerified:X("note_verified"),isBlock:x("is_block").notNull().default(0),isDelete:x("is_delete").notNull().default(0),isOwner:x("is_owner").notNull().default(0),createdBy:g("created_by",{length:255}),createdAt:F("created_at").notNull().default(s`now()`),modifyBy:g("modify_by",{length:255}),modifyAt:F("modify_at").notNull().default(s`now()`).$onUpdate(()=>new Date)},r=>({idxPostEstateNameSlugId:te("post_estate_name_slug_id_idx").on(r.title,r.slug,r.id)}));var mc=J(process.env.SCHEMA_POSTGRES||"").table("images",{id:K("id").default(s`gen_random_uuid()`).primaryKey(),link:g("link",{length:255}).notNull(),type:x("type").notNull().default(0),position:x("position").default(0),isAvatar:x("is_avatar").notNull().default(0),description:g("description",{length:255}),isUsed:x("is_used").default(0),postEstateId:K("post_estate_id").references(()=>Ee.id,{onDelete:"cascade",onUpdate:"cascade"}),isConfirmUpdate:x("is_confirm_update").notNull().default(0),createdBy:g("created_by",{length:255}),createdAt:F("created_at").notNull().default(s`now()`),modifyBy:g("modify_by",{length:255}),modifyAt:F("modify_at").notNull().default(s`now()`).$onUpdate(()=>new Date)},r=>({idxNameId:te("image_link_id_idx").on(r.link,r.id)}));var Qt=J("bds_products").table("common_land",{id:K("id").default(s`gen_random_uuid()`).primaryKey(),name:g("name",{length:255}).notNull(),code:g("code",{length:255}).notNull(),slug:g("slug",{length:255}).notNull(),content:X("content"),provinceCode:x("province_code").notNull(),districtCode:x("district_code").notNull(),wardCode:x("ward_code").notNull(),status:x("status").default(1),createdBy:g("created_by",{length:255}),createdAt:F("created_at").notNull().default(s`now()`),modifyBy:g("modify_by",{length:255}),modifyAt:F("modify_at").notNull().default(s`now()`).$onUpdate(()=>new Date)},r=>({idxCommonLandNameSlugId:te("common_land_name_slug_id_idx").on(r.name,r.slug,r.id)}));var bc=J(process.env.SCHEMA_POSTGRES||"").table("post_estate_detail",{id:K("id").default(s`gen_random_uuid()`).primaryKey(),postEstateId:K("post_estate_id").references(()=>Ee.id,{onDelete:"cascade"}),content:X("content"),acreage:se("acreage"),facade:se("facade"),numWayIn:se("num_way_in"),price:lr("price"),unit:x("unit").notNull().default(0),priceSquareMetre:lr("price_square_metre"),directionHouse:g("direction_house",{length:100}),directionBalcony:g("direction_balcony",{length:100}),numBedroom:x("num_bedroom"),numRoadHouse:x("num_road_House"),numFloors:x("num_floors"),numBathroom:x("num_bathroom"),furniture:g("furniture",{length:255}),houseOwningDocument:X("house_owning_document"),contactName:g("contact_name",{length:255}),contactPhone:g("contact_phone",{length:255}),contactMail:g("contact_mail",{length:100}),createdBy:g("created_by",{length:255}),createdAt:F("created_at").notNull().default(s`now()`),modifyBy:g("modify_by",{length:255}),modifyAt:F("modify_at").notNull().default(s`now()`).$onUpdate(()=>new Date)},r=>({}));var $c=J(process.env.SCHEMA_POSTGRES||"").table("post_estate_report",{id:K("id").default(s`gen_random_uuid()`).primaryKey(),description:g("description",{length:255}).notNull(),postEstateId:K("post_estate_id").notNull(),customerId:K("customer_id"),contactName:g("contact_name",{length:50}),contactPhone:g("contact_phone",{length:20}),contactMail:g("contact_mail",{length:50}),isConfirmed:x("is_confirmed").notNull().default(0),createdBy:g("created_by",{length:255}),createdAt:F("created_at").notNull().default(s`now()`),modifyBy:g("modify_by",{length:255}),modifyAt:F("modify_at").notNull().default(s`now()`).$onUpdate(()=>new Date)},r=>({idxPostEstateReportNameId:te("post_estate_report_name_id_idx").on(r.contactName,r.id)}));var Oc=J(process.env.SCHEMA_POSTGRES||"").table("post_estate_history",{id:K("id").default(s`gen_random_uuid()`).primaryKey(),postEstateId:K("post_estate_id").notNull().references(()=>Ee.id,{onDelete:"cascade",onUpdate:"cascade"}),note:X("node"),createdBy:g("created_by",{length:255}),createdAt:F("created_at").notNull().default(s`now()`),modifyBy:g("modify_by",{length:255}),modifyAt:F("modify_at").notNull().default(s`now()`).$onUpdate(()=>new Date)},r=>({idxPostEstateHistoryId:te("post_estate_history_id_idx").on(r.postEstateId,r.id)}));var Lt=class{constructor(e){this.db=e}transformArrayToObject(e){return Array.isArray(e)?e?.[0]??null:e||null}async insert(e,t){let i=await this.db.insert(e).values({...t}).returning();return this.transformArrayToObject(i)}async insertMany(e,t){return await this.db.insert(e).values([...t]).returning(),!0}async update(e,t){let i=await this.db.update(e).set({...t}).returning();return this.transformArrayToObject(i)}async updateMany(e,t){for(let i of t)await this.update(e,i);return!0}async deleteById(e,t){let n=Array.isArray(t)?vt(e.id,t):oe(e.id,t);return await this.db.delete(e).where(n),!0}async deleteByKey(e,t){let i=[];for(let n in t)t[n]!==void 0&&t[n]!==null&&i.push(oe(e[n],t[n]));return await this.db.delete(e).where(ae(s.join(i))),!0}async findByKey(e,t){let i=[];for(let o in t)t[o]!==void 0&&t[o]!==null&&i.push(oe(e[o],t[o]));let n=await this.db.select().from(e).where(ae(s.join(i))).limit(1);return this.transformArrayToObject(n)}async pagination(e,t,i){let n=e.as("sub"),c=await this.db.select({total:s`count(*)`}).from(n).execute(),f=Number(c[0].total),d=Math.ceil(f/i),m=(t-1)*i;return e.limit(i).offset(m),{data:await e.execute(),pagination:{totalRecords:f,totalPages:d,currentPage:t,limit:i}}}};var li=Object.freeze({BAD_REQUEST:"Bad request",SUCCESS:"Success",SERVER_INTERNAL:"Server internal",NOT_FOUND:"Server not found",ACCESS_DENIED:"Access denied"});var Ae=class extends Error{constructor(e){super(li.BAD_REQUEST),this.stack=e,Object.setPrototypeOf(this,Ae.prototype)}};var zt=class extends Lt{constructor(t){super(t.db);this.app=t}async create(t){try{let i=it.convertStringToSlug({text:t.name}),n=await this.validate(t.name,t.code);if(n.length>0)throw new Ae(n);let c={code:t.code,name:t.name,provinceCode:t.provinceCode,districtCode:t.districtCode,wardCode:t.wardCode,slug:i};return await this.insert(Qt,c)}catch(i){throw i}}async delete(t){}async validate(t,i){let n=[],[o,c]=await Promise.allSettled([await this.findByKey(Qt,{name:t}),await this.findByKey(Qt,{code:i})]);return o!==null&&n.push({code:"INVALID",field:"name",message:"Invalid name"}),c!==null&&n.push({code:"INVALID",field:"code",message:"Invalid code"}),n}};var et,Ft=class{constructor(e){this.app=e;Sr(this,et,void 0);this.create=async(e,t)=>{let i=e.body,n=await br(this,et).create({code:i.code,name:i.name,provinceCode:i.province_code,districtCode:i.district_code,wardCode:i.ward_code});t.send(n)};this.app=e,Nr(this,et,new zt(this.app))}};et=new WeakMap;0&&(module.exports={});
//# sourceMappingURL=common-land.handler.js.map
