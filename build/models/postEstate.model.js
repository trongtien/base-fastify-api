"use strict";var Je=Object.defineProperty;var Hi=Object.getOwnPropertyDescriptor;var Xi=Object.getOwnPropertyNames;var Gi=Object.prototype.hasOwnProperty;var ki=(i,e,t)=>e in i?Je(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t;var Zi=(i,e)=>{for(var t in e)Je(i,t,{get:e[t],enumerable:!0})},er=(i,e,t,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let s of Xi(e))!Gi.call(i,s)&&s!==t&&Je(i,s,{get:()=>e[s],enumerable:!(r=Hi(e,s))||r.enumerable});return i};var tr=i=>er(Je({},"__esModule",{value:!0}),i);var a=(i,e,t)=>(ki(i,typeof e!="symbol"?e+"":e,t),t);var In={};Zi(In,{postEstateModel:()=>Bn});module.exports=tr(In);var o=Symbol.for("drizzle:entityKind"),Rn=Symbol.for("drizzle:hasOwnEntityKind");function c(i,e){if(!i||typeof i!="object")return!1;if(i instanceof e)return!0;if(!Object.prototype.hasOwnProperty.call(e,o))throw new Error(`Class "${e.name??"<unknown>"}" doesn't look like a Drizzle entity. If this is incorrect and the class is provided by Drizzle, please report this as a bug.`);let t=i.constructor;if(t)for(;t;){if(o in t&&t[o]===e[o])return!0;t=Object.getPrototypeOf(t)}return!1}var ir,N=class{constructor(e,t){this.table=e,this.config=t,this.name=t.name,this.notNull=t.notNull,this.default=t.default,this.defaultFn=t.defaultFn,this.onUpdateFn=t.onUpdateFn,this.hasDefault=t.hasDefault,this.primary=t.primaryKey,this.isUnique=t.isUnique,this.uniqueName=t.uniqueName,this.uniqueType=t.uniqueType,this.dataType=t.dataType,this.columnType=t.columnType}name;primary;notNull;default;defaultFn;onUpdateFn;hasDefault;isUnique;uniqueName;uniqueType;dataType;columnType;enumValues=void 0;config;mapFromDriverValue(e){return e}mapToDriverValue(e){return e}};ir=o,a(N,ir,"Column");var rr,Pe=class{config;constructor(e,t,r){this.config={name:e,notNull:!1,default:void 0,hasDefault:!1,primaryKey:!1,isUnique:!1,uniqueName:void 0,uniqueType:void 0,dataType:t,columnType:r}}$type(){return this}notNull(){return this.config.notNull=!0,this}default(e){return this.config.default=e,this.config.hasDefault=!0,this}$defaultFn(e){return this.config.defaultFn=e,this.config.hasDefault=!0,this}$default=this.$defaultFn;$onUpdateFn(e){return this.config.onUpdateFn=e,this.config.hasDefault=!0,this}$onUpdate=this.$onUpdateFn;primaryKey(){return this.config.primaryKey=!0,this.config.notNull=!0,this}};rr=o,a(Pe,rr,"ColumnBuilder");var We=Symbol.for("drizzle:Name"),Ct=Symbol.for("drizzle:Schema"),oi=Symbol.for("drizzle:Columns"),ai=Symbol.for("drizzle:ExtraConfigColumns"),qt=Symbol.for("drizzle:OriginalName"),Ot=Symbol.for("drizzle:BaseName"),li=Symbol.for("drizzle:IsAlias"),ui=Symbol.for("drizzle:ExtraConfigBuilder"),nr=Symbol.for("drizzle:IsDrizzleTable"),sr,p=class{[(sr=o,We)];[qt];[Ct];[oi];[ai];[Ot];[li]=!1;[ui]=void 0;[nr]=!0;constructor(e,t,r){this[We]=this[qt]=e,this[Ct]=t,this[Ot]=r}};a(p,sr,"Table"),a(p,"Symbol",{Name:We,Schema:Ct,OriginalName:qt,Columns:oi,ExtraConfigColumns:ai,BaseName:Ot,IsAlias:li,ExtraConfigBuilder:ui});function ne(i){return i[We]}var Pt=Symbol.for("drizzle:PgInlineForeignKeys"),or,E=class extends p{[(or=o,Pt)]=[];[p.Symbol.ExtraConfigBuilder]=void 0};a(E,or,"PgTable"),a(E,"Symbol",Object.assign({},p.Symbol,{InlineForeignKeys:Pt}));function jt(i,e,t,r,s=i){let l=new E(i,r,s),u=Object.fromEntries(Object.entries(e).map(([f,g])=>{let w=g,S=w.build(l);return l[Pt].push(...w.buildForeignKeys(S,l)),[f,S]})),m=Object.fromEntries(Object.entries(e).map(([f,g])=>{let S=g.buildExtraConfigColumn(l);return[f,S]})),d=Object.assign(l,u);return d[p.Symbol.Columns]=u,d[p.Symbol.ExtraConfigColumns]=m,t&&(d[E.Symbol.ExtraConfigBuilder]=t),d}var zt=(i,e,t)=>jt(i,e,t,void 0);var ar,je=class{reference;_onUpdate="no action";_onDelete="no action";constructor(e,t){this.reference=()=>{let{name:r,columns:s,foreignColumns:l}=e();return{name:r,columns:s,foreignTable:l[0].table,foreignColumns:l}},t&&(this._onUpdate=t.onUpdate,this._onDelete=t.onDelete)}onUpdate(e){return this._onUpdate=e===void 0?"no action":e,this}onDelete(e){return this._onDelete=e===void 0?"no action":e,this}build(e){return new Ye(e,this)}};ar=o,a(je,ar,"PgForeignKeyBuilder");var lr,Ye=class{constructor(e,t){this.table=e,this.reference=t.reference,this.onUpdate=t._onUpdate,this.onDelete=t._onDelete}reference;onUpdate;onDelete;getName(){let{name:e,columns:t,foreignColumns:r}=this.reference(),s=t.map(m=>m.name),l=r.map(m=>m.name),u=[this.table[E.Symbol.Name],...s,r[0].table[E.Symbol.Name],...l];return e??`${u.join("_")}_fk`}};lr=o,a(Ye,lr,"PgForeignKey");function He(i,...e){return i(...e)}function Kt(i,e){return`${i[E.Symbol.Name]}_${e.join("_")}_unique`}var ur,Xe=class{constructor(e,t){this.name=t,this.columns=e}columns;nullsNotDistinctConfig=!1;nullsNotDistinct(){return this.nullsNotDistinctConfig=!0,this}build(e){return new Ge(e,this.columns,this.nullsNotDistinctConfig,this.name)}};ur=o,a(Xe,ur,"PgUniqueConstraintBuilder");var cr,At=class{name;constructor(e){this.name=e}on(...e){return new Xe(e,this.name)}};cr=o,a(At,cr,"PgUniqueOnConstraintBuilder");var fr,Ge=class{constructor(e,t,r,s){this.table=e,this.columns=t,this.name=s??Kt(this.table,this.columns.map(l=>l.name)),this.nullsNotDistinct=r}columns;name;nullsNotDistinct=!1;getName(){return this.name}};fr=o,a(Ge,fr,"PgUniqueConstraint");function ci(i,e,t){for(let r=e;r<i.length;r++){let s=i[r];if(s==="\\"){r++;continue}if(s==='"')return[i.slice(e,r).replace(/\\/g,""),r+1];if(!t&&(s===","||s==="}"))return[i.slice(e,r).replace(/\\/g,""),r]}return[i.slice(e).replace(/\\/g,""),i.length]}function fi(i,e=0){let t=[],r=e,s=!1;for(;r<i.length;){let l=i[r];if(l===","){(s||r===e)&&t.push(""),s=!0,r++;continue}if(s=!1,l==="\\"){r+=2;continue}if(l==='"'){let[d,f]=ci(i,r+1,!0);t.push(d),r=f;continue}if(l==="}")return[t,r+1];if(l==="{"){let[d,f]=fi(i,r+1);t.push(d),r=f;continue}let[u,m]=ci(i,r,!1);t.push(u),r=m}return[t,r]}function mi(i){let[e]=fi(i,1);return e}function Ft(i){return`{${i.map(e=>Array.isArray(e)?Ft(e):typeof e=="string"?`"${e.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}"`:`${e}`).join(",")}}`}var mr,x=class extends Pe{foreignKeyConfigs=[];array(e){return new Ze(this.config.name,this,e)}references(e,t={}){return this.foreignKeyConfigs.push({ref:e,actions:t}),this}unique(e,t){return this.config.isUnique=!0,this.config.uniqueName=e,this.config.uniqueType=t?.nulls,this}buildForeignKeys(e,t){return this.foreignKeyConfigs.map(({ref:r,actions:s})=>He((l,u)=>{let m=new je(()=>{let d=l();return{columns:[e],foreignColumns:[d]}});return u.onUpdate&&m.onUpdate(u.onUpdate),u.onDelete&&m.onDelete(u.onDelete),m.build(t)},r,s))}buildExtraConfigColumn(e){return new ke(e,this.config)}};mr=o,a(x,mr,"PgColumnBuilder");var dr,y=class extends N{constructor(e,t){t.uniqueName||(t.uniqueName=Kt(e,[t.name])),super(e,t),this.table=e}};dr=o,a(y,dr,"PgColumn");var hr,ke=class extends y{getSQLType(){return this.getSQLType()}indexConfig={order:this.config.order??"asc",nulls:this.config.nulls??"last",opClass:this.config.opClass};defaultConfig={order:"asc",nulls:"last",opClass:void 0};asc(){return this.indexConfig.order="asc",this}desc(){return this.indexConfig.order="desc",this}nullsFirst(){return this.indexConfig.nulls="first",this}nullsLast(){return this.indexConfig.nulls="last",this}op(e){return this.indexConfig.opClass=e,this}};hr=o,a(ke,hr,"ExtraConfigColumn");var pr,ee=class{constructor(e,t,r){this.name=e,this.type=t,this.indexConfig=r}name;type;indexConfig};pr=o,a(ee,pr,"IndexedColumn");var gr,Ze=class extends x{constructor(e,t,r){super(e,"array","PgArray"),this.config.baseBuilder=t,this.config.size=r}build(e){let t=this.config.baseBuilder.build(e);return new et(e,this.config,t)}};gr=o,a(Ze,gr,"PgArrayBuilder");var yr,Qt=class extends y{constructor(e,t,r,s){super(e,t),this.baseColumn=r,this.range=s,this.size=t.size}size;getSQLType(){return`${this.baseColumn.getSQLType()}[${typeof this.size=="number"?this.size:""}]`}mapFromDriverValue(e){return typeof e=="string"&&(e=mi(e)),e.map(t=>this.baseColumn.mapFromDriverValue(t))}mapToDriverValue(e,t=!1){let r=e.map(s=>s===null?null:c(this.baseColumn,Qt)?this.baseColumn.mapToDriverValue(s,!0):this.baseColumn.mapToDriverValue(s));return t?r:Ft(r)}},et=Qt;yr=o,a(et,yr,"PgArray");var Dt=Symbol.for("drizzle:isPgEnum");function di(i){return!!i&&typeof i=="function"&&Dt in i&&i[Dt]===!0}var wr,tt=class extends x{constructor(e,t){super(e,"string","PgEnumColumn"),this.config.enum=t}build(e){return new it(e,this.config)}};wr=o,a(tt,wr,"PgEnumColumnBuilder");var br,it=class extends y{enum=this.config.enum;enumValues=this.config.enum.enumValues;constructor(e,t){super(e,t),this.enum=t.enum}getSQLType(){return this.enum.enumName}};br=o,a(it,br,"PgEnumColumn");function hi(i,e,t){let r=Object.assign(s=>new tt(s,r),{enumName:i,enumValues:e,schema:t,[Dt]:!0});return r}var Sr,K=class{constructor(e,t,r,s=!1){this._={brand:"Subquery",sql:e,selectedFields:t,alias:r,isWith:s}}};Sr=o,a(K,Sr,"Subquery");var $r,ze=class extends K{};$r=o,a(ze,$r,"WithSubquery");var pi="0.31.2";var Et,Lt,Ae={startActiveSpan(i,e){return Et?(Lt||(Lt=Et.trace.getTracer("drizzle-orm",pi)),He((t,r)=>r.startActiveSpan(i,s=>{try{return e(s)}catch(l){throw s.setStatus({code:t.SpanStatusCode.ERROR,message:l instanceof Error?l.message:"Unknown error"}),l}finally{s.end()}}),Et,Lt)):e()}};var T=Symbol.for("drizzle:ViewBaseConfig");var xr,Vt=class{};xr=o,a(Vt,xr,"FakePrimitiveParam");function _t(i){return i!=null&&typeof i.getSQL=="function"}function Nr(i){let e={sql:"",params:[]};for(let t of i)e.sql+=t.sql,e.params.push(...t.params),t.typings?.length&&(e.typings||(e.typings=[]),e.typings.push(...t.typings));return e}var Tr,q=class{value;constructor(e){this.value=Array.isArray(e)?e:[e]}getSQL(){return new h([this])}};Tr=o,a(q,Tr,"StringChunk");var vr,se=class{constructor(e){this.queryChunks=e}decoder=yi;shouldInlineParams=!1;append(e){return this.queryChunks.push(...e.queryChunks),this}toQuery(e){return Ae.startActiveSpan("drizzle.buildSQL",t=>{let r=this.buildQueryFromSourceParams(this.queryChunks,e);return t?.setAttributes({"drizzle.query.text":r.sql,"drizzle.query.params":JSON.stringify(r.params)}),r})}buildQueryFromSourceParams(e,t){let r=Object.assign({},t,{inlineParams:t.inlineParams||this.shouldInlineParams,paramStartIndex:t.paramStartIndex||{value:0}}),{escapeName:s,escapeParam:l,prepareTyping:u,inlineParams:m,paramStartIndex:d}=r;return Nr(e.map(f=>{if(c(f,q))return{sql:f.value.join(""),params:[]};if(c(f,oe))return{sql:s(f.value),params:[]};if(f===void 0)return{sql:"",params:[]};if(Array.isArray(f)){let g=[new q("(")];for(let[w,S]of f.entries())g.push(S),w<f.length-1&&g.push(new q(", "));return g.push(new q(")")),this.buildQueryFromSourceParams(g,r)}if(c(f,se))return this.buildQueryFromSourceParams(f.queryChunks,{...r,inlineParams:m||f.shouldInlineParams});if(c(f,p)){let g=f[p.Symbol.Schema],w=f[p.Symbol.Name];return{sql:g===void 0?s(w):s(g)+"."+s(w),params:[]}}if(c(f,N))return t.invokeSource==="indexes"?{sql:s(f.name),params:[]}:{sql:s(f.table[p.Symbol.Name])+"."+s(f.name),params:[]};if(c(f,V)){let g=f[T].schema,w=f[T].name;return{sql:g===void 0?s(w):s(g)+"."+s(w),params:[]}}if(c(f,U)){let g=f.value===null?null:f.encoder.mapToDriverValue(f.value);if(c(g,se))return this.buildQueryFromSourceParams([g],r);if(m)return{sql:this.mapInlineParam(g,r),params:[]};let w;return u!==void 0&&(w=[u(f.encoder)]),{sql:l(d.value++,g),params:[g],typings:w}}return c(f,te)?{sql:l(d.value++,f),params:[f]}:c(f,se.Aliased)&&f.fieldAlias!==void 0?{sql:s(f.fieldAlias),params:[]}:c(f,K)?f._.isWith?{sql:s(f._.alias),params:[]}:this.buildQueryFromSourceParams([new q("("),f._.sql,new q(") "),new oe(f._.alias)],r):di(f)?f.schema?{sql:s(f.schema)+"."+s(f.enumName),params:[]}:{sql:s(f.enumName),params:[]}:_t(f)?this.buildQueryFromSourceParams([new q("("),f.getSQL(),new q(")")],r):m?{sql:this.mapInlineParam(f,r),params:[]}:{sql:l(d.value++,f),params:[f]}}))}mapInlineParam(e,{escapeString:t}){if(e===null)return"null";if(typeof e=="number"||typeof e=="boolean")return e.toString();if(typeof e=="string")return t(e);if(typeof e=="object"){let r=e.toString();return t(r==="[object Object]"?JSON.stringify(e):r)}throw new Error("Unexpected param value: "+e)}getSQL(){return this}as(e){return e===void 0?this:new se.Aliased(this,e)}mapWith(e){return this.decoder=typeof e=="function"?{mapFromDriverValue:e}:e,this}inlineParams(){return this.shouldInlineParams=!0,this}if(e){return e?this:void 0}},h=se;vr=o,a(h,vr,"SQL");var Cr,oe=class{constructor(e){this.value=e}brand;getSQL(){return new h([this])}};Cr=o,a(oe,Cr,"Name");function gi(i){return typeof i=="object"&&i!==null&&"mapToDriverValue"in i&&typeof i.mapToDriverValue=="function"}var yi={mapFromDriverValue:i=>i},wi={mapToDriverValue:i=>i},Us={...yi,...wi},qr,U=class{constructor(e,t=wi){this.value=e,this.encoder=t}brand;getSQL(){return new h([this])}};qr=o,a(U,qr,"Param");function n(i,...e){let t=[];(e.length>0||i.length>0&&i[0]!=="")&&t.push(new q(i[0]));for(let[r,s]of e.entries())t.push(s,new q(i[r+1]));return new h(t)}(i=>{function e(){return new h([])}i.empty=e;function t(d){return new h(d)}i.fromList=t;function r(d){return new h([new q(d)])}i.raw=r;function s(d,f){let g=[];for(let[w,S]of d.entries())w>0&&f!==void 0&&g.push(f),g.push(S);return new h(g)}i.join=s;function l(d){return new oe(d)}i.identifier=l;function u(d){return new te(d)}i.placeholder=u;function m(d,f){return new U(d,f)}i.param=m})(n||(n={}));(i=>{class e{constructor(r,s){this.sql=r,this.fieldAlias=s}static[o]="SQL.Aliased";isSelectionField=!1;getSQL(){return this.sql}clone(){return new e(this.sql,this.fieldAlias)}}i.Aliased=e})(h||(h={}));var Or,te=class{constructor(e){this.name=e}getSQL(){return new h([this])}};Or=o,a(te,Or,"Placeholder");var Pr,V=class{[(Pr=o,T)];constructor({name:e,schema:t,selectedFields:r,query:s}){this[T]={name:e,originalName:e,schema:t,selectedFields:r,query:s,isExisting:!s,isAlias:!1}}getSQL(){return new h([this])}};a(V,Pr,"View");N.prototype.getSQL=function(){return new h([this])};p.prototype.getSQL=function(){return new h([this])};K.prototype.getSQL=function(){return new h([this])};var jr,G=class{constructor(e){this.table=e}get(e,t){return t==="table"?this.table:e[t]}};jr=o,a(G,jr,"ColumnAliasProxyHandler");var zr,ie=class{constructor(e,t){this.alias=e,this.replaceOriginalName=t}get(e,t){if(t===p.Symbol.IsAlias)return!0;if(t===p.Symbol.Name)return this.alias;if(this.replaceOriginalName&&t===p.Symbol.OriginalName)return this.alias;if(t===T)return{...e[T],name:this.alias,isAlias:!0};if(t===p.Symbol.Columns){let s=e[p.Symbol.Columns];if(!s)return s;let l={};return Object.keys(s).map(u=>{l[u]=new Proxy(s[u],new G(new Proxy(e,this)))}),l}let r=e[t];return c(r,N)?new Proxy(r,new G(new Proxy(e,this))):r}};zr=o,a(ie,zr,"TableAliasProxyHandler");var Ar,Bt=class{constructor(e){this.alias=e}get(e,t){return t==="sourceTable"?Ke(e.sourceTable,this.alias):e[t]}};Ar=o,a(Bt,Ar,"RelationTableAliasProxyHandler");function Ke(i,e){return new Proxy(i,new ie(e,!1))}function J(i,e){return new Proxy(i,new G(new Proxy(i.table,new ie(e,!1))))}function It(i,e){return new h.Aliased(Fe(i.sql,e),i.fieldAlias)}function Fe(i,e){return n.join(i.queryChunks.map(t=>c(t,N)?J(t,e):c(t,h)?Fe(t,e):c(t,h.Aliased)?It(t,e):t))}var Kr,R=class extends x{defaultNow(){return this.default(n`now()`)}};Kr=o,a(R,Kr,"PgDateColumnBaseBuilder");var Fr,Ut=class extends R{constructor(e){super(e,"date","PgDate")}build(e){return new ae(e,this.config)}};Fr=o,a(Ut,Fr,"PgDateBuilder");var Qr,ae=class extends y{getSQLType(){return"date"}mapFromDriverValue(e){return new Date(e)}mapToDriverValue(e){return e.toISOString()}};Qr=o,a(ae,Qr,"PgDate");var Dr,Rt=class extends R{constructor(e){super(e,"string","PgDateString")}build(e){return new le(e,this.config)}};Dr=o,a(Rt,Dr,"PgDateStringBuilder");var Er,le=class extends y{getSQLType(){return"date"}};Er=o,a(le,Er,"PgDateString");var Lr,rt=class extends x{constructor(e){super(e,"number","PgInteger")}build(e){return new nt(e,this.config)}};Lr=o,a(rt,Lr,"PgIntegerBuilder");var Vr,nt=class extends y{getSQLType(){return"integer"}mapFromDriverValue(e){return typeof e=="string"?Number.parseInt(e):e}};Vr=o,a(nt,Vr,"PgInteger");function k(i){return new rt(i)}var _r,Mt=class extends x{constructor(e){super(e,"json","PgJson")}build(e){return new ue(e,this.config)}};_r=o,a(Mt,_r,"PgJsonBuilder");var Br,ue=class extends y{constructor(e,t){super(e,t)}getSQLType(){return"json"}mapToDriverValue(e){return JSON.stringify(e)}mapFromDriverValue(e){if(typeof e=="string")try{return JSON.parse(e)}catch{return e}return e}};Br=o,a(ue,Br,"PgJson");var Ir,Jt=class extends x{constructor(e){super(e,"json","PgJsonb")}build(e){return new ce(e,this.config)}};Ir=o,a(Jt,Ir,"PgJsonbBuilder");var Ur,ce=class extends y{constructor(e,t){super(e,t)}getSQLType(){return"jsonb"}mapToDriverValue(e){return JSON.stringify(e)}mapFromDriverValue(e){if(typeof e=="string")try{return JSON.parse(e)}catch{return e}return e}};Ur=o,a(ce,Ur,"PgJsonb");var Rr,Wt=class extends x{constructor(e,t,r){super(e,"string","PgNumeric"),this.config.precision=t,this.config.scale=r}build(e){return new fe(e,this.config)}};Rr=o,a(Wt,Rr,"PgNumericBuilder");var Mr,fe=class extends y{precision;scale;constructor(e,t){super(e,t),this.precision=t.precision,this.scale=t.scale}getSQLType(){return this.precision!==void 0&&this.scale!==void 0?`numeric(${this.precision}, ${this.scale})`:this.precision===void 0?"numeric":`numeric(${this.precision})`}};Mr=o,a(fe,Mr,"PgNumeric");var Jr,st=class extends x{constructor(e,t){super(e,"number","PgReal"),this.config.length=t}build(e){return new ot(e,this.config)}};Jr=o,a(st,Jr,"PgRealBuilder");var Wr,ot=class extends y{constructor(e,t){super(e,t)}getSQLType(){return"real"}mapFromDriverValue=e=>typeof e=="string"?Number.parseFloat(e):e};Wr=o,a(ot,Wr,"PgReal");function at(i){return new st(i)}var Yr,lt=class extends x{constructor(e,t){super(e,"string","PgText"),this.config.enumValues=t.enum}build(e){return new ut(e,this.config)}};Yr=o,a(lt,Yr,"PgTextBuilder");var Hr,ut=class extends y{enumValues=this.config.enumValues;getSQLType(){return"text"}};Hr=o,a(ut,Hr,"PgText");function Yt(i,e={}){return new lt(i,e)}var Xr,Ht=class extends R{constructor(e,t,r){super(e,"string","PgTime"),this.withTimezone=t,this.precision=r,this.config.withTimezone=t,this.config.precision=r}build(e){return new me(e,this.config)}};Xr=o,a(Ht,Xr,"PgTimeBuilder");var Gr,me=class extends y{withTimezone;precision;constructor(e,t){super(e,t),this.withTimezone=t.withTimezone,this.precision=t.precision}getSQLType(){return`time${this.precision===void 0?"":`(${this.precision})`}${this.withTimezone?" with time zone":""}`}};Gr=o,a(me,Gr,"PgTime");var kr,ct=class extends R{constructor(e,t,r){super(e,"date","PgTimestamp"),this.config.withTimezone=t,this.config.precision=r}build(e){return new de(e,this.config)}};kr=o,a(ct,kr,"PgTimestampBuilder");var Zr,de=class extends y{withTimezone;precision;constructor(e,t){super(e,t),this.withTimezone=t.withTimezone,this.precision=t.precision}getSQLType(){return`timestamp${this.precision===void 0?"":` (${this.precision})`}${this.withTimezone?" with time zone":""}`}mapFromDriverValue=e=>new Date(this.withTimezone?e:e+"+0000");mapToDriverValue=e=>e.toISOString()};Zr=o,a(de,Zr,"PgTimestamp");var en,ft=class extends R{constructor(e,t,r){super(e,"string","PgTimestampString"),this.config.withTimezone=t,this.config.precision=r}build(e){return new he(e,this.config)}};en=o,a(ft,en,"PgTimestampStringBuilder");var tn,he=class extends y{withTimezone;precision;constructor(e,t){super(e,t),this.withTimezone=t.withTimezone,this.precision=t.precision}getSQLType(){return`timestamp${this.precision===void 0?"":`(${this.precision})`}${this.withTimezone?" with time zone":""}`}};tn=o,a(he,tn,"PgTimestampString");function Xt(i,e={}){return e.mode==="string"?new ft(i,e.withTimezone??!1,e.precision):new ct(i,e.withTimezone??!1,e.precision)}var rn,mt=class extends x{constructor(e){super(e,"string","PgUUID")}defaultRandom(){return this.default(n`gen_random_uuid()`)}build(e){return new pe(e,this.config)}};rn=o,a(mt,rn,"PgUUIDBuilder");var nn,pe=class extends y{getSQLType(){return"uuid"}};nn=o,a(pe,nn,"PgUUID");function Gt(i){return new mt(i)}var sn,dt=class extends x{constructor(e,t){super(e,"string","PgVarchar"),this.config.length=t.length,this.config.enumValues=t.enum}build(e){return new ht(e,this.config)}};sn=o,a(dt,sn,"PgVarcharBuilder");var on,ht=class extends y{length=this.config.length;enumValues=this.config.enumValues;getSQLType(){return this.length===void 0?"varchar":`varchar(${this.length})`}};on=o,a(ht,on,"PgVarchar");function Z(i,e={}){return new dt(i,e)}var an,Qe=class{[(an=o,Symbol.toStringTag)]="QueryPromise";catch(e){return this.then(void 0,e)}finally(e){return this.then(t=>(e?.(),t),t=>{throw e?.(),t})}then(e,t){return this.execute().then(e,t)}};a(Qe,an,"QueryPromise");function ge(i,e){return Object.entries(i).reduce((t,[r,s])=>{if(typeof r!="string")return t;let l=e?[...e,r]:[r];return c(s,N)||c(s,h)||c(s,h.Aliased)?t.push({path:l,field:s}):c(s,p)?t.push(...ge(s[p.Symbol.Columns],l)):t.push(...ge(s,l)),t},[])}function kt(i,e){let t=Object.keys(i),r=Object.keys(e);if(t.length!==r.length)return!1;for(let[s,l]of t.entries())if(l!==r[s])return!1;return!0}function bi(i,e){for(let t of e)for(let r of Object.getOwnPropertyNames(t.prototype))r!=="constructor"&&Object.defineProperty(i.prototype,r,Object.getOwnPropertyDescriptor(t.prototype,r)||Object.create(null))}function De(i){return i[p.Symbol.Columns]}function Zt(i){return c(i,K)?i._.alias:c(i,V)?i[T].name:c(i,h)?void 0:i[p.Symbol.IsAlias]?i[p.Symbol.Name]:i[p.Symbol.BaseName]}var ln,ye=class extends Error{constructor({message:e,cause:t}){super(e),this.name="DrizzleError",this.cause=t}};ln=o,a(ye,ln,"DrizzleError");var un,ei=class extends ye{constructor(){super({message:"Rollback"})}};un=o,a(ei,un,"TransactionRollbackError");function B(i,e){return gi(e)&&!_t(i)&&!c(i,U)&&!c(i,te)&&!c(i,N)&&!c(i,p)&&!c(i,V)?new U(i,e):i}var pt=(i,e)=>n`${i} = ${B(e,i)}`,Si=(i,e)=>n`${i} <> ${B(e,i)}`;function Ee(...i){let e=i.filter(t=>t!==void 0);if(e.length!==0)return e.length===1?new h(e):new h([new q("("),n.join(e,new q(" and ")),new q(")")])}function $i(...i){let e=i.filter(t=>t!==void 0);if(e.length!==0)return e.length===1?new h(e):new h([new q("("),n.join(e,new q(" or ")),new q(")")])}function Ni(i){return n`not ${i}`}var xi=(i,e)=>n`${i} > ${B(e,i)}`,Ti=(i,e)=>n`${i} >= ${B(e,i)}`,vi=(i,e)=>n`${i} < ${B(e,i)}`,Ci=(i,e)=>n`${i} <= ${B(e,i)}`;function qi(i,e){if(Array.isArray(e)){if(e.length===0)throw new Error("inArray requires at least one value");return n`${i} in ${e.map(t=>B(t,i))}`}return n`${i} in ${B(e,i)}`}function Oi(i,e){if(Array.isArray(e)){if(e.length===0)throw new Error("notInArray requires at least one value");return n`${i} not in ${e.map(t=>B(t,i))}`}return n`${i} not in ${B(e,i)}`}function Pi(i){return n`${i} is null`}function ji(i){return n`${i} is not null`}function zi(i){return n`exists ${i}`}function Ai(i){return n`not exists ${i}`}function Ki(i,e,t){return n`${i} between ${B(e,i)} and ${B(t,i)}`}function Fi(i,e,t){return n`${i} not between ${B(e,i)} and ${B(t,i)}`}function Qi(i,e){return n`${i} like ${e}`}function Di(i,e){return n`${i} not like ${e}`}function Ei(i,e){return n`${i} ilike ${e}`}function Li(i,e){return n`${i} not ilike ${e}`}function Vi(i){return n`${i} asc`}function _i(i){return n`${i} desc`}var cn,Le=class{constructor(e,t,r){this.sourceTable=e,this.referencedTable=t,this.relationName=r,this.referencedTableName=t[p.Symbol.Name]}referencedTableName;fieldName};cn=o,a(Le,cn,"Relation");var fn,ti=class{constructor(e,t){this.table=e,this.config=t}};fn=o,a(ti,fn,"Relations");var mn,ii=class extends Le{constructor(e,t,r,s){super(e,t,r?.relationName),this.config=r,this.isNullable=s}withFieldName(e){let t=new ii(this.sourceTable,this.referencedTable,this.config,this.isNullable);return t.fieldName=e,t}},re=ii;mn=o,a(re,mn,"One");var dn,ri=class extends Le{constructor(e,t,r){super(e,t,r?.relationName),this.config=r}withFieldName(e){let t=new ri(this.sourceTable,this.referencedTable,this.config);return t.fieldName=e,t}},Ve=ri;dn=o,a(Ve,dn,"Many");function Bi(){return{and:Ee,between:Ki,eq:pt,exists:zi,gt:xi,gte:Ti,ilike:Ei,inArray:qi,isNull:Pi,isNotNull:ji,like:Qi,lt:vi,lte:Ci,ne:Si,not:Ni,notBetween:Fi,notExists:Ai,notLike:Di,notIlike:Li,notInArray:Oi,or:$i,sql:n}}function Ii(){return{sql:n,asc:Vi,desc:_i}}function Ui(i,e,t){if(c(t,re)&&t.config)return{fields:t.config.fields,references:t.config.references};let r=e[t.referencedTable[p.Symbol.Name]];if(!r)throw new Error(`Table "${t.referencedTable[p.Symbol.Name]}" not found in schema`);let s=i[r];if(!s)throw new Error(`Table "${r}" not found in schema`);let l=t.sourceTable,u=e[l[p.Symbol.Name]];if(!u)throw new Error(`Table "${l[p.Symbol.Name]}" not found in schema`);let m=[];for(let d of Object.values(s.relations))(t.relationName&&t!==d&&d.relationName===t.relationName||!t.relationName&&d.referencedTable===t.sourceTable)&&m.push(d);if(m.length>1)throw t.relationName?new Error(`There are multiple relations with name "${t.relationName}" in table "${r}"`):new Error(`There are multiple relations between "${r}" and "${t.sourceTable[p.Symbol.Name]}". Please specify relation name`);if(m[0]&&c(m[0],re)&&m[0].config)return{fields:m[0].config.references,references:m[0].config.fields};throw new Error(`There is not enough information to infer relation "${u}.${t.fieldName}"`)}var hn,W=class extends V{};hn=o,a(W,hn,"PgViewBase");var pn,_e=class{async migrate(e,t,r){let s=typeof r=="string"?"__drizzle_migrations":r.migrationsTable??"__drizzle_migrations",l=typeof r=="string"?"drizzle":r.migrationsSchema??"drizzle",u=n`
			CREATE TABLE IF NOT EXISTS ${n.identifier(l)}.${n.identifier(s)} (
				id SERIAL PRIMARY KEY,
				hash text NOT NULL,
				created_at bigint
			)
		`;await t.execute(n`CREATE SCHEMA IF NOT EXISTS ${n.identifier(l)}`),await t.execute(u);let d=(await t.all(n`select id, hash, created_at from ${n.identifier(l)}.${n.identifier(s)} order by created_at desc limit 1`))[0];await t.transaction(async f=>{for await(let g of e)if(!d||Number(d.created_at)<g.folderMillis){for(let w of g.sql)await f.execute(n.raw(w));await f.execute(n`insert into ${n.identifier(l)}.${n.identifier(s)} ("hash", "created_at") values(${g.hash}, ${g.folderMillis})`)}})}escapeName(e){return`"${e}"`}escapeParam(e){return`$${e+1}`}escapeString(e){return`'${e.replace(/'/g,"''")}'`}buildWithCTE(e){if(!e?.length)return;let t=[n`with `];for(let[r,s]of e.entries())t.push(n`${n.identifier(s._.alias)} as (${s._.sql})`),r<e.length-1&&t.push(n`, `);return t.push(n` `),n.join(t)}buildDeleteQuery({table:e,where:t,returning:r,withList:s}){let l=this.buildWithCTE(s),u=r?n` returning ${this.buildSelection(r,{isSingleTable:!0})}`:void 0,m=t?n` where ${t}`:void 0;return n`${l}delete from ${e}${m}${u}`}buildUpdateSet(e,t){let r=e[p.Symbol.Columns],s=Object.keys(r).filter(u=>t[u]!==void 0||r[u]?.onUpdateFn!==void 0),l=s.length;return n.join(s.flatMap((u,m)=>{let d=r[u],f=t[u]??n.param(d.onUpdateFn(),d),g=n`${n.identifier(d.name)} = ${f}`;return m<l-1?[g,n.raw(", ")]:[g]}))}buildUpdateQuery({table:e,set:t,where:r,returning:s,withList:l}){let u=this.buildWithCTE(l),m=this.buildUpdateSet(e,t),d=s?n` returning ${this.buildSelection(s,{isSingleTable:!0})}`:void 0,f=r?n` where ${r}`:void 0;return n`${u}update ${e} set ${m}${f}${d}`}buildSelection(e,{isSingleTable:t=!1}={}){let r=e.length,s=e.flatMap(({field:l},u)=>{let m=[];if(c(l,h.Aliased)&&l.isSelectionField)m.push(n.identifier(l.fieldAlias));else if(c(l,h.Aliased)||c(l,h)){let d=c(l,h.Aliased)?l.sql:l;t?m.push(new h(d.queryChunks.map(f=>c(f,y)?n.identifier(f.name):f))):m.push(d),c(l,h.Aliased)&&m.push(n` as ${n.identifier(l.fieldAlias)}`)}else c(l,N)&&(t?m.push(n.identifier(l.name)):m.push(l));return u<r-1&&m.push(n`, `),m});return n.join(s)}buildSelectQuery({withList:e,fields:t,fieldsFlat:r,where:s,having:l,table:u,joins:m,orderBy:d,groupBy:f,limit:g,offset:w,lockingClause:S,distinct:L,setOperators:j}){let D=r??ge(t);for(let C of D)if(c(C.field,N)&&ne(C.field.table)!==(c(u,K)?u._.alias:c(u,W)?u[T].name:c(u,h)?void 0:ne(u))&&!(A=>m?.some(({alias:I})=>I===(A[p.Symbol.IsAlias]?ne(A):A[p.Symbol.BaseName])))(C.field.table)){let A=ne(C.field.table);throw new Error(`Your "${C.path.join("->")}" field references a column "${A}"."${C.field.name}", but the table "${A}" is not part of the query! Did you forget to join it?`)}let v=!m||m.length===0,z=this.buildWithCTE(e),F;L&&(F=L===!0?n` distinct`:n` distinct on (${n.join(L.on,n`, `)})`);let Q=this.buildSelection(D,{isSingleTable:v}),O=(()=>{if(c(u,p)&&u[p.Symbol.OriginalName]!==u[p.Symbol.Name]){let C=n`${n.identifier(u[p.Symbol.OriginalName])}`;return u[p.Symbol.Schema]&&(C=n`${n.identifier(u[p.Symbol.Schema])}.${C}`),n`${C} ${n.identifier(u[p.Symbol.Name])}`}return u})(),_=[];if(m)for(let[C,A]of m.entries()){C===0&&_.push(n` `);let I=A.table,ve=A.lateral?n` lateral`:void 0;if(c(I,E)){let vt=I[E.Symbol.Name],Ce=I[E.Symbol.Schema],qe=I[E.Symbol.OriginalName],Oe=vt===qe?void 0:A.alias;_.push(n`${n.raw(A.joinType)} join${ve} ${Ce?n`${n.identifier(Ce)}.`:void 0}${n.identifier(qe)}${Oe&&n` ${n.identifier(Oe)}`} on ${A.on}`)}else if(c(I,V)){let vt=I[T].name,Ce=I[T].schema,qe=I[T].originalName,Oe=vt===qe?void 0:A.alias;_.push(n`${n.raw(A.joinType)} join${ve} ${Ce?n`${n.identifier(Ce)}.`:void 0}${n.identifier(qe)}${Oe&&n` ${n.identifier(Oe)}`} on ${A.on}`)}else _.push(n`${n.raw(A.joinType)} join${ve} ${I} on ${A.on}`);C<m.length-1&&_.push(n` `)}let H=n.join(_),b=s?n` where ${s}`:void 0,$=l?n` having ${l}`:void 0,M;d&&d.length>0&&(M=n` order by ${n.join(d,n`, `)}`);let xe;f&&f.length>0&&(xe=n` group by ${n.join(f,n`, `)}`);let Tt=g?n` limit ${g}`:void 0,Te=w?n` offset ${w}`:void 0,X=n.empty();if(S){let C=n` for ${n.raw(S.strength)}`;S.config.of&&C.append(n` of ${n.join(Array.isArray(S.config.of)?S.config.of:[S.config.of],n`, `)}`),S.config.noWait?C.append(n` no wait`):S.config.skipLocked&&C.append(n` skip locked`),X.append(C)}let Me=n`${z}select${F} ${Q} from ${O}${H}${b}${xe}${$}${M}${Tt}${Te}${X}`;return j.length>0?this.buildSetOperations(Me,j):Me}buildSetOperations(e,t){let[r,...s]=t;if(!r)throw new Error("Cannot pass undefined values to any set operator");return s.length===0?this.buildSetOperationQuery({leftSelect:e,setOperator:r}):this.buildSetOperations(this.buildSetOperationQuery({leftSelect:e,setOperator:r}),s)}buildSetOperationQuery({leftSelect:e,setOperator:{type:t,isAll:r,rightSelect:s,limit:l,orderBy:u,offset:m}}){let d=n`(${e.getSQL()}) `,f=n`(${s.getSQL()})`,g;if(u&&u.length>0){let j=[];for(let D of u)if(c(D,y))j.push(n.identifier(D.name));else if(c(D,h)){for(let v=0;v<D.queryChunks.length;v++){let z=D.queryChunks[v];c(z,y)&&(D.queryChunks[v]=n.identifier(z.name))}j.push(n`${D}`)}else j.push(n`${D}`);g=n` order by ${n.join(j,n`, `)} `}let w=l?n` limit ${l}`:void 0,S=n.raw(`${t} ${r?"all ":""}`),L=m?n` offset ${m}`:void 0;return n`${d}${S}${f}${g}${w}${L}`}buildInsertQuery({table:e,values:t,onConflict:r,returning:s,withList:l}){let u=[],m=e[p.Symbol.Columns],d=Object.entries(m),f=d.map(([,j])=>n.identifier(j.name));for(let[j,D]of t.entries()){let v=[];for(let[z,F]of d){let Q=D[z];if(Q===void 0||c(Q,U)&&Q.value===void 0)if(F.defaultFn!==void 0){let O=F.defaultFn(),_=c(O,h)?O:n.param(O,F);v.push(_)}else if(!F.default&&F.onUpdateFn!==void 0){let O=F.onUpdateFn(),_=c(O,h)?O:n.param(O,F);v.push(_)}else v.push(n`default`);else v.push(Q)}u.push(v),j<t.length-1&&u.push(n`, `)}let g=this.buildWithCTE(l),w=n.join(u),S=s?n` returning ${this.buildSelection(s,{isSingleTable:!0})}`:void 0,L=r?n` on conflict ${r}`:void 0;return n`${g}insert into ${e} ${f} values ${w}${L}${S}`}buildRefreshMaterializedViewQuery({view:e,concurrently:t,withNoData:r}){let s=t?n` concurrently`:void 0,l=r?n` with no data`:void 0;return n`refresh materialized view${s} ${e}${l}`}prepareTyping(e){return c(e,ce)||c(e,ue)?"json":c(e,fe)?"decimal":c(e,me)?"time":c(e,de)||c(e,he)?"timestamp":c(e,ae)||c(e,le)?"date":c(e,pe)?"uuid":"none"}sqlToQuery(e,t){return e.toQuery({escapeName:this.escapeName,escapeParam:this.escapeParam,escapeString:this.escapeString,prepareTyping:this.prepareTyping,invokeSource:t})}buildRelationalQueryWithoutPK({fullSchema:e,schema:t,tableNamesMap:r,table:s,tableConfig:l,queryConfig:u,tableAlias:m,nestedQueryRelation:d,joinOn:f}){let g=[],w,S,L=[],j,D=[];if(u===!0)g=Object.entries(l.columns).map(([F,Q])=>({dbKey:Q.name,tsKey:F,field:J(Q,m),relationTableTsKey:void 0,isJson:!1,selection:[]}));else{let z=Object.fromEntries(Object.entries(l.columns).map(([b,$])=>[b,J($,m)]));if(u.where){let b=typeof u.where=="function"?u.where(z,Bi()):u.where;j=b&&Fe(b,m)}let F=[],Q=[];if(u.columns){let b=!1;for(let[$,M]of Object.entries(u.columns))M!==void 0&&$ in l.columns&&(!b&&M===!0&&(b=!0),Q.push($));Q.length>0&&(Q=b?Q.filter($=>u.columns?.[$]===!0):Object.keys(l.columns).filter($=>!Q.includes($)))}else Q=Object.keys(l.columns);for(let b of Q){let $=l.columns[b];F.push({tsKey:b,value:$})}let O=[];u.with&&(O=Object.entries(u.with).filter(b=>!!b[1]).map(([b,$])=>({tsKey:b,queryConfig:$,relation:l.relations[b]})));let _;if(u.extras){_=typeof u.extras=="function"?u.extras(z,{sql:n}):u.extras;for(let[b,$]of Object.entries(_))F.push({tsKey:b,value:It($,m)})}for(let{tsKey:b,value:$}of F)g.push({dbKey:c($,h.Aliased)?$.fieldAlias:l.columns[b].name,tsKey:b,field:c($,N)?J($,m):$,relationTableTsKey:void 0,isJson:!1,selection:[]});let H=typeof u.orderBy=="function"?u.orderBy(z,Ii()):u.orderBy??[];Array.isArray(H)||(H=[H]),L=H.map(b=>c(b,N)?J(b,m):Fe(b,m)),w=u.limit,S=u.offset;for(let{tsKey:b,queryConfig:$,relation:M}of O){let xe=Ui(t,r,M),Tt=M.referencedTable[p.Symbol.Name],Te=r[Tt],X=`${m}_${b}`,Me=Ee(...xe.fields.map((I,ve)=>pt(J(xe.references[ve],X),J(I,m)))),C=this.buildRelationalQueryWithoutPK({fullSchema:e,schema:t,tableNamesMap:r,table:e[Te],tableConfig:t[Te],queryConfig:c(M,re)?$===!0?{limit:1}:{...$,limit:1}:$,tableAlias:X,joinOn:Me,nestedQueryRelation:M}),A=n`${n.identifier(X)}.${n.identifier("data")}`.as(b);D.push({on:n`true`,table:new K(C.sql,{},X),alias:X,joinType:"left",lateral:!0}),g.push({dbKey:b,tsKey:b,field:A,relationTableTsKey:Te,isJson:!0,selection:C.selection})}}if(g.length===0)throw new ye({message:`No fields selected for table "${l.tsName}" ("${m}")`});let v;if(j=Ee(f,j),d){let z=n`json_build_array(${n.join(g.map(({field:O,tsKey:_,isJson:H})=>H?n`${n.identifier(`${m}_${_}`)}.${n.identifier("data")}`:c(O,h.Aliased)?O.sql:O),n`, `)})`;c(d,Ve)&&(z=n`coalesce(json_agg(${z}${L.length>0?n` order by ${n.join(L,n`, `)}`:void 0}), '[]'::json)`);let F=[{dbKey:"data",tsKey:"data",field:z.as("data"),isJson:!0,relationTableTsKey:l.tsName,selection:g}];w!==void 0||S!==void 0||L.length>0?(v=this.buildSelectQuery({table:Ke(s,m),fields:{},fieldsFlat:[{path:[],field:n.raw("*")}],where:j,limit:w,offset:S,orderBy:L,setOperators:[]}),j=void 0,w=void 0,S=void 0,L=[]):v=Ke(s,m),v=this.buildSelectQuery({table:c(v,E)?v:new K(v,{},m),fields:{},fieldsFlat:F.map(({field:O})=>({path:[],field:c(O,N)?J(O,m):O})),joins:D,where:j,limit:w,offset:S,orderBy:L,setOperators:[]})}else v=this.buildSelectQuery({table:Ke(s,m),fields:{},fieldsFlat:g.map(({field:z})=>({path:[],field:c(z,N)?J(z,m):z})),joins:D,where:j,limit:w,offset:S,orderBy:L,setOperators:[]});return{tableTsKey:l.tsName,sql:v,selection:g}}};pn=o,a(_e,pn,"PgDialect");var gn,ni=class{config;constructor(e){this.config={...e}}get(e,t){if(t==="_")return{...e._,selectedFields:new Proxy(e._.selectedFields,this)};if(t===T)return{...e[T],selectedFields:new Proxy(e[T].selectedFields,this)};if(typeof t=="symbol")return e[t];let s=(c(e,K)?e._.selectedFields:c(e,V)?e[T].selectedFields:e)[t];if(c(s,h.Aliased)){if(this.config.sqlAliasedBehavior==="sql"&&!s.isSelectionField)return s.sql;let l=s.clone();return l.isSelectionField=!0,l}if(c(s,h)){if(this.config.sqlBehavior==="sql")return s;throw new Error(`You tried to reference "${t}" field from a subquery, which is a raw SQL field, but it doesn't have an alias declared. Please add an alias to the field using ".as('alias')" method.`)}return c(s,N)?this.config.alias?new Proxy(s,new G(new Proxy(s.table,new ie(this.config.alias,this.config.replaceOriginalName??!1)))):s:typeof s!="object"||s===null?s:new Proxy(s,new ni(this.config))}},P=ni;gn=o,a(P,gn,"SelectionProxyHandler");var yn,Be=class{getSelectedFields(){return this._.selectedFields}};yn=o,a(Be,yn,"TypedQueryBuilder");var vn,Y=class{fields;session;dialect;withList=[];distinct;constructor(e){this.fields=e.fields,this.session=e.session,this.dialect=e.dialect,e.withList&&(this.withList=e.withList),this.distinct=e.distinct}from(e){let t=!!this.fields,r;return this.fields?r=this.fields:c(e,K)?r=Object.fromEntries(Object.keys(e._.selectedFields).map(s=>[s,e[s]])):c(e,W)?r=e[T].selectedFields:c(e,h)?r={}:r=De(e),new Ie({table:e,fields:r,isPartialSelect:t,session:this.session,dialect:this.dialect,withList:this.withList,distinct:this.distinct})}};vn=o,a(Y,vn,"PgSelectBuilder");var Cn,gt=class extends Be{_;config;joinsNotNullableMap;tableName;isPartialSelect;session;dialect;constructor({table:e,fields:t,isPartialSelect:r,session:s,dialect:l,withList:u,distinct:m}){super(),this.config={withList:u,table:e,fields:{...t},distinct:m,setOperators:[]},this.isPartialSelect=r,this.session=s,this.dialect=l,this._={selectedFields:t},this.tableName=Zt(e),this.joinsNotNullableMap=typeof this.tableName=="string"?{[this.tableName]:!0}:{}}createJoin(e){return(t,r)=>{let s=this.tableName,l=Zt(t);if(typeof l=="string"&&this.config.joins?.some(u=>u.alias===l))throw new Error(`Alias "${l}" is already used in this query`);if(!this.isPartialSelect&&(Object.keys(this.joinsNotNullableMap).length===1&&typeof s=="string"&&(this.config.fields={[s]:this.config.fields}),typeof l=="string"&&!c(t,h))){let u=c(t,K)?t._.selectedFields:c(t,V)?t[T].selectedFields:t[p.Symbol.Columns];this.config.fields[l]=u}if(typeof r=="function"&&(r=r(new Proxy(this.config.fields,new P({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))),this.config.joins||(this.config.joins=[]),this.config.joins.push({on:r,table:t,joinType:e,alias:l}),typeof l=="string")switch(e){case"left":{this.joinsNotNullableMap[l]=!1;break}case"right":{this.joinsNotNullableMap=Object.fromEntries(Object.entries(this.joinsNotNullableMap).map(([u])=>[u,!1])),this.joinsNotNullableMap[l]=!0;break}case"inner":{this.joinsNotNullableMap[l]=!0;break}case"full":{this.joinsNotNullableMap=Object.fromEntries(Object.entries(this.joinsNotNullableMap).map(([u])=>[u,!1])),this.joinsNotNullableMap[l]=!1;break}}return this}}leftJoin=this.createJoin("left");rightJoin=this.createJoin("right");innerJoin=this.createJoin("inner");fullJoin=this.createJoin("full");createSetOperator(e,t){return r=>{let s=typeof r=="function"?r(wn()):r;if(!kt(this.getSelectedFields(),s.getSelectedFields()))throw new Error("Set operator error (union / intersect / except): selected fields are not the same or are in a different order");return this.config.setOperators.push({type:e,isAll:t,rightSelect:s}),this}}union=this.createSetOperator("union",!1);unionAll=this.createSetOperator("union",!0);intersect=this.createSetOperator("intersect",!1);intersectAll=this.createSetOperator("intersect",!0);except=this.createSetOperator("except",!1);exceptAll=this.createSetOperator("except",!0);addSetOperators(e){return this.config.setOperators.push(...e),this}where(e){return typeof e=="function"&&(e=e(new Proxy(this.config.fields,new P({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))),this.config.where=e,this}having(e){return typeof e=="function"&&(e=e(new Proxy(this.config.fields,new P({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))),this.config.having=e,this}groupBy(...e){if(typeof e[0]=="function"){let t=e[0](new Proxy(this.config.fields,new P({sqlAliasedBehavior:"alias",sqlBehavior:"sql"})));this.config.groupBy=Array.isArray(t)?t:[t]}else this.config.groupBy=e;return this}orderBy(...e){if(typeof e[0]=="function"){let t=e[0](new Proxy(this.config.fields,new P({sqlAliasedBehavior:"alias",sqlBehavior:"sql"}))),r=Array.isArray(t)?t:[t];this.config.setOperators.length>0?this.config.setOperators.at(-1).orderBy=r:this.config.orderBy=r}else{let t=e;this.config.setOperators.length>0?this.config.setOperators.at(-1).orderBy=t:this.config.orderBy=t}return this}limit(e){return this.config.setOperators.length>0?this.config.setOperators.at(-1).limit=e:this.config.limit=e,this}offset(e){return this.config.setOperators.length>0?this.config.setOperators.at(-1).offset=e:this.config.offset=e,this}for(e,t={}){return this.config.lockingClause={strength:e,config:t},this}getSQL(){return this.dialect.buildSelectQuery(this.config)}toSQL(){let{typings:e,...t}=this.dialect.sqlToQuery(this.getSQL());return t}as(e){return new Proxy(new K(this.getSQL(),this.config.fields,e),new P({alias:e,sqlAliasedBehavior:"alias",sqlBehavior:"error"}))}getSelectedFields(){return new Proxy(this.config.fields,new P({alias:this.tableName,sqlAliasedBehavior:"alias",sqlBehavior:"error"}))}$dynamic(){return this}};Cn=o,a(gt,Cn,"PgSelectQueryBuilder");var qn,Ie=class extends gt{_prepare(e){let{session:t,config:r,dialect:s,joinsNotNullableMap:l}=this;if(!t)throw new Error("Cannot execute a query on a query builder. Please use a database instance instead.");return Ae.startActiveSpan("drizzle.prepareQuery",()=>{let u=ge(r.fields),m=t.prepareQuery(s.sqlToQuery(this.getSQL()),u,e,!0);return m.joinsNotNullableMap=l,m})}prepare(e){return this._prepare(e)}execute=e=>Ae.startActiveSpan("drizzle.operation",()=>this._prepare().execute(e))};qn=o,a(Ie,qn,"PgSelect");bi(Ie,[Qe]);function we(i,e){return(t,r,...s)=>{let l=[r,...s].map(u=>({type:i,isAll:e,rightSelect:u}));for(let u of l)if(!kt(t.getSelectedFields(),u.rightSelect.getSelectedFields()))throw new Error("Set operator error (union / intersect / except): selected fields are not the same or are in a different order");return t.addSetOperators(l)}}var wn=()=>({union:bn,unionAll:Sn,intersect:$n,intersectAll:Nn,except:xn,exceptAll:Tn}),bn=we("union",!1),Sn=we("union",!0),$n=we("intersect",!1),Nn=we("intersect",!0),xn=we("except",!1),Tn=we("except",!0);var On,be=class{dialect;$with(e){let t=this;return{as(r){return typeof r=="function"&&(r=r(t)),new Proxy(new ze(r.getSQL(),r.getSelectedFields(),e,!0),new P({alias:e,sqlAliasedBehavior:"alias",sqlBehavior:"error"}))}}}with(...e){let t=this;function r(u){return new Y({fields:u??void 0,session:void 0,dialect:t.getDialect(),withList:e})}function s(u){return new Y({fields:u??void 0,session:void 0,dialect:t.getDialect(),distinct:!0})}function l(u,m){return new Y({fields:m??void 0,session:void 0,dialect:t.getDialect(),distinct:{on:u}})}return{select:r,selectDistinct:s,selectDistinctOn:l}}select(e){return new Y({fields:e??void 0,session:void 0,dialect:this.getDialect()})}selectDistinct(e){return new Y({fields:e??void 0,session:void 0,dialect:this.getDialect(),distinct:!0})}selectDistinctOn(e,t){return new Y({fields:t??void 0,session:void 0,dialect:this.getDialect(),distinct:{on:e}})}getDialect(){return this.dialect||(this.dialect=new _e),this.dialect}};On=o,a(be,On,"PgQueryBuilder");var Pn,yt=class{constructor(e,t){this.unique=e,this.name=t}on(...e){return new Se(e.map(t=>{if(c(t,h))return t;t=t;let r=new ee(t.name,t.columnType,t.indexConfig);return t.indexConfig=JSON.parse(JSON.stringify(t.defaultConfig)),r}),this.unique,!1,this.name)}onOnly(...e){return new Se(e.map(t=>{if(c(t,h))return t;t=t;let r=new ee(t.name,t.columnType,t.indexConfig);return t.indexConfig=t.defaultConfig,r}),this.unique,!0,this.name)}using(e,...t){return new Se(t.map(r=>{if(c(r,h))return r;r=r;let s=new ee(r.name,r.columnType,r.indexConfig);return r.indexConfig=JSON.parse(JSON.stringify(r.defaultConfig)),s}),this.unique,!0,this.name,e)}};Pn=o,a(yt,Pn,"PgIndexBuilderOn");var jn,Se=class{config;constructor(e,t,r,s,l="btree"){this.config={name:s,columns:e,unique:t,only:r,method:l}}concurrently(){return this.config.concurrently=!0,this}with(e){return this.config.with=e,this}where(e){return this.config.where=e,this}build(e){return new wt(this.config,e)}};jn=o,a(Se,jn,"PgIndexBuilder");var zn,wt=class{config;constructor(e,t){this.config={...e,table:t}}};zn=o,a(wt,zn,"PgIndex");function Ri(i){return new yt(!1,i)}var si=Symbol.for("drizzle:PgViewConfig");var An,Ue=class{constructor(e,t){this.name=e,this.schema=t}config={};with(e){return this.config.with=e,this}};An=o,a(Ue,An,"PgDefaultViewBuilderCore");var Kn,bt=class extends Ue{as(e){typeof e=="function"&&(e=e(new be));let t=new P({alias:this.name,sqlBehavior:"error",sqlAliasedBehavior:"alias",replaceOriginalName:!0}),r=new Proxy(e.getSelectedFields(),t);return new Proxy(new $e({pgConfig:this.config,config:{name:this.name,schema:this.schema,selectedFields:r,query:e.getSQL().inlineParams()}}),t)}};Kn=o,a(bt,Kn,"PgViewBuilder");var Fn,St=class extends Ue{columns;constructor(e,t,r){super(e,r),this.columns=De(zt(e,t))}existing(){return new Proxy(new $e({pgConfig:void 0,config:{name:this.name,schema:this.schema,selectedFields:this.columns,query:void 0}}),new P({alias:this.name,sqlBehavior:"error",sqlAliasedBehavior:"alias",replaceOriginalName:!0}))}as(e){return new Proxy(new $e({pgConfig:this.config,config:{name:this.name,schema:this.schema,selectedFields:this.columns,query:e.inlineParams()}}),new P({alias:this.name,sqlBehavior:"error",sqlAliasedBehavior:"alias",replaceOriginalName:!0}))}};Fn=o,a(St,Fn,"PgManualViewBuilder");var Qn,Re=class{constructor(e,t){this.name=e,this.schema=t}config={};using(e){return this.config.using=e,this}with(e){return this.config.with=e,this}tablespace(e){return this.config.tablespace=e,this}withNoData(){return this.config.withNoData=!0,this}};Qn=o,a(Re,Qn,"PgMaterializedViewBuilderCore");var Dn,$t=class extends Re{as(e){typeof e=="function"&&(e=e(new be));let t=new P({alias:this.name,sqlBehavior:"error",sqlAliasedBehavior:"alias",replaceOriginalName:!0}),r=new Proxy(e.getSelectedFields(),t);return new Proxy(new Ne({pgConfig:{with:this.config.with,using:this.config.using,tablespace:this.config.tablespace,withNoData:this.config.withNoData},config:{name:this.name,schema:this.schema,selectedFields:r,query:e.getSQL().inlineParams()}}),t)}};Dn=o,a($t,Dn,"PgMaterializedViewBuilder");var En,Nt=class extends Re{columns;constructor(e,t,r){super(e,r),this.columns=De(zt(e,t))}existing(){return new Proxy(new Ne({pgConfig:void 0,config:{name:this.name,schema:this.schema,selectedFields:this.columns,query:void 0}}),new P({alias:this.name,sqlBehavior:"error",sqlAliasedBehavior:"alias",replaceOriginalName:!0}))}as(e){return new Proxy(new Ne({pgConfig:void 0,config:{name:this.name,schema:this.schema,selectedFields:this.columns,query:e.inlineParams()}}),new P({alias:this.name,sqlBehavior:"error",sqlAliasedBehavior:"alias",replaceOriginalName:!0}))}};En=o,a(Nt,En,"PgManualMaterializedViewBuilder");var Ln,$e=class extends W{[(Ln=o,si)];constructor({pgConfig:e,config:t}){super(t),e&&(this[si]={with:e.with})}};a($e,Ln,"PgView");var Mi=Symbol.for("drizzle:PgMaterializedViewConfig"),Vn,Ne=class extends W{[(Vn=o,Mi)];constructor({pgConfig:e,config:t}){super(t),this[Mi]={with:e?.with,using:e?.using,tablespace:e?.tablespace,withNoData:e?.withNoData}}};a(Ne,Vn,"PgMaterializedView");function Ji(i,e,t){return e?new St(i,e,t):new bt(i,t)}function Wi(i,e,t){return e?new Nt(i,e,t):new $t(i,t)}var _n,xt=class{constructor(e){this.schemaName=e}table=(e,t,r)=>jt(e,t,r,this.schemaName);view=(e,t)=>Ji(e,t,this.schemaName);materializedView=(e,t)=>Wi(e,t,this.schemaName);enum=(e,t)=>hi(e,t,this.schemaName)};_n=o,a(xt,_n,"PgSchema");function Yi(i){if(i==="public")throw new Error("You can't specify 'public' as schema name. Postgres is using public schema by default. If you want to use 'public' schema, just use pgTable() instead of creating a schema");return new xt(i)}var Bn=Yi(process.env.SCHEMA_POSTGRES||"").table("post_estate",{id:Gt("id").default(n`gen_random_uuid()`).primaryKey(),title:Z("title",{length:255}).notNull(),slug:Z("slug",{length:255}).notNull(),code:Z("code",{length:255}).notNull(),address:Z("title",{length:255}),street:Z("street",{length:255}),lat:at("lat").default(0),lang:at("lang").default(0),type:k("type").notNull().default(0),youtubeUrl:Yt("youtube_url"),point:at("point").notNull(),provinceCode:k("province_code").notNull(),districtCode:k("district_code").notNull(),wardCode:k("ward_code").notNull(),customerId:Gt("customer_id").notNull(),noteVerified:Yt("note_verified"),isBlock:k("is_block").notNull().default(0),isDelete:k("is_delete").notNull().default(0),isOwner:k("is_owner").notNull().default(0),createdBy:Z("created_by",{length:255}),createdAt:Xt("created_at").notNull().default(n`now()`),modifyBy:Z("modify_by",{length:255}),modifyAt:Xt("modify_at").notNull().default(n`now()`).$onUpdate(()=>new Date)},i=>({idxPostEstateNameSlugId:Ri("post_estate_name_slug_id_idx").on(i.title,i.slug,i.id)}));0&&(module.exports={postEstateModel});
//# sourceMappingURL=postEstate.model.js.map
