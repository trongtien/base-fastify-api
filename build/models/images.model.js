"use strict";var He=Object.defineProperty;var ki=Object.getOwnPropertyDescriptor;var Gi=Object.getOwnPropertyNames;var Xi=Object.prototype.hasOwnProperty;var Zi=(i,e,t)=>e in i?He(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t;var er=(i,e)=>{for(var t in e)He(i,t,{get:e[t],enumerable:!0})},tr=(i,e,t,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let s of Gi(e))!Xi.call(i,s)&&s!==t&&He(i,s,{get:()=>e[s],enumerable:!(r=ki(e,s))||r.enumerable});return i};var ir=i=>tr(He({},"__esModule",{value:!0}),i);var a=(i,e,t)=>(Zi(i,typeof e!="symbol"?e+"":e,t),t);var Un={};er(Un,{imageModel:()=>In});module.exports=ir(Un);var o=Symbol.for("drizzle:entityKind"),Mn=Symbol.for("drizzle:hasOwnEntityKind");function c(i,e){if(!i||typeof i!="object")return!1;if(i instanceof e)return!0;if(!Object.prototype.hasOwnProperty.call(e,o))throw new Error(`Class "${e.name??"<unknown>"}" doesn't look like a Drizzle entity. If this is incorrect and the class is provided by Drizzle, please report this as a bug.`);let t=i.constructor;if(t)for(;t;){if(o in t&&t[o]===e[o])return!0;t=Object.getPrototypeOf(t)}return!1}var rr,N=class{constructor(e,t){this.table=e,this.config=t,this.name=t.name,this.notNull=t.notNull,this.default=t.default,this.defaultFn=t.defaultFn,this.onUpdateFn=t.onUpdateFn,this.hasDefault=t.hasDefault,this.primary=t.primaryKey,this.isUnique=t.isUnique,this.uniqueName=t.uniqueName,this.uniqueType=t.uniqueType,this.dataType=t.dataType,this.columnType=t.columnType}name;primary;notNull;default;defaultFn;onUpdateFn;hasDefault;isUnique;uniqueName;uniqueType;dataType;columnType;enumValues=void 0;config;mapFromDriverValue(e){return e}mapToDriverValue(e){return e}};rr=o,a(N,rr,"Column");var nr,Ae=class{config;constructor(e,t,r){this.config={name:e,notNull:!1,default:void 0,hasDefault:!1,primaryKey:!1,isUnique:!1,uniqueName:void 0,uniqueType:void 0,dataType:t,columnType:r}}$type(){return this}notNull(){return this.config.notNull=!0,this}default(e){return this.config.default=e,this.config.hasDefault=!0,this}$defaultFn(e){return this.config.defaultFn=e,this.config.hasDefault=!0,this}$default=this.$defaultFn;$onUpdateFn(e){return this.config.onUpdateFn=e,this.config.hasDefault=!0,this}$onUpdate=this.$onUpdateFn;primaryKey(){return this.config.primaryKey=!0,this.config.notNull=!0,this}};nr=o,a(Ae,nr,"ColumnBuilder");var Ye=Symbol.for("drizzle:Name"),jt=Symbol.for("drizzle:Schema"),li=Symbol.for("drizzle:Columns"),ui=Symbol.for("drizzle:ExtraConfigColumns"),At=Symbol.for("drizzle:OriginalName"),zt=Symbol.for("drizzle:BaseName"),ci=Symbol.for("drizzle:IsAlias"),fi=Symbol.for("drizzle:ExtraConfigBuilder"),sr=Symbol.for("drizzle:IsDrizzleTable"),or,p=class{[(or=o,Ye)];[At];[jt];[li];[ui];[zt];[ci]=!1;[fi]=void 0;[sr]=!0;constructor(e,t,r){this[Ye]=this[At]=e,this[jt]=t,this[zt]=r}};a(p,or,"Table"),a(p,"Symbol",{Name:Ye,Schema:jt,OriginalName:At,Columns:li,ExtraConfigColumns:ui,BaseName:zt,IsAlias:ci,ExtraConfigBuilder:fi});function ne(i){return i[Ye]}var Kt=Symbol.for("drizzle:PgInlineForeignKeys"),ar,Q=class extends p{[(ar=o,Kt)]=[];[p.Symbol.ExtraConfigBuilder]=void 0};a(Q,ar,"PgTable"),a(Q,"Symbol",Object.assign({},p.Symbol,{InlineForeignKeys:Kt}));function Dt(i,e,t,r,s=i){let l=new Q(i,r,s),u=Object.fromEntries(Object.entries(e).map(([f,y])=>{let w=y,S=w.build(l);return l[Kt].push(...w.buildForeignKeys(S,l)),[f,S]})),m=Object.fromEntries(Object.entries(e).map(([f,y])=>{let S=y.buildExtraConfigColumn(l);return[f,S]})),d=Object.assign(l,u);return d[p.Symbol.Columns]=u,d[p.Symbol.ExtraConfigColumns]=m,t&&(d[Q.Symbol.ExtraConfigBuilder]=t),d}var Et=(i,e,t)=>Dt(i,e,t,void 0);var lr,ze=class{reference;_onUpdate="no action";_onDelete="no action";constructor(e,t){this.reference=()=>{let{name:r,columns:s,foreignColumns:l}=e();return{name:r,columns:s,foreignTable:l[0].table,foreignColumns:l}},t&&(this._onUpdate=t.onUpdate,this._onDelete=t.onDelete)}onUpdate(e){return this._onUpdate=e===void 0?"no action":e,this}onDelete(e){return this._onDelete=e===void 0?"no action":e,this}build(e){return new ke(e,this)}};lr=o,a(ze,lr,"PgForeignKeyBuilder");var ur,ke=class{constructor(e,t){this.table=e,this.reference=t.reference,this.onUpdate=t._onUpdate,this.onDelete=t._onDelete}reference;onUpdate;onDelete;getName(){let{name:e,columns:t,foreignColumns:r}=this.reference(),s=t.map(m=>m.name),l=r.map(m=>m.name),u=[this.table[Q.Symbol.Name],...s,r[0].table[Q.Symbol.Name],...l];return e??`${u.join("_")}_fk`}};ur=o,a(ke,ur,"PgForeignKey");function Ge(i,...e){return i(...e)}function Qt(i,e){return`${i[Q.Symbol.Name]}_${e.join("_")}_unique`}var cr,Xe=class{constructor(e,t){this.name=t,this.columns=e}columns;nullsNotDistinctConfig=!1;nullsNotDistinct(){return this.nullsNotDistinctConfig=!0,this}build(e){return new Ze(e,this.columns,this.nullsNotDistinctConfig,this.name)}};cr=o,a(Xe,cr,"PgUniqueConstraintBuilder");var fr,Ft=class{name;constructor(e){this.name=e}on(...e){return new Xe(e,this.name)}};fr=o,a(Ft,fr,"PgUniqueOnConstraintBuilder");var mr,Ze=class{constructor(e,t,r,s){this.table=e,this.columns=t,this.name=s??Qt(this.table,this.columns.map(l=>l.name)),this.nullsNotDistinct=r}columns;name;nullsNotDistinct=!1;getName(){return this.name}};mr=o,a(Ze,mr,"PgUniqueConstraint");function mi(i,e,t){for(let r=e;r<i.length;r++){let s=i[r];if(s==="\\"){r++;continue}if(s==='"')return[i.slice(e,r).replace(/\\/g,""),r+1];if(!t&&(s===","||s==="}"))return[i.slice(e,r).replace(/\\/g,""),r]}return[i.slice(e).replace(/\\/g,""),i.length]}function di(i,e=0){let t=[],r=e,s=!1;for(;r<i.length;){let l=i[r];if(l===","){(s||r===e)&&t.push(""),s=!0,r++;continue}if(s=!1,l==="\\"){r+=2;continue}if(l==='"'){let[d,f]=mi(i,r+1,!0);t.push(d),r=f;continue}if(l==="}")return[t,r+1];if(l==="{"){let[d,f]=di(i,r+1);t.push(d),r=f;continue}let[u,m]=mi(i,r,!1);t.push(u),r=m}return[t,r]}function hi(i){let[e]=di(i,1);return e}function Lt(i){return`{${i.map(e=>Array.isArray(e)?Lt(e):typeof e=="string"?`"${e.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}"`:`${e}`).join(",")}}`}var dr,x=class extends Ae{foreignKeyConfigs=[];array(e){return new tt(this.config.name,this,e)}references(e,t={}){return this.foreignKeyConfigs.push({ref:e,actions:t}),this}unique(e,t){return this.config.isUnique=!0,this.config.uniqueName=e,this.config.uniqueType=t?.nulls,this}buildForeignKeys(e,t){return this.foreignKeyConfigs.map(({ref:r,actions:s})=>Ge((l,u)=>{let m=new ze(()=>{let d=l();return{columns:[e],foreignColumns:[d]}});return u.onUpdate&&m.onUpdate(u.onUpdate),u.onDelete&&m.onDelete(u.onDelete),m.build(t)},r,s))}buildExtraConfigColumn(e){return new et(e,this.config)}};dr=o,a(x,dr,"PgColumnBuilder");var hr,g=class extends N{constructor(e,t){t.uniqueName||(t.uniqueName=Qt(e,[t.name])),super(e,t),this.table=e}};hr=o,a(g,hr,"PgColumn");var pr,et=class extends g{getSQLType(){return this.getSQLType()}indexConfig={order:this.config.order??"asc",nulls:this.config.nulls??"last",opClass:this.config.opClass};defaultConfig={order:"asc",nulls:"last",opClass:void 0};asc(){return this.indexConfig.order="asc",this}desc(){return this.indexConfig.order="desc",this}nullsFirst(){return this.indexConfig.nulls="first",this}nullsLast(){return this.indexConfig.nulls="last",this}op(e){return this.indexConfig.opClass=e,this}};pr=o,a(et,pr,"ExtraConfigColumn");var yr,ee=class{constructor(e,t,r){this.name=e,this.type=t,this.indexConfig=r}name;type;indexConfig};yr=o,a(ee,yr,"IndexedColumn");var gr,tt=class extends x{constructor(e,t,r){super(e,"array","PgArray"),this.config.baseBuilder=t,this.config.size=r}build(e){let t=this.config.baseBuilder.build(e);return new it(e,this.config,t)}};gr=o,a(tt,gr,"PgArrayBuilder");var wr,_t=class extends g{constructor(e,t,r,s){super(e,t),this.baseColumn=r,this.range=s,this.size=t.size}size;getSQLType(){return`${this.baseColumn.getSQLType()}[${typeof this.size=="number"?this.size:""}]`}mapFromDriverValue(e){return typeof e=="string"&&(e=hi(e)),e.map(t=>this.baseColumn.mapFromDriverValue(t))}mapToDriverValue(e,t=!1){let r=e.map(s=>s===null?null:c(this.baseColumn,_t)?this.baseColumn.mapToDriverValue(s,!0):this.baseColumn.mapToDriverValue(s));return t?r:Lt(r)}},it=_t;wr=o,a(it,wr,"PgArray");var Vt=Symbol.for("drizzle:isPgEnum");function pi(i){return!!i&&typeof i=="function"&&Vt in i&&i[Vt]===!0}var br,rt=class extends x{constructor(e,t){super(e,"string","PgEnumColumn"),this.config.enum=t}build(e){return new nt(e,this.config)}};br=o,a(rt,br,"PgEnumColumnBuilder");var Sr,nt=class extends g{enum=this.config.enum;enumValues=this.config.enum.enumValues;constructor(e,t){super(e,t),this.enum=t.enum}getSQLType(){return this.enum.enumName}};Sr=o,a(nt,Sr,"PgEnumColumn");function yi(i,e,t){let r=Object.assign(s=>new rt(s,r),{enumName:i,enumValues:e,schema:t,[Vt]:!0});return r}var $r,K=class{constructor(e,t,r,s=!1){this._={brand:"Subquery",sql:e,selectedFields:t,alias:r,isWith:s}}};$r=o,a(K,$r,"Subquery");var Nr,Ke=class extends K{};Nr=o,a(Ke,Nr,"WithSubquery");var gi="0.31.2";var Bt,It,De={startActiveSpan(i,e){return Bt?(It||(It=Bt.trace.getTracer("drizzle-orm",gi)),Ge((t,r)=>r.startActiveSpan(i,s=>{try{return e(s)}catch(l){throw s.setStatus({code:t.SpanStatusCode.ERROR,message:l instanceof Error?l.message:"Unknown error"}),l}finally{s.end()}}),Bt,It)):e()}};var T=Symbol.for("drizzle:ViewBaseConfig");var Tr,Ut=class{};Tr=o,a(Ut,Tr,"FakePrimitiveParam");function Rt(i){return i!=null&&typeof i.getSQL=="function"}function xr(i){let e={sql:"",params:[]};for(let t of i)e.sql+=t.sql,e.params.push(...t.params),t.typings?.length&&(e.typings||(e.typings=[]),e.typings.push(...t.typings));return e}var vr,q=class{value;constructor(e){this.value=Array.isArray(e)?e:[e]}getSQL(){return new h([this])}};vr=o,a(q,vr,"StringChunk");var Cr,se=class{constructor(e){this.queryChunks=e}decoder=bi;shouldInlineParams=!1;append(e){return this.queryChunks.push(...e.queryChunks),this}toQuery(e){return De.startActiveSpan("drizzle.buildSQL",t=>{let r=this.buildQueryFromSourceParams(this.queryChunks,e);return t?.setAttributes({"drizzle.query.text":r.sql,"drizzle.query.params":JSON.stringify(r.params)}),r})}buildQueryFromSourceParams(e,t){let r=Object.assign({},t,{inlineParams:t.inlineParams||this.shouldInlineParams,paramStartIndex:t.paramStartIndex||{value:0}}),{escapeName:s,escapeParam:l,prepareTyping:u,inlineParams:m,paramStartIndex:d}=r;return xr(e.map(f=>{if(c(f,q))return{sql:f.value.join(""),params:[]};if(c(f,oe))return{sql:s(f.value),params:[]};if(f===void 0)return{sql:"",params:[]};if(Array.isArray(f)){let y=[new q("(")];for(let[w,S]of f.entries())y.push(S),w<f.length-1&&y.push(new q(", "));return y.push(new q(")")),this.buildQueryFromSourceParams(y,r)}if(c(f,se))return this.buildQueryFromSourceParams(f.queryChunks,{...r,inlineParams:m||f.shouldInlineParams});if(c(f,p)){let y=f[p.Symbol.Schema],w=f[p.Symbol.Name];return{sql:y===void 0?s(w):s(y)+"."+s(w),params:[]}}if(c(f,N))return t.invokeSource==="indexes"?{sql:s(f.name),params:[]}:{sql:s(f.table[p.Symbol.Name])+"."+s(f.name),params:[]};if(c(f,_)){let y=f[T].schema,w=f[T].name;return{sql:y===void 0?s(w):s(y)+"."+s(w),params:[]}}if(c(f,M)){let y=f.value===null?null:f.encoder.mapToDriverValue(f.value);if(c(y,se))return this.buildQueryFromSourceParams([y],r);if(m)return{sql:this.mapInlineParam(y,r),params:[]};let w;return u!==void 0&&(w=[u(f.encoder)]),{sql:l(d.value++,y),params:[y],typings:w}}return c(f,te)?{sql:l(d.value++,f),params:[f]}:c(f,se.Aliased)&&f.fieldAlias!==void 0?{sql:s(f.fieldAlias),params:[]}:c(f,K)?f._.isWith?{sql:s(f._.alias),params:[]}:this.buildQueryFromSourceParams([new q("("),f._.sql,new q(") "),new oe(f._.alias)],r):pi(f)?f.schema?{sql:s(f.schema)+"."+s(f.enumName),params:[]}:{sql:s(f.enumName),params:[]}:Rt(f)?this.buildQueryFromSourceParams([new q("("),f.getSQL(),new q(")")],r):m?{sql:this.mapInlineParam(f,r),params:[]}:{sql:l(d.value++,f),params:[f]}}))}mapInlineParam(e,{escapeString:t}){if(e===null)return"null";if(typeof e=="number"||typeof e=="boolean")return e.toString();if(typeof e=="string")return t(e);if(typeof e=="object"){let r=e.toString();return t(r==="[object Object]"?JSON.stringify(e):r)}throw new Error("Unexpected param value: "+e)}getSQL(){return this}as(e){return e===void 0?this:new se.Aliased(this,e)}mapWith(e){return this.decoder=typeof e=="function"?{mapFromDriverValue:e}:e,this}inlineParams(){return this.shouldInlineParams=!0,this}if(e){return e?this:void 0}},h=se;Cr=o,a(h,Cr,"SQL");var qr,oe=class{constructor(e){this.value=e}brand;getSQL(){return new h([this])}};qr=o,a(oe,qr,"Name");function wi(i){return typeof i=="object"&&i!==null&&"mapToDriverValue"in i&&typeof i.mapToDriverValue=="function"}var bi={mapFromDriverValue:i=>i},Si={mapToDriverValue:i=>i},Rs={...bi,...Si},Or,M=class{constructor(e,t=Si){this.value=e,this.encoder=t}brand;getSQL(){return new h([this])}};Or=o,a(M,Or,"Param");function n(i,...e){let t=[];(e.length>0||i.length>0&&i[0]!=="")&&t.push(new q(i[0]));for(let[r,s]of e.entries())t.push(s,new q(i[r+1]));return new h(t)}(i=>{function e(){return new h([])}i.empty=e;function t(d){return new h(d)}i.fromList=t;function r(d){return new h([new q(d)])}i.raw=r;function s(d,f){let y=[];for(let[w,S]of d.entries())w>0&&f!==void 0&&y.push(f),y.push(S);return new h(y)}i.join=s;function l(d){return new oe(d)}i.identifier=l;function u(d){return new te(d)}i.placeholder=u;function m(d,f){return new M(d,f)}i.param=m})(n||(n={}));(i=>{class e{constructor(r,s){this.sql=r,this.fieldAlias=s}static[o]="SQL.Aliased";isSelectionField=!1;getSQL(){return this.sql}clone(){return new e(this.sql,this.fieldAlias)}}i.Aliased=e})(h||(h={}));var Pr,te=class{constructor(e){this.name=e}getSQL(){return new h([this])}};Pr=o,a(te,Pr,"Placeholder");var jr,_=class{[(jr=o,T)];constructor({name:e,schema:t,selectedFields:r,query:s}){this[T]={name:e,originalName:e,schema:t,selectedFields:r,query:s,isExisting:!s,isAlias:!1}}getSQL(){return new h([this])}};a(_,jr,"View");N.prototype.getSQL=function(){return new h([this])};p.prototype.getSQL=function(){return new h([this])};K.prototype.getSQL=function(){return new h([this])};var Ar,Z=class{constructor(e){this.table=e}get(e,t){return t==="table"?this.table:e[t]}};Ar=o,a(Z,Ar,"ColumnAliasProxyHandler");var zr,ie=class{constructor(e,t){this.alias=e,this.replaceOriginalName=t}get(e,t){if(t===p.Symbol.IsAlias)return!0;if(t===p.Symbol.Name)return this.alias;if(this.replaceOriginalName&&t===p.Symbol.OriginalName)return this.alias;if(t===T)return{...e[T],name:this.alias,isAlias:!0};if(t===p.Symbol.Columns){let s=e[p.Symbol.Columns];if(!s)return s;let l={};return Object.keys(s).map(u=>{l[u]=new Proxy(s[u],new Z(new Proxy(e,this)))}),l}let r=e[t];return c(r,N)?new Proxy(r,new Z(new Proxy(e,this))):r}};zr=o,a(ie,zr,"TableAliasProxyHandler");var Kr,Mt=class{constructor(e){this.alias=e}get(e,t){return t==="sourceTable"?Ee(e.sourceTable,this.alias):e[t]}};Kr=o,a(Mt,Kr,"RelationTableAliasProxyHandler");function Ee(i,e){return new Proxy(i,new ie(e,!1))}function H(i,e){return new Proxy(i,new Z(new Proxy(i.table,new ie(e,!1))))}function Jt(i,e){return new h.Aliased(Fe(i.sql,e),i.fieldAlias)}function Fe(i,e){return n.join(i.queryChunks.map(t=>c(t,N)?H(t,e):c(t,h)?Fe(t,e):c(t,h.Aliased)?Jt(t,e):t))}var Dr,J=class extends x{defaultNow(){return this.default(n`now()`)}};Dr=o,a(J,Dr,"PgDateColumnBaseBuilder");var Er,Wt=class extends J{constructor(e){super(e,"date","PgDate")}build(e){return new ae(e,this.config)}};Er=o,a(Wt,Er,"PgDateBuilder");var Fr,ae=class extends g{getSQLType(){return"date"}mapFromDriverValue(e){return new Date(e)}mapToDriverValue(e){return e.toISOString()}};Fr=o,a(ae,Fr,"PgDate");var Qr,Ht=class extends J{constructor(e){super(e,"string","PgDateString")}build(e){return new le(e,this.config)}};Qr=o,a(Ht,Qr,"PgDateStringBuilder");var Lr,le=class extends g{getSQLType(){return"date"}};Lr=o,a(le,Lr,"PgDateString");var _r,st=class extends x{constructor(e){super(e,"number","PgInteger")}build(e){return new ot(e,this.config)}};_r=o,a(st,_r,"PgIntegerBuilder");var Vr,ot=class extends g{getSQLType(){return"integer"}mapFromDriverValue(e){return typeof e=="string"?Number.parseInt(e):e}};Vr=o,a(ot,Vr,"PgInteger");function B(i){return new st(i)}var Br,Yt=class extends x{constructor(e){super(e,"json","PgJson")}build(e){return new ue(e,this.config)}};Br=o,a(Yt,Br,"PgJsonBuilder");var Ir,ue=class extends g{constructor(e,t){super(e,t)}getSQLType(){return"json"}mapToDriverValue(e){return JSON.stringify(e)}mapFromDriverValue(e){if(typeof e=="string")try{return JSON.parse(e)}catch{return e}return e}};Ir=o,a(ue,Ir,"PgJson");var Ur,kt=class extends x{constructor(e){super(e,"json","PgJsonb")}build(e){return new ce(e,this.config)}};Ur=o,a(kt,Ur,"PgJsonbBuilder");var Rr,ce=class extends g{constructor(e,t){super(e,t)}getSQLType(){return"jsonb"}mapToDriverValue(e){return JSON.stringify(e)}mapFromDriverValue(e){if(typeof e=="string")try{return JSON.parse(e)}catch{return e}return e}};Rr=o,a(ce,Rr,"PgJsonb");var Mr,Gt=class extends x{constructor(e,t,r){super(e,"string","PgNumeric"),this.config.precision=t,this.config.scale=r}build(e){return new fe(e,this.config)}};Mr=o,a(Gt,Mr,"PgNumericBuilder");var Jr,fe=class extends g{precision;scale;constructor(e,t){super(e,t),this.precision=t.precision,this.scale=t.scale}getSQLType(){return this.precision!==void 0&&this.scale!==void 0?`numeric(${this.precision}, ${this.scale})`:this.precision===void 0?"numeric":`numeric(${this.precision})`}};Jr=o,a(fe,Jr,"PgNumeric");var Wr,at=class extends x{constructor(e,t){super(e,"number","PgReal"),this.config.length=t}build(e){return new lt(e,this.config)}};Wr=o,a(at,Wr,"PgRealBuilder");var Hr,lt=class extends g{constructor(e,t){super(e,t)}getSQLType(){return"real"}mapFromDriverValue=e=>typeof e=="string"?Number.parseFloat(e):e};Hr=o,a(lt,Hr,"PgReal");function ut(i){return new at(i)}var Yr,ct=class extends x{constructor(e,t){super(e,"string","PgText"),this.config.enumValues=t.enum}build(e){return new ft(e,this.config)}};Yr=o,a(ct,Yr,"PgTextBuilder");var kr,ft=class extends g{enumValues=this.config.enumValues;getSQLType(){return"text"}};kr=o,a(ft,kr,"PgText");function Xt(i,e={}){return new ct(i,e)}var Gr,Zt=class extends J{constructor(e,t,r){super(e,"string","PgTime"),this.withTimezone=t,this.precision=r,this.config.withTimezone=t,this.config.precision=r}build(e){return new me(e,this.config)}};Gr=o,a(Zt,Gr,"PgTimeBuilder");var Xr,me=class extends g{withTimezone;precision;constructor(e,t){super(e,t),this.withTimezone=t.withTimezone,this.precision=t.precision}getSQLType(){return`time${this.precision===void 0?"":`(${this.precision})`}${this.withTimezone?" with time zone":""}`}};Xr=o,a(me,Xr,"PgTime");var Zr,mt=class extends J{constructor(e,t,r){super(e,"date","PgTimestamp"),this.config.withTimezone=t,this.config.precision=r}build(e){return new de(e,this.config)}};Zr=o,a(mt,Zr,"PgTimestampBuilder");var en,de=class extends g{withTimezone;precision;constructor(e,t){super(e,t),this.withTimezone=t.withTimezone,this.precision=t.precision}getSQLType(){return`timestamp${this.precision===void 0?"":` (${this.precision})`}${this.withTimezone?" with time zone":""}`}mapFromDriverValue=e=>new Date(this.withTimezone?e:e+"+0000");mapToDriverValue=e=>e.toISOString()};en=o,a(de,en,"PgTimestamp");var tn,dt=class extends J{constructor(e,t,r){super(e,"string","PgTimestampString"),this.config.withTimezone=t,this.config.precision=r}build(e){return new he(e,this.config)}};tn=o,a(dt,tn,"PgTimestampStringBuilder");var rn,he=class extends g{withTimezone;precision;constructor(e,t){super(e,t),this.withTimezone=t.withTimezone,this.precision=t.precision}getSQLType(){return`timestamp${this.precision===void 0?"":`(${this.precision})`}${this.withTimezone?" with time zone":""}`}};rn=o,a(he,rn,"PgTimestampString");function pe(i,e={}){return e.mode==="string"?new dt(i,e.withTimezone??!1,e.precision):new mt(i,e.withTimezone??!1,e.precision)}var nn,ht=class extends x{constructor(e){super(e,"string","PgUUID")}defaultRandom(){return this.default(n`gen_random_uuid()`)}build(e){return new ye(e,this.config)}};nn=o,a(ht,nn,"PgUUIDBuilder");var sn,ye=class extends g{getSQLType(){return"uuid"}};sn=o,a(ye,sn,"PgUUID");function ge(i){return new ht(i)}var on,pt=class extends x{constructor(e,t){super(e,"string","PgVarchar"),this.config.length=t.length,this.config.enumValues=t.enum}build(e){return new yt(e,this.config)}};on=o,a(pt,on,"PgVarcharBuilder");var an,yt=class extends g{length=this.config.length;enumValues=this.config.enumValues;getSQLType(){return this.length===void 0?"varchar":`varchar(${this.length})`}};an=o,a(yt,an,"PgVarchar");function R(i,e={}){return new pt(i,e)}var ln,Qe=class{[(ln=o,Symbol.toStringTag)]="QueryPromise";catch(e){return this.then(void 0,e)}finally(e){return this.then(t=>(e?.(),t),t=>{throw e?.(),t})}then(e,t){return this.execute().then(e,t)}};a(Qe,ln,"QueryPromise");function we(i,e){return Object.entries(i).reduce((t,[r,s])=>{if(typeof r!="string")return t;let l=e?[...e,r]:[r];return c(s,N)||c(s,h)||c(s,h.Aliased)?t.push({path:l,field:s}):c(s,p)?t.push(...we(s[p.Symbol.Columns],l)):t.push(...we(s,l)),t},[])}function ei(i,e){let t=Object.keys(i),r=Object.keys(e);if(t.length!==r.length)return!1;for(let[s,l]of t.entries())if(l!==r[s])return!1;return!0}function $i(i,e){for(let t of e)for(let r of Object.getOwnPropertyNames(t.prototype))r!=="constructor"&&Object.defineProperty(i.prototype,r,Object.getOwnPropertyDescriptor(t.prototype,r)||Object.create(null))}function Le(i){return i[p.Symbol.Columns]}function ti(i){return c(i,K)?i._.alias:c(i,_)?i[T].name:c(i,h)?void 0:i[p.Symbol.IsAlias]?i[p.Symbol.Name]:i[p.Symbol.BaseName]}var un,be=class extends Error{constructor({message:e,cause:t}){super(e),this.name="DrizzleError",this.cause=t}};un=o,a(be,un,"DrizzleError");var cn,ii=class extends be{constructor(){super({message:"Rollback"})}};cn=o,a(ii,cn,"TransactionRollbackError");function I(i,e){return wi(e)&&!Rt(i)&&!c(i,M)&&!c(i,te)&&!c(i,N)&&!c(i,p)&&!c(i,_)?new M(i,e):i}var gt=(i,e)=>n`${i} = ${I(e,i)}`,Ni=(i,e)=>n`${i} <> ${I(e,i)}`;function _e(...i){let e=i.filter(t=>t!==void 0);if(e.length!==0)return e.length===1?new h(e):new h([new q("("),n.join(e,new q(" and ")),new q(")")])}function xi(...i){let e=i.filter(t=>t!==void 0);if(e.length!==0)return e.length===1?new h(e):new h([new q("("),n.join(e,new q(" or ")),new q(")")])}function Ti(i){return n`not ${i}`}var vi=(i,e)=>n`${i} > ${I(e,i)}`,Ci=(i,e)=>n`${i} >= ${I(e,i)}`,qi=(i,e)=>n`${i} < ${I(e,i)}`,Oi=(i,e)=>n`${i} <= ${I(e,i)}`;function Pi(i,e){if(Array.isArray(e)){if(e.length===0)throw new Error("inArray requires at least one value");return n`${i} in ${e.map(t=>I(t,i))}`}return n`${i} in ${I(e,i)}`}function ji(i,e){if(Array.isArray(e)){if(e.length===0)throw new Error("notInArray requires at least one value");return n`${i} not in ${e.map(t=>I(t,i))}`}return n`${i} not in ${I(e,i)}`}function Ai(i){return n`${i} is null`}function zi(i){return n`${i} is not null`}function Ki(i){return n`exists ${i}`}function Di(i){return n`not exists ${i}`}function Ei(i,e,t){return n`${i} between ${I(e,i)} and ${I(t,i)}`}function Fi(i,e,t){return n`${i} not between ${I(e,i)} and ${I(t,i)}`}function Qi(i,e){return n`${i} like ${e}`}function Li(i,e){return n`${i} not like ${e}`}function _i(i,e){return n`${i} ilike ${e}`}function Vi(i,e){return n`${i} not ilike ${e}`}function Bi(i){return n`${i} asc`}function Ii(i){return n`${i} desc`}var fn,Ve=class{constructor(e,t,r){this.sourceTable=e,this.referencedTable=t,this.relationName=r,this.referencedTableName=t[p.Symbol.Name]}referencedTableName;fieldName};fn=o,a(Ve,fn,"Relation");var mn,ri=class{constructor(e,t){this.table=e,this.config=t}};mn=o,a(ri,mn,"Relations");var dn,ni=class extends Ve{constructor(e,t,r,s){super(e,t,r?.relationName),this.config=r,this.isNullable=s}withFieldName(e){let t=new ni(this.sourceTable,this.referencedTable,this.config,this.isNullable);return t.fieldName=e,t}},re=ni;dn=o,a(re,dn,"One");var hn,si=class extends Ve{constructor(e,t,r){super(e,t,r?.relationName),this.config=r}withFieldName(e){let t=new si(this.sourceTable,this.referencedTable,this.config);return t.fieldName=e,t}},Be=si;hn=o,a(Be,hn,"Many");function Ui(){return{and:_e,between:Ei,eq:gt,exists:Ki,gt:vi,gte:Ci,ilike:_i,inArray:Pi,isNull:Ai,isNotNull:zi,like:Qi,lt:qi,lte:Oi,ne:Ni,not:Ti,notBetween:Fi,notExists:Di,notLike:Li,notIlike:Vi,notInArray:ji,or:xi,sql:n}}function Ri(){return{sql:n,asc:Bi,desc:Ii}}function Mi(i,e,t){if(c(t,re)&&t.config)return{fields:t.config.fields,references:t.config.references};let r=e[t.referencedTable[p.Symbol.Name]];if(!r)throw new Error(`Table "${t.referencedTable[p.Symbol.Name]}" not found in schema`);let s=i[r];if(!s)throw new Error(`Table "${r}" not found in schema`);let l=t.sourceTable,u=e[l[p.Symbol.Name]];if(!u)throw new Error(`Table "${l[p.Symbol.Name]}" not found in schema`);let m=[];for(let d of Object.values(s.relations))(t.relationName&&t!==d&&d.relationName===t.relationName||!t.relationName&&d.referencedTable===t.sourceTable)&&m.push(d);if(m.length>1)throw t.relationName?new Error(`There are multiple relations with name "${t.relationName}" in table "${r}"`):new Error(`There are multiple relations between "${r}" and "${t.sourceTable[p.Symbol.Name]}". Please specify relation name`);if(m[0]&&c(m[0],re)&&m[0].config)return{fields:m[0].config.references,references:m[0].config.fields};throw new Error(`There is not enough information to infer relation "${u}.${t.fieldName}"`)}var pn,Y=class extends _{};pn=o,a(Y,pn,"PgViewBase");var yn,Ie=class{async migrate(e,t,r){let s=typeof r=="string"?"__drizzle_migrations":r.migrationsTable??"__drizzle_migrations",l=typeof r=="string"?"drizzle":r.migrationsSchema??"drizzle",u=n`
			CREATE TABLE IF NOT EXISTS ${n.identifier(l)}.${n.identifier(s)} (
				id SERIAL PRIMARY KEY,
				hash text NOT NULL,
				created_at bigint
			)
		`;await t.execute(n`CREATE SCHEMA IF NOT EXISTS ${n.identifier(l)}`),await t.execute(u);let d=(await t.all(n`select id, hash, created_at from ${n.identifier(l)}.${n.identifier(s)} order by created_at desc limit 1`))[0];await t.transaction(async f=>{for await(let y of e)if(!d||Number(d.created_at)<y.folderMillis){for(let w of y.sql)await f.execute(n.raw(w));await f.execute(n`insert into ${n.identifier(l)}.${n.identifier(s)} ("hash", "created_at") values(${y.hash}, ${y.folderMillis})`)}})}escapeName(e){return`"${e}"`}escapeParam(e){return`$${e+1}`}escapeString(e){return`'${e.replace(/'/g,"''")}'`}buildWithCTE(e){if(!e?.length)return;let t=[n`with `];for(let[r,s]of e.entries())t.push(n`${n.identifier(s._.alias)} as (${s._.sql})`),r<e.length-1&&t.push(n`, `);return t.push(n` `),n.join(t)}buildDeleteQuery({table:e,where:t,returning:r,withList:s}){let l=this.buildWithCTE(s),u=r?n` returning ${this.buildSelection(r,{isSingleTable:!0})}`:void 0,m=t?n` where ${t}`:void 0;return n`${l}delete from ${e}${m}${u}`}buildUpdateSet(e,t){let r=e[p.Symbol.Columns],s=Object.keys(r).filter(u=>t[u]!==void 0||r[u]?.onUpdateFn!==void 0),l=s.length;return n.join(s.flatMap((u,m)=>{let d=r[u],f=t[u]??n.param(d.onUpdateFn(),d),y=n`${n.identifier(d.name)} = ${f}`;return m<l-1?[y,n.raw(", ")]:[y]}))}buildUpdateQuery({table:e,set:t,where:r,returning:s,withList:l}){let u=this.buildWithCTE(l),m=this.buildUpdateSet(e,t),d=s?n` returning ${this.buildSelection(s,{isSingleTable:!0})}`:void 0,f=r?n` where ${r}`:void 0;return n`${u}update ${e} set ${m}${f}${d}`}buildSelection(e,{isSingleTable:t=!1}={}){let r=e.length,s=e.flatMap(({field:l},u)=>{let m=[];if(c(l,h.Aliased)&&l.isSelectionField)m.push(n.identifier(l.fieldAlias));else if(c(l,h.Aliased)||c(l,h)){let d=c(l,h.Aliased)?l.sql:l;t?m.push(new h(d.queryChunks.map(f=>c(f,g)?n.identifier(f.name):f))):m.push(d),c(l,h.Aliased)&&m.push(n` as ${n.identifier(l.fieldAlias)}`)}else c(l,N)&&(t?m.push(n.identifier(l.name)):m.push(l));return u<r-1&&m.push(n`, `),m});return n.join(s)}buildSelectQuery({withList:e,fields:t,fieldsFlat:r,where:s,having:l,table:u,joins:m,orderBy:d,groupBy:f,limit:y,offset:w,lockingClause:S,distinct:L,setOperators:j}){let F=r??we(t);for(let C of F)if(c(C.field,N)&&ne(C.field.table)!==(c(u,K)?u._.alias:c(u,Y)?u[T].name:c(u,h)?void 0:ne(u))&&!(z=>m?.some(({alias:U})=>U===(z[p.Symbol.IsAlias]?ne(z):z[p.Symbol.BaseName])))(C.field.table)){let z=ne(C.field.table);throw new Error(`Your "${C.path.join("->")}" field references a column "${z}"."${C.field.name}", but the table "${z}" is not part of the query! Did you forget to join it?`)}let v=!m||m.length===0,A=this.buildWithCTE(e),D;L&&(D=L===!0?n` distinct`:n` distinct on (${n.join(L.on,n`, `)})`);let E=this.buildSelection(F,{isSingleTable:v}),O=(()=>{if(c(u,p)&&u[p.Symbol.OriginalName]!==u[p.Symbol.Name]){let C=n`${n.identifier(u[p.Symbol.OriginalName])}`;return u[p.Symbol.Schema]&&(C=n`${n.identifier(u[p.Symbol.Schema])}.${C}`),n`${C} ${n.identifier(u[p.Symbol.Name])}`}return u})(),V=[];if(m)for(let[C,z]of m.entries()){C===0&&V.push(n` `);let U=z.table,qe=z.lateral?n` lateral`:void 0;if(c(U,Q)){let Pt=U[Q.Symbol.Name],Oe=U[Q.Symbol.Schema],Pe=U[Q.Symbol.OriginalName],je=Pt===Pe?void 0:z.alias;V.push(n`${n.raw(z.joinType)} join${qe} ${Oe?n`${n.identifier(Oe)}.`:void 0}${n.identifier(Pe)}${je&&n` ${n.identifier(je)}`} on ${z.on}`)}else if(c(U,_)){let Pt=U[T].name,Oe=U[T].schema,Pe=U[T].originalName,je=Pt===Pe?void 0:z.alias;V.push(n`${n.raw(z.joinType)} join${qe} ${Oe?n`${n.identifier(Oe)}.`:void 0}${n.identifier(Pe)}${je&&n` ${n.identifier(je)}`} on ${z.on}`)}else V.push(n`${n.raw(z.joinType)} join${qe} ${U} on ${z.on}`);C<m.length-1&&V.push(n` `)}let G=n.join(V),b=s?n` where ${s}`:void 0,$=l?n` having ${l}`:void 0,W;d&&d.length>0&&(W=n` order by ${n.join(d,n`, `)}`);let ve;f&&f.length>0&&(ve=n` group by ${n.join(f,n`, `)}`);let Ot=y?n` limit ${y}`:void 0,Ce=w?n` offset ${w}`:void 0,X=n.empty();if(S){let C=n` for ${n.raw(S.strength)}`;S.config.of&&C.append(n` of ${n.join(Array.isArray(S.config.of)?S.config.of:[S.config.of],n`, `)}`),S.config.noWait?C.append(n` no wait`):S.config.skipLocked&&C.append(n` skip locked`),X.append(C)}let We=n`${A}select${D} ${E} from ${O}${G}${b}${ve}${$}${W}${Ot}${Ce}${X}`;return j.length>0?this.buildSetOperations(We,j):We}buildSetOperations(e,t){let[r,...s]=t;if(!r)throw new Error("Cannot pass undefined values to any set operator");return s.length===0?this.buildSetOperationQuery({leftSelect:e,setOperator:r}):this.buildSetOperations(this.buildSetOperationQuery({leftSelect:e,setOperator:r}),s)}buildSetOperationQuery({leftSelect:e,setOperator:{type:t,isAll:r,rightSelect:s,limit:l,orderBy:u,offset:m}}){let d=n`(${e.getSQL()}) `,f=n`(${s.getSQL()})`,y;if(u&&u.length>0){let j=[];for(let F of u)if(c(F,g))j.push(n.identifier(F.name));else if(c(F,h)){for(let v=0;v<F.queryChunks.length;v++){let A=F.queryChunks[v];c(A,g)&&(F.queryChunks[v]=n.identifier(A.name))}j.push(n`${F}`)}else j.push(n`${F}`);y=n` order by ${n.join(j,n`, `)} `}let w=l?n` limit ${l}`:void 0,S=n.raw(`${t} ${r?"all ":""}`),L=m?n` offset ${m}`:void 0;return n`${d}${S}${f}${y}${w}${L}`}buildInsertQuery({table:e,values:t,onConflict:r,returning:s,withList:l}){let u=[],m=e[p.Symbol.Columns],d=Object.entries(m),f=d.map(([,j])=>n.identifier(j.name));for(let[j,F]of t.entries()){let v=[];for(let[A,D]of d){let E=F[A];if(E===void 0||c(E,M)&&E.value===void 0)if(D.defaultFn!==void 0){let O=D.defaultFn(),V=c(O,h)?O:n.param(O,D);v.push(V)}else if(!D.default&&D.onUpdateFn!==void 0){let O=D.onUpdateFn(),V=c(O,h)?O:n.param(O,D);v.push(V)}else v.push(n`default`);else v.push(E)}u.push(v),j<t.length-1&&u.push(n`, `)}let y=this.buildWithCTE(l),w=n.join(u),S=s?n` returning ${this.buildSelection(s,{isSingleTable:!0})}`:void 0,L=r?n` on conflict ${r}`:void 0;return n`${y}insert into ${e} ${f} values ${w}${L}${S}`}buildRefreshMaterializedViewQuery({view:e,concurrently:t,withNoData:r}){let s=t?n` concurrently`:void 0,l=r?n` with no data`:void 0;return n`refresh materialized view${s} ${e}${l}`}prepareTyping(e){return c(e,ce)||c(e,ue)?"json":c(e,fe)?"decimal":c(e,me)?"time":c(e,de)||c(e,he)?"timestamp":c(e,ae)||c(e,le)?"date":c(e,ye)?"uuid":"none"}sqlToQuery(e,t){return e.toQuery({escapeName:this.escapeName,escapeParam:this.escapeParam,escapeString:this.escapeString,prepareTyping:this.prepareTyping,invokeSource:t})}buildRelationalQueryWithoutPK({fullSchema:e,schema:t,tableNamesMap:r,table:s,tableConfig:l,queryConfig:u,tableAlias:m,nestedQueryRelation:d,joinOn:f}){let y=[],w,S,L=[],j,F=[];if(u===!0)y=Object.entries(l.columns).map(([D,E])=>({dbKey:E.name,tsKey:D,field:H(E,m),relationTableTsKey:void 0,isJson:!1,selection:[]}));else{let A=Object.fromEntries(Object.entries(l.columns).map(([b,$])=>[b,H($,m)]));if(u.where){let b=typeof u.where=="function"?u.where(A,Ui()):u.where;j=b&&Fe(b,m)}let D=[],E=[];if(u.columns){let b=!1;for(let[$,W]of Object.entries(u.columns))W!==void 0&&$ in l.columns&&(!b&&W===!0&&(b=!0),E.push($));E.length>0&&(E=b?E.filter($=>u.columns?.[$]===!0):Object.keys(l.columns).filter($=>!E.includes($)))}else E=Object.keys(l.columns);for(let b of E){let $=l.columns[b];D.push({tsKey:b,value:$})}let O=[];u.with&&(O=Object.entries(u.with).filter(b=>!!b[1]).map(([b,$])=>({tsKey:b,queryConfig:$,relation:l.relations[b]})));let V;if(u.extras){V=typeof u.extras=="function"?u.extras(A,{sql:n}):u.extras;for(let[b,$]of Object.entries(V))D.push({tsKey:b,value:Jt($,m)})}for(let{tsKey:b,value:$}of D)y.push({dbKey:c($,h.Aliased)?$.fieldAlias:l.columns[b].name,tsKey:b,field:c($,N)?H($,m):$,relationTableTsKey:void 0,isJson:!1,selection:[]});let G=typeof u.orderBy=="function"?u.orderBy(A,Ri()):u.orderBy??[];Array.isArray(G)||(G=[G]),L=G.map(b=>c(b,N)?H(b,m):Fe(b,m)),w=u.limit,S=u.offset;for(let{tsKey:b,queryConfig:$,relation:W}of O){let ve=Mi(t,r,W),Ot=W.referencedTable[p.Symbol.Name],Ce=r[Ot],X=`${m}_${b}`,We=_e(...ve.fields.map((U,qe)=>gt(H(ve.references[qe],X),H(U,m)))),C=this.buildRelationalQueryWithoutPK({fullSchema:e,schema:t,tableNamesMap:r,table:e[Ce],tableConfig:t[Ce],queryConfig:c(W,re)?$===!0?{limit:1}:{...$,limit:1}:$,tableAlias:X,joinOn:We,nestedQueryRelation:W}),z=n`${n.identifier(X)}.${n.identifier("data")}`.as(b);F.push({on:n`true`,table:new K(C.sql,{},X),alias:X,joinType:"left",lateral:!0}),y.push({dbKey:b,tsKey:b,field:z,relationTableTsKey:Ce,isJson:!0,selection:C.selection})}}if(y.length===0)throw new be({message:`No fields selected for table "${l.tsName}" ("${m}")`});let v;if(j=_e(f,j),d){let A=n`json_build_array(${n.join(y.map(({field:O,tsKey:V,isJson:G})=>G?n`${n.identifier(`${m}_${V}`)}.${n.identifier("data")}`:c(O,h.Aliased)?O.sql:O),n`, `)})`;c(d,Be)&&(A=n`coalesce(json_agg(${A}${L.length>0?n` order by ${n.join(L,n`, `)}`:void 0}), '[]'::json)`);let D=[{dbKey:"data",tsKey:"data",field:A.as("data"),isJson:!0,relationTableTsKey:l.tsName,selection:y}];w!==void 0||S!==void 0||L.length>0?(v=this.buildSelectQuery({table:Ee(s,m),fields:{},fieldsFlat:[{path:[],field:n.raw("*")}],where:j,limit:w,offset:S,orderBy:L,setOperators:[]}),j=void 0,w=void 0,S=void 0,L=[]):v=Ee(s,m),v=this.buildSelectQuery({table:c(v,Q)?v:new K(v,{},m),fields:{},fieldsFlat:D.map(({field:O})=>({path:[],field:c(O,N)?H(O,m):O})),joins:F,where:j,limit:w,offset:S,orderBy:L,setOperators:[]})}else v=this.buildSelectQuery({table:Ee(s,m),fields:{},fieldsFlat:y.map(({field:A})=>({path:[],field:c(A,N)?H(A,m):A})),joins:F,where:j,limit:w,offset:S,orderBy:L,setOperators:[]});return{tableTsKey:l.tsName,sql:v,selection:y}}};yn=o,a(Ie,yn,"PgDialect");var gn,oi=class{config;constructor(e){this.config={...e}}get(e,t){if(t==="_")return{...e._,selectedFields:new Proxy(e._.selectedFields,this)};if(t===T)return{...e[T],selectedFields:new Proxy(e[T].selectedFields,this)};if(typeof t=="symbol")return e[t];let s=(c(e,K)?e._.selectedFields:c(e,_)?e[T].selectedFields:e)[t];if(c(s,h.Aliased)){if(this.config.sqlAliasedBehavior==="sql"&&!s.isSelectionField)return s.sql;let l=s.clone();return l.isSelectionField=!0,l}if(c(s,h)){if(this.config.sqlBehavior==="sql")return s;throw new Error(`You tried to reference "${t}" field from a subquery, which is a raw SQL field, but it doesn't have an alias declared. Please add an alias to the field using ".as('alias')" method.`)}return c(s,N)?this.config.alias?new Proxy(s,new Z(new Proxy(s.table,new ie(this.config.alias,this.config.replaceOriginalName??!1)))):s:typeof s!="object"||s===null?s:new Proxy(s,new oi(this.config))}},P=oi;gn=o,a(P,gn,"SelectionProxyHandler");var wn,Ue=class{getSelectedFields(){return this._.selectedFields}};wn=o,a(Ue,wn,"TypedQueryBuilder");var Cn,k=class{fields;session;dialect;withList=[];distinct;constructor(e){this.fields=e.fields,this.session=e.session,this.dialect=e.dialect,e.withList&&(this.withList=e.withList),this.distinct=e.distinct}from(e){let t=!!this.fields,r;return this.fields?r=this.fields:c(e,K)?r=Object.fromEntries(Object.keys(e._.selectedFields).map(s=>[s,e[s]])):c(e,Y)?r=e[T].selectedFields:c(e,h)?r={}:r=Le(e),new Re({table:e,fields:r,isPartialSelect:t,session:this.session,dialect:this.dialect,withList:this.withList,distinct:this.distinct})}};Cn=o,a(k,Cn,"PgSelectBuilder");var qn,wt=class extends Ue{_;config;joinsNotNullableMap;tableName;isPartialSelect;session;dialect;constructor({table:e,fields:t,isPartialSelect:r,session:s,dialect:l,withList:u,distinct:m}){super(),this.config={withList:u,table:e,fields:{...t},distinct:m,setOperators:[]},this.isPartialSelect=r,this.session=s,this.dialect=l,this._={selectedFields:t},this.tableName=ti(e),this.joinsNotNullableMap=typeof this.tableName=="string"?{[this.tableName]:!0}:{}}createJoin(e){return(t,r)=>{let s=this.tableName,l=ti(t);if(typeof l=="string"&&this.config.joins?.some(u=>u.alias===l))throw new Error(`Alias "${l}" is already used in this query`);if(!this.isPartialSelect&&(Object.keys(this.joinsNotNullableMap).length===1&&typeof s=="string"&&(this.config.fields={[s]:this.config.fields}),typeof l=="string"&&!c(t,h))){let u=c(t,K)?t._.selectedFields:c(t,_)?t[T].selectedFields:t[p.Symbol.Columns];this.config.fields[l]=u}if(typeof r=="function"&&(r=r(new Proxy(this.config.fields,new P({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))),this.config.joins||(this.config.joins=[]),this.config.joins.push({on:r,table:t,joinType:e,alias:l}),typeof l=="string")switch(e){case"left":{this.joinsNotNullableMap[l]=!1;break}case"right":{this.joinsNotNullableMap=Object.fromEntries(Object.entries(this.joinsNotNullableMap).map(([u])=>[u,!1])),this.joinsNotNullableMap[l]=!0;break}case"inner":{this.joinsNotNullableMap[l]=!0;break}case"full":{this.joinsNotNullableMap=Object.fromEntries(Object.entries(this.joinsNotNullableMap).map(([u])=>[u,!1])),this.joinsNotNullableMap[l]=!1;break}}return this}}leftJoin=this.createJoin("left");rightJoin=this.createJoin("right");innerJoin=this.createJoin("inner");fullJoin=this.createJoin("full");createSetOperator(e,t){return r=>{let s=typeof r=="function"?r(bn()):r;if(!ei(this.getSelectedFields(),s.getSelectedFields()))throw new Error("Set operator error (union / intersect / except): selected fields are not the same or are in a different order");return this.config.setOperators.push({type:e,isAll:t,rightSelect:s}),this}}union=this.createSetOperator("union",!1);unionAll=this.createSetOperator("union",!0);intersect=this.createSetOperator("intersect",!1);intersectAll=this.createSetOperator("intersect",!0);except=this.createSetOperator("except",!1);exceptAll=this.createSetOperator("except",!0);addSetOperators(e){return this.config.setOperators.push(...e),this}where(e){return typeof e=="function"&&(e=e(new Proxy(this.config.fields,new P({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))),this.config.where=e,this}having(e){return typeof e=="function"&&(e=e(new Proxy(this.config.fields,new P({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))),this.config.having=e,this}groupBy(...e){if(typeof e[0]=="function"){let t=e[0](new Proxy(this.config.fields,new P({sqlAliasedBehavior:"alias",sqlBehavior:"sql"})));this.config.groupBy=Array.isArray(t)?t:[t]}else this.config.groupBy=e;return this}orderBy(...e){if(typeof e[0]=="function"){let t=e[0](new Proxy(this.config.fields,new P({sqlAliasedBehavior:"alias",sqlBehavior:"sql"}))),r=Array.isArray(t)?t:[t];this.config.setOperators.length>0?this.config.setOperators.at(-1).orderBy=r:this.config.orderBy=r}else{let t=e;this.config.setOperators.length>0?this.config.setOperators.at(-1).orderBy=t:this.config.orderBy=t}return this}limit(e){return this.config.setOperators.length>0?this.config.setOperators.at(-1).limit=e:this.config.limit=e,this}offset(e){return this.config.setOperators.length>0?this.config.setOperators.at(-1).offset=e:this.config.offset=e,this}for(e,t={}){return this.config.lockingClause={strength:e,config:t},this}getSQL(){return this.dialect.buildSelectQuery(this.config)}toSQL(){let{typings:e,...t}=this.dialect.sqlToQuery(this.getSQL());return t}as(e){return new Proxy(new K(this.getSQL(),this.config.fields,e),new P({alias:e,sqlAliasedBehavior:"alias",sqlBehavior:"error"}))}getSelectedFields(){return new Proxy(this.config.fields,new P({alias:this.tableName,sqlAliasedBehavior:"alias",sqlBehavior:"error"}))}$dynamic(){return this}};qn=o,a(wt,qn,"PgSelectQueryBuilder");var On,Re=class extends wt{_prepare(e){let{session:t,config:r,dialect:s,joinsNotNullableMap:l}=this;if(!t)throw new Error("Cannot execute a query on a query builder. Please use a database instance instead.");return De.startActiveSpan("drizzle.prepareQuery",()=>{let u=we(r.fields),m=t.prepareQuery(s.sqlToQuery(this.getSQL()),u,e,!0);return m.joinsNotNullableMap=l,m})}prepare(e){return this._prepare(e)}execute=e=>De.startActiveSpan("drizzle.operation",()=>this._prepare().execute(e))};On=o,a(Re,On,"PgSelect");$i(Re,[Qe]);function Se(i,e){return(t,r,...s)=>{let l=[r,...s].map(u=>({type:i,isAll:e,rightSelect:u}));for(let u of l)if(!ei(t.getSelectedFields(),u.rightSelect.getSelectedFields()))throw new Error("Set operator error (union / intersect / except): selected fields are not the same or are in a different order");return t.addSetOperators(l)}}var bn=()=>({union:Sn,unionAll:$n,intersect:Nn,intersectAll:xn,except:Tn,exceptAll:vn}),Sn=Se("union",!1),$n=Se("union",!0),Nn=Se("intersect",!1),xn=Se("intersect",!0),Tn=Se("except",!1),vn=Se("except",!0);var Pn,$e=class{dialect;$with(e){let t=this;return{as(r){return typeof r=="function"&&(r=r(t)),new Proxy(new Ke(r.getSQL(),r.getSelectedFields(),e,!0),new P({alias:e,sqlAliasedBehavior:"alias",sqlBehavior:"error"}))}}}with(...e){let t=this;function r(u){return new k({fields:u??void 0,session:void 0,dialect:t.getDialect(),withList:e})}function s(u){return new k({fields:u??void 0,session:void 0,dialect:t.getDialect(),distinct:!0})}function l(u,m){return new k({fields:m??void 0,session:void 0,dialect:t.getDialect(),distinct:{on:u}})}return{select:r,selectDistinct:s,selectDistinctOn:l}}select(e){return new k({fields:e??void 0,session:void 0,dialect:this.getDialect()})}selectDistinct(e){return new k({fields:e??void 0,session:void 0,dialect:this.getDialect(),distinct:!0})}selectDistinctOn(e,t){return new k({fields:t??void 0,session:void 0,dialect:this.getDialect(),distinct:{on:e}})}getDialect(){return this.dialect||(this.dialect=new Ie),this.dialect}};Pn=o,a($e,Pn,"PgQueryBuilder");var jn,bt=class{constructor(e,t){this.unique=e,this.name=t}on(...e){return new Ne(e.map(t=>{if(c(t,h))return t;t=t;let r=new ee(t.name,t.columnType,t.indexConfig);return t.indexConfig=JSON.parse(JSON.stringify(t.defaultConfig)),r}),this.unique,!1,this.name)}onOnly(...e){return new Ne(e.map(t=>{if(c(t,h))return t;t=t;let r=new ee(t.name,t.columnType,t.indexConfig);return t.indexConfig=t.defaultConfig,r}),this.unique,!0,this.name)}using(e,...t){return new Ne(t.map(r=>{if(c(r,h))return r;r=r;let s=new ee(r.name,r.columnType,r.indexConfig);return r.indexConfig=JSON.parse(JSON.stringify(r.defaultConfig)),s}),this.unique,!0,this.name,e)}};jn=o,a(bt,jn,"PgIndexBuilderOn");var An,Ne=class{config;constructor(e,t,r,s,l="btree"){this.config={name:s,columns:e,unique:t,only:r,method:l}}concurrently(){return this.config.concurrently=!0,this}with(e){return this.config.with=e,this}where(e){return this.config.where=e,this}build(e){return new St(this.config,e)}};An=o,a(Ne,An,"PgIndexBuilder");var zn,St=class{config;constructor(e,t){this.config={...e,table:t}}};zn=o,a(St,zn,"PgIndex");function $t(i){return new bt(!1,i)}var ai=Symbol.for("drizzle:PgViewConfig");var Kn,Me=class{constructor(e,t){this.name=e,this.schema=t}config={};with(e){return this.config.with=e,this}};Kn=o,a(Me,Kn,"PgDefaultViewBuilderCore");var Dn,Nt=class extends Me{as(e){typeof e=="function"&&(e=e(new $e));let t=new P({alias:this.name,sqlBehavior:"error",sqlAliasedBehavior:"alias",replaceOriginalName:!0}),r=new Proxy(e.getSelectedFields(),t);return new Proxy(new xe({pgConfig:this.config,config:{name:this.name,schema:this.schema,selectedFields:r,query:e.getSQL().inlineParams()}}),t)}};Dn=o,a(Nt,Dn,"PgViewBuilder");var En,xt=class extends Me{columns;constructor(e,t,r){super(e,r),this.columns=Le(Et(e,t))}existing(){return new Proxy(new xe({pgConfig:void 0,config:{name:this.name,schema:this.schema,selectedFields:this.columns,query:void 0}}),new P({alias:this.name,sqlBehavior:"error",sqlAliasedBehavior:"alias",replaceOriginalName:!0}))}as(e){return new Proxy(new xe({pgConfig:this.config,config:{name:this.name,schema:this.schema,selectedFields:this.columns,query:e.inlineParams()}}),new P({alias:this.name,sqlBehavior:"error",sqlAliasedBehavior:"alias",replaceOriginalName:!0}))}};En=o,a(xt,En,"PgManualViewBuilder");var Fn,Je=class{constructor(e,t){this.name=e,this.schema=t}config={};using(e){return this.config.using=e,this}with(e){return this.config.with=e,this}tablespace(e){return this.config.tablespace=e,this}withNoData(){return this.config.withNoData=!0,this}};Fn=o,a(Je,Fn,"PgMaterializedViewBuilderCore");var Qn,Tt=class extends Je{as(e){typeof e=="function"&&(e=e(new $e));let t=new P({alias:this.name,sqlBehavior:"error",sqlAliasedBehavior:"alias",replaceOriginalName:!0}),r=new Proxy(e.getSelectedFields(),t);return new Proxy(new Te({pgConfig:{with:this.config.with,using:this.config.using,tablespace:this.config.tablespace,withNoData:this.config.withNoData},config:{name:this.name,schema:this.schema,selectedFields:r,query:e.getSQL().inlineParams()}}),t)}};Qn=o,a(Tt,Qn,"PgMaterializedViewBuilder");var Ln,vt=class extends Je{columns;constructor(e,t,r){super(e,r),this.columns=Le(Et(e,t))}existing(){return new Proxy(new Te({pgConfig:void 0,config:{name:this.name,schema:this.schema,selectedFields:this.columns,query:void 0}}),new P({alias:this.name,sqlBehavior:"error",sqlAliasedBehavior:"alias",replaceOriginalName:!0}))}as(e){return new Proxy(new Te({pgConfig:void 0,config:{name:this.name,schema:this.schema,selectedFields:this.columns,query:e.inlineParams()}}),new P({alias:this.name,sqlBehavior:"error",sqlAliasedBehavior:"alias",replaceOriginalName:!0}))}};Ln=o,a(vt,Ln,"PgManualMaterializedViewBuilder");var _n,xe=class extends Y{[(_n=o,ai)];constructor({pgConfig:e,config:t}){super(t),e&&(this[ai]={with:e.with})}};a(xe,_n,"PgView");var Ji=Symbol.for("drizzle:PgMaterializedViewConfig"),Vn,Te=class extends Y{[(Vn=o,Ji)];constructor({pgConfig:e,config:t}){super(t),this[Ji]={with:e?.with,using:e?.using,tablespace:e?.tablespace,withNoData:e?.withNoData}}};a(Te,Vn,"PgMaterializedView");function Wi(i,e,t){return e?new xt(i,e,t):new Nt(i,t)}function Hi(i,e,t){return e?new vt(i,e,t):new Tt(i,t)}var Bn,Ct=class{constructor(e){this.schemaName=e}table=(e,t,r)=>Dt(e,t,r,this.schemaName);view=(e,t)=>Wi(e,t,this.schemaName);materializedView=(e,t)=>Hi(e,t,this.schemaName);enum=(e,t)=>yi(e,t,this.schemaName)};Bn=o,a(Ct,Bn,"PgSchema");function qt(i){if(i==="public")throw new Error("You can't specify 'public' as schema name. Postgres is using public schema by default. If you want to use 'public' schema, just use pgTable() instead of creating a schema");return new Ct(i)}var Yi=qt(process.env.SCHEMA_POSTGRES||"").table("post_estate",{id:ge("id").default(n`gen_random_uuid()`).primaryKey(),title:R("title",{length:255}).notNull(),slug:R("slug",{length:255}).notNull(),code:R("code",{length:255}).notNull(),address:R("title",{length:255}),street:R("street",{length:255}),lat:ut("lat").default(0),lang:ut("lang").default(0),type:B("type").notNull().default(0),youtubeUrl:Xt("youtube_url"),point:ut("point").notNull(),provinceCode:B("province_code").notNull(),districtCode:B("district_code").notNull(),wardCode:B("ward_code").notNull(),customerId:ge("customer_id").notNull(),noteVerified:Xt("note_verified"),isBlock:B("is_block").notNull().default(0),isDelete:B("is_delete").notNull().default(0),isOwner:B("is_owner").notNull().default(0),createdBy:R("created_by",{length:255}),createdAt:pe("created_at").notNull().default(n`now()`),modifyBy:R("modify_by",{length:255}),modifyAt:pe("modify_at").notNull().default(n`now()`).$onUpdate(()=>new Date)},i=>({idxPostEstateNameSlugId:$t("post_estate_name_slug_id_idx").on(i.title,i.slug,i.id)}));var In=qt(process.env.SCHEMA_POSTGRES||"").table("images",{id:ge("id").default(n`gen_random_uuid()`).primaryKey(),link:R("link",{length:255}).notNull(),type:B("type").notNull().default(0),position:B("position").default(0),isAvatar:B("is_avatar").notNull().default(0),description:R("description",{length:255}),isUsed:B("is_used").default(0),postEstateId:ge("post_estate_id").references(()=>Yi.id,{onDelete:"cascade",onUpdate:"cascade"}),isConfirmUpdate:B("is_confirm_update").notNull().default(0),createdBy:R("created_by",{length:255}),createdAt:pe("created_at").notNull().default(n`now()`),modifyBy:R("modify_by",{length:255}),modifyAt:pe("modify_at").notNull().default(n`now()`).$onUpdate(()=>new Date)},i=>({idxNameId:$t("image_link_id_idx").on(i.link,i.id)}));0&&(module.exports={imageModel});
//# sourceMappingURL=images.model.js.map
