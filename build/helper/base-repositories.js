"use strict";var v=Object.defineProperty;var qe=Object.getOwnPropertyDescriptor;var Ne=Object.getOwnPropertyNames;var xe=Object.prototype.hasOwnProperty;var Ae=(r,e,t)=>e in r?v(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var Te=(r,e)=>{for(var t in e)v(r,t,{get:e[t],enumerable:!0})},ze=(r,e,t,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let i of Ne(e))!xe.call(r,i)&&i!==t&&v(r,i,{get:()=>e[i],enumerable:!(n=qe(e,i))||n.enumerable});return r};var Pe=r=>ze(v({},"__esModule",{value:!0}),r);var a=(r,e,t)=>(Ae(r,typeof e!="symbol"?e+"":e,t),t);var it={};Te(it,{BaseRepository:()=>oe});module.exports=Pe(it);var o=Symbol.for("drizzle:entityKind"),ot=Symbol.for("drizzle:hasOwnEntityKind");function m(r,e){if(!r||typeof r!="object")return!1;if(r instanceof e)return!0;if(!Object.prototype.hasOwnProperty.call(e,o))throw new Error(`Class "${e.name??"<unknown>"}" doesn't look like a Drizzle entity. If this is incorrect and the class is provided by Drizzle, please report this as a bug.`);let t=r.constructor;if(t)for(;t;){if(o in t&&t[o]===e[o])return!0;t=Object.getPrototypeOf(t)}return!1}var De,w=class{constructor(e,t){this.table=e,this.config=t,this.name=t.name,this.notNull=t.notNull,this.default=t.default,this.defaultFn=t.defaultFn,this.onUpdateFn=t.onUpdateFn,this.hasDefault=t.hasDefault,this.primary=t.primaryKey,this.isUnique=t.isUnique,this.uniqueName=t.uniqueName,this.uniqueType=t.uniqueType,this.dataType=t.dataType,this.columnType=t.columnType}name;primary;notNull;default;defaultFn;onUpdateFn;hasDefault;isUnique;uniqueName;uniqueType;dataType;columnType;enumValues=void 0;config;mapFromDriverValue(e){return e}mapToDriverValue(e){return e}};De=o,a(w,De,"Column");var Qe,P=class{config;constructor(e,t,n){this.config={name:e,notNull:!1,default:void 0,hasDefault:!1,primaryKey:!1,isUnique:!1,uniqueName:void 0,uniqueType:void 0,dataType:t,columnType:n}}$type(){return this}notNull(){return this.config.notNull=!0,this}default(e){return this.config.default=e,this.config.hasDefault=!0,this}$defaultFn(e){return this.config.defaultFn=e,this.config.hasDefault=!0,this}$default=this.$defaultFn;$onUpdateFn(e){return this.config.onUpdateFn=e,this.config.hasDefault=!0,this}$onUpdate=this.$onUpdateFn;primaryKey(){return this.config.primaryKey=!0,this.config.notNull=!0,this}};Qe=o,a(P,Qe,"ColumnBuilder");var M=Symbol.for("drizzle:Name"),R=Symbol.for("drizzle:Schema"),ae=Symbol.for("drizzle:Columns"),ue=Symbol.for("drizzle:ExtraConfigColumns"),W=Symbol.for("drizzle:OriginalName"),_=Symbol.for("drizzle:BaseName"),le=Symbol.for("drizzle:IsAlias"),ce=Symbol.for("drizzle:ExtraConfigBuilder"),ve=Symbol.for("drizzle:IsDrizzleTable"),Ee,y=class{[(Ee=o,M)];[W];[R];[ae];[ue];[_];[le]=!1;[ce]=void 0;[ve]=!0;constructor(e,t,n){this[M]=this[W]=e,this[R]=t,this[_]=n}};a(y,Ee,"Table"),a(y,"Symbol",{Name:M,Schema:R,OriginalName:W,Columns:ae,ExtraConfigColumns:ue,BaseName:_,IsAlias:le,ExtraConfigBuilder:ce});var fe=Symbol.for("drizzle:PgInlineForeignKeys"),Oe,$=class extends y{[(Oe=o,fe)]=[];[y.Symbol.ExtraConfigBuilder]=void 0};a($,Oe,"PgTable"),a($,"Symbol",Object.assign({},y.Symbol,{InlineForeignKeys:fe}));var Fe,D=class{reference;_onUpdate="no action";_onDelete="no action";constructor(e,t){this.reference=()=>{let{name:n,columns:i,foreignColumns:u}=e();return{name:n,columns:i,foreignTable:u[0].table,foreignColumns:u}},t&&(this._onUpdate=t.onUpdate,this._onDelete=t.onDelete)}onUpdate(e){return this._onUpdate=e===void 0?"no action":e,this}onDelete(e){return this._onDelete=e===void 0?"no action":e,this}build(e){return new E(e,this)}};Fe=o,a(D,Fe,"PgForeignKeyBuilder");var Ie,E=class{constructor(e,t){this.table=e,this.reference=t.reference,this.onUpdate=t._onUpdate,this.onDelete=t._onDelete}reference;onUpdate;onDelete;getName(){let{name:e,columns:t,foreignColumns:n}=this.reference(),i=t.map(p=>p.name),u=n.map(p=>p.name),h=[this.table[$.Symbol.Name],...i,n[0].table[$.Symbol.Name],...u];return e??`${h.join("_")}_fk`}};Ie=o,a(E,Ie,"PgForeignKey");function O(r,...e){return r(...e)}function G(r,e){return`${r[$.Symbol.Name]}_${e.join("_")}_unique`}var Le,F=class{constructor(e,t){this.name=t,this.columns=e}columns;nullsNotDistinctConfig=!1;nullsNotDistinct(){return this.nullsNotDistinctConfig=!0,this}build(e){return new I(e,this.columns,this.nullsNotDistinctConfig,this.name)}};Le=o,a(F,Le,"PgUniqueConstraintBuilder");var je,J=class{name;constructor(e){this.name=e}on(...e){return new F(e,this.name)}};je=o,a(J,je,"PgUniqueOnConstraintBuilder");var Ve,I=class{constructor(e,t,n,i){this.table=e,this.columns=t,this.name=i??G(this.table,this.columns.map(u=>u.name)),this.nullsNotDistinct=n}columns;name;nullsNotDistinct=!1;getName(){return this.name}};Ve=o,a(I,Ve,"PgUniqueConstraint");function me(r,e,t){for(let n=e;n<r.length;n++){let i=r[n];if(i==="\\"){n++;continue}if(i==='"')return[r.slice(e,n).replace(/\\/g,""),n+1];if(!t&&(i===","||i==="}"))return[r.slice(e,n).replace(/\\/g,""),n]}return[r.slice(e).replace(/\\/g,""),r.length]}function pe(r,e=0){let t=[],n=e,i=!1;for(;n<r.length;){let u=r[n];if(u===","){(i||n===e)&&t.push(""),i=!0,n++;continue}if(i=!1,u==="\\"){n+=2;continue}if(u==='"'){let[l,s]=me(r,n+1,!0);t.push(l),n=s;continue}if(u==="}")return[t,n+1];if(u==="{"){let[l,s]=pe(r,n+1);t.push(l),n=s;continue}let[h,p]=me(r,n,!1);t.push(h),n=p}return[t,n]}function de(r){let[e]=pe(r,1);return e}function H(r){return`{${r.map(e=>Array.isArray(e)?H(e):typeof e=="string"?`"${e.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}"`:`${e}`).join(",")}}`}var Ke,x=class extends P{foreignKeyConfigs=[];array(e){return new j(this.config.name,this,e)}references(e,t={}){return this.foreignKeyConfigs.push({ref:e,actions:t}),this}unique(e,t){return this.config.isUnique=!0,this.config.uniqueName=e,this.config.uniqueType=t?.nulls,this}buildForeignKeys(e,t){return this.foreignKeyConfigs.map(({ref:n,actions:i})=>O((u,h)=>{let p=new D(()=>{let l=u();return{columns:[e],foreignColumns:[l]}});return h.onUpdate&&p.onUpdate(h.onUpdate),h.onDelete&&p.onDelete(h.onDelete),p.build(t)},n,i))}buildExtraConfigColumn(e){return new L(e,this.config)}};Ke=o,a(x,Ke,"PgColumnBuilder");var Ue,C=class extends w{constructor(e,t){t.uniqueName||(t.uniqueName=G(e,[t.name])),super(e,t),this.table=e}};Ue=o,a(C,Ue,"PgColumn");var Be,L=class extends C{getSQLType(){return this.getSQLType()}indexConfig={order:this.config.order??"asc",nulls:this.config.nulls??"last",opClass:this.config.opClass};defaultConfig={order:"asc",nulls:"last",opClass:void 0};asc(){return this.indexConfig.order="asc",this}desc(){return this.indexConfig.order="desc",this}nullsFirst(){return this.indexConfig.nulls="first",this}nullsLast(){return this.indexConfig.nulls="last",this}op(e){return this.indexConfig.opClass=e,this}};Be=o,a(L,Be,"ExtraConfigColumn");var Me,X=class{constructor(e,t,n){this.name=e,this.type=t,this.indexConfig=n}name;type;indexConfig};Me=o,a(X,Me,"IndexedColumn");var Re,j=class extends x{constructor(e,t,n){super(e,"array","PgArray"),this.config.baseBuilder=t,this.config.size=n}build(e){let t=this.config.baseBuilder.build(e);return new V(e,this.config,t)}};Re=o,a(j,Re,"PgArrayBuilder");var We,Y=class extends C{constructor(e,t,n,i){super(e,t),this.baseColumn=n,this.range=i,this.size=t.size}size;getSQLType(){return`${this.baseColumn.getSQLType()}[${typeof this.size=="number"?this.size:""}]`}mapFromDriverValue(e){return typeof e=="string"&&(e=de(e)),e.map(t=>this.baseColumn.mapFromDriverValue(t))}mapToDriverValue(e,t=!1){let n=e.map(i=>i===null?null:m(this.baseColumn,Y)?this.baseColumn.mapToDriverValue(i,!0):this.baseColumn.mapToDriverValue(i));return t?n:H(n)}},V=Y;We=o,a(V,We,"PgArray");var he=Symbol.for("drizzle:isPgEnum");function ye(r){return!!r&&typeof r=="function"&&he in r&&r[he]===!0}var _e,Z=class extends x{constructor(e,t){super(e,"string","PgEnumColumn"),this.config.enum=t}build(e){return new K(e,this.config)}};_e=o,a(Z,_e,"PgEnumColumnBuilder");var Je,K=class extends C{enum=this.config.enum;enumValues=this.config.enum.enumValues;constructor(e,t){super(e,t),this.enum=t.enum}getSQLType(){return this.enum.enumName}};Je=o,a(K,Je,"PgEnumColumn");var Ge,q=class{constructor(e,t,n,i=!1){this._={brand:"Subquery",sql:e,selectedFields:t,alias:n,isWith:i}}};Ge=o,a(q,Ge,"Subquery");var He,k=class extends q{};He=o,a(k,He,"WithSubquery");var ge="0.31.2";var ee,te,be={startActiveSpan(r,e){return ee?(te||(te=ee.trace.getTracer("drizzle-orm",ge)),O((t,n)=>n.startActiveSpan(r,i=>{try{return e(i)}catch(u){throw i.setStatus({code:t.SpanStatusCode.ERROR,message:u instanceof Error?u.message:"Unknown error"}),u}finally{i.end()}}),ee,te)):e()}};var Q=Symbol.for("drizzle:ViewBaseConfig");var Ye,re=class{};Ye=o,a(re,Ye,"FakePrimitiveParam");function ne(r){return r!=null&&typeof r.getSQL=="function"}function Xe(r){let e={sql:"",params:[]};for(let t of r)e.sql+=t.sql,e.params.push(...t.params),t.typings?.length&&(e.typings||(e.typings=[]),e.typings.push(...t.typings));return e}var Ze,d=class{value;constructor(e){this.value=Array.isArray(e)?e:[e]}getSQL(){return new f([this])}};Ze=o,a(d,Ze,"StringChunk");var ke,A=class{constructor(e){this.queryChunks=e}decoder=$e;shouldInlineParams=!1;append(e){return this.queryChunks.push(...e.queryChunks),this}toQuery(e){return be.startActiveSpan("drizzle.buildSQL",t=>{let n=this.buildQueryFromSourceParams(this.queryChunks,e);return t?.setAttributes({"drizzle.query.text":n.sql,"drizzle.query.params":JSON.stringify(n.params)}),n})}buildQueryFromSourceParams(e,t){let n=Object.assign({},t,{inlineParams:t.inlineParams||this.shouldInlineParams,paramStartIndex:t.paramStartIndex||{value:0}}),{escapeName:i,escapeParam:u,prepareTyping:h,inlineParams:p,paramStartIndex:l}=n;return Xe(e.map(s=>{if(m(s,d))return{sql:s.value.join(""),params:[]};if(m(s,T))return{sql:i(s.value),params:[]};if(s===void 0)return{sql:"",params:[]};if(Array.isArray(s)){let c=[new d("(")];for(let[g,B]of s.entries())c.push(B),g<s.length-1&&c.push(new d(", "));return c.push(new d(")")),this.buildQueryFromSourceParams(c,n)}if(m(s,A))return this.buildQueryFromSourceParams(s.queryChunks,{...n,inlineParams:p||s.shouldInlineParams});if(m(s,y)){let c=s[y.Symbol.Schema],g=s[y.Symbol.Name];return{sql:c===void 0?i(g):i(c)+"."+i(g),params:[]}}if(m(s,w))return t.invokeSource==="indexes"?{sql:i(s.name),params:[]}:{sql:i(s.table[y.Symbol.Name])+"."+i(s.name),params:[]};if(m(s,z)){let c=s[Q].schema,g=s[Q].name;return{sql:c===void 0?i(g):i(c)+"."+i(g),params:[]}}if(m(s,S)){let c=s.value===null?null:s.encoder.mapToDriverValue(s.value);if(m(c,A))return this.buildQueryFromSourceParams([c],n);if(p)return{sql:this.mapInlineParam(c,n),params:[]};let g;return h!==void 0&&(g=[h(s.encoder)]),{sql:u(l.value++,c),params:[c],typings:g}}return m(s,N)?{sql:u(l.value++,s),params:[s]}:m(s,A.Aliased)&&s.fieldAlias!==void 0?{sql:i(s.fieldAlias),params:[]}:m(s,q)?s._.isWith?{sql:i(s._.alias),params:[]}:this.buildQueryFromSourceParams([new d("("),s._.sql,new d(") "),new T(s._.alias)],n):ye(s)?s.schema?{sql:i(s.schema)+"."+i(s.enumName),params:[]}:{sql:i(s.enumName),params:[]}:ne(s)?this.buildQueryFromSourceParams([new d("("),s.getSQL(),new d(")")],n):p?{sql:this.mapInlineParam(s,n),params:[]}:{sql:u(l.value++,s),params:[s]}}))}mapInlineParam(e,{escapeString:t}){if(e===null)return"null";if(typeof e=="number"||typeof e=="boolean")return e.toString();if(typeof e=="string")return t(e);if(typeof e=="object"){let n=e.toString();return t(n==="[object Object]"?JSON.stringify(e):n)}throw new Error("Unexpected param value: "+e)}getSQL(){return this}as(e){return e===void 0?this:new A.Aliased(this,e)}mapWith(e){return this.decoder=typeof e=="function"?{mapFromDriverValue:e}:e,this}inlineParams(){return this.shouldInlineParams=!0,this}if(e){return e?this:void 0}},f=A;ke=o,a(f,ke,"SQL");var et,T=class{constructor(e){this.value=e}brand;getSQL(){return new f([this])}};et=o,a(T,et,"Name");function we(r){return typeof r=="object"&&r!==null&&"mapToDriverValue"in r&&typeof r.mapToDriverValue=="function"}var $e={mapFromDriverValue:r=>r},Se={mapToDriverValue:r=>r},sr={...$e,...Se},tt,S=class{constructor(e,t=Se){this.value=e,this.encoder=t}brand;getSQL(){return new f([this])}};tt=o,a(S,tt,"Param");function b(r,...e){let t=[];(e.length>0||r.length>0&&r[0]!=="")&&t.push(new d(r[0]));for(let[n,i]of e.entries())t.push(i,new d(r[n+1]));return new f(t)}(r=>{function e(){return new f([])}r.empty=e;function t(l){return new f(l)}r.fromList=t;function n(l){return new f([new d(l)])}r.raw=n;function i(l,s){let c=[];for(let[g,B]of l.entries())g>0&&s!==void 0&&c.push(s),c.push(B);return new f(c)}r.join=i;function u(l){return new T(l)}r.identifier=u;function h(l){return new N(l)}r.placeholder=h;function p(l,s){return new S(l,s)}r.param=p})(b||(b={}));(r=>{class e{constructor(n,i){this.sql=n,this.fieldAlias=i}static[o]="SQL.Aliased";isSelectionField=!1;getSQL(){return this.sql}clone(){return new e(this.sql,this.fieldAlias)}}r.Aliased=e})(f||(f={}));var rt,N=class{constructor(e){this.name=e}getSQL(){return new f([this])}};rt=o,a(N,rt,"Placeholder");var nt,z=class{[(nt=o,Q)];constructor({name:e,schema:t,selectedFields:n,query:i}){this[Q]={name:e,originalName:e,schema:t,selectedFields:n,query:i,isExisting:!i,isAlias:!1}}getSQL(){return new f([this])}};a(z,nt,"View");w.prototype.getSQL=function(){return new f([this])};y.prototype.getSQL=function(){return new f([this])};q.prototype.getSQL=function(){return new f([this])};function ie(r,e){return we(e)&&!ne(r)&&!m(r,S)&&!m(r,N)&&!m(r,w)&&!m(r,y)&&!m(r,z)?new S(r,e):r}var U=(r,e)=>b`${r} = ${ie(e,r)}`;function se(...r){let e=r.filter(t=>t!==void 0);if(e.length!==0)return e.length===1?new f(e):new f([new d("("),b.join(e,new d(" and ")),new d(")")])}function Ce(r,e){if(Array.isArray(e)){if(e.length===0)throw new Error("inArray requires at least one value");return b`${r} in ${e.map(t=>ie(t,r))}`}return b`${r} in ${ie(e,r)}`}var oe=class{constructor(e){this.db=e}transformArrayToObject(e){return Array.isArray(e)?e?.[0]??null:e||null}async insert(e,t){let n=await this.db.insert(e).values({...t}).returning();return this.transformArrayToObject(n)}async insertMany(e,t){return await this.db.insert(e).values([...t]).returning(),!0}async update(e,t){let n=await this.db.update(e).set({...t}).returning();return this.transformArrayToObject(n)}async updateMany(e,t){for(let n of t)await this.update(e,n);return!0}async deleteById(e,t){let i=Array.isArray(t)?Ce(e.id,t):U(e.id,t);return await this.db.delete(e).where(i),!0}async deleteByKey(e,t){let n=[];for(let i in t)t[i]!==void 0&&t[i]!==null&&n.push(U(e[i],t[i]));return await this.db.delete(e).where(se(b.join(n))),!0}async findByKey(e,t){let n=[];for(let u in t)t[u]!==void 0&&t[u]!==null&&n.push(U(e[u],t[u]));let i=await this.db.select().from(e).where(se(b.join(n))).limit(1);return this.transformArrayToObject(i)}async pagination(e,t,n){let i=e.as("sub"),h=await this.db.select({total:b`count(*)`}).from(i).execute(),p=Number(h[0].total),l=Math.ceil(p/n),s=(t-1)*n;return e.limit(n).offset(s),{data:await e.execute(),pagination:{totalRecords:p,totalPages:l,currentPage:t,limit:n}}}};0&&(module.exports={BaseRepository});
//# sourceMappingURL=base-repositories.js.map
